!function(){"use strict";function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],0<=excluded.indexOf(key)||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],0<=excluded.indexOf(key)||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=function(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||function(arr,i){if(!(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _construct(Parent,args,Class){return(_construct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||_iterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function wrapControllerParams(controller){var newController=controller;if("function"==typeof controller){var $inject=["$element","$compile","$scope"].concat(_toConsumableArray(controller.$inject||[]));if(3<$inject.length&&!controller.length)throw new Error("Wrong code style!");(newController=function($element,$compile,$scope){var _this=this,onError=function(){return $element.addClass("_internal-error"),_this};try{for(var _len2=arguments.length,args=new Array(3<_len2?_len2-3:0),_key2=3;_key2<_len2;_key2++)args[_key2-3]=arguments[_key2];var instance=_construct(controller,args),originalPostLink=instance.$postLink;return $element.addClass($element.prop("tagName").toLowerCase().replace(/^w-/,"")),originalPostLink&&(instance.$postLink=function(){try{for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return originalPostLink.apply(instance,args)}catch(e){return onError()}}),instance}catch(e){return onError()}}).$inject=$inject}return newController}var origin,factory,controller,rc,wOtc,directive,_password,_rounds,_libs$crypto2,encryptSeed,decryptSeed,base58Encode,base58Decode,base64Encode,blake2b,stringToBytes,buildAddress,buildPublicKey,sharedKey,messageEncrypt,_users,MultiAccount,clipboard,ClipboardService,MAX_HEIGHT_COLLAPSED,MAX_HEIGHT_OPENED,NewsItemCtrl,Row;angular.module("app.ui",[]),origin=angular.module,angular.module=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var name=args[0],module=origin.call.apply(origin,[angular].concat(args));return-1===WavesApp.modules.indexOf(name)&&(WavesApp.modules.push(name),function(module){var origin=module.controller;module.controller=function(name,$ctrl){if("function"!=typeof $ctrl)throw new Error("Wrong code style!");return WavesApp.addController(name,$ctrl),origin.call(this,name,wrapControllerParams($ctrl))}}(module),function(module){var origin=module.component;module.component=function(name,$component){return $component.controller=wrapControllerParams($component.controller),origin.call(this,name,$component)}}(module),function(module){var origin=module.directive;module.directive=function(name,$directive){return $directive.controller=wrapControllerParams($directive.controller),origin.call(this,name,$directive)}}(module)),module},angular.module("app",["react","ngAnimate","ngMaterial","ui.router","ui.router.state.events","app.templates","app.utils","app.ui","app.welcome","app.prediction","app.staking","app.signUp","app.signIn","app.migrate","app.switch","app.create","app.restore","app.saveSeed","app.desktop","app.ledger","app.keeper","app.fromBackup","app.import","app.migration","app.wallet","app.dex","app.tokens","app.unavailable","app.stand","app.faq","app.stakingFaq","app.news","app.chooseUser","app.investments","app.buyBTC","app.buyBTCFaq","app.wallet.leasing","app.nsbt","app.buyWaves","app.buyWAVESFaq","app.leverage","app.nsbtFaq","app.leasingFaq","app.page404","app.otc","app.otcFaq","app.buyUsdn","app.buyUSDNFaq","app.otc","app.marketMaking","app.defo","app.defoFaq","app.defoStakingFaq","app.swapWavesUsdn","app.defoInvestment","app.defoInvestmentFaq"]),angular.module("app.dex",[]),angular.module("app.faq",[]),angular.module("app.otc",[]),angular.module("app.defo",[]),angular.module("app.news",[]),angular.module("app.nsbt",[]),angular.module("app.stand",[]),angular.module("app.utils",[]),angular.module("app.buyBTC",[]),angular.module("app.create",[]),angular.module("app.import",[]),angular.module("app.keeper",[]),angular.module("app.ledger",[]),angular.module("app.otcFaq",[]),angular.module("app.signIn",[]),angular.module("app.signUp",[]),angular.module("app.switch",[]),angular.module("app.tokens",[]),angular.module("app.wallet",["app.wallet.assets","app.wallet.portfolio","app.wallet.transactions","app.wallet.leasing"]),angular.module("app.buyUsdn",[]),angular.module("app.defoFaq",[]),angular.module("app.desktop",[]),angular.module("app.migrate",[]),angular.module("app.nsbtFaq",[]),angular.module("app.page404",[]),angular.module("app.restore",[]),angular.module("app.staking",[]),angular.module("app.welcome",[]),function(){var _isValidAddress=require("@waves/signature-adapter").isValidAddress,tsUtils=require("ts-utils"),Money=require("@waves/data-entities").Money,_require3=require("ramda"),map=_require3.map,prop=_require3.prop,pipe=_require3.pipe,filter=_require3.filter,isNil=_require3.isNil,equals=_require3.equals,values=_require3.values,any=_require3.any,isEmpty=_require3.isEmpty,ds=require("data-service"),analytics=ds.analytics,factory=function(storage,$state,defaultSettings,state,UserRouteState,Poll,timeLine,utils,themes,multiAccount,$injector,configService){var User=function(){function User(){var _this2=this;_classCallCheck(this,User),this.loginSignal=new tsUtils.Signal,this.logoutSignal=new tsUtils.Signal,this.clickStakeNowSignal=new tsUtils.Signal,this.networkError=void 0,this.currentUser=null,this.extraFee=void 0,this.changeScript=void 0,this.setScamSignal=void 0,this.setTokensNameSignal=new tsUtils.Signal,this.scam=void 0,this.tokensName=Object.create(null),this.highlightReferralLink=!1,this._settings=void 0,this.debugMode=!1,this.__props=void 0,this._changeTimer=void 0,this._stateList=void 0,this._history=void 0,this._hasScript=void 0,this._scriptInfoPoll=void 0,this._scriptInfoPollTimeoutId=void 0,this._uiId=void 0,this._sawStakingAdv=!1,this._achievements={migration:{}},this._buyOptions={},this._resetFields(),Mousetrap.bind(["ctrl+shift+k"],function(){return _this2.switchNextTheme()}),Mousetrap.bind("i d k f a",function(){$injector.get("modalManager").showWalletDebugModal()}),this.loginSignal.on(function(){storage.load("uiId").then(function(uiId){window.intercomSettings.name=_this2.name,window.intercomSettings.user_id=uiId?"".concat(uiId,"_").concat(_this2.address.slice(-4)):window.intercomSettings.user_id,window.Intercom&&window.Intercom.enabled&&window.Intercom("update",{user_id:window.intercomSettings.user_id})})}),this._getUserMigrationAchievement=this._getUserMigrationAchievement.bind(this);var apiTokenService=ds.utils.ApiTokenService.getInstance();apiTokenService.addSignatureProvider(utils.signToken),apiTokenService.addErrorCb(function(){$state.go("chooseUser")}),apiTokenService.changeToken.on(function(data){_this2.address===data.address&&(_this2.currentUser.apiTokenWavesExchange=data.tokenData,_this2.saveMultiAccountUser(_this2.currentUser,_this2.currentUser.hash))})}var _updateScriptAccountData;return _createClass(User,[{key:"sawStakingAdv",get:function(){return this._sawStakingAdv},set:function(value){this._sawStakingAdv=value}}]),_createClass(User,[{key:"setScam",value:function(hash){equals(hash,this.scam)||(this.scam=hash,this.setScamSignal.dispatch())}},{key:"setTokensNameList",value:function(hash){equals(hash,this.tokensName)||(this.tokensName=hash,this.setTokensNameSignal.dispatch())}},{key:"hasScript",value:function(){return this._hasScript}},{key:"getSetting",value:function(name){return this._settings.get(name)}},{key:"togglePinAsset",value:function(assetId,state){this.toggleArrayUserSetting("pinnedAssetIdList",assetId,state),this.hasInArrayUserSetting("pinnedAssetIdList",assetId)&&this.toggleSpamAsset(assetId,!1)}},{key:"toggleSpamAsset",value:function(assetId,state){this.toggleArrayUserSetting("wallet.portfolio.spam",assetId,state),this.hasInArrayUserSetting("wallet.portfolio.spam",assetId)&&this.togglePinAsset(assetId,!1)}},{key:"toggleArrayUserSetting",value:function(path,value,state){var list=this.getSetting(path),index=list.indexOf(value);if((state=tsUtils.isEmpty(state)?-1===index:state)&&-1===index){var newList=list.slice();return newList.push(value),this.setSetting(path,newList),null}if(!state&&-1!==index){var _newList=list.slice();return _newList.splice(index,1),this.setSetting(path,_newList),null}}},{key:"hasInArrayUserSetting",value:function(path,value){return this.getSetting(path).includes(value)}},{key:"getDefaultUserSettings",value:function(settings){var common=this._settings.getSettings().common;return defaultSettings.create(_objectSpread({},settings),_objectSpread({},common))}},{key:"getSettingsByUser",value:function(user){return this.getDefaultUserSettings(user.settings)}},{key:"setSetting",value:function(name,value){this._settings.set(name,value)}},{key:"getMultiAccountData",value:function(){return storage.load("multiAccountData")}},{key:"getMultiAccountHash",value:function(){return storage.load("multiAccountHash")}},{key:"getMultiAccountUsers",value:function(){var _this3=this;return storage.load("multiAccountUsers").then(function(users){return multiAccount.toList(users).filter(function(user){return _this3.isValidAddress(user.address)})})}},{key:"saveMultiAccount",value:function(data){return Promise.all([storage.save("multiAccountData",data.multiAccountData),storage.save("multiAccountHash",data.multiAccountHash)])}},{key:"migrateUser",value:function(userToMigrate,userHash){var _this4=this;return this.saveMultiAccountUser(userToMigrate,userHash).then(function(){return _this4.removeUserByAddress(userToMigrate.address)})}},{key:"saveMultiAccountUser",value:function(user,userHash){var _this5=this;return user.settings&&(user.settings=_objectSpread({},user.settings,{encryptionRounds:void 0})),storage.load("multiAccountUsers").then(function(users){return _this5.saveMultiAccountUsers(_objectSpread({},users,_defineProperty({},userHash,{name:user.name,settings:user.settings,apiTokenWavesExchange:user.apiTokenWavesExchange,lastLogin:user.lastLogin})))})}},{key:"deleteMultiAccountUser",value:function(userHash){var _this6=this;return Promise.all([multiAccount.deleteUser(userHash),storage.load("multiAccountUsers")]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),data=_ref2[0],users=_ref2[1];return delete users[userHash],Promise.all([_this6.saveMultiAccountUsers(users),_this6.saveMultiAccount(data)])})}},{key:"saveMultiAccountUsers",value:function(users){return storage.save("multiAccountUsers",users)}},{key:"setMultiAccountSettings",value:function(commonSettings){this._settings.setCommonSettings(commonSettings)}},{key:"getMultiAccountSettings",value:function(){return storage.load("multiAccountSettings")}},{key:"saveMultiAccountSettings",value:function(settings){return storage.save("multiAccountSettings",settings)}},{key:"onLogin",value:function(){var _this7=this;return this.isAuthorised?Promise.resolve():new Promise(function(resolve,reject){_this7.loginSignal.once(resolve),_this7.logoutSignal.once(reject)})}},{key:"initScriptInfoPolling",value:function(){var _this8=this;clearTimeout(this._scriptInfoPollTimeoutId),this._scriptInfoPollTimeoutId=setTimeout(function(){_this8._scriptInfoPoll&&_this8._scriptInfoPoll.destroy(),_this8._scriptInfoPoll=new Poll(function(){return _this8.updateScriptAccountData()},function(){return null},1e4)},3e4)}},{key:"login",value:function(userData){var _this9=this;return this.networkError=!1,this._getUsersMigrationAchievements(),this._addUserData(userData).then(function(){_this9.initScriptInfoPolling(),analytics.send({name:"Sign In Success"})})}},{key:"setUiId",value:function(){var _this10=this;return storage.load("uiId").then(function(localId){return localId?ds.uiId.mapUiId(localId).then(function(_ref3){var uid=_ref3.uid;return _this10._saveUiId(uid)}):ds.uiId.getUiId().then(function(_ref4){var uid=_ref4.uid;return _this10._saveUiId(uid)})}).catch(function(){return Promise.resolve()})}},{key:"goToActiveState",value:function(fallbackStateName){if(this.initRouteState){var _this$initRouteState=this.initRouteState,_name=_this$initRouteState.name,_params=_this$initRouteState.params;this.fromInitState=this.initRouteState,$state.go(_name,_params),this.initRouteState=null}else{var _this$getActiveState=this.getActiveState(fallbackStateName),name=_this$getActiveState.name,params=_this$getActiveState.params;$state.go(name,params)}}},{key:"setInitRouteState",value:function(name,params){this.initRouteState||(this.initRouteState={name:name,params:params})}},{key:"forceInitRouteState",value:function(name,params){this.initRouteState=name?{name:name,params:params}:null}},{key:"create",value:function(userData,hasBackup,restore){var _this11=this;return this.logout($state.current.name,!0),this.addUser(userData,hasBackup,restore).then(function(createdUser){return _this11.login(createdUser)}).then(function(){_this11.initScriptInfoPolling()})}},{key:"addUser",value:function(userData,hasBackup,restore){var _this12=this;return multiAccount.addUser({userType:userData.userType||"seed",seed:userData.seed,networkByte:userData.networkByte,privateKey:userData.privateKey,publicKey:userData.publicKey,id:userData.id}).then(function(_ref5){var multiAccountData=_ref5.multiAccountData,multiAccountHash=_ref5.multiAccountHash,userHash=_ref5.userHash;return _this12.saveMultiAccountUser(_objectSpread({},userData,{settings:{hasBackup:hasBackup}}),userHash).then(function(){return _this12.saveMultiAccount({multiAccountData:multiAccountData,multiAccountHash:multiAccountHash})}).then(function(){return _this12.getMultiAccountUsers()}).then(function(multiAccountUsers){var createdUser=multiAccountUsers.find(function(user){return user.hash===userHash});if(!createdUser)throw new Error("Can't save user");return restore&&analytics.send({name:"Import Backup Success",params:{userType:userData.userType}}),_objectSpread({},createdUser)})})}},{key:"logout",value:function(stateName,isSwitch){if(!this.isAuthorised)return null;analytics.user.logout(),ds.app.logOut(),clearTimeout(this._scriptInfoPollTimeoutId),this._scriptInfoPoll&&this._scriptInfoPoll.destroy(),stateName?(this._resetFields(),analytics.addDefaultParams({userType:"unknown"}),isSwitch&&$state.current.name!==stateName&&$state.go(stateName),this.logoutSignal.dispatch({}),isSwitch||(this.changeTheme(themes.getDefaultTheme(),{dontSave:!0}),multiAccount.signOut(),$state.go(stateName,void 0,{custom:{logout:!0}}))):WavesApp.isDesktop()?transfer("reload"):window.location.reload(!0),this.debugMode=!1}},{key:"resetAll",value:function(){return Promise.all([storage.save("multiAccountData",""),storage.save("multiAccountHash",""),storage.save("multiAccountUsers",""),storage.save("userList","")])}},{key:"checkPassword",value:function(password){return Promise.all([this.getMultiAccountData(),this.getMultiAccountHash()]).then(function(_ref6){var _ref7=_slicedToArray(_ref6,2),multiAccountData=_ref7[0],multiAccountHash=_ref7[1];return multiAccountData?multiAccount.signIn(multiAccountData,password,void 0,multiAccountHash):Promise.reject("Empty account")})}},{key:"getActiveState",value:function(name){if(!name)return this.getSetting("lastState");var userState=tsUtils.find(this._stateList||[],{name:name});return userState?{name:userState.state}:{name:WavesApp.stateTree.getPath(name).join(".")}}},{key:"applyState",value:function(state,params){var _this13=this;this._history.push(state.name),this._history=this._history.slice(-10),this._stateList&&this._stateList.some(function(item){return item.applyState(state,_this13)}),this.setSetting("lastState",{name:state.name,params:params})}},{key:"getLastState",value:function(){return 1<this._history.length?this._history[this._history.length-2]:"welcome"}},{key:"getUserList",value:function(){return storage.onReady().then(function(){return storage.load("userList")}).then(function(list){return Array.isArray(list)?list.sort(function(a,b){return b.lastLogin-a.lastLogin}):[]})}},{key:"isValidAddress",value:function(address){try{return _isValidAddress(address,ds.config.get("code").charCodeAt(0))}catch(e){return!1}}},{key:"getFilteredUserList",value:function(){var _this14=this;return this.getUserList().then(function(list){return list.filter(function(user){return _this14.isValidAddress(user.address)})})}},{key:"removeUserByAddress",value:function(removeAddress){return storage.load("userList").then(function(list){return list.filter(function(_ref8){return _ref8.address!==removeAddress})}).then(function(list){return storage.save("userList",list)})}},{key:"getThemeSettings",value:function(){var currentTheme=this.getSetting("theme");return themes.getSettings(currentTheme)}},{key:"changeTheme",value:function(theme,options){var currentTheme=this.getSetting("theme"),newTheme=themes.changeTheme(theme||this.getSetting("theme"));currentTheme!==newTheme&&options&&!options.dontSave&&this.setSetting("theme",newTheme)}},{key:"changeCandle",value:function(name){var currentTheme=this.getSetting("theme"),current=this.getSetting("candle");themes.setCandleColorsByName(currentTheme,name),name!==current&&this.setSetting("candle",name)}},{key:"switchNextTheme",value:function(){var newTheme=themes.switchNext();this.setSetting("theme",newTheme)}},{key:"updateScriptAccountData",value:(_updateScriptAccountData=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var item,waves,address,addHasScript,response,_this15=this,_args=arguments;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return address=(item=0<_args.length&&void 0!==_args[0]?_args[0]:null)?item.address:this.address,_context.prev=2,this.networkError=!1,_context.next=6,ds.api.assets.get($injector.get("baseAssetService").WavesAssetId);case 6:waves=_context.sent,_context.next=13;break;case 9:throw _context.prev=9,_context.t0=_context.catch(2),this.networkError=!0,new Error("Can't get Waves asset");case 13:return addHasScript=function(value){_this15._hasScript!==value&&(_this15._hasScript=value,_this15.changeScript.dispatch())},_context.prev=14,_context.next=17,ds.fetch("".concat(ds.config.get("node"),"/addresses/scriptInfo/").concat(address));case 17:response=_context.sent,this.extraFee=Money.fromCoins(response.extraFee,waves),addHasScript(0!==response.extraFee),_context.next=26;break;case 22:_context.prev=22,_context.t1=_context.catch(14),addHasScript(!!this._hasScript),this.extraFee=this.extraFee||Money.fromCoins(0,waves);case 26:case"end":return _context.stop()}},_callee,this,[[2,9],[14,22]])})),function(){return _updateScriptAccountData.apply(this,arguments)})},{key:"getApiToken",value:function(){var _this16=this;try{this.currentlyProcessingSign||(this.currentlyProcessingSign=!0,this.pendingSign=utils.getApiToken(this.apiTokenWavesExchange).then(function(apiTokenWavesExchange){_this16.currentUser.apiTokenWavesExchange=apiTokenWavesExchange,delete _this16.currentlyProcessingSign,delete _this16.pendingSign}),this.pendingSign.then(function(){_this16.currentlyProcessingSign=!1},function(){_this16.currentlyProcessingSign=!1}))}catch(e){this.currentlyProcessingSign=!1}return this.pendingSign||Promise.resolve()}},{key:"hasUserMigrationAchievement",value:function(){return any(equals(!0),values(this._achievements.migration))}},{key:"hasAddressMigrationAchievement",value:function(address){return this._achievements.migration[address]||!1}},{key:"loginDebug",value:function(address,publicKey){var _this17=this,currentUser=_objectSpread({},this.currentUser);return this.logout("switch",!0),this.debugMode=!0,this._getUserMigrationAchievement(address),this.currentUser=_objectSpread({},currentUser,{name:"Debug mode ".concat(address),address:address,publicKey:publicKey||currentUser.publicKey}),this._setObserve(),ds.app.login({userType:"seed",networkByte:ds.config.get("code").charCodeAt(0),seed:"",address:address,publicKey:publicKey||currentUser.publicKey}),ds.app.initDataManager({userType:"seed",networkByte:ds.config.get("code").charCodeAt(0),seed:"",address:address,publicKey:publicKey||currentUser.publicKey}),$state.go("switch"),Promise.resolve().then(function(){return _this17.updateScriptAccountData()}).then(function(){return _this17.loginSignal.dispatch()}).catch(function(e){return ds.app.logOut(),Promise.reject(e)})}},{key:"_getUserMigrationAchievement",value:function(address){var _this18=this,migrationDate=Date.UTC(2019,11,2);return ds.api.transactions.hasTransactionsBeforeTimestamp(address,+new Date(migrationDate)).catch(function(){return!1}).then(function(result){_this18._achievements.migration[address]=result})}},{key:"_getUsersMigrationAchievements",value:function(){var _this19=this;Promise.all([this.getMultiAccountUsers(),this.getFilteredUserList()]).then(function(_ref9){for(var _ref10=_slicedToArray(_ref9,2),multiAccUsers=_ref10[0],lockedUsers=_ref10[1],addresses=pipe(map(prop("address")),filter(function(address){return isNil(_this19._achievements.migration[address])}))(multiAccUsers.concat(lockedUsers)),getAchievementForAddress=function getAchievementForAddress(){addresses.length&&_this19._getUserMigrationAchievement(addresses.pop()).then(function(){return getAchievementForAddress()})},i=0;i<Math.min(5,addresses.length);i+=1)getAchievementForAddress()})}},{key:"_resetFields",value:function(){var commonSettings,_this20=this;this.networkError=!1,this.currentUser=null,this.extraFee=null,this.changeScript=new tsUtils.Signal,this.setScamSignal=new tsUtils.Signal,this.scam=Object.create(null),this.__props=Object.create(null),this._changeTimer=null,this._stateList=null,this._history=[],this._hasScript=!1,this._scriptInfoPoll=null,this._scriptInfoPollTimeoutId=null,this._userReady=!1,this._settings&&this._settings.change.off(),this._settings&&(commonSettings=this._settings.getSettings().common,this._settings.change.off()),this._settings=defaultSettings.create({},commonSettings),this._settings.change.on(function(){return _this20._onChangeSettings()}),ds.dataManager.dropAddress()}},{key:"addAnalytics",value:function(){var auuid=this._uiId,address=this.address,userType=this.userType||"seed",platform=WavesApp.isDesktop()?"desktop":"web";analytics.addDefaultParams({userType:userType,platform:platform,address:address,auuid:auuid})}},{key:"_addUserData",value:function(userData){var commonSettings,_this21=this;this.currentUser={hash:userData.hash,name:userData.name,id:userData.id,address:userData.address,publicKey:userData.publicKey,userType:userData.userType,settings:userData.settings,apiTokenWavesExchange:userData.apiTokenWavesExchange,lastLogin:Date.now()},this._setObserve(),this._settings&&(commonSettings=this._settings.getSettings().common,this._settings.change.off()),this._settings=defaultSettings.create(this.currentUser.settings,commonSettings),this._settings.change.on(function(){return _this21._onChangeSettings()});var states=WavesApp.stateTree.find("main").getChildren();return this._stateList=states.map(function(baseTree){var id=baseTree.id;return new UserRouteState("main",id,_this21._settings.get("".concat(id,".activeState")))}),Object.keys(ds.utils.ConfigService.getConfig()).forEach(function(key){var value=_this21._settings.get("network.".concat(key));value&&ds.config.set(key,value)}),ds.config.set("locationOrigin",configService.get("NETWORK.locationOrigin")),this.saveMultiAccountUser(this.currentUser,this.currentUser.hash).then(function(){return ds.app.login(userData)}).then(function(){return _this21.getApiToken()}).then(function(){return ds.app.initDataManager(userData)}).then(function(){_this21._userReady=!0,_this21.changeTheme(_this21._settings.get("theme")),_this21.changeCandle()}).then(function(){return _this21._logoutTimer()}).then(function(){return _this21.updateScriptAccountData()}).catch(function(e){return Promise.reject(e)}).then(function(){return _this21.setUiId()}).then(function(){return _this21.addAnalytics()}).then(function(){return _this21.loginSignal.dispatch()}).catch(function(e){return ds.app.logOut(),Promise.reject(e)})}},{key:"_logoutTimer",value:function(){var _this22=this;this.receive(state.signals.sleep,function(min){min>=_this22._settings.get("logoutAfterMin")&&_this22.logout("signIn")})}},{key:"_onChangeSettings",value:function(){var _this$_settings$getSe2=this._settings.getSettings(),common=_this$_settings$getSe2.common,settings=_this$_settings$getSe2.settings;this.currentUser&&(this.currentUser.settings=_objectSpread({},settings)),isEmpty(common)||this.saveMultiAccountSettings(common)}},{key:"_onChangePropsForSave",value:function(){var _this23=this;this._changeTimer||(this._changeTimer=timeLine.timeout(function(){_this23._changeTimer=null,_this23.saveMultiAccountUser(_this23.currentUser,_this23.currentUser.hash)},500))}},{key:"_setObserve",value:function(){var _this24=this;Object.keys(this.currentUser).forEach(function(key){_this24._observe(key,_this24.currentUser)})}},{key:"_observe",value:function(key,target){var _this25=this;this.__props[key]=target[key],Object.defineProperty(target,key,{get:function(){return _this25.__props[key]},set:function(value){equals(value,_this25.__props[key])||(_this25.__props[key]=value,_this25._onChangePropsForSave())}})}},{key:"_saveUiId",value:function(uiId){return this._uiId=uiId,storage.save("uiId",uiId)}},{key:"achievements",get:function(){return this._achievements}},{key:"buyOptions",get:function(){return this._buyOptions},set:function(options){return this._buyOptions=options}},{key:"changeSetting",get:function(){return this._settings.change}},{key:"hash",get:function(){return this.currentUser?this.currentUser.hash:null}},{key:"address",get:function(){return this.currentUser?this.currentUser.address:null}},{key:"id",get:function(){return this.currentUser?this.currentUser.id:null}},{key:"name",get:function(){return this.currentUser?this.currentUser.name:null},set:function(name){this.currentUser&&(this.currentUser.name=name)}},{key:"userType",get:function(){return this.currentUser?this.currentUser.userType:null}},{key:"publicKey",get:function(){return this.currentUser?this.currentUser.publicKey:null}},{key:"apiTokenWavesExchange",get:function(){return this.currentUser?this.currentUser.apiTokenWavesExchange:null}},{key:"isAuthorised",get:function(){return this._userReady&&!!this.address}}]),User}();return User.prototype.receive=tsUtils.Receiver.prototype.receive,User.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,User.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,new User};factory.$inject=["storage","$state","defaultSettings","state","UserRouteState","Poll","timeLine","utils","themes","multiAccount","$injector","configService"],angular.module("app").factory("user",factory)}(),(factory=function($q,localeParser){var onLoad=$q(function(resolve){i18next.on("initialized",resolve)}),parse=function(text){return localeParser(function(argument_0){return(0<arguments.length&&void 0!==argument_0?argument_0:"").split("").map(function(_char){switch(_char.charCodeAt(0)){case 34:return"&quot;";case 38:return"&amp;";case 39:return"&#39;";case 60:return"&lt;";case 62:return"&gt;";default:return _char}}).join("")}(text))};return{translate:function(literal,ns,params,skipErrors){var translate=["".concat(ns=ns||"app",":").concat(literal)];return"app"!==ns&&translate.push("app:".concat(literal)),skipErrors?translate.some(function(key){return i18next.exists(key,params)})?parse(i18next.t(translate,params)):"":parse(i18next.t(translate,_objectSpread({},params,{interpolation:{escapeValue:!1}})))},translateField:function(controller,literalField,translatedField,ns,params){var _this26=this,apply=function(){null!=controller[literalField]&&(controller[translatedField]=_this26.translate(controller[literalField],ns,params))};controller.observe(literalField,apply),i18next.on("languageChanged",apply),controller.signals.destroy.once(function(){i18next.off("languageChanged",apply)}),controller[translatedField]||apply()},getNs:function($element){return $element.closest("[w-i18n-ns]").attr("w-i18n-ns")||""},onLoad:onLoad}}).$inject=["$q","localeParser"],angular.module("app").factory("i18n",factory),angular.module("app.buyWaves",[]),angular.module("app.leverage",[]),angular.module("app.saveSeed",[]),angular.module("app.sessions",[]),function(){var factory=function(utils){return function(){function Queue(options){_classCallCheck(this,Queue),this.signals=utils.liteObject({change:new tsUtils.Signal}),this._queueLimit=options.queueLimit,this._list=[],this._activeList=[],this._queueHash=Object.create(null)}return _createClass(Queue,[{key:"push",value:function(item){if(this._queueHash[item.id])throw new Error("Duplicate queue id!");var handler=this._getEndPromiseHandler(item);item.promise.then(handler,handler),this._queueHash[item.id]=item,this._activeList.length===this._queueLimit?this._list.push(item):(this._activeList.push(item),this._dispatch())}},{key:"remove",value:function(id){if(this._queueHash[id]){var item=this._queueHash[id];return this._getEndPromiseHandler(item)(),item}}},{key:"removeAll",value:function(){var _this27=this;Object.keys(this._queueHash).forEach(function(key){return _this27.remove(key)})}},{key:"destroy",value:function(id){this._queueHash[id]&&(this.remove(id),delete this._queueHash[id])}},{key:"destroyAll",value:function(){var _this28=this;Object.keys(this._queueHash).forEach(function(key){return _this28.destroy(key)})}},{key:"has",value:function(id){return!!this._queueHash[id]}},{key:"getActiveList",value:function(){return this._activeList.slice()}},{key:"_dispatch",value:function(){this.signals.change.dispatch(this.getActiveList())}},{key:"_getEndPromiseHandler",value:function(item){var _this29=this;return this._queueHash[item.id]&&delete this._queueHash[item.id],function(){[_this29._list,_this29._activeList].forEach(function(list,isActiveList){var index=list.indexOf(item);-1!==index&&(list.splice(index,1),isActiveList&&_this29._updateActiveList())})}}},{key:"_updateActiveList",value:function(){if(this._list.length){var item=this._list.shift();this._activeList.push(item)}this._dispatch()}}]),Queue}()};factory.$inject=["utils"],angular.module("app").factory("Queue",factory)}(),function(){var factory=function(timeLine,$injector){var tsUtils=require("ts-utils");return new(function(){function State(){var _this30=this;_classCallCheck(this,State),this.user=void 0,this.signals={window:{blur:new tsUtils.Signal,focus:new tsUtils.Signal},sleep:new tsUtils.Signal,wakeUp:new tsUtils.Signal,changeRouterStateSuccess:new tsUtils.Signal,changeRouterStateStart:new tsUtils.Signal},this.lastOpenVersion="",this._timer=null,this._seepStartTime=null,this._maxSleep=null,this.__sleepStep=null,this._block=document.createElement("DIV"),this._handlers=Object.create(null),timeLine.wait(100).then(function(){_this30.user=$injector.get("user"),_this30.user.loginSignal.once(_this30._handleLogin,_this30),_this30.user.logoutSignal.once(_this30._handleLogout,_this30)}),this._initialize()}return _createClass(State,[{key:"_sleepStep",get:function(){return this.__sleepStep},set:function(value){value?this._maxSleep&&this._addBlock():this._removeBlock(),this.__sleepStep=value}}]),_createClass(State,[{key:"_initialize",value:function(){this._addBlockStyles(),this._createHandlers(),this._setHandlers()}},{key:"_handleLogin",value:function(){this._maxSleep=this.user.getSetting("logoutAfterMin"),this.user.changeSetting.on(this._onUserSettingChange,this),this.user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._timer&&(timeLine.cancel(this._timer),this._timer=null),this.user.changeSetting.off(this._onUserSettingChange),this.user.loginSignal.once(this._handleLogin,this)}},{key:"_onUserSettingChange",value:function(path){"logoutAfterMin"===path&&(this._maxSleep=this.user.getSetting("logoutAfterMin"))}},{key:"_addBlockStyles",value:function(){this._block.classList.add("sleep-block")}},{key:"_createHandlers",value:function(){var _this31=this;this._handlers.focus=function(){_this31.signals.window.focus.dispatch(),_this31._wakeUp()},this._handlers.blur=function(){_this31.signals.window.blur.dispatch(),_this31._sleep()}}},{key:"_wakeUp",value:function(){this._seepStartTime=null,this._sleepStep=null,this._timer&&(timeLine.cancel(this._timer),this._timer=null),this.signals.wakeUp.dispatch()}},{key:"_removeBlock",value:function(){this._block&&this._block.parentNode===document.body&&document.body.removeChild(this._block)}},{key:"_addBlock",value:function(){this._block&&!this._block.parentNode&&document.body.appendChild(this._block)}},{key:"_sleep",value:function(){var _this32=this;this._timer&&(timeLine.cancel(this._timer),this._timer=null),this._seepStartTime||(this._seepStartTime=Date.now(),this._setSleepStep(0)),this._timer=timeLine.timeout(function(){_this32._timer=null;var time=Date.now()-_this32._seepStartTime,sleepMinutes=Math.floor(time/6e4);_this32._sleep(),_this32._setSleepStep(sleepMinutes)},1e3)}},{key:"_setSleepStep",value:function(step){if(this._sleepStep===step)return null;this._sleepStep=step,this.signals.sleep.dispatch(this._sleepStep)}},{key:"_setHandlers",value:function(){var _this33=this;Object.keys(this._handlers).forEach(function(event){window.addEventListener(event,_this33._handlers[event],!1)})}}]),State}())};factory.$inject=["timeLine","$injector"],angular.module("app").factory("state",factory)}(),function(){var factory=function(){return new(function(){function Themes(){_classCallCheck(this,Themes),this._events={},this.cssRules={},this.currentTheme="default",this.themes=WavesApp.themesConf.themes,this.candleColors={},this._initCssStyleEl(),this.changeTheme(),this._setDefaultCandle(),this.links=[].slice.apply(document.querySelectorAll("[rel=stylesheet]")).filter(function(el){return el.getAttribute("theme")})}return _createClass(Themes,[{key:"getCurrentTheme",value:function(){return this.hasTheme(this.currentTheme)?this.currentTheme:"default"}},{key:"getDefaultTheme",value:function(){return"default"}},{key:"changeTheme",value:function(name){return name=name||"default",this.hasTheme(name)&&name!==this.currentTheme&&(this.currentTheme=name,this._changeTheme(name)),this.currentTheme}},{key:"hasTheme",value:function(name){return this.themes.includes(name)}},{key:"getAllThemes",value:function(){return this.themes}},{key:"getSettings",value:function(theme){return WavesApp.themesConf[theme||this.currentTheme||"default"]||{}}},{key:"getTradingViewConfig",value:function(theme){return theme=this.hasTheme(theme)?theme:"default",this.getSettings(theme).tradingView||{}}},{key:"switchNext",value:function(){var index=this.themes.indexOf(this.currentTheme)+1,newTheme=this.themes[index%this.themes.length];return this.changeTheme(newTheme),this.currentTheme}},{key:"getCandlesColors",value:function(currentTheme){return this.getTradingViewConfig(currentTheme).candles}},{key:"getCurrentCandleSColor",value:function(name){if(name){var _this$getCandlesColor=this.getCandlesColors()[name];return{up:_this$getCandlesColor.upColor,down:_this$getCandlesColor.downColor,volume0:_this$getCandlesColor.volume0,volume1:_this$getCandlesColor.volume1}}var _this$candleColors=this.candleColors,up=_this$candleColors.up,down=_this$candleColors.down,volume0=_this$candleColors.volume0,volume1=_this$candleColors.volume1;return{up:up=up||this.getCandlesColors().blue.upColor,down:down=down||this.getCandlesColors().blue.downColor,volume0:volume0=volume0||this.getCandlesColors().blue.volume0,volume1:volume1=volume1||this.getCandlesColors().blue.volume1}}},{key:"changeStyleRules",value:function(rules){this.cssRules=_objectSpread({},this.cssRules,{},rules),this._applyRules()}},{key:"setCandleColors",value:function(up,down){this.candleColors={up:up,down:down},this.changeStyleRules({".candle-up-color-dynamic":{color:"".concat(up,"!important")},".candle-down-color-dynamic":{color:"".concat(down,"!important")},".candle-up-bg-color-dynamic":{"background-color":"".concat(up,"!important")},".candle-down-bg-color-dynamic":{"background-color":"".concat(down,"!important")}})}},{key:"setCandleColorsByName",value:function(currentTheme,name){currentTheme=this.hasTheme(currentTheme)?currentTheme:"default";var colors=this.getCandlesColors(currentTheme),cfg=colors[name]||colors.blue;cfg&&this.setCandleColors(cfg.upColor,cfg.downColor)}},{key:"_setDefaultCandle",value:function(){var _this$getCandlesColor2=this.getCandlesColors().blue,upColor=_this$getCandlesColor2.upColor,downColor=_this$getCandlesColor2.downColor;this.setCandleColors(upColor,downColor)}},{key:"_changeTheme",value:function(name){name=this.hasTheme(name)?name:"default",this.links.forEach(function(style){style.getAttribute("theme")===name&&(style.disabled=!1,document.head.appendChild(style))})}},{key:"_applyRules",value:function(){for(var cssText="",parseStyles=function(argument_0){for(var styles=0<arguments.length&&void 0!==argument_0?argument_0:{},stylesTxt="",_i2=0,_Object$entries=Object.entries(styles);_i2<_Object$entries.length;_i2++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i2],2),style=_Object$entries$_i[0],value=_Object$entries$_i[1];stylesTxt+="\n".concat(style,": ").concat(value,";")}return stylesTxt},_i3=0,_Object$entries2=Object.entries(this.cssRules);_i3<_Object$entries2.length;_i3++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i3],2),rule=_Object$entries2$_i[0],css=_Object$entries2$_i[1];cssText+="".concat(rule," {").concat(parseStyles(css),"\n}\n")}this.cssStyleEl.innerHTML=cssText}},{key:"_initCssStyleEl",value:function(){this.cssStyleEl=document.createElement("style"),document.head.appendChild(this.cssStyleEl)}}]),Themes}())};factory.$inject=[],angular.module("app").factory("themes",factory)}(),angular.module("app.buyBTCFaq",[]),angular.module("app.migration",[]),function(){var factory=function(){var Ease={linear:function(t){return t},get:function(amount){return amount<-1&&(amount=-1),1<amount&&(amount=1),function(t){return 0===amount?t:amount<0?t*(t*-amount+1+amount):t*((2-t)*amount+(1-amount))}},getPowIn:function(pow){return function(t){return Math.pow(t,pow)}},getPowOut:function(pow){return function(t){return 1-Math.pow(1-t,pow)}},getPowInOut:function(pow){return function(t){return(t*=2)<1?.5*Math.pow(t,pow):1-.5*Math.abs(Math.pow(2-t,pow))}},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},getBackIn:function(amount){return function(t){return t*t*((amount+1)*t-amount)}},getBackOut:function(amount){return function(t){return--t*t*((amount+1)*t+amount)+1}},getBackInOut:function(amount){return amount*=1.525,function(t){return(t*=2)<1?t*t*((amount+1)*t-amount)*.5:.5*((t-=2)*t*((amount+1)*t+amount)+2)}},circIn:function(t){return-(Math.sqrt(1-t*t)-1)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},bounceIn:function(t){return 1-Ease.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*Ease.bounceIn(2*t):.5*Ease.bounceOut(2*t-1)+.5},getElasticIn:function(amplitude,period){var pi2=2*Math.PI;return function(t){if(0==t||1==t)return t;var s=period/pi2*Math.asin(1/amplitude);return-amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period)}},getElasticOut:function(amplitude,period){var pi2=2*Math.PI;return function(t){if(0==t||1==t)return t;var s=period/pi2*Math.asin(1/amplitude);return amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period)+1}},getElasticInOut:function(amplitude,period){var pi2=2*Math.PI;return function(t){var s=period/pi2*Math.asin(1/amplitude);return(t*=2)<1?amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period)*-.5:amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*.5+1}}};return Ease.backOut=Ease.getBackOut(1.7),Ease.backIn=Ease.getBackIn(1.7),Ease.backInOut=Ease.getBackInOut(1.7),Ease.elasticIn=Ease.getElasticIn(1,.3),Ease.elasticInOut=Ease.getElasticInOut(1,.3*1.5),Ease.elasticOut=Ease.getElasticOut(1,.3),Ease.quadIn=Ease.getPowIn(2),Ease.quadOut=Ease.getPowOut(2),Ease.quadInOut=Ease.getPowInOut(2),Ease.cubicIn=Ease.getPowIn(3),Ease.cubicOut=Ease.getPowOut(3),Ease.cubicInOut=Ease.getPowInOut(3),Ease.quartIn=Ease.getPowIn(4),Ease.quartOut=Ease.getPowOut(4),Ease.quartInOut=Ease.getPowInOut(4),Ease.quintIn=Ease.getPowIn(5),Ease.quintOut=Ease.getPowOut(5),Ease.quintInOut=Ease.getPowInOut(5),Ease};factory.$inject=[],angular.module("app.utils").factory("ease",factory)}(),function(){var factory=function(PromiseControl,timeLine,utils,$q){var tsUtils=require("ts-utils"),Poll=function(){function Poll(getData,applyData,time,errorRequestTime){_classCallCheck(this,Poll),this.id=tsUtils.uniqueId("poll"),this.signals={destroy:new tsUtils.Signal},this._errorRequestTime=errorRequestTime||1e3,this._ready=$q.defer(),this._removed=!1,this._time=time,this._getData=getData,this._applyData=applyData,this._paused=!1,this._timer=null,this._promise=null,this._pausePromise=null,this._initialize()}return _createClass(Poll,[{key:"ready",get:function(){return this._ready.promise}},{key:"_promise",get:function(){return this.__promise},set:function(promise){this.__promise&&this.__promise.drop(),this.__promise=promise}}]),_createClass(Poll,[{key:"pause",value:function(promise){var _this34=this;if(this._paused=!0,this._stopTimers(),this._pausePromise){this._pausePromise.drop();var pausePromise=utils.resolve(this._pausePromise.promise()).then(function(){return promise});this._pausePromise=new PromiseControl(pausePromise)}else this._pausePromise=new PromiseControl(promise);this._pausePromise.always(function(){_this34._pausePromise=null,_this34.play()})}},{key:"stop",value:function(){this._paused=!0,this._stopTimers()}},{key:"play",value:function(){this._paused=!1,this._pausePromise&&(this._pausePromise.drop(),this._pausePromise=null),this._run()}},{key:"destroy",value:function(){this._removed=!0,this._stopTimers(),this.stopReceive(),this.signals.destroy.dispatch()}},{key:"restart",value:function(){return this._stopTimers(),this._run()}},{key:"_initialize",value:function(){this._run()}},{key:"_stopTimers",value:function(){timeLine.cancel(this._timer),this._promise=null}},{key:"_run",value:function(){var _this35=this;return new Promise(function(resolve){if(_this35._removed)return null;if(_this35._paused)return null;var result=_this35._getData();Poll._isPromise(result)?(_this35._promise=new PromiseControl(result),_this35._promise.then(function(data){_this35._addTimeout(),_this35._applyData(data),_this35._ready.resolve(),resolve()},function(){_this35._timer=timeLine.timeout(function(){return _this35._run()},_this35._errorRequestTime)})):(_this35._applyData(result),_this35._addTimeout(),resolve())})}},{key:"_addTimeout",value:function(){var _this36=this;this._timer=timeLine.timeout(function(){return _this36._run()},this._time)}}],[{key:"_isPromise",value:function(data){return data&&data.then&&"function"==typeof data.then}}]),Poll}();return Poll.prototype.receive=tsUtils.Receiver.prototype.receive,Poll.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,Poll.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,Poll};factory.$inject=["PromiseControl","timeLine","utils","$q"],angular.module("app.utils").factory("Poll",factory)}(),(controller=function($element,$compile,$scope,Base){var ds=require("data-service");return new(function(){function WMd(){var _getPrototypeOf2,_this37;_classCallCheck(this,WMd);for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];return(_this37=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(WMd)).call.apply(_getPrototypeOf2,[this].concat(args)))).literalId=void 0,_this37.text={},_this37.literal=void 0,_this37.$content=void 0,_this37._changeLang=function(){_this37._render()},_this37}return _inherits(WMd,Base),_createClass(WMd,[{key:"$postLink",value:function(){this._onChangeText(),i18next.on("languageChanged",this._changeLang),this.observe("text",this._onChangeText)}},{key:"$onDestroy",value:function(){i18next.off("languageChanged",this._changeLang)}},{key:"_render",value:function(){if(this.$content&&this.$content.remove(),0===Object.keys(this.text||{}).length)return null;var textData=ds.utils.parseMd(i18next.t(["app:".concat(this.literal)])||"");this.$content=$compile(textData)($scope),$element.append(this.$content)}},{key:"_createLiteral",value:function(){var _this38=this;this.literal="md_element_".concat(this.literalId),Object.entries(this.text||{}).forEach(function(_ref11){var _ref12=_slicedToArray(_ref11,2),lang=_ref12[0],message=_ref12[1];i18next.addResource(lang,"app",_this38.literal,message)})}},{key:"_onChangeText",value:function(){this._createLiteral(),this._render()}}]),WMd}())}).$inject=["$element","$compile","$scope","Base"],angular.module("app").component("wMd",{bindings:{text:"<",literalId:"<"},controller:controller}),function(){var _require4=require("ts-utils"),getPaths=_require4.getPaths,get=_require4.get,Signal=_require4.Signal,tsApiValidator=require("ts-api-validator"),_require5=require("ramda"),splitEvery=_require5.splitEvery,pipe=_require5.pipe,path=_require5.path,ifElse=_require5.ifElse,concat=_require5.concat,defaultTo=_require5.defaultTo,identity=_require5.identity,isNil=_require5.isNil,_require6=require("@waves/waves-browser-bus"),WindowAdapter=_require6.WindowAdapter,Bus=_require6.Bus,_require7=require("@waves/waves-transactions"),libs=_require7.libs,serializeCustomData=_require7.serializeCustomData,_libs$crypto=libs.crypto,base58Decode=_libs$crypto.base58Decode,base58Encode=_libs$crypto.base58Encode,stringToBytes=_libs$crypto.stringToBytes,bytesToString=_libs$crypto.bytesToString,ds=require("data-service"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,Money=require("@waves/data-entities").Money,STATUS_LIST=require("@waves/oracle-data").STATUS_LIST,BigNumber=require("@waves/bignumber").BigNumber,_moment=require("moment"),GOOD_COLORS_LIST=["#39a12c","#6a737b","#e49616","#008ca7","#ff5b38","#ff6a00","#c74124","#00a78e","#b01e53","#e0c61b","#5a81ea","#72b7d2","#a5b5c3","#81c926","#86a3bd","#c1d82f","#5c84a8","#267e1b","#fbb034","#ff846a","#47c1ff","#00a0af","#85d7c6","#8a7967","#26c1c9","#72d28b","#5B1909","#264764","#270774","#8763DE","#F04085","#1E6AFD","#FF1E43","#D3002D","#967400","#264163"],INTERVAL_PRESETS={"1m":6e4,"5m":3e5,"15m":9e5,"30m":18e5,"1h":36e5,"2h":72e5,"3h":108e5,"4h":144e5,"6h":216e5,"12h":432e5,"1d":864e5,"1w":6048e5,"1M":26784e5},INTERVAL_MAP={1:{interval:INTERVAL_PRESETS["1m"],intervalName:"1m",converter:identity},5:{interval:INTERVAL_PRESETS["5m"],intervalName:"5m",converter:identity},15:{interval:INTERVAL_PRESETS["15m"],intervalName:"15m",converter:identity},30:{interval:INTERVAL_PRESETS["30m"],intervalName:"30m",converter:identity},60:{interval:INTERVAL_PRESETS["1h"],intervalName:"1h",converter:identity},120:{interval:INTERVAL_PRESETS["2h"],intervalName:"2h",converter:identity},180:{interval:INTERVAL_PRESETS["3h"],intervalName:"3h",converter:identity},240:{interval:INTERVAL_PRESETS["4h"],intervalName:"4h",converter:identity},360:{interval:INTERVAL_PRESETS["6h"],intervalName:"6h",converter:identity},720:{interval:INTERVAL_PRESETS["12h"],intervalName:"12h",converter:identity},D:{interval:INTERVAL_PRESETS["1d"],intervalName:"1d",converter:identity},W:{interval:INTERVAL_PRESETS["1w"],intervalName:"1w",converter:identity},M:{interval:INTERVAL_PRESETS["1M"],intervalName:"1M",converter:identity}},IMPORT_PRIORITY_MAP={seed:0,key:0,wavesKeeper:1,ledger:2},BigNumberPart=function(){function BigNumberPart(){return _classCallCheck(this,BigNumberPart),_possibleConstructorReturn(this,_getPrototypeOf(BigNumberPart).apply(this,arguments))}return _inherits(BigNumberPart,tsApiValidator.BasePart),_createClass(BigNumberPart,[{key:"getValue",value:function(data){switch(_typeof(data)){case"string":case"number":return new BigNumber(data);default:return null}}}]),BigNumberPart}(),factory=function($q,$injector){var base58ToBytes=base58Decode,bytesToBase58=base58Encode,utils={apiValidatorParts:{BigNumberPart:BigNumberPart},getAssetLogo:function(assetId){return $injector.get("baseAssetService").getDefaultAssetsIconMap()[assetId]},getAssetLogoBackground:function(assetId){var sum=assetId.split("").map(function(_char2){return _char2.charCodeAt(0)}).reduce(function(acc,code){return acc+code},0);return GOOD_COLORS_LIST[sum%GOOD_COLORS_LIST.length]},getImportPriorityMap:function(){return IMPORT_PRIORITY_MAP},base58ToBytes:pipe(defaultTo(""),base58ToBytes),base58ToString:pipe(defaultTo(""),base58ToBytes,bytesToString),stringToBytes:pipe(defaultTo(""),stringToBytes),stringToBase58:pipe(defaultTo(""),String,stringToBytes,bytesToBase58),bytesToBase58:pipe(defaultTo(new Uint8Array([])),bytesToBase58),bytesToString:pipe(defaultTo(new Uint8Array([])),bytesToString),bytesToSafeString:ifElse(pipe(identity,bytesToString,isNil),pipe(identity,bytesToBase58,concat("base58:")),pipe(identity,bytesToString)),removeUrlProtocol:function(url){return url.replace(/.+?(:\/\/)/,"")},getUrlForRoute:function(url){url=decodeURI(url||location.href);return pipe(utils.removeUrlProtocol,function(url){return url.includes("#")?url.slice(url.indexOf("#")).replace("#","/"):""})(url)},getRouterParams:function(url){var Router=$injector.get("Router"),router=new Router;return Object.keys(Router.ROUTES).forEach(function(name){var handler=function(name){return function(){var params=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Object.create(null),search=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Object.create(null),url=Router.ROUTES[name];return{name:name,url:url,data:_objectSpread({},params,{},search)}}}(name);router.registerRoute(Router.ROUTES[name],handler)}),router.apply(url)},createQS:function(obj){var createKeyValue=function(key,v){return"".concat(key,"=").concat(function(v){switch(!0){case v instanceof Date:return v.getTime();default:return encodeURIComponent(v)}}(v))},qs=Object.entries(obj).filter(function(_ref13){var _ref14=_slicedToArray(_ref13,2);_ref14[0];return void 0!==_ref14[1]}).map(function(_ref15){var _ref16=_slicedToArray(_ref15,2),key=_ref16[0],value=_ref16[1];return Array.isArray(value)?function(key,values){return values.map(function(v){return createKeyValue("".concat(key,"[]"),v)}).join("&")}(key,value):createKeyValue(key,value)}).join("&");return""===qs?qs:"?".concat(qs)},observe:function(target,keys,options){return function(target,keys,options){var observer=function(target){if(!target.__){var observer=Object.create(null);Object.defineProperty(target,"__",{writable:!1,configurable:!1,enumerable:!1,value:observer})}return target.__}(target);return options=options||Object.create(null),utils.toArray(keys).forEach(function(key){if(observer[key])return null;var item=Object.create(null);item.signal=new Signal,item.timer=null,item.value=target[key];var originalDescriptor=function(target,key){var descriptor=Object.getOwnPropertyDescriptor(target,key);if(descriptor)return descriptor;if(target.constructor&&target.constructor!==Object.constructor&&target.constructor.prototype)return Object.getOwnPropertyDescriptor(target.constructor.prototype,key);return null}(target,key);if(observer[key]=item,originalDescriptor&&originalDescriptor.get){var descriptor={enumerable:originalDescriptor.enumerable,get:originalDescriptor.get};originalDescriptor.set?descriptor.set=function(value){var prev=originalDescriptor.get.call(target);isNotEqualValue(prev,value)&&(originalDescriptor.set.call(target,value),observer[key].signal.dispatch({value:value,prev:prev}))}:descriptor.set=function(){throw new Error("Original descriptor has't set property!")},Object.defineProperty(target,key,descriptor)}else Object.defineProperty(target,key,{enumerable:!0,get:function(){return observer[key].value},set:function(value){value=options.set?options.set(value):value;var prev=observer[key].value;isNotEqualValue(prev,value)&&(observer[key].value=value,observer[key].signal.dispatch({value:value,prev:prev}))}})}),function(observer,keys){{if(Array.isArray(keys)){var event=keys.sort(utils.comparators.asc).join(",");return observer.__events||(observer.__events=Object.create(null)),observer.__events[event]||(observer.__events[event]=new Signal,keys.forEach(function(key){observer[key].signal.on(function(){observer.__events[event].dispatch()})})),observer.__events[event]}return observer[keys].signal}}(observer,keys)}(target,keys,options)},getPublicKeysFromScript:function(script){return(script.match(/ByteVector\(\d+\sbytes,\s(.[^)]+)/g)||[]).map(function(res){return res.replace(/ByteVector\(\d+\sbytes,\s0x/,"")}).map(function(key){return splitEvery(2,key).map(function(byte16){return parseInt(byte16,16)})}).map(base58Encode)},debounce:function(callback,timeout){var control={queued:!1,args:null};return function(){for(var _this39=this,_len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];control.args=args,control.queued||setTimeout(function(){control.queued=!1,callback.call.apply(callback,[_this39].concat(_toConsumableArray(control.args)))},timeout),control.queued=!0}},timeoutPromise:function(promise,timeout){var timer,timeoutPromise=new Promise(function(_,reject){timer=setTimeout(function(){reject(new Error("Timeout error!"))},timeout)});return promise.finally(function(){clearTimeout(timer)}),Promise.race([promise,timeoutPromise])},parseElectronUrl:function(url){var _url$split2=_slicedToArray(url.split("#"),2),pathAndSearch=_url$split2[0],hash=_url$split2[1],_pathAndSearch$split2=_slicedToArray(pathAndSearch.split("?"),2),path=_pathAndSearch$split2[0],search=_pathAndSearch$split2[1];return{path:path,search:"?".concat(search||""),hash:"#".concat(hash||"")}},redirect:function(url){WavesApp.isDesktop()?window.openInBrowser(url):location.href=url},parseSearchParams:function(argument_0){var search=0<arguments.length&&void 0!==argument_0?argument_0:"",hashes=search.slice(search.indexOf("?")+1).split("&").filter(Boolean),params=Object.create(null),normalizeValue=function(value){if("null"===value)return null;var num=Number(value);return String(num)===value?num:value};return hashes.forEach(function(hash){var _hash$split2=_slicedToArray(hash.split("="),2),key=_hash$split2[0],val=_hash$split2[1];key.includes("[]")?function(name,value){var key=name.replace("[]","");params[key]||(params[key]=[]),params[key].push(normalizeValue(decodeURIComponent(value)))}(key,val):function(name,value){params[name]=null==value||normalizeValue(decodeURIComponent(value))}(key,val)}),params},debounceRequestAnimationFrame:function(callback){var control={queued:!1,args:null};return function(){for(var _this40=this,_len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];control.args=args,control.queued||requestAnimationFrame(function(){control.queued=!1,callback.call.apply(callback,[_this40].concat(_toConsumableArray(control.args)))}),control.queued=!0}},animate:function($element,properties,options){return new Promise(function(resolve){if((options=options||Object.create(null)).complete){var origin=options.complete;options.complete=function(){resolve(),origin()}}else options.complete=resolve;$element.stop(!0,!0).animate(properties,options)})},animateTransform:function($element,to){var prefixis=["","-ms-","-moz-","-o-","-webkit-"];return $q(function(resolve){var from_x=0,from_y=0;$element.stop(!0,!0).animate({},{progress:function(tween,_progress){var x=(to.x-from_x)*_progress+from_x,y=(to.y-from_y)*_progress+from_y;prefixis.forEach(function(prefix){$element.css("".concat(prefix,"transform"),"translate(".concat(x,"px, ").concat(y,"px)"))})},complete:resolve,duration:300})})},animateByClass:function($element,className,state,stopProperty){return $q(function(resolve){var element=$element.get(0),eventList=["transitionend","oTransitionEnd","otransitionend","webkitTransitionEnd"];if(element.classList.contains(className)===state)return resolve(),null;function handler(e){e.currentTarget!==element||stopProperty&&e.propertyName!==stopProperty||(resolve(),eventList.forEach(function(eventName){element.removeEventListener(eventName,handler,!1)}))}eventList.forEach(function(eventName){element.addEventListener(eventName,handler,!1)}),$element.toggleClass(className,state)})},safeApply:function($scope){try{var phase=$scope.$root&&$scope.$root.$$phase;"$apply"!==phase&&"$digest"!==phase&&$scope.$apply()}catch(e){return null}},safeDigest:function($scope){try{var phase=$scope.$root&&$scope.$root.$$phase;"$apply"!==phase&&"$digest"!==phase&&$scope.$digest()}catch(e){return null}},postDigest:function($scope){return new Promise(function(resolve){$scope.$parent.$$postDigest(resolve)})},when:function(data){return this.isPromise(data)?data:Promise.resolve(data)},isPromise:function(data){return data&&data.then&&"function"==typeof data.then},whenAll:function(promises){return utils.when(Promise.all(promises))},getMoneyWithoutFee:function(money,fee){return fee&&money.asset.id===fee.asset.id?money.sub(fee):money},isEqual:function(a,b){var typeA=_typeof(a);if(typeA!==_typeof(b))return!1;if("object"!==typeA)return a===b;if(a instanceof Money&&b instanceof Money)return a.asset.id===b.asset.id&&a.eq(b);if(a instanceof BigNumber&&b instanceof BigNumber)return a.eq(b);var pathsA=getPaths(a),pathsB=getPaths(b);return pathsA.length===pathsB.length&&pathsA.every(function(path,index){return get(a,path)===get(b,path)&&String(path)===String(pathsB[index])})},bind:function(target,keys){if(null==keys)if(0===(keys=Object.keys(target).filter(function(name){return"function"==typeof target[name]})).length){var proto=Object.getPrototypeOf(target);keys=Object.getOwnPropertyNames(proto).filter(function(method){return"_"!==method.charAt(0)&&"constructor"!==method})}else keys=keys.filter(function(key){return"function"==typeof target[key]});else keys=Array.isArray(keys)?keys:[keys];return keys.forEach(function(key){target[key]=target[key].bind(target)}),target},resolve:function(promiseLike){var getCallback=function(state,resolve){return function(data){return resolve({state:state,data:data})}};return new Promise(function(resolve){promiseLike.then(getCallback(!0,resolve),getCallback(!1,resolve))})},moment:function(date,pattern){return _moment(date,pattern)},loadImage:function(url){return new Promise(function(resolve,reject){var img=new Image;img.onload=resolve,img.onerror=reject,img.src=url})},getNiceNumber:function(num,precision){switch(_typeof(num)){case"string":case"number":return new BigNumber(num,10).toFormat(precision&&Number(precision));case"object":if(null!=num)return num.toFormat(precision&&Number(precision));throw new Error("Wrong format!");default:throw new Error("Wrong format!")}},parseNiceNumber:function(data){if(data instanceof BigNumber)return data;var num=new BigNumber(String(data).replace(",","").replace(/\s/g,"")||0,10);return num.isNaN()?new BigNumber(0):num},loadOrTimeout:function(target,timeout){return new Promise(function(resolve,reject){target.addEventListener("load",resolve,!1),target.addEventListener("error",reject,!1),setTimeout(function(){reject(new Error("Timeout limit error!"))},timeout)})},importUsersByWindow:function(win,origin,timeout){return new Promise(function(resolve,reject){WindowAdapter.createSimpleWindowAdapter(win,{origins:[origin]}).then(function(adapter){var bus=new Bus(adapter);bus.once("ready",function(){bus.request("getLocalStorageData",null,timeout).then(utils.onExportUsers(origin,resolve)).catch(reject)}),bus.request("getLocalStorageData",null,timeout).then(utils.onExportUsers(origin,resolve)).catch(reject)})})},importAccountByIframe:function(origin,timeout){var iframe=document.createElement("iframe"),remove=function(){iframe.parentNode&&document.body.removeChild(iframe)};iframe.src="".concat(origin,"/export.html");var result=utils.loadOrTimeout(iframe,timeout).then(function(){return utils.importUsersByWindow(iframe,origin,timeout)}).then(function(data){return remove(),Promise.resolve(data)}).catch(function(error){return remove(),Promise.reject(error)});return iframe.style.opacity="0",iframe.style.position="absolute",iframe.style.left="0",iframe.style.top="0",document.body.appendChild(iframe),result},importAccountByTab:function(origin,timeout){var left="left=".concat(Math.floor(screen.width-50)),right="top=".concat(Math.floor(screen.height-50)),closed=!1,win=window.open("".concat(origin,"/export.html"),"export","".concat("width=100",",").concat("height=100",",").concat(left,",").concat(top,",").concat(right,",no,no,no,no,no,no")),close=function(d){return closed||(win.close(),closed=!0),d};return utils.importUsersByWindow(win,origin,timeout).then(close).catch(function(e){return close(),Promise.reject(e)})},onExportUsers:function(origin,resolve){return function(response){response||resolve([]),resolve(response)}},openDex:function(asset1,asset2){var $state=$injector.get("$state"),defaultAssets=$injector.get("baseAssetService").getDefaultAssetsHashId();if(asset1&&asset2)return asset1===asset2?utils.openDex(asset1):(setTimeout(function(){$state.go("main.trade",{tradingPair:"".concat(asset1,"_").concat(asset2)})},50),null);asset2=asset1===defaultAssets.WAVES?defaultAssets.BTC:defaultAssets.WAVES,setTimeout(function(){$state.go("main.trade",{tradingPair:"".concat(asset1,"_").concat(asset2)})},50)},getValidCandleOptions:function(from,to,argument_2){var interval=2<arguments.length&&void 0!==argument_2?argument_2:60;from=6e4*Math.floor(from/6e4),to=6e4*Math.ceil(to/6e4);var config=INTERVAL_MAP[interval],options={timeStart:from instanceof Date?from.getTime():from,timeEnd:to instanceof Date?to.getTime():to,interval:interval};function getTimeEnd(timeStart){return Math.min(options.timeEnd,timeStart+1440*config.interval)}options.timeEnd-options.timeStart<config.interval&&(options.timeStart=options.timeEnd-config.interval);var intervals=[],newInterval={timeStart:options.timeStart,timeEnd:getTimeEnd(options.timeStart),interval:config.intervalName};for(intervals.push(_objectSpread({},newInterval));newInterval.timeEnd<options.timeEnd;)newInterval.timeStart=newInterval.timeEnd,newInterval.timeEnd=getTimeEnd(newInterval.timeStart),intervals.push(_objectSpread({},newInterval));return{options:intervals,config:config}},getMaxInterval:function(from,to,argument_2){var amount=2<arguments.length&&void 0!==argument_2?argument_2:100,delta=to-from,findDif=function(interval){return Math.abs(delta/interval-amount)},intObj=Object.values(INTERVAL_MAP).reduce(function(prev,cur){return findDif(cur.interval)<findDif(prev.interval)?cur:prev});return Object.keys(INTERVAL_MAP).find(function(key){return INTERVAL_MAP[key].interval===intObj.interval})},concatCandles:function(_ref17){var fromOld,toOld,fromNew,toNew,candleConfig,to=_ref17.to,from=_ref17.from,amountId=_ref17.amountId,priceId=_ref17.priceId,dayX=_ref17.dayX,interval=_ref17.interval,oldMatcher=_ref17.oldMatcher,currentMatcher=_ref17.currentMatcher,promisesOld=[],promises=[];if(dayX<to&&from<dayX){fromOld=from,fromNew=toOld=dayX,toNew=to;var _utils$getValidCandle=utils.getValidCandleOptions(fromOld,toOld,interval),optionsForOld=_utils$getValidCandle.options;candleConfig=_utils$getValidCandle.config,promisesOld=optionsForOld.map(function(option){return ds.config.getDataService().getCandles(amountId,priceId,_objectSpread({matcher:oldMatcher},option))})}else if(to<=dayX){fromOld=from,toOld=to,toNew=fromNew=null;var _utils$getValidCandle2=utils.getValidCandleOptions(fromOld,toOld,interval),_optionsForOld=_utils$getValidCandle2.options;candleConfig=_utils$getValidCandle2.config,promisesOld=_optionsForOld.map(function(option){return ds.config.getDataService().getCandles(amountId,priceId,_objectSpread({matcher:oldMatcher},option))})}else fromNew=from,toNew=to;if(null!=fromNew&&null!=toNew){var _utils$getValidCandle3=utils.getValidCandleOptions(fromNew,toNew,interval),options=_utils$getValidCandle3.options;candleConfig=_utils$getValidCandle3.config,promises=options.map(function(option){return ds.config.getDataService().getCandles(amountId,priceId,_objectSpread({matcher:currentMatcher},option))})}return{promisesWithCandles:promisesOld.concat(promises),candleConfig:candleConfig}},getNiceNumberTemplate:function(num,precision,shortMode){var bigNum=this.parseNiceNumber(num),formatted=this.getNiceNumber(bigNum,precision),minValue="number"==typeof shortMode?shortMode:1e4;if(("number"==typeof shortMode||shortMode)&&bigNum.gte(minValue))return this.getNiceBigNumberTemplate(bigNum);var separatorDecimal=WavesApp.getLocaleData().separators.decimal,_formatted$split2=_slicedToArray(formatted.split(separatorDecimal),2),_int=_formatted$split2[0],decimal=_formatted$split2[1];if(decimal){var decimalTpl=function(decimal,separator){var mute=[];decimal.split("").reverse().some(function(_char3){return"0"!==_char3||(mute.push(0),!1)});var end=decimal.length-mute.length;if(end)return"".concat(separator).concat(decimal.substr(0,end),'<span class="decimal-muted">').concat(mute.join(""),"</span>");return'<span class="decimal-muted">'.concat(separator).concat(mute.join(""),"</span>")}(decimal,separatorDecimal);return'<span class="int">'.concat(_int,"</span>")+'<span class="decimal">'.concat(decimalTpl,"</span>")}return'<span class="int">'.concat(_int,"</span>")},getNiceBigNumberTemplate:function(bigNum){var stringNum,postfix,i18n=$injector.get("i18n");return postfix=bigNum.gte(1e6)?(stringNum=bigNum.div(1e6).toFormat(1),i18n.translate("number.short.million")):(stringNum=bigNum.div(1e3).toFormat(1),i18n.translate("number.short.thousand")),"".concat(stringNum).concat(postfix)},getDataFromOracles:function(assetId){var user=$injector.get("user"),asset=$injector.get("baseAssetService").getDefaultAssetsHashById()[assetId]||{},dataOracle=ds.dataManager.getOraclesAssetData(assetId),isGatewaySoon=4===path(["status"],dataOracle)||asset.isGatewaySoon,isGateway=isGatewaySoon&&3===Number(path(["status"],dataOracle))||asset.isGateway,isTokenomica=path(["status"],dataOracle)===STATUS_LIST.VERIFIED&&"Tokenomica"===path(["provider"],dataOracle),isVerified=path(["status"],dataOracle)===STATUS_LIST.VERIFIED&&"Tokenomica"!==path(["provider"],dataOracle)||asset.isVerified,isSuspicious=user.scam[assetId],ticker=path(["ticker"],dataOracle),link=path(["link"],dataOracle),email=path(["email"],dataOracle),logo=path(["logo"],dataOracle),provider=isVerified||isTokenomica&&path(["provider"],dataOracle)||asset.provider||null,description=path(["description","en"],dataOracle),isStable=asset.isStable,isPrediction=asset.isPrediction;return _objectSpread({isVerified:isVerified,isStable:isStable,isGateway:isGateway,isTokenomica:isTokenomica,isSuspicious:isSuspicious,isGatewaySoon:isGatewaySoon,isPrediction:isPrediction,isInvestment:asset.isInvestment,isDefi:asset.isDefi,hasLabel:isVerified||isGateway||isSuspicious||isTokenomica||isGatewaySoon||isStable||isPrediction,ticker:ticker,link:link,email:email,provider:provider,description:description,logo:logo,canRate:null==asset.canRate||asset.canRate},asset)},toArray:function(some){return Array.isArray(some)?some:[some]},toHash:function(list,key){return list.reduce(function(result,item){return result[get(item,key)]=item,result},Object.create(null))},groupMoney:function(moneyList){return moneyList.filter(Boolean).reduce(function(result,money){return result[money.asset.id]?result[money.asset.id]=result[money.asset.id].add(money):result[money.asset.id]=money,result},Object.create(null))},wait:function(time){return $q(function(resolve){time?setTimeout(resolve,time):requestAnimationFrame(resolve)})},addUniqueToArray:function(list,array){list.forEach(function(item){-1===array.indexOf(item)&&array.push(item)})},parseAngularParam:function(attribute,$scope,destroy){var exp=function(value){if(!value)return!1;var openIndex=value.indexOf("{{"),closeIndex=value.indexOf("}}");return-1!==openIndex&&-1!==closeIndex&&openIndex<closeIndex}(attribute)&&attribute,change=new Signal,result=utils.liteObject({attribute:attribute,exp:exp,change:change,value:null});if(exp)if(-1!==exp.indexOf("::"))result.value=$scope.$eval(exp.replace("::","").replace(/{{(.*)?(}})/,"$1"));else{var stop=$scope.$watch(exp,function(value){result.value=value,change.dispatch(value)});destroy.once(function(){stop()})}else result.value=attribute;return result},liteObject:function(props){var result=Object.create(null);return Object.assign(result,props),result},filterOrderBookByCharCropRate:function(data){var _data$cropRange=data.cropRange,min=_data$cropRange.min,max=_data$cropRange.max;return min&&max?{asks:data.asks.filter(function(ask){return ask.price.lte(max)}),bids:data.bids.filter(function(bid){return bid.price.gte(min)})}:{bids:[],asks:[]}},cache:function(storage,fetch,toId,time,fromList){return function(data){var promise,list=utils.toArray(data),toRequest=[],promiseList=[];return list.forEach(function(item){var id=toId(item);storage[id]?promiseList.push(storage[id].then(fromList(item))):toRequest.push(item)}),toRequest.length?(promise=fetch(toRequest),toRequest.forEach(function(item){var id=toId(item);storage[id]=promise,setTimeout(function(){delete storage[id]},time)}),Promise.all([promise].concat(promiseList)).then(function(){for(var _len7=arguments.length,list=new Array(_len7),_key7=0;_key7<_len7;_key7++)list[_key7]=arguments[_key7];return list.reduce(function(acc,i){return acc.concat.apply(acc,_toConsumableArray(i))},[])})):Promise.all(promiseList)}},parseError:function(error){try{return"string"==typeof error?JSON.parse(error).message:error}catch(e){return error}},getOrderBookRangeByCropRate:function(data){if(!(data.asks&&data.asks.length&&data.bids&&data.bids.length))return{min:null,max:null};var spreadPrice=new BigNumber(data.asks[0].price).add(data.bids[0].price).div(2),delta=spreadPrice.mul(data.chartCropRate).div(2),max=spreadPrice.add(delta);return{min:BigNumber.max(0,spreadPrice.sub(delta)),max:max}},chainCall:function(functionList){return new Promise(function(resolve,reject){var callList=functionList.slice().reverse();!function apply(){if(callList.length){var result=callList.pop()();result&&result.then&&"function"==typeof result.then?result.then(apply,reject):apply()}else resolve()}()})},getEventInfo:function(event){return"changedTouches"in event.originalEvent?_objectSpread({},event,{pageX:event.changedTouches[0].pageX,pageY:event.changedTouches[0].pageY,screenX:event.changedTouches[0].screenX,screenY:event.changedTouches[0].screenY,clientX:event.changedTouches[0].clientX,clientY:event.changedTouches[0].clientY}):_objectSpread({},event,{pageX:event.pageX,pageY:event.pageY,screenX:event.screenX,screenY:event.screenY,clientX:event.clientX,clientY:event.clientY})},comparators:{asc:function(a,b){return null==a?null==b?0:-1:null==b?1:b<a?1:a===b?0:-1},desc:function(a,b){return null==a?null==b?0:1:null==b?-1:b<a?-1:a===b?0:1},bigNumber:{asc:function(a,b){return a.gt(b)?1:a.eq(b)?0:-1},desc:function(a,b){return a.gt(b)?-1:a.eq(b)?0:1}},money:{asc:function(a,b){return utils.comparators.bigNumber.asc(a.getTokens(),b.getTokens())},desc:function(a,b){return utils.comparators.bigNumber.desc(a.getTokens(),b.getTokens())}},smart:{asc:function(a,b){return a instanceof Money&&b instanceof Money?utils.comparators.money.asc(a,b):a instanceof BigNumber&&b instanceof BigNumber?utils.comparators.bigNumber.asc(a,b):utils.comparators.asc(a,b)},desc:function(a,b){return a instanceof Money&&b instanceof Money?utils.comparators.money.desc(a,b):a instanceof BigNumber&&b instanceof BigNumber?utils.comparators.bigNumber.desc(a,b):utils.comparators.desc(a,b)}},process:function(processor){return{asc:function(a,b){return utils.comparators.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.desc(processor(a),processor(b))},bigNumber:{asc:function(a,b){return utils.comparators.bigNumber.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.bigNumber.desc(processor(a),processor(b))}},money:{asc:function(a,b){return utils.comparators.money.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.money.desc(processor(a),processor(b))}},smart:{asc:function(a,b){return utils.comparators.smart.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.smart.desc(processor(a),processor(b))}}}}},remapOldClientAccounts:function(account){return{name:account.name,address:account.address,encryptedSeed:account.cipher,settings:{encryptionRounds:1e3}}},getSecretToken:function(_ref18){var senderPublicKey=_ref18.senderPublicKey,service=_ref18.service,signature=_ref18.signature,timestamp=_ref18.timestamp;return fetch("".concat(service,"/oauth/token"),{method:"POST",headers:{Authorization:"Basic ".concat(btoa("test-client:secret")),"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:"grant_type=password&username=".concat(senderPublicKey,"&password=").concat(timestamp,":").concat(signature,"&scope=client")}).then(function(response){return response.json()})},getExchangeTotalPrice:function(amount,price){var amountTokens=amount.getTokens(),priceTokens=price.getTokens(),precision=price.asset.precision;return amountTokens.mul(priceTokens).toFormat(precision)},getExchangeFee:function(tx){return tx.exchangeType===WavesApp.TRANSACTION_TYPES.EXTENDED.EXCHANGE_BUY?tx.buyMatcherFee:tx.sellMatcherFee},getTransactionTypeName:function(tx){var user=$injector.get("user");return ds.utils.transactions.getTransactionTypeName(tx,user)},typOfExchange:function(_ref19){var exchangeType=_ref19.exchangeType;return ds.utils.transactions.typeOfExchange({exchangeType:exchangeType})},isMyPublicKey:function(publicKey){var user=$injector.get("user");return ds.utils.transactions.isMyPublicKey(publicKey,user.publicKey)},isMyAddressOrAlias:function(addressOrAlias){var user=$injector.get("user");return ds.utils.transactions.isMyAddressOrAlias(addressOrAlias,user.address)},isNotEqualValue:isNotEqualValue,checkIsScriptError:function(error){return 7==(error>>8&4095)},signInvoke:function(data){var user=$injector.get("user"),signableData={type:SIGN_TYPE.SCRIPT_INVOCATION,data:ds.utils.normalizeTxTimestamp(data)};return utils.createSignable(signableData).then(function(signable){return"seed"===user.userType||"privateKey"===user.userType?signable.addMyProof().then(function(){return signable}):signable.getSignature().then(function(){return signable})})},createOrder:function(data,orderType){var _this41=this,timestamp=ds.utils.normalizeTime(Date.now()),notification=$injector.get("notification"),modalManager=$injector.get("modalManager"),isAdvancedMode=$injector.get("user").getSetting("advancedMode"),signableData={type:SIGN_TYPE.CREATE_ORDER,data:_objectSpread({},data,{version:3,timestamp:timestamp})};return utils.createSignable(signableData).then(function(signable){return utils.signMatcher(signable).then(function(signable){return signable.getDataForApi()}).then(function(data){return"market"===orderType?ds.createMarketOrder(data):ds.createOrder(data)}).catch(function(data){var isScriptError=_this41.checkIsScriptError(data.error);return isAdvancedMode&&isScriptError?modalManager.showConfirmTx(signable,!1).then(function(data){return"market"===orderType?ds.createMarketOrder(data):ds.createOrder(data)},function(){return null}):Promise.reject(_objectSpread({},data,{isScriptError:isScriptError}))})}).catch(function(data){return data&&data.error&&data.isScriptError?notification.error({ns:"app.dex",title:{literal:"directives.createOrder.notifications.error.title"},body:{literal:"directives.createOrder.notifications.error.".concat(data.error),params:data.params?data.params:{}}},-1):notification.error({ns:"app.dex",title:{literal:"directives.createOrder.notifications.error.title"},body:{literal:data&&data.message||data}},-1),Promise.reject(data)})},createSignable:function(data){try{return Promise.resolve(ds.signature.getSignatureApi().makeSignable(data))}catch(e){return Promise.reject(e)}},signToken:function(serviceName,expiration){var api=ds.signature.getSignatureApi(),seconds=Math.floor(expiration/1e3),code=api.getNetworkByte(),netByte="string"==typeof code?code:String.fromCharCode(code),data="".concat(netByte,":").concat(serviceName,":").concat(String(seconds)),bytes=stringToBytes(data),serializeData={version:1,binary:libs.crypto.base64Encode(bytes)},binary=serializeCustomData(serializeData),hash=libs.crypto.base58Encode(libs.crypto.blake2b(binary));return utils.signApiToken({binary:binary,hash:hash,sign:function(){return api.signApiTokenData(serviceName,expiration)},expiresIn:seconds})},getApiToken:function(authData){return ds.utils.ApiTokenService.getInstance().getTokenById(authData&&authData.refreshToken,utils.signToken)},signApiToken:function(signData){return this.deviceSign(signData.sign,"apiToken",_objectSpread({type:"apiToken"},signData))},signUserOrders:function(data){var api=ds.signature.getSignatureApi(),_ref20$matcherSign=(data||{matcherSign:{}}).matcherSign,matcherSign=void 0===_ref20$matcherSign?{}:_ref20$matcherSign,signature=matcherSign.signature,timestamp=matcherSign.timestamp;return api.getPublicKey().then(function(senderPublicKey){var _libs$marshall$serial=libs.marshall.serializePrimitives,BASE58_STRING=_libs$marshall$serial.BASE58_STRING,LONG=_libs$marshall$serial.LONG,pBytes=BASE58_STRING(senderPublicKey),sBytes=BASE58_STRING(signature),timestampBytes=LONG(timestamp),bytes=Uint8Array.from([].concat(_toConsumableArray(Array.from(pBytes)),_toConsumableArray(Array.from(timestampBytes))));return libs.crypto.verifySignature(pBytes,bytes,sBytes)?Promise.resolve():Promise.reject()}).then(function(){var dayForwardTime=ds.app.getTimeStamp(1,"day");return!timestamp||timestamp-dayForwardTime<0?Promise.reject():Promise.resolve(data.matcherSign)}).catch(function(){var timestamp=ds.app.getTimeStamp(WavesApp.matcherSignInterval.count,WavesApp.matcherSignInterval.timeType),signable=ds.signature.getSignatureApi().makeSignable({type:SIGN_TYPE.MATCHER_ORDERS,data:{timestamp:timestamp}});return utils.signMatcher(signable).then(function(signable){return signable.getSignature()}).then(function(signature){return{signature:signature,timestamp:timestamp}})})},deviceSign:function(signCb,signType,anyData){var user=$injector.get("user"),modalManager=$injector.get("modalManager");if("seed"===user.userType||"privateKey"===user.userType)return signCb();return function signByDeviceLoop(){return modalManager.showSignByDevice(signCb,anyData).catch(function(e){return modalManager.showSignDeviceError(_objectSpread({signableType:signType},function(user,error){return"wavesKeeper"===user.userType&&error&&5===error.code&&error.msg.includes("another active account")?{error:"sign-user-error",userType:user.userType}:{error:"sign-error",userType:user.userType}}(user,e))).then(function(){return signByDeviceLoop()})}).catch(function(){return Promise.reject({message:"Your sign is not confirmed!"})})}()},signMatcher:function(signable,argument_1){var anyData=1<arguments.length&&void 0!==argument_1?argument_1:null;return this.deviceSign(function(){return signable.addMyProof().then(function(){return signable})},signable.type,_objectSpread({signable:signable},anyData))},assetNameWarning:function(name){var user=$injector.get("user");if(!(name=(name||"").toLowerCase().trim()))return Promise.resolve(!1);if(name&&Object.keys(user.tokensName).some(function(item){return name===item.toLowerCase()}))return Promise.resolve(!0);var api=ds.config.get("api");return ds.fetch("".concat(api,"/v0/assets?search=").concat(encodeURIComponent(name))).then(function(_ref21){return _ref21.data.some(function(_ref22){var data=_ref22.data;return(data.name||"").toLowerCase()===name||(data.ticker||"").toLowerCase()===name})}).catch(function(){return!1})},isLockedInDex:function(assetId1,argument_1){var assetId2=1<arguments.length&&void 0!==argument_1?argument_1:null,configService=$injector.get("configService"),lockedAssetsIndDex=$injector.get("baseAssetService").getIdByTicker(configService.get("SETTINGS.DEX.LOCKED_PAIRS")||[]);return lockedAssetsIndDex.includes(assetId1)||lockedAssetsIndDex.includes(assetId2)},isLockedInDexSmartAssets:function(amountAsset,priceAsset){return $injector.get("configService").get("SETTINGS.DEX.SMART_ASSETS_LOCKED")&&(amountAsset.hasScript||priceAsset.hasScript)},getShortId:function(id){return 12<id.length?"".concat(id.slice(0,6),"****").concat(id.slice(-6)):id},downloadFile:function(filename,text){var pom=document.createElement("a");if(pom.setAttribute("href","data:text/plain;charset=utf-8,".concat(encodeURIComponent(text))),pom.setAttribute("download",filename),document.createEvent){var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!0),pom.dispatchEvent(event)}else pom.click()},startTimer:function(options,cb,timeout){var timer,isStop=!1,getLastTime=function(date){var year=date.year,day=date.day,month=date.month-1,hours=date.hours||0,minutes=date.minutes||0,seconds=date.seconds||0,offset=6e4*(new Date).getTimezoneOffset(),msToday=Date.now(),msDate=new Date(year,month,day,hours,minutes,seconds).getTime()-offset-108e5,delta=msDate-msToday<0?0:msDate-msToday,daysLast=Math.floor(delta/864e5),hoursLast=Math.floor(delta/36e5)%24,minuteslast=Math.floor(delta/6e4)%60,secondslast=Math.floor(delta/1e3)%60;return{days:daysLast,hours:hoursLast,minutes:minuteslast,seconds:secondslast}}.bind(null,options),lastTime={};return function loop(){if(!isStop){timer&&clearTimeout(timer);var currentTime=getLastTime();lastTime.minutes===currentTime.minutes&&lastTime.seconds===currentTime.seconds||(cb(currentTime),lastTime=currentTime),0<currentTime.seconds+currentTime.hours+currentTime.minutes+currentTime.days&&(timer=setTimeout(loop,timeout))}}(),function(){isStop=!0}},filterPinnedAssets:function(assetsList){return assetsList.filter(function(assetId){return"string"==typeof assetId&&0<assetId.length&&!!assetId&&!assetId.includes(" ")})}};function isNotEqualValue(oldValue,newValue){return _typeof(oldValue)!==_typeof(newValue)||(oldValue instanceof Money&&newValue instanceof Money?oldValue.asset.id!==newValue.asset.id||oldValue.toTokens()!==newValue.toTokens():oldValue instanceof BigNumber&&newValue instanceof BigNumber?!oldValue.eq(newValue):Array.isArray(oldValue)&&Array.isArray(newValue)?oldValue.length!==newValue.length||oldValue.some(function(item,i){return isNotEqualValue(item,newValue[i])}):oldValue!==newValue)}return utils};factory.$inject=["$q","$injector"],angular.module("app.utils").factory("utils",factory)}(),function(){var Money=require("@waves/data-entities").Money,locationHref=location.href,i18next=require("i18next"),ds=require("data-service"),_require13=require("ramda"),propEq=_require13.propEq,where=_require13.where,gte=_require13.gte,lte=_require13.lte,equals=_require13.equals,__=_require13.__,i18nextReady=new Promise(function(resolve){if(i18next.isInitialized)resolve(i18next.options);else{var interval=setInterval(function(){i18next.isInitialized&&(resolve(i18next.options),i18next.off("initialized",handler))},1e3),handler=function handler(data){resolve(data),i18next.off("initialized",handler),clearInterval(interval)};clearInterval(interval),i18next.on("initialized",handler)}}),PROGRESS_MAP={RUN_SCRIPT:10,APP_RUN:40,LOCALIZE_READY:50};if(100!==Object.values(PROGRESS_MAP).reduce(function(result,item){return result+item},0))throw new Error("Configure preloader progress!");var LOADER={_current:0,_root:document.querySelector(".app-loader"),_element:document.querySelector(".app-loader .progress"),addProgress:function(delta){this._current+=delta,this._current=Math.min(this._current,100),this._element.style.width="".concat(this._current,"%"),WavesApp.progress=this._current},stop:function(){var _this42=this;return new Promise(function(resolve){var loader=$(_this42._root);function remove(){resolve(),loader.remove()}var timer=setTimeout(function(){remove()},2e3);try{loader.fadeOut(1e3,function(){clearTimeout(timer),remove()})}catch(e){remove(),clearTimeout(timer)}})}},STAKING_ADV_EXCEPTIONS=["news","signIn","migration"],STATES_WITH_STAKING_INFO=["investments","staking","stakingLanding"];LOADER.addProgress(PROGRESS_MAP.RUN_SCRIPT),WavesApp.state="initApp";var run=function($rootScope,utils,user,$state,$transitions,state,modalManager,storage,balanceWatcher,matcher,notification,decorators,multiAccount,ModalRouter,configService,userNotification,migrationService,configsActionsService,baseAssetService,whatsNew,referralLinkService){var _dec,_class,phone=WavesApp.device.phone(),tablet=WavesApp.device.tablet(),analytics=require("data-service").analytics,isPhone=!!phone,isTablet=!!tablet,isDesktop=!(isPhone||isTablet),isWeb=WavesApp.isWeb();return $rootScope.isDesktop=isDesktop,$rootScope.isNotDesktop=!isDesktop,$rootScope.isPhone=isPhone,$rootScope.isNotPhone=!isPhone,$rootScope.isTablet=isTablet,isPhone?document.body.classList.add("phone"):isTablet?document.body.classList.add("tablet"):isWeb?document.body.classList.add("web"):document.body.classList.add("desktop"),new(_dec=decorators.scope({closeByModal:!1}),_applyDecoratedDescriptor((_class=function(){function AppRun(){var _this43=this;_classCallCheck(this,AppRun),this._unavailable=!1;var identityImg=require("identity-img");LOADER.addProgress(PROGRESS_MAP.APP_RUN),this.activeClasses=[],this._modalRouter=new ModalRouter,identityImg.config({rows:8,cells:8}),setTimeout(function(){_this43._getImagesReadyPromise()},configService.get("SETTINGS.PRELOAD_TIMEOUT")||1e4),this._setHandlers(),this._stopLoader(),this._initializeLogin(),this._sendOpenAppAnalytics(),this._initializeOutLinks(),this._listenChangeLanguage(),configsActionsService.run(),WavesApp.isDesktop()&&(migrationService.listen(),migrationService.onConnect(function(){$state.go("migration")})),storage.load("lng").then(function(lng){i18next.changeLanguage(lng||i18next.options.fallbackLng[0])}),$rootScope.WavesApp=WavesApp}var _showStakingInfoModal2;return _createClass(AppRun,[{key:"_initTryDesktop",value:function(){var _this44=this;if(multiAccount.isSignedIn||!isDesktop||WavesApp.isDesktop())return Promise.resolve(!0);var url=new URL(locationHref),href="waves-exchange://".concat(url.pathname).concat(url.search).concat(url.hash).replace("///","//");return storage.load("openClientMode").then(function(clientMode){switch(clientMode){case"desktop":return window.open(href),_this44._runDesktop();case"web":default:return Promise.resolve(!0)}})}},{key:"_runDesktop",value:function(){return this._canOpenDesktopPage=!0,$state.go("desktop"),!1}},{key:"_setHandlers",value:function(){var _this45=this;$transitions.onSuccess({},function(transition){_this45._onChangeStateSuccess(transition)}),configService.change.on(this._updateServiceAvailable,this)}},{key:"_updateServiceAvailable",value:function(path){if("SERVICE_TEMPORARILY_UNAVAILABLE"!==path)return null;var unavailable=configService.get("SERVICE_TEMPORARILY_UNAVAILABLE");if(unavailable===this._unavailable)return null;(this._unavailable=unavailable)&&!user.address?$state.go("unavailable"):user.logout("welcome")}},{key:"_initializeOutLinks",value:function(){WavesApp.isDesktop()&&$(document).on("click",'[target="_blank"]',function(e){var $link=$(e.currentTarget);e.preventDefault(),openInBrowser($link.attr("href"))})}},{key:"_userByIdNotification",value:function(id){if(id){var closed=user.getSetting("closedUserNotification")||[],_configService$getUse2=configService.getUserNotifications().byIds;(void 0===_configService$getUse2?[]:_configService$getUse2).filter(function(msg){return!closed.includes(msg.id)&&msg.users.includes(id)}).forEach(function(item){var method=["warn","success","error","info"].find(equals(item.message.type))||"warn",literal="user-notification.".concat(item.id);Object.entries(item.message.text).forEach(function(_ref23){var _ref24=_slicedToArray(_ref23,2),lang=_ref24[0],message=_ref24[1];i18next.addResource(lang,"app",literal,message)}),userNotification[method](_objectSpread({id:item.id},item.message,{body:{literal:literal}})).then(function(){user.setSetting("closedUserNotification",[item.id].concat(_toConsumableArray(user.getSetting("closedUserNotification")||[])))})})}}},{key:"_updateUserNotifications",value:function(){user.getMultiAccountSettings().then(function(settings){return user.setMultiAccountSettings(settings)}).then(function(){var notifications=configService.get("NOTIFICATIONS")||[],time=ds.utils.normalizeTime(Date.now()),closed=(user.getSetting("closedNotification")||[]).filter(function(id){return notifications.some(propEq("id",id))});user.setSetting("closedNotification",closed);var notificationsWithDate=notifications.map(function(item){return _objectSpread({},item,{start_date:new Date(item.start_date),end_date:new Date(item.end_date)})});notificationsWithDate.filter(where({start_date:lte(__,time),end_date:gte(__,time),id:function(_id){return!(userNotification.has(_id)||closed.includes(_id))}})).forEach(function(item){var method=["warn","success","error","info"].find(equals(item.type))||"warn",literal="user-notification.".concat(item.id);Object.entries(item.text).forEach(function(_ref25){var _ref26=_slicedToArray(_ref25,2),lang=_ref26[0],message=_ref26[1];i18next.addResource(lang,"app",literal,message)}),userNotification[method](_objectSpread({},item,{body:{literal:literal}})).then(function(){user.setSetting("closedNotification",[item.id].concat(_toConsumableArray(user.getSetting("closedNotification"))))})}),notificationsWithDate.filter(where({end_date:lte(__,time)})).forEach(function(item){return userNotification.remove(item.id)})})}},{key:"_listenChangeLanguage",value:function(){i18next.on("languageChanged",this._changeLangHandler)}},{key:"_stopListenChangeLanguage",value:function(){i18next.off("languageChanged",this._changeLangHandler)}},{key:"_changeLangHandler",value:function(){storage.save("lng",i18next.language),WavesApp.isDesktop()&&localStorage.setItem("lng",JSON.stringify(i18next.language))}},{key:"_initializeLogin",value:function(){var _this46=this;storage.load("uiId").then(function(uiId){analytics.init({platform:WavesApp.type,networkByte:ds.config.get("code"),userType:"unknown",referrer:document.referrer,auuid:uiId||void 0}),analytics.activate()}),this._onInitialTransitions(),user.logoutSignal.on(function(){notification.destroyAll(),userNotification.removeAll(),clearInterval(_this46._notifyTimer)}),user.loginSignal.on(function(){userNotification.destroyAll(),i18nextReady.then(function(){_this46._initializeCurveNotify(),storage.load("subscribeModalViewed").then(function(isViewed){isViewed||modalManager.showEmailSubscribeModal()})}),balanceWatcher.change.once(_this46._onBalanceChange,_this46),user.getSetting("hasBackup")||_this46._initializeBackupWarning()}),i18nextReady.then(function(){_this46._initializeCurveNotify(),_this46._updateUserNotifications(),clearInterval(_this46._notifyTimer),_this46._notifyTimer=setInterval(function(){_this46._updateUserNotifications(),storage.load("uiId").then(function(uiId){return _this46._userByIdNotification(uiId)})},1e4)})}},{key:"_sendToStat",value:function(lng,usersLength){var params={label:lng,value:usersLength.toString()};ds.analytics.sendToRest("User_Site_Open_Rest",params)}},{key:"_sendOpenAppAnalytics",value:function(){var _this47=this;Promise.all([storage.load("lng"),storage.load("multiAccountUsers")]).then(function(_ref27){var _ref28=_slicedToArray(_ref27,2),lng=_ref28[0],usersMap=_ref28[1];lng=lng||"en";var users=usersMap?Object.keys(usersMap).length:0;try{_this47._sendToStat(lng,users)}catch(e){console.error(e)}analytics.user.siteOpen(lng,users)})}},{key:"_getIntercomElements",value:function(){return{intercomElement:document.querySelector("#intercom-container")}}},{key:"_hideIntercom",value:function(){var intercomElement=this._getIntercomElements().intercomElement;if(intercomElement&&(intercomElement.style.display="none"),window.intercomSettings.hide_default_launcher=!0,!window.Intercom)return null;window.Intercom("update",{hide_default_launcher:!0}),window.Intercom("hide")}},{key:"_showIntercom",value:function(){window.intercomSettings.hide_default_launcher=!1;var intercomElement=this._getIntercomElements().intercomElement;window.Intercom("update",{hide_default_launcher:!1}),intercomElement&&(intercomElement.style.display="block")}},{key:"_onInitialTransitions",value:function(){var _this48=this,waiting=!1,START_STATES=WavesApp.stateTree.where({noLogin:!0}).map(function(item){return WavesApp.stateTree.getPath(item.id).join(".")}).concat(["news","staking","prediction","stakingRef","main.trade","investments","stakingFaq","buyBTC","buyBTCFaq","buyWaves","buyWAVESFaq","leverage","page404","marketMaking","buyUsdn","buyUSDNFaq","defoLanding","defoFaq","defoStakingFaq","otc","otcFaq","defoInvestmentFaq"]),offInitialTransitions=$transitions.onStart({},function(transition){var tryDesktop,toState=transition.to(),fromState=transition.from(),params=transition.params();if(["main.dex","main.dex-demo"].includes(toState.name))return $state.target("main.trade",{tradingPair:"".concat(params.assetId1,"_").concat(params.assetId2)});if("stakingLegacy"===toState.name||"staking"===toState.name)return $state.target("stakingLanding");if("leasingLegacy"===toState.name)return $state.target("leasing");if("buycrypto"===toState.name)return $state.target("buyBTC");"main.trade"===toState.name?_this48._hideIntercom():_this48._showIntercom();var resultDexDemoTransition=_this48._onDexDemoTransition(transition);if(resultDexDemoTransition)return resultDexDemoTransition;if("stakingRef"===toState.name&&!fromState.name&&params.ref)return referralLinkService.save(params.ref),ds.analytics.referral.openByReferralLink(params.ref),$state.target("stakingLanding");if(-1===START_STATES.indexOf(toState.name)){if("unavailable"===fromState.name)return $state.target(START_STATES[0]);if(!multiAccount.isSignedIn)return user.setInitRouteState(toState.name,params),$state.target(START_STATES[0])}return("unavailable"!==toState.name||_this48._unavailable)&&("desktop"!==toState.name||_this48._canOpenDesktopPage)?(_this48._showStakingInfoModal(toState),waiting?null:(tryDesktop="main.trade"!==toState.name||user.address?_this48._initTryDesktop():Promise.resolve(),waiting=!0,void tryDesktop.then(function(canChangeState){return _this48._login(toState,fromState,canChangeState)}).then(function(){waiting=!1,offInitialTransitions(),-1===START_STATES.indexOf(toState.name)&&$state.go(toState.name,params),_this48._initializeTermsAccepted().then(function(){return user.onLogin()}).then(function(){_this48._modalRouter.initialize()});var offInnerTransitions=_this48._onInnerTransitions(START_STATES);user.logoutSignal.once(function(){offInnerTransitions(),_this48._onInitialTransitions()})}).catch(function(){waiting=!1}))):$state.target(START_STATES[0])})}},{key:"_onDexDemoTransition",value:function(transition){var skipStates=["signIn","signUp","import","create","keeper","ledger","fromBackup","chooseUser"],toState=transition.to(),fromState=transition.from(),params=transition.params();if(!["staking","stakingLanding","welcome"].includes(toState.name))return"main.trade"!==fromState.name||user.address?void(!this.hasDexDemo&&user.address||(skipStates.includes(toState.name)||skipStates.includes(fromState.name))&&!user.address||(this.hasDexDemo=!1)):(this.hasDexDemo=!0,void(params.tradingPair&&(user.forceInitRouteState("main.trade",{tradingPair:params.tradingPair}),user.buyOptions=null)));user.forceInitRouteState(null)}},{key:"_onInnerTransitions",value:function(START_STATES){var _this49=this;return $transitions.onStart({},function(transition){var toState=transition.to(),custom=transition.options().custom;return"main.trade"===toState.name?_this49._hideIntercom():_this49._showIntercom(),!_this49._onDexDemoTransition(transition)&&(_this49._showStakingInfoModal(toState),!(-1!==START_STATES.indexOf(toState.name)&&!custom.logout&&"migration"!==toState.name&&"news"!==toState.name&&"staking"!==toState.name&&"faq"!==toState.name&&"stakingFaq"!==toState.name&&"nsbtFaq"!==toState.name&&"prediction"!==toState.name&&"main.trade"!==toState.name&&"investments"!==toState.name&&"buyBTC"!==toState.name&&"buyBTCFaq"!==toState.name&&"leasingFaq"!==toState.name&&"investments"!==toState.name&&"leverage"!==toState.name&&"buyUsdn"!==toState.name&&"buyUSDNFaq"!==toState.name&&"defo"!==toState.name&&"defoFaq"!==toState.name&&"defoStakingFaq"!==toState.name&&"otc"!==toState.name&&"otcFaq"!==toState.name&&"defoInvestmentFaq"!==toState.name)&&void state.signals.changeRouterStateStart.dispatch(transition))})}},{key:"_onBalanceChange",value:function(){if(!user.getSetting("hasBackup")){var balance=balanceWatcher.getBalance(),baseAssetId=baseAssetService.getBaseAssetId(),pairs=Object.entries(balance).reduce(function(acc,_ref29){var _ref30=_slicedToArray(_ref29,2),assetId=_ref30[0];return"0"!==_ref30[1].toTokens()&&acc.push([assetId,baseAssetId]),acc},[]);0!==pairs.length&&Promise.all([ds.api.assets.get(baseAssetId),ds.api.matchers.getRates(matcher.currentMatcherAddress,pairs)]).then(function(_ref31){var _ref32=_slicedToArray(_ref31,2),usdAsset=_ref32[0],usd=_ref32[1].data.reduce(function(acc,rate){var amountAssetInUsd=balance[rate.amountAsset].convertTo(usdAsset,rate.data.rate);return acc.add(amountAssetInUsd)},new Money(0,usdAsset));usd.gte(usd.cloneWithTokens(100))&&modalManager.showTutorialModals()})}}},{key:"_initializeTermsAccepted",value:function(){return storage.load("needReadNewTerms").then(function(needReadNewTerms){return needReadNewTerms?modalManager.showAcceptNewTerms(user):Promise.resolve()})}},{key:"_initializeCurveNotify",value:function(){storage.load("curve-notification-closed").then(function(property){null==property&&(notification.has("curve")||notification.info({id:"curve",ns:"app.ui",mod:"curve-notification",title:{literal:"notification.curve.title"},body:{literal:"notification.curve.body"},onCloseByUser:function(){storage.save("curve-notification-closed","closed")}},-1))})}},{key:"_initializeBackupWarning",value:function(scope){var _this50=this,id="_hasBackupId";if(!notification.has(id)){var changeModalsHandler=function(modal){scope.closeByModal=!0,notification.remove(id),scope.closeByModal=!1,modal.catch(function(){return null}).then(function(){user.getSetting("hasBackup")||_this50._initializeBackupWarning()})};modalManager.openModal.once(changeModalsHandler),analytics.send({name:"Create Save Phrase Show",target:"ui"}),notification.error({id:id,ns:"app.utils",title:{literal:"notification.backup.title"},body:{literal:"notification.backup.body"},action:{literal:"notification.backup.action",callback:function(){analytics.send({name:"Create Save Phrase Yes Click",target:"ui"}),modalManager.showSeedBackupModal()}},onClose:function(){if(notification.remove(id),scope.closeByModal||user.getSetting("hasBackup"))return null;modalManager.openModal.off(changeModalsHandler);var stop=$transitions.onSuccess({},function(){stop(),_this50._initializeBackupWarning()})},onCloseByUser:function(){analytics.send({name:"Create Save Phrase No Click",target:"ui"})}},-1)}}},{key:"_login",value:function(currentState,prevState,canChangeState){if(user.isAuthorised)return user.onLogin();var states=WavesApp.stateTree.where({noLogin:!0}).map(function(item){return WavesApp.stateTree.getPath(item.id).join(".")}).concat(multiAccount.isSignedIn?["create","migrate","news","staking","chooseUser","prediction","investments","buyBTC","buyBTCFaq","nsbt","leverage","leasing","buyUsdn","buyUSDNFaq","defo","defoFaq","defoStakingFaq","swapWavesUsdn","defoStakingFaq","otc","otcFaq","defoInvestment","defoInvestmentFaq"]:["news","staking","prediction","stakingRef","investments","leverage","buyBTC","buyBTCFaq","page404","marketMaking","buyUsdn","buyUSDNFaq","defoLanding","defoFaq","defoStakingFaq","otc","otcFaq","defoInvestmentFaq"]);return canChangeState&&-1===states.indexOf(currentState.name)&&"chooseUser"!==prevState.name&&$state.go(states[0]),user.onLogin()}},{key:"_onChangeStateSuccess",value:function(transition){var _this51=this,toState=transition.to(),fromState=transition.from(),from=fromState.name||document.referrer;if(toState.name!==fromState.name){switch(toState.name){case"create":analytics.send({name:"Create New Account Show",params:{from:from}});break;case"import":analytics.send({name:"Import Accounts Show",params:{from:from},target:"ui"});break;case"restore":analytics.send({name:"Import Backup Show",params:{from:from},target:"ui"});break;case"leasing":analytics.send({name:"Leasing Show",params:{from:from},target:"ui"});break;case"main.tokens":analytics.send({name:"Token Generation Show",target:"ui"});break;case"main.wallet.assets":analytics.send({name:"Wallet Assets Show",target:"ui"});break;case"main.wallet.portfolio":analytics.send({name:"Wallet Portfolio Show",target:"ui"});break;case"main.trade":analytics.send({name:"DEX Show",target:"ui"});break;case"otc":user.isAuthorised?analytics.otc.pageShow():analytics.otc.showLandingPage()}if(this.activeClasses.forEach(function(className){document.body.classList.remove(className)}),this.activeClasses=[],toState.name.split(".").filter(Boolean).forEach(function(className){var name=className.replace(/_/g,"-");document.body.classList.add(name),_this51.activeClasses.push(name)}),"main.trade"===toState.name&&!user.address){document.body.classList.add("trade_demo"),this.activeClasses.push("trade_demo")}}var params=transition.params();user.applyState(toState,params),state.signals.changeRouterStateSuccess.dispatch(toState)}},{key:"_stopLoader",value:function(){Promise.all([this._getLocalizeReadyPromise()]).then(function(){LOADER.stop(),WavesApp.state="appRun"}).catch(function(e){console.error(e),WavesApp.state="loadingError"})}},{key:"_getLocalizeReadyPromise",value:function(){return i18nextReady.then(function(){return LOADER.addProgress(PROGRESS_MAP.LOCALIZE_READY)})}},{key:"_getImagesReadyPromise",value:function(){return $.ajax({url:"/img/images-list.json?v=".concat(WavesApp.version),dataType:"json"}).then(AppRun.loadImages)}},{key:"_showStakingInfoModal",value:(_showStakingInfoModal2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(state){var showStakingAdv,stakingAdvIsClosed;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return showStakingAdv=configService.get("SETTINGS.SHOW_STAKING_ADV"),_context2.next=3,storage.load("stakingAdvIsClosed");case 3:if(stakingAdvIsClosed=_context2.sent,!showStakingAdv||stakingAdvIsClosed||STAKING_ADV_EXCEPTIONS.includes(state.name)||user.sawStakingAdv)return _context2.abrupt("return");_context2.next=6;break;case 6:if(STATES_WITH_STAKING_INFO.includes(state.name))return user.sawStakingAdv=!0,_context2.abrupt("return");_context2.next=9;break;case 9:user.sawStakingAdv=!0,modalManager.showStakingInfoModal();case 11:case"end":return _context2.stop()}},_callee2)})),function(_x){return _showStakingInfoModal2.apply(this,arguments)})}],[{key:"getLoadImagePromise",value:function(){return function(path){return new Promise(function(resolve){var img=new Image,apply=function(){resolve()};if(path&&0<path.indexOf(".svg"))return resolve();img.onload=function(){return setTimeout(function(){return apply()},50)},img.onerror=function(){console.warn("Can't load image! \"".concat(path,'"')),apply()},img.src=path})}}},{key:"loadImages",value:function(list){var queue=list.map(function(item){return{fn:function(){return AppRun.getLoadImagePromise()(item)}}});new ds.utils.PromiseQueue(queue,1).startIterate()}},{key:"_getUrlFromState",value:function(state){return WavesApp.stateTree.getPath(state.name.split(".").slice(-1)[0]).filter(function(id){return!WavesApp.stateTree.find(id).get("abstract")}).map(function(id){return WavesApp.stateTree.find(id).get("url")||id}).reduce(function(url,id){return"".concat(url,"/").concat(id)},"")}}]),AppRun}()).prototype,"_initializeBackupWarning",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"_initializeBackupWarning"),_class.prototype),_class)};run.$inject=["$rootScope","utils","user","$state","$transitions","state","modalManager","storage","balanceWatcher","matcher","notification","decorators","multiAccount","ModalRouter","configService","userNotification","migrationService","configsActionsService","baseAssetService","whatsNew","referralLinkService"],angular.module("app").run(run);var utils=require("data-service").utils;$(function(){new utils.ConfigService(WavesApp).configReady.then(function(){angular.bootstrap(document.querySelector("html"),["app"])})})}(),angular.module("app.buyUSDNFaq",[]),angular.module("app.chooseUser",[]),angular.module("app.fromBackup",[]),angular.module("app.leasingFaq",[]),angular.module("app.prediction",[]),angular.module("app.stakingFaq",[]),function(){var factory=function(utils){var each=require("ts-utils").each,Router=function(){function Router(){_classCallCheck(this,Router),this._routesHash=Object.create(null)}return _createClass(Router,[{key:"apply",value:function(fullUrl){var _this52=this,_fullUrl$split2=_slicedToArray(fullUrl.split("?"),2),url=_fullUrl$split2[0],searchStr=_fullUrl$split2[1],search=utils.parseSearchParams(searchStr),parts=url.split("/"),urls=Object.keys(this._routesHash).sort(function(a,b){var reg=/:/g;return(a.match(reg)||{length:0}).length-(b.match(reg)||{length:0}).length}).map(function(url){return url.split("/")}).filter(function(routeParts){return routeParts.length===parts.length}),listener=null,params=null;return urls.some(function(routeParts){var urlParams=Object.create(null),valid=routeParts.every(function(part,i){return":"===part.charAt(0)?(urlParams[part.substr(1)]=parts[i],!0):part===parts[i]});return valid&&(params=urlParams,listener=_this52._routesHash[routeParts.join("/")]),valid}),listener?listener(params,search):null}},{key:"registerRoute",value:function(route,listener){this._routesHash[route]=listener}},{key:"registerRouteHash",value:function(hash){var _this53=this;each(hash,function(listener,url){_this53.registerRoute(url,listener)})}}]),Router}();return Router.ROUTES={SEND:"/send",SEND_ASSET:"/send/:assetId",ASSET_INFO:"/asset/:assetId",ACCOUNT:"/account",GATEWAY_AUTH:"/gateway/auth",ANY_TX:"/tx"},Router};factory.$inject=["utils"],angular.module("app.utils").factory("Router",factory)}(),rc=require("react-components"),(wOtc=function(reactDirective,$state,user,balanceWatcher,modalManager,baseAssetService,notification){return reactDirective(rc.Otc,void 0,void 0,{$state:$state,user:user,balanceWatcher:balanceWatcher,modalManager:modalManager,baseAssetService:baseAssetService,notification:notification})}).$inject=["reactDirective","$state","user","balanceWatcher","modalManager","baseAssetService","notification"],angular.module("app.otc").directive("wOtc",wOtc),function(){var controller=function(Base){var tsUtils=require("ts-utils");return new(function(){function Tab(){var _this54;return _classCallCheck(this,Tab),(_this54=_possibleConstructorReturn(this,_getPrototypeOf(Tab).call(this))).selected=!1,_this54.wTabs=null,_this54.title="",_this54.id="",_this54.changeId=new tsUtils.Signal,_this54.observe("id",function(){if(!_this54.id)throw new Error("Tab without id!");_this54.changeId.dispatch(_assertThisInitialized(_this54))}),_this54}return _inherits(Tab,Base),_createClass(Tab,[{key:"$onInit",value:function(){this.wTabs.addTab(this)}}]),Tab}())};controller.$inject=["Base"],angular.module("app.ui").component("wTab",{transclude:!0,template:'<div ng-if="$ctrl.selected" class="tab-tem" ng-transclude></div>',controller:controller,require:{wTabs:"^wTabs"},bindings:{title:"<titleName",id:"<"}})}(),function(){var factory=function($q,utils,migration,state,storageSelect,$injector){var difference=require("ramda").difference,usedStorage=storageSelect(),MIGRATION_MAP={};return new(function(){function Storage(){var _this55=this;_classCallCheck(this,Storage),usedStorage.init(),MIGRATION_MAP["1.0.3"]=this._remapSettings.bind(this),this._isNewDefer=$q.defer(),this._canWrite=$q.defer(),this._activeWrite=Promise.resolve(),this.load("lastVersion").then(function(version){var baseAssetService=$injector.get("baseAssetService");if(_this55.defaultPinnedAssets=baseAssetService.getDefaultPinnedAssets(),_this55._canWrite.resolve(),_this55.save("lastVersion",WavesApp.version),state.lastOpenVersion=version){var versions=migration.migrateFrom(version,Object.keys(MIGRATION_MAP));return utils.chainCall(versions.map(function(version){return MIGRATION_MAP[version].bind(null,_this55)})).then(function(){_this55._isNewDefer.resolve(version)})}return _this55._isNewDefer.resolve(version),Promise.resolve()})}return _createClass(Storage,[{key:"onReady",value:function(){return this._isNewDefer.promise}},{key:"save",value:function(key,value){var _this56=this;return this._canWrite.promise.then(function(){return _this56._activeWrite=_this56._activeWrite.then(function(){return utils.when(usedStorage.write(key,value))}),_this56._activeWrite})}},{key:"load",value:function(key){return utils.when(usedStorage.read(key))}},{key:"clear",value:function(){return this._canWrite.promise.then(function(){return utils.when(usedStorage.clear())})}},{key:"_remapPinned",value:function(user){var settings=_objectSpread({},user.settings),pinnedAssetIdList=settings.pinnedAssetIdList;pinnedAssetIdList&&Array.isArray(pinnedAssetIdList)?(pinnedAssetIdList=utils.filterPinnedAssets(pinnedAssetIdList).map(function(assetId){return"9wTCRypSjVwedqNTwLSq5TrePGg2JjP79htfaYyoNRNN"===assetId?"34N9YcEETLWn93qYQ64EsP1x89tSruJU44RrEMSXXEPJ":assetId}),settings.pinnedAssetIdList=difference(pinnedAssetIdList,this.defaultPinnedAssets),settings.unpinnedDefaultAssetIdList=difference(this.defaultPinnedAssets,pinnedAssetIdList).filter(function(assetId){return"WAVES"!==assetId})):(settings.pinnedAssetIdList=void 0,settings.unpinnedDefaultAssetIdList=void 0);return settings}},{key:"_remapSettings",value:function(){var _this57=this;this.load("multiAccountUsers").then(function(multiAccountUsers){try{if(multiAccountUsers&&"object"===_typeof(multiAccountUsers))multiAccountUsers=Object.entries(multiAccountUsers).reduce(function(acc,_ref33){var _ref34=_slicedToArray(_ref33,2),key=_ref34[0],user=_ref34[1];return user=_objectSpread({},user,{settings:_this57._remapPinned(user)}),acc[key]=user,acc},Object.create(null))}catch(e){return null}_this57.save("multiAccountUsers",multiAccountUsers)})}}]),Storage}())};factory.$inject=["$q","utils","migration","state","storageSelect","$injector"],angular.module("app.utils").factory("storage",factory)}(),angular.module("app.buyWAVESFaq",[]),function(){var controller=function(Base,$element,$state,$location,user,$scope,waves,utils,modalManager,matcher,baseAssetService){var analytics=require("data-service").analytics,ds=require("data-service"),ANALYTICS_TABS_NAMES={myOpenOrders:"My Open Orders",myOrderHistory:"My Orders History",myTradeHistory:"My Trade History",tradeHistory:"Trade History",myBalance:"Balance"};return new(function(){function DexCtrl(){var _this58;_classCallCheck(this,DexCtrl),(_this58=_possibleConstructorReturn(this,_getPrototypeOf(DexCtrl).call(this,$scope))).orderbookState=void 0,_this58.ready=!1,_this58.isLogined=!!user.address,_this58._leftHidden=!1,_this58._rightHidden=!1,_this58._assetIdPair=null,_this58.isMobile=window.innerWidth<=720,_this58.syncSettings({tab:"dex.layout.bottomleft.tab",_leftHidden:"dex.layout.leftColumnState",_rightHidden:"dex.layout.rightColumnState",_assetIdPair:"dex.assetIdPair"}),_this58.orderbookState=ds.dataManager.orderbookSubject.getValue(),_this58.orderbookSubscription=ds.dataManager.orderbookSubject.subscribe(function(state){if((_this58.orderbookState=state).loaded&&!state.error){var pair=state.pair,lastTrade=state.lastTrade,pairText="| ".concat(pair.amountAsset.displayName,"/").concat(pair.priceAsset.displayName),title=lastTrade.price.isNaN()?"- ".concat(pairText):"".concat(lastTrade.price.toFormat()," ").concat(pairText);_this58._setTitle(title)}else _this58._setTitle("Bitcoin Exchange | Cryptocurrency Exchange | Trading Platform | Waves")}),_this58.isLogined||(_this58.tab="tradeHistory"),_this58.observe("tab",_this58._onChangeTab),_this58._initializePair().then(function(){_this58.ready=!0,utils.safeApply($scope)}),_this58.observe("_assetIdPair",_this58._onChangePair),_this58.observe(["_leftHidden","_rightHidden"],_this58._onChangeProperty);return _this58.listenEventEmitter($(window),"resize",function(){_this58.isMobile=window.innerWidth<=720,utils.safeApply($scope)}),_this58}var _onChangePair2;return _inherits(DexCtrl,Base),_createClass(DexCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(DexCtrl.prototype),"$onDestroy",this).call(this),ds.dataManager.setAssetPair(void 0),this.orderbookSubscription.unsubscribe(),this._setTitle("Bitcoin Exchange | Cryptocurrency Exchange | Trading Platform | Waves")}},{key:"toggleColumn",value:function(column){this["_".concat(column,"Hidden")]=!this["_".concat(column,"Hidden")]}},{key:"_onChangePair",value:(_onChangePair2=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var pair,userAssetIdPair,_this59=this;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this._getPair();case 2:if(pair=_context3.sent,userAssetIdPair=user.getSetting("dex.assetIdPair"),utils.isLockedInDex(userAssetIdPair.amount,userAssetIdPair.price))return _context3.abrupt("return",this._showModalAndRedirect(userAssetIdPair.amount,userAssetIdPair.price,pair));_context3.next=6;break;case 6:return _context3.next=8,matcher.getPairRestrictions(pair).catch(function(){return{}});case 8:return _context3.abrupt("return",ds.api.matcher.getLastPrice(pair).catch(function(e){if(e.message.includes("blacklisted"))return _this59._showModalAndRedirect(userAssetIdPair.amount,userAssetIdPair.price,pair)}).then(function(){var amountAssetParam=pair.amountAsset.ticker||pair.amountAsset.id,priceAssetParam=pair.priceAsset.ticker||pair.priceAsset.id;_this59._switchToPairRoute(amountAssetParam,priceAssetParam),ds.dataManager.setAssetPair(pair)}));case 9:case"end":return _context3.stop()}},_callee3,this)})),function(){return _onChangePair2.apply(this,arguments)})},{key:"_showModalAndRedirect",value:function(amountAssetId,priceAssetId,lockedPair){var _this60=this,defaultAssets=baseAssetService.getDefaultAssetsHashId();Promise.all([waves.node.assets.getAsset(amountAssetId),waves.node.assets.getAsset(priceAssetId)]).then(function(_ref35){var _ref36=_slicedToArray(_ref35,2),priceAsset=_ref36[0],amountAsset=_ref36[1],amountAssetName=amountAsset.ticker||amountAsset.displayName,priceAssetName=priceAsset.ticker||priceAsset.displayName,unLockedAsset=utils.isLockedInDex(defaultAssets.BTC)?Object.values(defaultAssets).filter(function(assetId){return lockedPair.priceAsset.id!==assetId}).find(function(assetId){return"WAVES"!==assetId&&!utils.isLockedInDex(assetId)}):defaultAssets.BTC;return user.setSetting("dex.assetIdPair",{amount:defaultAssets.WAVES,price:unLockedAsset}),modalManager.showLockPairWarning(amountAssetName,priceAssetName).then(function(){_this60._switchToPairRoute(defaultAssets.WAVES,unLockedAsset),_this60._initializePair()})})}},{key:"_onChangeTab",value:function(){ANALYTICS_TABS_NAMES[this.tab]&&analytics.dex.changeActiveTab(ANALYTICS_TABS_NAMES[this.tab])}},{key:"_getLastPrice",value:function(){return this._getPair().then(function(pair){var pairText="| ".concat(pair.amountAsset.displayName,"/").concat(pair.priceAsset.displayName);return waves.matcher.getLastPrice(pair).then(function(data){var priceText=data.price.getTokens().isNaN()?"-":data.price.toFormat();return"".concat(priceText," ").concat(pairText)},function(){return"- ".concat(pairText)})})}},{key:"_initializePair",value:function(){var _this61=this;return new Promise(function(resolve){setTimeout(_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var defaultAssets,urlPair;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return defaultAssets=baseAssetService.getDefaultAssetsHashId(),_context4.next=3,_this61._getPairFromState();case 3:if(urlPair=_context4.sent)return _context4.abrupt("return",_this61._getPair(urlPair).then(function(_ref38){var amountAsset=_ref38.amountAsset,priceAsset=_ref38.priceAsset;return utils.isLockedInDexSmartAssets(amountAsset,priceAsset)?(modalManager.showSmartPairModal(amountAsset.ticker||amountAsset.displayName,priceAsset.ticker||priceAsset.displayName),Promise.reject()):{amountAsset:amountAsset,priceAsset:priceAsset}}).catch(function(){return _this61._getPair({amount:defaultAssets.WAVES,price:defaultAssets.BTC})}).then(function(_ref39){var amountAsset=_ref39.amountAsset,priceAsset=_ref39.priceAsset,activeTab=user.getSetting("dex.watchlist.activeTab");"all"!==activeTab&&activeTab!==amountAsset.id&&activeTab!==priceAsset.id&&user.setSetting("dex.watchlist.activeTab","all"),_this61._assetIdPair={amount:amountAsset.id,price:priceAsset.id}}).then(resolve));_context4.next=8;break;case 8:_this61._onChangePair(),resolve();case 10:case"end":return _context4.stop()}},_callee4)})),200)})}},{key:"_getPair",value:function(argument_0){var pair=0<arguments.length&&void 0!==argument_0?argument_0:this._assetIdPair;if(pair)return ds.api.pairs.get(pair.amount,pair.price);var defaultAssets=baseAssetService.getDefaultAssetsHashId();return ds.api.pairs.get(defaultAssets.WAVES,defaultAssets.BTC)}},{key:"_getPairFromState",value:function(){var defaultAssets=baseAssetService.getDefaultAssetsHashId(),_$state$params$tradin=$state.params.tradingPair,_tradingPair$split2=_slicedToArray((void 0===_$state$params$tradin?"":_$state$params$tradin).split("_"),2),amountAsset=_tradingPair$split2[0],priceAsset=_tradingPair$split2[1];amountAsset!==priceAsset&&priceAsset||(priceAsset=amountAsset===defaultAssets.WAVES?"BTC":"WAVES");var amountId=baseAssetService.getIdByTicker(amountAsset),priceId=baseAssetService.getIdByTicker(priceAsset),isID=function(str){return 16<new Blob([str],{type:"text/plain"}).size||"WAVES"===str},amountPromise=isID(amountId)?Promise.resolve(amountId):waves.node.assets.getAssetByTicker(amountAsset).then(function(asset){return asset.id}),pricePromise=isID(priceId)?Promise.resolve(priceId):waves.node.assets.getAssetByTicker(priceAsset).then(function(asset){return asset.id});return Promise.all([amountPromise,pricePromise]).then(function(_ref40){var _ref41=_slicedToArray(_ref40,2);return{amount:_ref41[0],price:_ref41[1]}}).catch(function(){return{amount:baseAssetService.getIdByTicker("BTC"),price:baseAssetService.getIdByTicker("WAVES")}})}},{key:"_onChangeProperty",value:function(){var $graphWrapper=$element.find(".graph-wrapper");$graphWrapper.hide(),setTimeout(function(){return $graphWrapper.show()},100)}},{key:"_setTitle",value:function(text){window.document.title=text}},{key:"_switchToPairRoute",value:function(amountAssetParam,priceAssetParam){var tradingPair="".concat(amountAssetParam,"_").concat(priceAssetParam);user.forceInitRouteState($state.current.name,{tradingPair:tradingPair}),$state.go($state.current.name,{tradingPair:tradingPair})}}]),DexCtrl}())};controller.$inject=["Base","$element","$state","$location","user","$scope","waves","utils","modalManager","matcher","baseAssetService"],angular.module("app.dex").controller("DexCtrl",controller)}(),angular.module("app.investments",[]),function(){var controller=function($scope,clipboardService,$element){$element.on("click",function(){clipboardService.copy($scope.wCopy)})};controller.$inject=["$scope","clipboardService","$element"];angular.module("app.ui").directive("wCopy",function(){return{restrict:"A",priority:100,scope:{wCopy:"<"},controller:controller}})}(),function(){function controller($scope,$element){return new(function(){function WDate(){_classCallCheck(this,WDate),this._date=null,this.handlerType=null,this.timerCallback=null}return _createClass(WDate,[{key:"date",get:function(){return $scope.date instanceof Date?$scope.date:"string"==typeof $scope.date?new Date(Number($scope.date)):new Date($scope.date)}}]),_createClass(WDate,[{key:"$postLink",value:function(){var _this62=this;if(this.mode=$scope.mode||AVAILABLE_MODES[0],!AVAILABLE_MODES.includes(this.mode))throw new Error("Wrong date mode!");"time-ago"===this.mode?(this.listener=function(){return _this62._initTimeAgoMode()},$scope.$watch("date",function(){return _this62._initTimeAgoMode()}),this._initTimeAgoMode()):(this.filter=tsUtils.date(PATTERNS[this.mode][i18next.language]),this.listener=function(){_this62.filter=tsUtils.date(PATTERNS[_this62.mode][i18next.language]),_this62._initSimpleMode()},$scope.$watch("date",function(){return _this62._initSimpleMode()}),this._initSimpleMode()),i18next.on("languageChanged",this.listener)}},{key:"_initTimeAgoMode",value:function(){var _this63=this;if(null==$scope.date)return $element.html("");this.handlerType&&this.timerCallback&&controller.off(this.handlerType,this.timerCallback);var date=this.date,delta=Date.now()-date;this.timerCallback=function(){return _this63._initTimeAgoMode()},delta<TIMES.min?($element.html("".concat(Math.round(delta/TIMES.sec)," sec ago")),this.handlerType="sec",controller.once(this.handlerType,this.timerCallback)):delta<TIMES.hour?($element.html("".concat(Math.round(delta/TIMES.min)," min ago")),this.handlerType="min",controller.once(this.handlerType,this.timerCallback)):delta<TIMES.day?($element.html("".concat(Math.round(delta/TIMES.hour)," hours ago")),this.handlerType="hour",controller.once(this.handlerType,this.timerCallback)):delta<TIMES.week?$element.html("".concat(Math.round(delta/TIMES.day)," days ago")):delta<TIMES.month?$element.html("".concat(Math.round(delta/TIMES.week)," weeks ago")):delta<TIMES.year?$element.html("".concat(Math.round(delta/TIMES.month)," months ago")):$element.html("A lot of time ago")}},{key:"_initSimpleMode",value:function(){if(null==$scope.date)return $element.html("");$element.text(this.filter(this.date))}},{key:"$onDestroy",value:function(){i18next.off("languageChanged",this.listener),this.handlerType&&this.timerCallback&&controller.off(this.handlerType,this.timerCallback)}}]),WDate}())}var PATTERNS={default:{en:"DD/MM/YYYY",ru:"DD.MM.YYYY"},short:{en:"DD/MM",ru:"DD.MM"}},TIMES={sec:1e3,min:6e4,hour:36e5,day:864e5,week:6048e5,month:2592e6,year:31536e6},AVAILABLE_MODES=["default","short","time-ago"];controller.$inject=["$scope","$element"],controller.handlers={sec:[],min:[],hour:[]},controller.timers={sec:null,min:null,hour:null},controller.once=function(type,handler){controller.handlers[type].push(handler),controller.isNeedStart(type)&&controller.startTimer(type)},controller.off=function(type,handler){controller.handlers[type]=controller.handlers[type].filter(tsUtils.notContains(handler))},controller.trigger=function(type){var handlers=controller.handlers[type].slice();controller.handlers[type]=[],handlers.forEach(function(cb){return cb()})},controller.isNeedStart=function(type){return!!controller.handlers[type].length&&!controller.timers[type]},controller.startTimer=function(type){controller.timers[type]=setTimeout(function(){controller.timers[type]=null,controller.trigger(type)},TIMES[type])},angular.module("app").directive("wDate",function(){return{restrict:"A",scope:{mode:"@",date:"<wDate"},controller:controller}})}(),angular.module("app.ui").component("wDots",{templateUrl:"modules/ui/directives/dots/dots.html"}),function(){var controller=function(Base,user,$scope){return new(function(){function Sign(){var _this64;return _classCallCheck(this,Sign),(_this64=_possibleConstructorReturn(this,_getPrototypeOf(Sign).call(this))).userType=user.userType,_this64.isLedger="ledger"===user.userType,_this64.isKeeper="wavesKeeper"===user.userType,_this64.signPending=!1,_this64.signable=null,_this64.signError=!1,_this64.id="",_this64.hideId=!1,_this64.keeperError=0,_this64.observe("signable",_this64._onChangeSignable),_this64}return _inherits(Sign,Base),_createClass(Sign,[{key:"isShown",get:function(){return user.userType&&"seed"!==user.userType&&this.signable}}]),_createClass(Sign,[{key:"trySign",value:function(){var _this65=this;return this.signError=!1,this.signPending=!0,this.keeperError=0,this.signable.addMyProof().then(function(signature){_this65.signPending=!1,_this65.onSuccess({signature:signature})}).catch(function(e){_this65.signPending=!1,_this65.signError=!0,_this65.isKeeper&&e&&5===e.code&&e.msg.includes("another active account")&&(_this65.keeperError=1)}).then(function(){$scope.$apply()})}},{key:"cancel",value:function(){this.signError=!1,this.signPending=!1,this.onCancel()}},{key:"_onChangeSignable",value:function(){var _this66=this,signable=this.signable;signable?(signable.getId().then(function(id){_this66.id=id,$scope.$apply()}),this.trySign()):(this.signPending=!1,this.id="")}}]),Sign}())};controller.$inject=["Base","user","$scope"],angular.module("app.ui").component("wSign",{scope:!1,bindings:{signable:"<",hideId:"<",onSuccess:"&",onCancel:"&"},templateUrl:"modules/ui/directives/sign/sign.html",controller:controller})}(),function(){var controller=function(){return new(function(){function Row(){_classCallCheck(this,Row),this.table=null,this.selectValue=null,this.selected=!1,this.cells=[]}return _createClass(Row,[{key:"$postLink",value:function(){this.table.registerRow(this)}},{key:"registerCell",value:function(cell){var index=this.cells.length;cell.setIndex(index),this.cells.push(cell)}},{key:"select",value:function(){null!=this.selectValue&&(this.table.selected=this.selectValue)}}]),Row}())};controller.$inject=[],angular.module("app.ui").component("wRow",{bindings:{selectValue:"@"},require:{table:"^wTable"},transclude:!0,template:'<div ng-click="$ctrl.select()" ng-transclude ng-class="{selected: $ctrl.selected}" class="table__row-wrap"></div>',controller:controller})}(),function(){var controller=function(Base,ComponentList){return new(function(){function Tabs(){var _this67;return _classCallCheck(this,Tabs),(_this67=_possibleConstructorReturn(this,_getPrototypeOf(Tabs).call(this))).tabs=new ComponentList,_this67.ngModel=null,_this67}return _inherits(Tabs,Base),_createClass(Tabs,[{key:"addTab",value:function(tab){this.tabs.push(tab)}},{key:"$postLink",value:function(){this._initializeSelected(),this.receive(this.tabs.signals.remove,this._initializeSelected,this),this.receive(this.tabs.signals.add,this._initializeSelected,this),this.observe("ngModel",this._initializeSelected)}},{key:"select",value:function(tab){this.tabs.forEach(function(myTab){myTab.selected=!1}),tab.selected=!0,this.ngModel=tab.id}},{key:"_initializeSelected",value:function(){if(!this.tabs.length)return null;if(null==this.ngModel)return this.select(this.tabs.first()),null;var active=_slicedToArray(this.tabs.where({id:this.ngModel}).components,1)[0];active?this.select(active):this.select(this.tabs.first())}}]),Tabs}())};controller.$inject=["Base","ComponentList"],angular.module("app.ui").component("wTabs",{transclude:!0,templateUrl:"modules/ui/directives/tabs/tabs.html",controller:controller,bindings:{ngModel:"="}})}(),angular.module("app.unavailable",[]),function(){var factory=function(){return new(function(){function ReadFile(){_classCallCheck(this,ReadFile)}return _createClass(ReadFile,[{key:"read",value:function(fileBlob){var deferred=$.Deferred(),reader=new FileReader;return reader.addEventListener("error",function(error){deferred.reject(error)}),reader.addEventListener("progress",function(event){var percentLoaded=Math.min(Math.round(event.loaded/event.total*100),100);deferred.notify(percentLoaded)}),reader.addEventListener("abort",function(event){deferred.reject(event)}),reader.addEventListener("load",function(event){deferred.resolve(event.currentTarget.result)},!1),reader.readAsBinaryString(fileBlob),deferred.promise()}}]),ReadFile}())};factory.$inject=[],angular.module("app.utils").factory("readFile",factory)}(),function(){var factory=function(PromiseControl){var tsUtils=require("ts-utils"),TimerList=function(){function TimerList(){_classCallCheck(this,TimerList),this.list=[]}return _createClass(TimerList,[{key:"add",value:function(item){this.list.push(item),this.list.sort(TimerList.comparator)}},{key:"remove",value:function(id){id="string"==typeof id?id:id.id;for(var i=this.list.length;i--;)if(this.list[i].id===id){this.list.splice(i,1);break}}}],[{key:"comparator",value:function(a,b){return b.start+b.timeout-(a.start+a.timeout)}}]),TimerList}();return new(function(){function TimeLine(){_classCallCheck(this,TimeLine),this._listeners=new TimerList,this._timer=null}return _createClass(TimeLine,[{key:"timeout",value:function(callback,_timeout){var start=Date.now(),id=tsUtils.uniqueId("timeLineItem"),defer=$.Deferred(),promise=new PromiseControl(defer.promise());return promise.id=id,promise.start=start,promise.time=_timeout,this._listeners.add({handler:callback,timeout:_timeout,start:start,id:id,defer:defer}),1===this._listeners.list.length&&this._addTimeout(),promise}},{key:"wait",value:function(timeout){return this.timeout(null,timeout)}},{key:"cancel",value:function(promise){if(!promise)return null;promise.drop(),this._listeners.remove(promise.id)}},{key:"_run",value:function(){if(!this._listeners.list.length)return null;for(var now=Date.now(),i=this._listeners.list.length-1;0<=i;i--){var item=this._listeners.list[i];if(item){if(!(now-item.start>=item.timeout))break;try{item.handler&&item.handler(),item.defer.resolve()}catch(e){}this._listeners.remove(item)}}this._listeners.list.length&&this._addTimeout()}},{key:"_addTimeout",value:function(){var _this68=this;this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){_this68._timer=null,_this68._run()},200)}}]),TimeLine}())};factory.$inject=["PromiseControl"],angular.module("app.utils").factory("timeLine",factory)}(),function(){var factory=function(notification,user,migration,utils){var MIGRATION_LIST=[];function removeVersion(version){var versions=user.getSetting("whatsNewList").slice(),index=versions.indexOf(version);-1!==index&&(versions.splice(index,1),user.setSetting("whatsNewList",versions))}return user.loginSignal.on(function(){notification.destroyAll();var notShownUpdates=user.getSetting("whatsNewList").filter(function(version){return!migration.gt(version,WavesApp.version)||(removeVersion(version),!1)}),lastOpenVersion=user.getSetting("lastOpenVersion"),newVersionList=migration.migrateFrom(lastOpenVersion||WavesApp.version,MIGRATION_LIST);migration.sort(function(list1,list2){var hash=Object.create(null);return list1.concat(list2).forEach(function(version){hash[version]=!0}),Object.keys(hash)}(newVersionList,notShownUpdates)).forEach(function(version){notification.info({ns:"app.utils",title:{literal:"utils.whatsNew.title",params:{version:version}},body:{literal:"utils.whatsNew.body.".concat(version.replace(/\./g,"_"))},onClose:function(){removeVersion(version)}},-1)}),function(version){var versions=user.getSetting("whatsNewList").slice();utils.toArray(version).forEach(function(version){versions.push(version)}),user.setSetting("whatsNewList",versions)}(newVersionList),user.setSetting("lastOpenVersion",WavesApp.version)}),Object.create(null)};factory.$inject=["notification","user","migration","utils"],angular.module("app.utils").factory("whatsNew",factory)}(),(directive=function(Base,i18n,utils){return{scope:!1,restrict:"A",link:function($scope,$element,$attrs){return new(function(){function I18n(){var _this69;if(_classCallCheck(this,I18n),(_this69=_possibleConstructorReturn(this,_getPrototypeOf(I18n).call(this,$scope)))._forStop=[],_this69._watchers=Object.create(null),_this69._literalTemplate=I18n._getLiteralTemplate(),_this69._parts=I18n._getParts(_this69._literalTemplate),_this69._handler=utils.debounce(_this69._getHandler()),_this69._addWatchers(),_this69.listenEventEmitter(i18next,"languageChanged",_this69._handler),$attrs.params&&!$attrs.params.includes("::")){var stop=$scope.$watch($attrs.params,_this69._handler);_this69._forStop.push(stop)}return _this69._handler(),_this69}return _inherits(I18n,Base),_createClass(I18n,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(I18n.prototype),"$onDestroy",this).call(this),this._forStop.forEach(function(cb){return cb()}),this._forStop=[]}},{key:"_getHandler",value:function(){var _this70=this,ns=this._getNs();return function(){var skipErrors="skipErrors"in $attrs,defaultValue=function(text){return text.split("").map(function(_char4){switch(_char4.charCodeAt(0)){case 34:return"&quot;";case 38:return"&amp;";case 39:return"&#39;";case 60:return"&lt;";case 62:return"&gt;";default:return _char4}}).join("")}($attrs.defaultValue||""),params=$attrs.params&&$scope.$eval($attrs.params)||void 0,result=i18n.translate(_this70._compile(_this70._literalTemplate),ns,params,skipErrors);$element.html(result||(defaultValue||result))}}},{key:"_getNs",value:function(){return $attrs.wI18nNs?$attrs.wI18nNs:i18n.getNs($element)}},{key:"_compile",value:function(literal){return this._parts&&this._parts.forEach(function(_ref42){var part=_ref42.part,evalTpl=_ref42.evalTpl;literal=literal.replace(part,$scope.$eval(evalTpl))}),literal}},{key:"_addWatchers",value:function(){var _this71=this;if(!this._parts)return null;this._parts.forEach(function(_ref43){var part=_ref43.part,needWatch=_ref43.needWatch,evalTpl=_ref43.evalTpl;needWatch&&!_this71._watchers[part]&&(_this71._forStop.push($scope.$watch(evalTpl,_this71._handler)),_this71._watchers[part]=!0)})}}],[{key:"_getLiteralTemplate",value:function(){return String($element.attr("w-i18n")).trim()}},{key:"_getParts",value:function(template){var parts=template.match(/{{.*?(}})/g);return parts?parts.map(function(part){return{part:part,evalTpl:part.replace("{{","").replace("}}","").replace("::",""),needWatch:-1===part.indexOf("::")}}):null}}]),I18n}())},transclude:!0,template:function($element){if("W-I18N"===$element.get(0).tagName)return"<span ng-transclude></span>"}}}).$inject=["Base","i18n","utils"],angular.module("app").directive("wI18n",directive),function(){window.dataLayer=window.dataLayer||[],window.dataLayer.push({originalLocation:window.location.href});var ROUTES={id:"root",children:[{id:"signUp",data:{url:"/sign-up",noLogin:!0,views:[{name:"main"}]}},{id:"signIn",data:{url:"/sign-in",noLogin:!0,views:[{name:"main"}]}},{id:"switch",data:{url:"/switch",noLogin:!0,views:[{name:"main"}]}},{id:"migrate",data:{url:"/migrate?id",views:[{name:"main"}]}},{id:"unavailable",data:{noLogin:!0,views:[{name:"main"}]}},{id:"welcome",data:{url:"/",noLogin:!0,views:[{name:"main"}]}},{id:"prediction",data:{url:"/prediction",views:[{name:"main"}]}},{id:"saveSeed",data:{url:"/save-seed",views:[{name:"main"}]}},{id:"create",data:{url:"/create?new",views:[{name:"main"}]}},{id:"restore",data:{url:"/import/restore",views:[{name:"main"}]}},{id:"fromBackup",data:{url:"/import/fromBackup",views:[{name:"main"}]}},{id:"ledger",data:{url:"/import/ledger",views:[{name:"main"}]}},{id:"keeper",data:{url:"/import/waveskeeper",views:[{name:"main"}]}},{id:"import",data:{views:[{name:"main"}]}},{id:"migration",data:{url:"/migration?faq",views:[{name:"main"}],noLogin:!0}},{id:"stand",data:{noLogin:!0,views:[{name:"main"}]}},{id:"desktop",data:{noLogin:!0,views:[{name:"main"}]}},{id:"stakingFaq",data:{url:"/investments/staking/USDN/faq",noLogin:!0,views:[{name:"main"}]}},{id:"nsbtFaq",data:{url:"/investments/nsbt/faq",noLogin:!0,views:[{name:"main"}]}},{id:"leasingFaq",data:{url:"/investments/staking/WAVES/faq?start",noLogin:!0,views:[{name:"main"}]}},{id:"faq",data:{url:"/faq",noLogin:!0,views:[{name:"main",noController:!0}]}},{id:"news",data:{views:[{name:"main"}]}},{id:"staking",data:{url:"/investments/staking/USDN/client",controller:"Staking",views:[{name:"main"}]},children:[]},{id:"stakingLanding",data:{url:"/investments/staking/USDN",noLogin:!0,controller:"Staking",views:[{name:"main",templateUrl:"modules/staking/templates/staking.html"}]},children:[]},{id:"stablecoins",data:{url:"/investments/staking/stablecoins/{ticker}",controller:"Staking",views:[{name:"main",templateUrl:"modules/staking/templates/staking.html"}],params:{ticker:{dynamic:!0,value:"EURN"}}},children:[]},{id:"chooseUser",data:{url:"/choose-user",views:[{name:"main"}]}},{id:"main",data:{abstract:!0,views:[{name:"main",templateUrl:"modules/app/templates/main.html"}]},children:[{id:"wallet",data:{views:[{name:"mainContent",noController:!0,template:'<ui-view name="content" class="ui-view"></ui-view>'}],redirectTo:"main.wallet.assets"},children:[{id:"assets",data:{views:[{name:"content"}]}},{id:"portfolio",data:{views:[{name:"content"}]}},{id:"transactions",data:{views:[{name:"content"}]}}]},{id:"dex",data:{url:"/dex?assetId1&assetId2",reloadOnSearch:!1,views:[{name:"mainContent"}]}},{id:"dex-demo",data:{noLogin:!0,controller:"Dex",url:"/dex-demo?assetId1&assetId2",reloadOnSearch:!1,views:[{name:"mainContent",templateUrl:"modules/dex/templates/dex.html"}]}},{id:"trade",data:{url:"/trade/{tradingPair}",controller:"Dex",views:[{name:"mainContent",templateUrl:"modules/dex/templates/dex.html"}],params:{tradingPair:{dynamic:!0,value:"WAVES"}}}},{id:"tokens",data:{views:[{name:"mainContent"}]}}]},{id:"stakingRef",data:{url:"/?ref",controller:"Staking",views:[{name:"main",templateUrl:"modules/staking/templates/staking.html"}]},children:[]},{id:"investments",data:{url:"/investments",views:[{name:"main"}]},children:[]},{id:"leverage",data:{url:"/leverage",views:[{name:"main"}],reloadOnSearch:!1},children:[]},{id:"page404",data:{url:"/404",views:[{name:"main"}]},children:[]},{id:"buycrypto",data:{url:"/buycrypto",views:[{name:"main"}]}},{id:"buyBTC",data:{url:"/buycrypto/buybtc",views:[{name:"main"}]},children:[]},{id:"buyBTCFaq",data:{url:"/buycrypto/buybtc/faq",views:[{name:"main"}]},children:[]},{id:"buyUsdn",data:{url:"/buycrypto/buyusdn",views:[{name:"main"}]},children:[]},{id:"buyUSDNFaq",data:{url:"/buycrypto/buyusdn/faq",views:[{name:"main"}]},children:[]},{id:"leasing",data:{url:"/investments/staking/WAVES?start",controller:"Leasing",views:[{name:"main",templateUrl:"modules/wallet/modules/leasing/templates/leasing.html"}],reloadOnSearch:!1},children:[]},{id:"nsbt",data:{url:"/investments/nsbt",controller:"Nsbt",views:[{name:"main"}]},children:[]},{id:"marketMaking",data:{url:"/market-making",views:[{name:"main"}]}},{id:"otc",data:{url:"/otc/usdt_usdn",views:[{name:"main"}]}},{id:"swapWavesUsdn",data:{url:"/swap/waves_usdn",views:[{name:"main"}]}},{id:"otcFaq",data:{url:"/otc/usdt_usdn/faq",views:[{name:"main"}]}},{id:"defo",data:{url:"/defo/swap/client",controller:"DeFo",views:[{name:"main"}]},children:[]},{id:"defoLanding",data:{url:"/defo/swap",noLogin:!0,controller:"DeFo",views:[{name:"main",templateUrl:"modules/defo/templates/defo.html"}]},children:[]},{id:"defoFaq",data:{url:"/defo/faq",views:[{name:"main"}]},children:[]},{id:"defoStakingFaq",data:{url:"/investments/staking/stablecoins/faq",views:[{name:"main"}]},children:[]},{id:"defoInvestment",data:{url:"/investments/neutrinopools",views:[{name:"main"}]},children:[]},{id:"defoInvestmentFaq",data:{url:"/investments/neutrinopools/faq",views:[{name:"main"}]},children:[]}]},config=function($urlRouterProvider,$stateProvider,$locationProvider,$compileProvider){var tsUtils=require("ts-utils"),BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),i18next=require("i18next"),moment=require("moment");return WavesApp.stateTree=new tsUtils.Tree(ROUTES),new(function(){function AppConfig(){_classCallCheck(this,AppConfig),this._initUrlResolveMode(),this._initLocalize(),this._initAdapters(),this._initStates(),this._initCompiler()}return _createClass(AppConfig,[{key:"_initAdapters",value:function(){var TransportU2F=WavesApp.isWeb()?require("@ledgerhq/hw-transport-u2f"):window.TransportNodeHid;ds.signAdapters.adapterList.forEach(function(Adapter){try{Adapter.initOptions({networkCode:ds.config.get("code").charCodeAt(0),openTimeout:WavesApp.sign.openTimeout,listenTimeout:WavesApp.sign.listenTimeout,exchangeTimeout:WavesApp.sign.exchangeTimeout,debug:!WavesApp.isProduction(),transport:TransportU2F&&TransportU2F.default,extension:function(){return"undefined"==typeof Waves?null:Waves}})}catch(e){return null}})}},{key:"_initUrlResolveMode",value:function(){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/")}},{key:"_initLocalize",value:function(){var BIG_NUMBER_FORMAT={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:" ",fractionGroupSize:0};i18next.use(ds.BackendI18Next).init({lng:AppConfig.getUserLang(),debug:!WavesApp.isProduction()&&-1!==location.href.indexOf("localesDebug=true"),ns:WavesApp.modules,fallbackLng:"en",whitelist:Object.keys(WavesApp.localize),defaultNS:"app",useCookie:!1,useLocalStorage:!1,interpolation:{format:function(value,_format){switch(_format){case"money":return value&&value.getTokens().toFixed()||"";case"money-currency":return value?"".concat(value.getTokens().toFixed()," ").concat(value.asset.displayName):"";case"money-fee":return value&&"".concat(value.getTokens().toFixed()," ").concat(value.asset.displayName)||"";case"BigNumber":return value&&value.toFixed()||"";default:throw new Error("Wrong format type!")}}},backend:{loadPath:"/locales/{{lng}}_".concat(WavesApp.version,".json"),referenceLng:"en",fetch:ds.fetch,locales:WavesApp.locales}}),i18next.on("initialized",function(){var localeData=WavesApp.getLocaleData().separators;document.querySelector("html").setAttribute("lng",i18next.language),BigNumber.config.set({ROUNDING_MODE:BigNumber.ROUND_MODE.ROUND_DOWN,FORMAT:tsUtils.merge(Object.create(null),BIG_NUMBER_FORMAT,{groupSeparator:localeData.group,decimalSeparator:localeData.decimal})}),moment.locale(i18next.language),WavesApp.isDesktop()&&transfer("setLanguage",i18next.language),i18next.on("languageChanged",function(){WavesApp.isDesktop()&&transfer("setLanguage",i18next.language),moment.locale(i18next.language),document.querySelector("html").setAttribute("lng",i18next.language);var localeData=WavesApp.getLocaleData().separators;BigNumber.config.set({ROUNDING_MODE:BigNumber.ROUND_MODE.ROUND_DOWN,FORMAT:tsUtils.merge(Object.create(null),BIG_NUMBER_FORMAT,{groupSeparator:localeData.group,decimalSeparator:localeData.decimal})})})})}},{key:"_initStates",value:function(){var defaultUrl=AppConfig.getUrlFromState(WavesApp.stateTree.find("welcome"));$urlRouterProvider.when("",defaultUrl),WavesApp.stateTree.toArray().slice(1).forEach(function(item){var _abstract=item.get("abstract"),url=AppConfig.getUrlFromState(item),redirectTo=item.get("redirectTo"),reloadOnSearch=item.get("reloadOnSearch"),params=item.get("params"),views=item.get("views").reduce(function(views,viewData){var controller=_abstract||viewData.noController?void 0:AppConfig.getCtrlName(item.get("controller")||tsUtils.camelCase(item.id)),template=viewData.template,templateUrl=template?void 0:viewData.templateUrl||AppConfig.getTemplateUrl(WavesApp.stateTree.getPath(item.id));return views[viewData.name]={controller:controller,template:template,templateUrl:templateUrl},views},Object.create(null));$stateProvider.state(WavesApp.stateTree.getPath(item.id).join("."),{abstract:_abstract,url:url,redirectTo:redirectTo,views:views,reloadOnSearch:reloadOnSearch,params:params})})}},{key:"_initCompiler",value:function(){$compileProvider.commentDirectivesEnabled(!1),$compileProvider.cssClassDirectivesEnabled(!1),$compileProvider.debugInfoEnabled(!WavesApp.isProduction())}}],[{key:"getCtrlName",value:function(name){return"".concat(name.charAt(0).toUpperCase()+name.substr(1),"Ctrl as $ctrl")}},{key:"getTemplateUrl",value:function(path){return path.filter(function(id){return!WavesApp.stateTree.find(id).get("abstract")}).reduce(function(result,item,index,array){return item=tsUtils.camelCase(item),index===array.length-1?result+="/modules/".concat(item,"/templates/").concat(item,".html"):result+="/modules/".concat(item),result},"").replace(/\/\//g,"/").substr(1)}},{key:"getUserLang",value:function(){var langFromStorage,available=Object.keys(WavesApp.localize);try{langFromStorage=JSON.parse(localStorage.getItem("lng"))}catch(e){localStorage.removeItem("lng")}if(-1!==available.indexOf(langFromStorage))return langFromStorage;var cookieLng=Cookies.get("locale"),userLang=navigator.language||navigator.userLanguage;if(-1!==available.indexOf(cookieLng))return cookieLng;if(userLang){if(-1!==available.indexOf(userLang))return userLang;var lng=null;return userLang.split(/\W/).some(function(part){return-1!==available.indexOf(part)?lng=part:-1!==available.indexOf(part.toLowerCase())&&(lng=part.toLowerCase()),!!lng}),lng||"en"}return"en"}},{key:"getUrlFromState",value:function(state){return state.get("abstract")?void 0:state.get("url")||"/".concat(state.id)}}]),AppConfig}())};config.$inject=["$urlRouterProvider","$stateProvider","$locationProvider","$compileProvider"],angular.module("app").config(config)}(),function(){var factory=function(configsActionsService,utils,user,storage){var Signal=require("ts-utils").Signal;return new(function(){function NewsService(){_classCallCheck(this,NewsService),this.newsList=[],this.change=new Signal,this.updateService=configsActionsService._updateService,this.updateService.change.on(this._dispatchUpdates,this)}return _createClass(NewsService,[{key:"fetchNews",value:function(){this._dispatchUpdates()}},{key:"saveNewsViewed",value:function(){storage.save("newsViewed",this.newsList.length),this.newsList=this.newsList.map(function(newsItem){return _objectSpread({},newsItem,{notViewed:!1})}),this.change.dispatch({newsList:this.newsList,notViewedAmount:0})}},{key:"_dispatchUpdates",value:function(){var _this72=this;return this._setUpdates().then(function(newsList){_this72.newsList=newsList,_this72.change.dispatch({notViewedAmount:newsList.filter(function(newsItem){return newsItem.notViewed}).length,newsList:newsList})})}},{key:"_setUpdates",value:function(){var _this73=this;return storage.load("newsViewed").then(function(storageNewsViewed){return user.getMultiAccountData().then(function(data){var newsViewed=storageNewsViewed;return data||(newsViewed=_this73.updateService.news.length,storage.save("newsViewed",newsViewed)),_this73.updateService.news.sort(function(a,b){return utils.comparators.asc(a.timestamp,b.timestamp)}).map(function(item,i){return _objectSpread({},item,{notViewed:(newsViewed||0)<=i})}).reverse()})})}}]),NewsService}())};factory.$inject=["configsActionsService","utils","user","storage"],angular.module("app").factory("newsService",factory)}(),function(){var factory=function(node,matcher,wavesUtils,utils){return utils.bind(new function Waves(){_classCallCheck(this,Waves),this.node=node,this.matcher=matcher,this.utils=wavesUtils})};factory.$inject=["node","matcher","wavesUtils","utils"],angular.module("app").factory("waves",factory)}(),function(){var controller=function(user){return new function OtcCtrl(){_classCallCheck(this,OtcCtrl),this.isLogined=!!user.address}};controller.$inject=["user"],angular.module("app.otc").controller("OtcCtrl",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.OtcFaq,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.otcFaq").directive("wOtcFaq",controller)}(),function(){var controller=function($element){return new(function(){function Cell(){_classCallCheck(this,Cell),this.row=null}return _createClass(Cell,[{key:"$postLink",value:function(){this.row.registerCell(this)}},{key:"setIndex",value:function(index){$element.addClass("cell-".concat(index))}},{key:"getWidth",value:function(){return $element.width()}}]),Cell}())};controller.$inject=["$element"],angular.module("app.ui").component("wCell",{require:{row:"^wRow"},transclude:!0,template:'<div ng-transclude class="table__cell-wrap"></div>',controller:controller})}(),function(){var factory=function(user,modalManager,waves,Router,utils){return function(){function ModalRouter(){var _this74=this;_classCallCheck(this,ModalRouter),this._sleep=!1,this._firstUrl=ModalRouter._getUrlData(),this._router=new Router,this._router.registerRouteHash(this._wrapClose(this._getRoutes())),WavesApp.isDesktop()&&window.listenMainProcessEvent(function(eventType,urlString){user.onLogin().then(function(){var hash=utils.parseElectronUrl(urlString).hash;hash&&_this74._apply(ModalRouter._getUrlData(hash.replace("#","")))})})}return _createClass(ModalRouter,[{key:"initialize",value:function(){var _this75=this;window.addEventListener("hashchange",function(){_this75._sleep||_this75._apply(ModalRouter._getUrlData())},!1),user.onLogin().then(function(){_this75._apply(_this75._firstUrl),_this75._firstUrl=window.location.href})}},{key:"_apply",value:function(url){return this._router.apply(url)}},{key:"_getRoutes",value:function(){var _ref46;return _defineProperty(_ref46={},Router.ROUTES.SEND,function(){return modalManager.showSendAsset()}),_defineProperty(_ref46,Router.ROUTES.SEND_ASSET,function(_ref44,search){var assetId=_ref44.assetId;return modalManager.showSendAsset(_objectSpread({},search,{assetId:assetId}))}),_defineProperty(_ref46,Router.ROUTES.ASSET_INFO,function(_ref45){var assetId=_ref45.assetId;return waves.node.assets.getAsset(assetId).then(function(asset){return modalManager.showAssetInfo(asset)})}),_defineProperty(_ref46,Router.ROUTES.ACCOUNT,function(){return modalManager.showAccountInfo()}),_defineProperty(_ref46,Router.ROUTES.GATEWAY_AUTH,function(params,search){return modalManager.showGatewaySign(search)}),_defineProperty(_ref46,Router.ROUTES.ANY_TX,function(params,search){return modalManager.showAnyTx(search)}),_ref46}},{key:"_wrapClose",value:function(hash){var _this76=this;return Object.keys(hash).forEach(function(key){var handler=hash[key];hash[key]=function(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return _this76._sleep=!0,user.onLogin().then(function(){var result=handler.apply(void 0,args);if(!result||!result.then||"function"!=typeof result.then)throw new Error("Modal result must be a promise!");var cb=function(){_this76._sleep=!1,location.hash=""};return result.then(cb,cb),result})}}),hash}}],[{key:"_getUrlData",value:function(fromUrl){return"/".concat(decodeURIComponent(fromUrl||ModalRouter._getLocation()))}},{key:"_getLocation",value:function(){if(WavesApp.isDesktop()){var lastIndex=location.hash.lastIndexOf("#");return location.hash.indexOf("#")<lastIndex?location.hash.slice(lastIndex+1):""}return location.hash.replace("#","")}}]),ModalRouter}()};factory.$inject=["user","modalManager","waves","Router","utils"],angular.module("app.ui").factory("ModalRouter",factory)}(),angular.module("app.utils").factory("migration",function(){var migration={migrateFrom:function(version,versionList){return versionList.filter(migration.getCurrentVersionFilter(version)).sort(migration._comparator)},sort:function(versionList){return versionList.slice().sort(migration._comparator)},lt:function(v1,v2){return migration._comparator(v1,v2)<0},lte:function(v1,v2){return migration._comparator(v1,v2)<=0},gt:function(v1,v2){return 0<migration._comparator(v1,v2)},gte:function(v1,v2){return 0<=migration._comparator(v1,v2)},getCurrentVersionFilter:function(lastVersion){return function(version){return migration.gt(version,lastVersion)&&migration.lte(version,WavesApp.version)}},_comparator:function(v1,v2){var v1Beta=v1.includes("beta"),v2Beta=v2.includes("beta");if(v1Beta&&!v2Beta)return-1;if(!v1Beta&&v2Beta)return 1;v1=migration._parse(v1),v2=migration._parse(v2);for(var i=0;i<v1.length;i++){var part1=v1[i],part2=v2[i]||0;if(part1<part2)return-1;if(part2<part1)return 1}return 0},_parse:function(version){return version.replace(/[^0-9.]/g,"").split(".").map(Number)}};return migration}),function(){var factory=function(Poll,eventManager){return function(){function PollCache(_ref47){var _this77=this,getData=_ref47.getData,timeout=_ref47.timeout,isBalance=_ref47.isBalance;_classCallCheck(this,PollCache),this._ready=!1,this._data=null,this._isBalance=isBalance,this._poll=new Poll(function(){return getData().then(function(data){return _this77._isError=!1,data}).catch(function(e){return _this77._isError=!0,e})},this._applyData.bind(this),timeout||5e3),this._isError=!1,this._readyDfr=$.Deferred(),this._isBalance&&(this._changeBalanceHandler=function(){_this77._poll.restart()},eventManager.signals.changeBalanceEvent.on(this._changeBalanceHandler))}return _createClass(PollCache,[{key:"destroy",value:function(){this._isBalance&&eventManager.signals.changeBalanceEvent.off(this._changeBalanceHandler),this._poll.destroy()}},{key:"get",value:function(){return this._ready?this._isError?Promise.reject(this.data):Promise.resolve(this.data):this._readyDfr.promise()}},{key:"_applyData",value:function(data){this._ready||(this._readyDfr.resolve(data),this._ready=!0,this._readyDfr=null),this.data=data}}]),PollCache}()};factory.$inject=["Poll","eventManager"],angular.module("app.ui").factory("PollCache",factory)}(),function(){var factory=function(user,utils){var tsUtils=require("ts-utils"),Base=function(){function Base($scope){var _this78=this;if(_classCallCheck(this,Base),this.wasDestroed=!1,this.__emitterListeners=Object.create(null),$scope)var stop=$scope.$on("$destroy",function(){_this78.$onDestroy(),stop()});this.signals={destroy:new tsUtils.Signal,logout:new tsUtils.Signal},this.cid=tsUtils.uniqueId("base"),this.receive(user.logoutSignal,this.signals.logout.dispatch,this.signals.logout)}return _createClass(Base,[{key:"listenEventEmitter",value:function(emitter,event,handler,methods){(methods=methods||Object.create(null)).on=methods.on||"on",methods.off=methods.off||"off",this.__emitterListeners[event]||(this.__emitterListeners[event]=[]),this.__emitterListeners[event].push({emitter:emitter,handler:handler,methods:methods}),emitter[methods.on](event,handler,methods.capture)}},{key:"stopListenEventEmitter",value:function(argument_0,argument_1,argument_2){var event,handler,emitter,_this79=this;return(arguments.length<=0?void 0:argument_0)&&"object"===_typeof(arguments.length<=0?void 0:argument_0)?(handler=event=null,emitter=arguments.length<=0?void 0:argument_0):(arguments.length<=0?void 0:argument_0)&&"function"==typeof(arguments.length<=0?void 0:argument_0)?(handler=arguments.length<=0?void 0:argument_0,emitter=event=null):event=arguments.length<=0?void 0:argument_0,(arguments.length<=1?void 0:argument_1)&&"object"===_typeof(arguments.length<=1?void 0:argument_1)?emitter=arguments.length<=1?void 0:argument_1:handler=arguments.length<=1?void 0:argument_1,(arguments.length<=2?void 0:argument_2)&&(emitter=arguments.length<=2?void 0:argument_2),event?handler?void(this.__emitterListeners[event]=this.__emitterListeners[event].filter(function(data){return emitter?data.emitter!==emitter||data.handler!==handler||(emitter[data.methods.off](event,handler),!1):data.handler!==handler||(data.emitter[data.methods.off](event,handler),!1)})):(this.__emitterListeners[event].slice().forEach(function(data){_this79.stopListenEventEmitter(event,data.handler,emitter)}),null):(Object.keys(this.__emitterListeners).forEach(function(myEvent){_this79.stopListenEventEmitter(myEvent,handler,emitter)}),null)}},{key:"observe",value:function(keys,callback,options){this.receive(utils.observe(this,keys,options),callback,this)}},{key:"observeOnce",value:function(keys,callback,options){this.receiveOnce(utils.observe(this,keys,options),callback,this)}},{key:"stopObserve",value:function(keys,handler){this.stopReceive(utils.observe(this,keys),handler)}},{key:"syncSettings",value:function(syncObject){var _this80=this;return Object.keys(syncObject).forEach(function(name){var settingsPath=syncObject[name];if(_this80.observe(name,function(){user.setSetting(settingsPath,_this80[name])}),user.changeSetting){var handler=function(path){path===settingsPath&&(_this80[name]=user.getSetting(path))};_this80.receive(user.changeSetting,handler),_this80.receiveOnce(user.logoutSignal,function(){_this80.stopReceive(user.logoutSignal,handler)})}_this80[name]=user.getSetting(settingsPath)})}},{key:"$onDestroy",value:function(){this.signals.destroy.dispatch(),this.stopReceive(),this.signals.destroy.off(),this.signals.logout.off(),this.stopListenEventEmitter(),this.wasDestroed=!0}}]),Base}();return Base.DOM_EVENTS_METHODS={on:"addEventListener",off:"removeEventListener",capture:!1},Base.prototype.receive=tsUtils.Receiver.prototype.receive,Base.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,Base.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,Base};factory.$inject=["user","utils"],angular.module("app.utils").factory("Base",factory)}(),function(){var Signal=require("ts-utils").Signal,factory=function(user,Poll,$injector,TxEvent,utils){var EventManager=function(){function EventManager(){var _this81=this;_classCallCheck(this,EventManager),this.ready=null,this.signals={changeBalanceEvent:new Signal},this._poll=null,this._events=Object.create(null),this._waves=null,user.onLogin().then(function(){return _this81._handleLogin()},function(){return _this81._handleLogout()})}return _createClass(EventManager,[{key:"addTx",value:function(tx,moneyList){this._events[tx.id]=new TxEvent(tx.id,moneyList),this._syncEventList(),this._resetPoll()}},{key:"getReservedMoneyList",value:function(){var _this82=this;return Object.keys(this._events).reduce(function(list,eventId){return list.concat(_this82._events[eventId].getReservedMoneyList())},[])}},{key:"_handleLogin",value:function(){this._initialize(),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._poll&&this._poll.destroy(),user.loginSignal.once(this._handleLogin,this)}},{key:"_initialize",value:function(){var _this83=this;this._waves=$injector.get("waves"),this._waves.node.transactions.listUtx().then(function(list){var events=user.getSetting("events"),utxHash=utils.toHash(list,"id");Object.keys(events).forEach(function(id){utxHash[id]||_this83._removeEvent(id,!0)}),list&&list.length&&_this83._resetPoll()})}},{key:"_addEvent",value:function(tx){if(!this._events[tx.id])return this._events[tx.id]=new TxEvent(tx.id,EventManager._getMoneyListData(tx)),this._syncEventList(),!0}},{key:"_removeEvent",value:function(id,force){(this._events[id]||force)&&(delete this._events[id],this._syncEventList(),force||this.signals.changeBalanceEvent.dispatch())}},{key:"_resetPoll",value:function(){var _this84=this;this._poll&&this._poll.destroy(),setTimeout(function(){_this84._poll=new Poll(_this84._waves.node.transactions.listUtx,_this84._addUtxList.bind(_this84),1e3)},1e3)}},{key:"_addUtxList",value:function(list){var _this85=this,dispatch=!1,utxHash=utils.toHash(list,"id");Object.keys(this._events).forEach(function(id){utxHash[id]||(_this85._removeEvent(id),dispatch=!0)}),list.length?(list.forEach(function(tx){_this85._events[tx.id]||(_this85._addEvent(tx),dispatch=!0)}),dispatch&&this.signals.changeBalanceEvent.dispatch()):this._poll&&(this._poll.destroy(),this._poll=null)}},{key:"_syncEventList",value:function(){var result=Object.create(null);Object.keys(this._events).forEach(function(id){result[id]=!0}),user.setSetting("events",result)}}],[{key:"_getMoneyListData",value:function(tx){var moneyList=[tx.fee];return 4===tx.type&&moneyList.push(tx.amount),moneyList}}]),EventManager}();return utils.bind(new EventManager)};factory.$inject=["user","Poll","$injector","TxEvent","utils"],angular.module("app").factory("eventManager",factory)}(),function(){var factory=function(){var AVAILABLE_TAGS=["div","span"],AVAILABLE_URL_PROTOCOLS=["http:","https:","mailto:","tg:"],LocaleParser=function(){function LocaleParser(open,close,contentOpen,contentClose,compile){_classCallCheck(this,LocaleParser),this.openChar=open,this.closeChar=close,this.contentOpenChar=contentOpen,this.contentCloseChar=contentClose,this.compile=compile}return _createClass(LocaleParser,[{key:"parse",value:function(text){var _this86=this,openList=[],closeList=[],openContent=[],closeContent=[];text.split("").forEach(function(_char5,index){switch(_char5){case _this86.openChar:openList.push(index);break;case _this86.closeChar:closeList.push(index);break;case _this86.contentOpenChar:openContent.push(index);break;case _this86.contentCloseChar:closeContent.push(index)}});var mainIntervals=[],contentIntervals=[];openList.reverse().forEach(function(open){closeList.some(function(close,i){return open<close&&(mainIntervals.push({open:open,close:close}),closeList.splice(i,1),!0)})}),openContent.reverse().forEach(function(open){closeContent.some(function(close,i){return open<close&&(contentIntervals.push({open:open,close:close}),closeContent.splice(i,1),!0)})});var index=0,result="";return mainIntervals.reverse().forEach(function(mainData){contentIntervals.forEach(function(contentData){if(contentData.open===mainData.close+1){var content=text.slice(contentData.open+1,contentData.close),main=text.slice(mainData.open+1,mainData.close);result+=text.slice(index,mainData.open)+_this86.compile({main:main,content:content}),index=contentData.close+1}})}),result+=text.slice(index)}}]),LocaleParser}(),tagParser=new LocaleParser("{","}","[","]",function(_ref48){var main=_ref48.main,content=_ref48.content;try{var firstDotIndex=main.indexOf("."),tagName="";switch(firstDotIndex){case 0:tagName="span";break;case-1:tagName=main;break;default:tagName=main.slice(0,firstDotIndex)}var classes=main.slice(firstDotIndex+1).split(".").join(" ");if(-1===AVAILABLE_TAGS.indexOf(tagName))throw new Error("Locale parser: Wrong tag name! ".concat(tagName));return"<".concat(tagName,' class="').concat(classes,'">').concat(content,"</").concat(tagName,">")}catch(e){return content}}),linkParser=new LocaleParser("[","]","(",")",function(_ref49){var main=_ref49.main,content=_ref49.content;try{var url=new URL(content);if(-1===AVAILABLE_URL_PROTOCOLS.indexOf(url.protocol))throw new Error("Locale parser: Wrong url protocol! ".concat(url.protocol));return'<a href="'.concat(content,'" target="_blank" rel="noopener noreferrer">').concat(main,"</a>")}catch(e){return""}});return function(text){return tagParser.parse(linkParser.parse(text))}};factory.$inject=[],angular.module("app").factory("localeParser",factory)}(),_libs$crypto2=require("@waves/waves-transactions").libs.crypto,encryptSeed=_libs$crypto2.encryptSeed,decryptSeed=_libs$crypto2.decryptSeed,base58Encode=_libs$crypto2.base58Encode,base58Decode=_libs$crypto2.base58Decode,base64Encode=_libs$crypto2.base64Encode,blake2b=_libs$crypto2.blake2b,stringToBytes=_libs$crypto2.stringToBytes,buildAddress=_libs$crypto2.address,buildPublicKey=_libs$crypto2.publicKey,sharedKey=_libs$crypto2.sharedKey,messageEncrypt=_libs$crypto2.messageEncrypt,_users={},MultiAccount=function(){function MultiAccount(){_classCallCheck(this,MultiAccount)}return _createClass(MultiAccount,[{key:"signUp",value:function(password,rounds){_password=password,_rounds=rounds,_users={};var str=JSON.stringify(_users),multiAccountHash=base58Encode(blake2b(stringToBytes(str))),multiAccountData=encryptSeed(str,_password,_rounds);return Promise.resolve({multiAccountData:multiAccountData,multiAccountHash:multiAccountHash})}},{key:"signIn",value:function(encryptedAccount,password,rounds,hash){try{var str=decryptSeed(encryptedAccount,password,rounds);if(base58Encode(blake2b(stringToBytes(str)))!==hash)throw new Error("hash does not match");return _password=password,_rounds=rounds,_users=JSON.parse(str),Promise.resolve()}catch(e){return Promise.reject(e)}}},{key:"signOut",value:function(){_rounds=_password=void 0,_users={}}},{key:"changePassword",value:function(encryptedAccount,oldPassword,newPassword,rounds,hash){try{var str=decryptSeed(encryptedAccount,oldPassword,rounds);if(base58Encode(blake2b(stringToBytes(str)))!==hash)throw new Error("hash does not match");_password=newPassword,_rounds=rounds,_users=JSON.parse(str);var multiAccountData=encryptSeed(str,_password,_rounds);return Promise.resolve({multiAccountData:multiAccountData,multiAccountHash:hash})}catch(e){return Promise.reject(e)}}},{key:"addUser",value:function(_ref50){var userType=_ref50.userType,networkByte=_ref50.networkByte,seed=_ref50.seed,id=_ref50.id,privateKey=_ref50.privateKey,_publicKey=_ref50.publicKey||buildPublicKey(seed||{privateKey:privateKey}),userHash=this.hash(networkByte+_publicKey);_users[userHash]={userType:userType,networkByte:networkByte,seed:seed,id:id,privateKey:privateKey,publicKey:_publicKey};var str=JSON.stringify(_users),multiAccountHash=base58Encode(blake2b(stringToBytes(str))),multiAccountData=encryptSeed(str,_password,_rounds);return Promise.resolve({multiAccountData:multiAccountData,multiAccountHash:multiAccountHash,userHash:userHash})}},{key:"deleteUser",value:function(userHash){delete _users[userHash];var str=JSON.stringify(_users),multiAccountHash=base58Encode(blake2b(stringToBytes(str))),multiAccountData=encryptSeed(str,_password,_rounds);return Promise.resolve({multiAccountData:multiAccountData,multiAccountHash:multiAccountHash,userHash:userHash})}},{key:"toList",value:function(multiAccountUsers){return this.isSignedIn?Object.entries(multiAccountUsers||{}).map(function(_ref51){var _ref52=_slicedToArray(_ref51,2),userHash=_ref52[0],user=_ref52[1],_user=_users[userHash];return _user?_objectSpread({},user,{userType:_user.userType,networkByte:_user.networkByte,id:_user.id,seed:_user.seed,privateKey:_user.privateKey,publicKey:_user.publicKey,address:buildAddress({publicKey:_user.publicKey},String.fromCharCode(_user.networkByte)),hash:userHash}):(delete multiAccountUsers[userHash],null)}).filter(Boolean).sort(function(a,b){return b.lastLogin-a.lastLogin}):[]}},{key:"hash",value:function(str){return base58Encode(blake2b(base58Decode(str)))}},{key:"export",value:function(privateKeyFrom,publicKeyTo,storageData){return base64Encode(messageEncrypt(sharedKey(privateKeyFrom,publicKeyTo,"waves_migration_token"),JSON.stringify({password:_password,storageData:storageData})))}},{key:"isSignedIn",get:function(){return!!_password}}]),MultiAccount}(),angular.module("app").service("multiAccount",MultiAccount),function(){var factory=function(state,user,$state){return new(function(){function StateManager(){_classCallCheck(this,StateManager),this.rootStateList=[],this.subStateList=[],state.signals.changeRouterStateSuccess.on(this._currentStateLists,this),this.changeRouteState=state.signals.changeRouterStateSuccess,this._currentStateLists()}return _createClass(StateManager,[{key:"getSrefByState",value:function(state){return WavesApp.stateTree.getPath(state.id).join(".")}},{key:"getStateTree",value:function(argument_0){var fromId=0<arguments.length&&void 0!==argument_0?argument_0:"main";return WavesApp.stateTree.find(fromId).getChildren().filter(function(child){return!0!==child.get("noLogin")}).map(StateManager._remapStateItem)}},{key:"_currentStateLists",value:function(){if(!$state.$current||!$state.$current.name)return!1;var root=WavesApp.stateTree.find("main"),rootPath=WavesApp.stateTree.getPath(root.id).join(".");this.rootStateList=root.getChildren().map(function(item){var path=user.getActiveState(item.id).name,base="".concat(rootPath,".").concat(item.id);return{path:path,name:item.id,base:base}});var idList=$state.$current.name.split("."),parent=idList[idList.length-2],stateData=WavesApp.stateTree.find(parent);stateData&&!stateData.get("abstract")?this.subStateList=stateData.getChildren().map(function(item){var path=WavesApp.stateTree.getPath(item.id).join(".");return{name:item.id,path:path}}):this.subStateList=[]}}],[{key:"_remapStateItem",value:function(item){var list=item.getChildren().map(StateManager._remapStateItem),result={list:list,isLeaf:0===list.length,id:item.id};return list.length?Object.defineProperty(result,"sref",{get:function(){return user.getActiveState(item.id).name}}):result.sref=user.getActiveState(item.id).name,result}}]),StateManager}())};factory.$inject=["state","user","$state"],angular.module("app").factory("stateManager",factory)}(),function(){var controller=function(Base,$scope,user){return new(function(){function DeFoCtrl(){var _this87;return _classCallCheck(this,DeFoCtrl),(_this87=_possibleConstructorReturn(this,_getPrototypeOf(DeFoCtrl).call(this,$scope))).isLogined=!!user.address,_this87}return _inherits(DeFoCtrl,Base),DeFoCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.defo").controller("DeFoCtrl",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,configService,user,modalManager,baseAssetService,balanceWatcher,storage){return reactDirective(rc.DeFo,void 0,void 0,{$state:$state,configService:configService,user:user,modalManager:modalManager,baseAssetService:baseAssetService,balanceWatcher:balanceWatcher,storage:storage})};controller.$inject=["reactDirective","$state","configService","user","modalManager","baseAssetService","balanceWatcher","storage"],angular.module("app.defo").directive("wDefo",controller)}(),angular.module("app.marketMaking",[]).controller("MarketMakingCtrl",function(){}),function(){var controller=function(Base,newsService,utils,multiAccount,$scope,storage){var slice=require("ramda").slice;return new(function(){function NewsCtrl(){var _this88;return _classCallCheck(this,NewsCtrl),(_this88=_possibleConstructorReturn(this,_getPrototypeOf(NewsCtrl).call(this,$scope))).dateBlocks=Object.create(null),_this88.totalPages=0,_this88.shownNewsList=[],storage.load("lng").then(function(lng){_this88.lng=lng,_this88.observe("newsList",_this88._onChangeNewsList),_this88._setChangeHandler(),newsService.fetchNews()}),_this88._bindedChangeLang=_this88._changeLang.bind(_assertThisInitialized(_this88)),i18next.on("languageChanged",_this88._bindedChangeLang),_this88.onSetPage=_this88._onSetPage.bind(_assertThisInitialized(_this88)),_this88}return _inherits(NewsCtrl,Base),_createClass(NewsCtrl,[{key:"isSignedIn",get:function(){return multiAccount.isSignedIn}}]),_createClass(NewsCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(NewsCtrl.prototype),"$onDestroy",this).call(this),newsService.saveNewsViewed(),i18next.off("languageChanged",this._bindedChangeLang)}},{key:"_onSetPage",value:function(index){var indexOfLast=15*(index+1),indexOfFirst=indexOfLast-15;this.shownNewsList=slice(indexOfFirst,indexOfLast,this.newsList)}},{key:"_setChangeHandler",value:function(){var _this89=this;this.receive(newsService.change,function(_ref53){var newsList=_ref53.newsList;_this89.dateBlocks=Object.create(null),newsList.forEach(function(newsItem){var date=new Date(newsItem.timestamp),dateHash=new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0,0).getTime();_this89.dateBlocks[dateHash]?_this89.dateBlocks[dateHash].push(newsItem):_this89.dateBlocks[dateHash]=[newsItem]}),_this89.newsList=_this89._remapDateBlocks(_this89.dateBlocks),utils.safeApply($scope)},this)}},{key:"_parseDate",value:function(timestamp){var numberTimestamp=Number(timestamp),currentYear=(new Date).getFullYear(),newsYear=new Date(numberTimestamp).getFullYear(),time=new Date(numberTimestamp).toLocaleString(this.lng,{day:"numeric",month:"long"});return currentYear===newsYear?time:"".concat(time,", ").concat(newsYear)}},{key:"_remapDateBlocks",value:function(dateBlocks){var _this90=this;return Object.keys(dateBlocks).map(function(key){return{dateHash:key,date:_this90._parseDate(key),newsList:dateBlocks[key].sort(function(a,b){return utils.comparators.desc(a.timestamp,b.timestamp)})}}).sort(function(a,b){return utils.comparators.desc(a.dateHash,b.dateHash)})}},{key:"_changeLang",value:function(lng){var _this91=this;this.lng="ru"===lng||"en"===lng?lng:"en",this.newsList.forEach(function(newsItem){newsItem.date=_this91._parseDate(newsItem.dateHash)}),utils.safeApply($scope)}},{key:"_onChangeNewsList",value:function(){this.totalPages=Math.ceil(this.newsList.length/15),this.shownNewsList=slice(0,15,this.newsList)}}]),NewsCtrl}())};controller.$inject=["Base","newsService","utils","multiAccount","$scope","storage"],angular.module("app.news").controller("NewsCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function NsbtCtrl(){var _this92;return _classCallCheck(this,NsbtCtrl),(_this92=_possibleConstructorReturn(this,_getPrototypeOf(NsbtCtrl).call(this,$scope))).isLogined=!!user.address,_this92}return _inherits(NsbtCtrl,Base),NsbtCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.nsbt").controller("NsbtCtrl",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user,modalManager){return reactDirective(rc.Nsbt,void 0,void 0,{$state:$state,user:user,modalManager:modalManager})};controller.$inject=["reactDirective","$state","user","modalManager"],angular.module("app.nsbt").directive("wNsbt",controller)}(),function(){var controller=function(Base,ChartFactory,$element){var Signal=require("ts-utils").Signal;return new(function(){function Chart(){var _this93;return _classCallCheck(this,Chart),(_this93=_possibleConstructorReturn(this,_getPrototypeOf(Chart).call(this))).signals=Object.assign(_this93.signals,{mouseMove:new Signal,mouseLeave:new Signal}),_this93}return _inherits(Chart,Base),_createClass(Chart,[{key:"$postLink",value:function(){this.chart=new ChartFactory($element,this.options,this.data),this.observe("data",this._updateData),this.observe("options",this._updateOptions),this.receive(this.chart.signals.mouseMove,this.signals.mouseMove.dispatch,this.signals.mouseMove),this.receive(this.chart.signals.mouseLeave,this.signals.mouseLeave.dispatch,this.signals.mouseLeave),this.receive(this.chart.signals.mouseMove,this._onMove,this),this.receive(this.chart.signals.mouseLeave,this._onLeave,this)}},{key:"_updateData",value:function(){this.chart.setData(this.data)}},{key:"_updateOptions",value:function(){this.chart.setOptions(this.options)}},{key:"_onMove",value:function(chartData){this.mouseMove({chartData:chartData})}},{key:"_onLeave",value:function(event){this.mouseLeave({event:event})}}]),Chart}())};controller.$inject=["Base","ChartFactory","$element"],angular.module("app.ui").component("wChart",{bindings:{options:"<",data:"<",mouseMove:"&",mouseLeave:"&"},transclude:!0,template:"<div ng-transclude></div>",controller:controller})}(),function(){var EXCLUDE_ATRIBUTES=["tabindex"],directive=function(Base,utils){return{result:"E",require:null,transclude:!1,template:function($element,$data){var attrs=Object.keys($data.$attr).reduce(function(result,name){return result.push("".concat($data.$attr[name],'="').concat($data[name],'"')),result},[]),typeClass=$data.type?"input-type-".concat($data.type):"",element=$element[0];return EXCLUDE_ATRIBUTES.forEach(function(attr){element.removeAttribute(attr)}),"textarea"in $data?'<div class="w-input-wrap '.concat(typeClass,'"><textarea ').concat(attrs.join(" "),"></textarea></div>"):'<div class="w-input-wrap '.concat(typeClass,'"><input ').concat(attrs.join(" "),"></div>")},link:function($scope,$element,$attrs){return new(function(){function Input(){var _this94;return _classCallCheck(this,Input),(_this94=_possibleConstructorReturn(this,_getPrototypeOf(Input).call(this,$scope)))._$input=null,_this94._$inputWrap=null,_this94._$form=null,_this94._stopScopeHandlers=[],_this94._name=null,_this94._pristine=!0,_this94._initialize(),_this94}return _inherits(Input,Base),_createClass(Input,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(Input.prototype),"$onDestroy",this).call(this),this._stopScopeHandlers.forEach(function(cb){return cb()})}},{key:"_initialize",value:function(){this.firstTouch=!0,this._$input=$element.find("input,textarea"),this._$inputWrap=$element.find(".w-input-wrap");var name=this._name=this._getName(),formName=$element.closest("form").attr("name");if(this._setHandlers(),this._name&&formName){var form=this._$form=this._getForm(formName);this.receive(utils.observe(form[name],"$valid"),this._onChangeValid,this),this.receive(utils.observe(form[name],"$touched"),this._onChangeTouched,this),this._onChangeValid(),this._onChangeTouched()}$attrs.autoFocus&&this._$input.focus()}},{key:"_setHandlers",value:function(){var _this95=this;this._$input.on("click",function(){_this95._pristine=!0}),this._$input.on("focus",function(){_this95._$inputWrap.addClass("focused"),_this95._pristine=!0}),this._$input.on("blur",function(){_this95._$inputWrap.removeClass("focused"),_this95.firstTouch=!0}),this._$input.on("keydown",function(e){_this95._hideValue(e)})}},{key:"_hideValue",value:function(){var el=this._$input.get(0);if(!el.attributes.hidezero||!this.firstTouch)return null;this.firstTouch=!1;var value=el.value;!Number.isNaN(Number(value))&&"0"===value&&this._pristine&&(this._pristine=!1,el.value="")}},{key:"_getName",value:function(){var name=this._$input.attr("name");return name?-1===name.indexOf("{{")?name:$scope.$eval(name.replace("{{","").replace("}}","").replace("::","")):null}},{key:"_getForm",value:function(name){var $localScope=$scope,form=null;do{if(form=$localScope.$eval(name))break;$localScope=$localScope.$parent}while($localScope.$parent);if(!form)throw new Error("Cant find parent form data!");return form}},{key:"_onChangeValid",value:function(){this._$inputWrap.toggleClass("valid",this._$form[this._name].$valid),this._$inputWrap.toggleClass("invalid",!this._$form[this._name].$valid)}},{key:"_onChangeTouched",value:function(){this._$inputWrap.toggleClass("touched",this._$form[this._name].$touched)}}]),Input}())}}};directive.$inject=["Base","utils"],angular.module("app.ui").directive("wInput",directive)}(),function(){var controller=function($element,$scope,Base){return new(function(){function Radio(){var _this96;return _classCallCheck(this,Radio),(_this96=_possibleConstructorReturn(this,_getPrototypeOf(Radio).call(this))).radioWrap=null,_this96.input=null,_this96.name=null,_this96.value=null,_this96}return _inherits(Radio,Base),_createClass(Radio,[{key:"checked",get:function(){return this.radioWrap.getValue()===this.value}}]),_createClass(Radio,[{key:"$postLink",value:function(){this.input=$element.find("input"),this.radioWrap.addRadio(this),this._setHandlers(),this.observe("value",this._onChangeValueAttr),this._onChangeValueAttr()}},{key:"init",value:function(){this._setChecked()}},{key:"_setHandlers",value:function(){var _this97=this;this.input.on("change",function(){_this97.radioWrap.setValue(_this97.value),$scope.$apply()})}},{key:"_onChangeValueAttr",value:function(){this._setChecked()}},{key:"_setChecked",value:function(){this.input.prop("checked",this.checked)}}]),Radio}())};controller.$inject=["$element","$scope","Base"],angular.module("app.ui").component("wRadio",{bindings:{value:"<"},transclude:!0,templateUrl:"modules/ui/directives/radio/radio.html",require:{radioWrap:"^wRadioWrap"},controller:controller})}(),angular.module("app.ui").component("wTHead",{require:{table:"^wTable"},transclude:!0,template:'<div ng-transclude class="table-thead"></div>'}),function(){var controller=function($element,Base,StyleManager){return new(function(){function Table(){var _this98;return _classCallCheck(this,Table),(_this98=_possibleConstructorReturn(this,_getPrototypeOf(Table).call(this)))._children=[],_this98.selected=null,_this98.cid=tsUtils.uniqueId("tableView"),$element.addClass(_this98.cid),_this98.styleManager=new StyleManager(_this98.cid),_this98.observe("selected",_this98._onChangeSelected),_this98}return _inherits(Table,Base),_createClass(Table,[{key:"$postLink",value:function(){this._onChangeSelected(),this._initColumnWidths()}},{key:"$onDestroy",value:function(){this.styleManager.destroy()}},{key:"registerRow",value:function(row){this._children.push(row),this._setRowSelected(row)}},{key:"_onChangeSelected",value:function(){this._children.forEach(this._setRowSelected,this)}},{key:"_initColumnWidths",value:function(){for(var columnsCount=this._children[0].cells.length,width=100/columnsCount,i=0;i<columnsCount;i++)this.styleManager.addStyle(".cell-".concat(i),{width:"".concat(width,"%")})}},{key:"_setRowSelected",value:function(row){row.selected=null!=row.selectValue&&row.selectValue===this.selected}}]),Table}())};controller.$inject=["$element","Base","StyleManager"],angular.module("app.ui").component("wTable",{bindings:{selected:"="},transclude:!0,template:'<div class="table__wrap" ng-transclude></div>',controller:controller})}(),function(){var factory=function($mdDialog,utils,decorators,$templateRequest,$rootScope,$injector,state,storage,user){var tsUtils=require("ts-utils"),ds=require("data-service"),analytics=ds.analytics,Money=require("@waves/data-entities").Money,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,DEFAULT_OPTIONS={clickOutsideToClose:!0,escapeToClose:!0,autoWrap:!1,multiple:!0,skipHide:!0,controllerAs:"$ctrl",ns:"app.utils"},DEFAULT_TEMPLATES_URLS_HEADER="modules/utils/modals/templates/header.modal.html",ModalManager=function(){function ModalManager(){_classCallCheck(this,ModalManager),this.openModal=new tsUtils.Signal,this._counter=0,state.signals.changeRouterStateStart.on(this.closeModals,this),user.logoutSignal.on(this.closeModals,this)}return _createClass(ModalManager,[{key:"showScriptModal",value:function(){return this._getModal({id:"script-modal",contentUrl:"modules/utils/modals/script/script.html",controller:"ScriptModalCtrl",title:"modal.script.setScript"})}},{key:"showPasswordModal",value:function(){return this._getModal({id:"password-modal",contentUrl:"modules/utils/modals/password/password.html",controller:"PasswordModalCtrl",title:"modal.settings.changePass"})}},{key:"showForgotPasswordModal",value:function(_ref54){var overwrite=_ref54.overwrite;return this._getModal({id:"forgot-password-modal",contentUrl:"modules/utils/modals/forgot-password/forgot-password.html",controller:"ForgotPasswordModalCtrl",locals:{overwrite:overwrite}})}},{key:"showTryDesktopModal",value:function(){return analytics.send({name:"Onboarding Platform Popup Show",target:"ui"}),this._getModal({id:"try-desktop",title:"",contentUrl:"modules/utils/modals/tryDesktop/tryDesktop.html",controller:"TryDesktopCtrl",clickOutsideToClose:!1,escapeToClose:!1,mod:"try-desktop-modal"})}},{key:"showExportAccount",value:function(){return this._getModal({id:"export-account",title:"modal.settings.exportAccounts.title",contentUrl:"modules/utils/modals/exportAccounts/exportAccounts.html",controller:"ExportAccountsCtrl",mod:"export-account"})}},{key:"showPairingWithMobile",value:function(){return this._getModal({id:"pairing-with-mobile",title:"",contentUrl:"modules/utils/modals/pairingWithMobile/pairingWithMobile.html",controller:"PairingWithMobileCtrl",mod:"pairing-with-mobile"})}},{key:"showSignByDevice",value:function(signable,argument_1){var anyData=1<arguments.length&&void 0!==argument_1?argument_1:null;return this._getModal({id:"sign-by-device",contentUrl:"modules/utils/modals/signByDevice/signByDevice.html",controller:"SignByDeviceCtrl",locals:{signable:signable,anyData:anyData},clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showConfirmOrder",value:function(options){return this._getModal({id:"confirm-correct-order",contentUrl:"modules/utils/modals/confirmOrder/confirmOrder.html",controller:"ConfirmOrderCtrl",locals:options})}},{key:"showConfirmInvoke",value:function(options){return this._getModal({id:"confirm-correct-invoke",contentUrl:"modules/utils/modals/confirmInvoke/confirmInvoke.html",controller:"ConfirmInvokeCtrl",locals:options})}},{key:"showLoginByDevice",value:function(promise,type){return this._getModal({id:"login-by-device",contentUrl:"modules/utils/modals/loginByDevice/loginByDevice.html",controller:"LoginByDeviceCtrl",locals:function(){return{promise:promise,type:type}},clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showSignDeviceError",value:function(locals){return this._getModal({id:"error-sign-device",contentUrl:"modules/utils/modals/signDeviceError/signDeviceError.html",controller:"SignDeviceError",locals:_objectSpread({},locals),clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showGatewaySign",value:function(search){return this._getModal({id:"gateway-sign-in",title:"{{$ctrl.titleLiteral}}",contentUrl:"modules/utils/modals/gateway/gatewaySign.html",controller:"GatewaySignCtrl",locals:{search:search},clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showPinAsset",value:function(){return this._getModal({id:"pin-asset",title:"modal.pinAsset.title",templateUrl:"modules/utils/modals/pinAsset/pinAsset.html",controller:"PinAssetCtrl",mod:"pin-asset-modal"})}},{key:"showAssetInfo",value:function(asset){return this._getModal({id:"asset-info",title:"modal.assetInfo.title",contentUrl:"modules/utils/modals/assetInfo/assetInfo.html",locals:asset,controller:"AssetInfoCtrl",mod:"m-dialog m-dialog_asset-info"})}},{key:"showSettings",value:function(){return this._getModal({id:"user-settings",ns:"app.utils",title:"modal.settings.title",contentUrl:"modules/utils/modals/settings/settings.html",controller:"SettingsCtrl",mod:"settings-modal"})}},{key:"showAcceptNewTerms",value:function(){return this._getModal({id:"accept-new-terms",templateUrl:"modules/utils/modals/acceptNewTerms/accept-new-terms.html",controller:"AcceptNewTermsCtrl",clickOutsideToClose:!1,escapeToClose:!1}).then(function(){storage.save("needReadNewTerms",!1)})}},{key:"showPredictionResult",value:function(type,winnerBalance,wavesBalance,didFinished){return this._getModal({locals:{type:type,winnerBalance:winnerBalance,wavesBalance:wavesBalance,didFinished:didFinished},id:"prediction-result",templateUrl:"modules/utils/modals/predictionResult/predictionResult.html",controller:"PredictionResultCtrl",clickOutsideToClose:!0,escapeToClose:!0})}},{key:"showTutorialModals",value:function(){return this._getModal({id:"tutorial-modals",templateUrl:"modules/utils/modals/tutorialModals/tutorialModals.html",controller:"TutorialModalsCtrl"})}},{key:"showSeedBackupModal",value:function(){var _this99=this;return ds.signature.getSignatureApi().getSeed().then(function(phrase){var seed=new ds.Seed(phrase,ds.config.get("code"));return _this99._getModal({id:"seed-backup",contentUrl:"modules/utils/modals/seedBackup/seedBackupModals.html",controller:"SeedBackupModalsCtrl",locals:{seed:seed}})})}},{key:"showConfirmDeleteUser",value:function(user){return this._getModal({id:"delete-user-confirm",templateUrl:"modules/utils/modals/confirmDeleteUser/confirmDeleteUser.modal.html",controller:"confirmDeleteUserCtrl",locals:{user:user}})}},{key:"showDexScriptedPair",value:function(assets){return this._getModal({id:"dex-scripted-pair",templateUrl:"modules/utils/modals/dexScriptedPair/dexScriptedPair.html",controller:"DexScriptedPairCtrl",locals:{assets:assets}})}},{key:"showAccountChangeName",value:function(){return this._getModal({id:"changeName",templateUrl:"modules/utils/modals/changeName/changeName.html",controller:"ChangeNameCtrl"})}},{key:"showAccountAddress",value:function(){return this._getModal({id:"addressInfo",templateUrl:"modules/utils/modals/addressInfo/addressInfo.html",controller:"AddressInfoCtrl"})}},{key:"showAccountInfo",value:function(){var user=$injector.get("user");return this._getModal({id:"account-info",controller:"AccountInfoCtrl",title:"modal.account.title",titleParams:{name:user.name||$injector.get("i18n").translate("modal.account.title_default_name","app.utils")},contentUrl:"modules/utils/modals/accountInfo/account-info.modal.html",mod:"account-info"})}},{key:"showSendAsset",value:function(data){return data=data||Object.create(null),this._getModal({id:"send-asset",controller:"AssetSendCtrl",templateUrl:"modules/utils/modals/sendAsset/send.modal.html",mod:"modal-send",locals:{assetId:data.assetId,canChooseAsset:!data.assetId,mode:data.mode,amount:data.amount,recipient:data.recipient,strict:data.strict,referrer:data.referrer,attachment:data.attachment}})}},{key:"showReceiveModal",value:function(asset){return this._getModal({id:"receive-popup",locals:{asset:asset},templateUrl:"modules/utils/modals/receive/Receive.html",controller:"ReceiveCtrl"})}},{key:"showDepositAsset",value:function(user,asset){return this._getModal({id:"deposit-asset",locals:{address:user.address,asset:asset},title:"modal.deposit.title",titleParams:{assetName:asset.name},contentUrl:"modules/utils/modals/depositAsset/deposit-asset.modal.html",controller:"DepositAsset",mod:"modal-deposit-asset"})}},{key:"showSepaAsset",value:function(user,asset){return this._getModal({id:"sepa-asset",locals:{address:user.address,asset:asset},title:"modal.sepa.title",titleParams:{assetName:asset.name},contentUrl:"modules/utils/modals/sepaAsset/sepa-asset.modal.html",controller:"SepaAsset",mod:"modal-sepa-asset"})}},{key:"showTransactionInfo",value:function(transactionId){return this._getModal({id:"transaction-info",ns:"app.ui",controller:"TransactionInfoCtrl",templateUrl:"modules/utils/modals/transactionInfo/transaction-info.modal.html",mod:"transaction-info",locals:{transactionId:transactionId}})}},{key:"showAnyTx",value:function(tx,analyticsText){return this._getModal({id:"any-tx-modal",controller:"AnyTxModalCtrl",contentUrl:"modules/utils/modals/anyTxModal/any-tx-modal.html",title:"modals.anyTx.title",locals:{tx:tx,analyticsText:analyticsText},focusOnOpen:!1})}},{key:"showStartLeasing",value:function(){return this._getModal({id:"start-leasing",ns:"app.utils",controller:"StartLeasingCtrl",titleContent:"{{$ctrl.title}}",mod:"start-leasing",contentUrl:"modules/utils/modals/startLeasing/startLeasing.html"})}},{key:"showConfirmTx",value:function(signable,analyticsText,onBuyWithCardClick){return this._getModal({id:"confirm-tx",mod:"confirm-tx",ns:"app.ui",locals:{signable:signable,analyticsText:analyticsText,onBuyWithCardClick:onBuyWithCardClick},controller:"ConfirmTxCtrl",contentUrl:"modules/utils/modals/confirmTx/confirmTx.modal.html"})}},{key:"showBurnModal",value:function(assetId,onBuyWithCardClick){var _this100=this;return $injector.get("waves").node.assets.balance(assetId).then(function(_ref55){var available=_ref55.available;return _this100._getModal({id:"token-burn",mod:"change-token",locals:{money:available,txType:"burn",onBuyWithCardClick:onBuyWithCardClick},titleContent:'<span w-i18n="modal.token.burn.title" params="{name: $ctrl.asset.name}"></span>',contentUrl:"modules/utils/modals/changeToken/change-token-modal.html",controller:"TokenChangeModalCtrl"})})}},{key:"showReissueModal",value:function(assetId,onBuyWithCardClick){var _this101=this;return $injector.get("waves").node.assets.balance(assetId).then(function(_ref56){var available=_ref56.available;return _this101._getModal({id:"token-burn",mod:"change-token",locals:{money:available,txType:"reissue",onBuyWithCardClick:onBuyWithCardClick},titleContent:'<span w-i18n="modal.token.reissue.title" params="{name: $ctrl.asset.name}"></span>',contentUrl:"modules/utils/modals/changeToken/change-token-modal.html",controller:"TokenChangeModalCtrl"})})}},{key:"showSponsorshipModal",value:function(assetId,isEdit,onBuyWithCardClick){var _this102=this,title=isEdit?"modal.sponsorship_edit.title":"modal.sponsorship.title";return ds.api.assets.get(assetId).then(function(asset){return _this102._getModal({id:"sponsorship",mod:"sponsorship",locals:{asset:asset,assetId:assetId,isCreateSponsored:!isEdit,onBuyWithCardClick:onBuyWithCardClick},titleContent:'<span w-i18n="'.concat(title,'"></span>'),controller:"SponsoredModalCtrl",contentUrl:"modules/utils/modals/sponsored/sponsored.html"})})}},{key:"showSetAssetScriptModal",value:function(assetId){return this._getModal({id:"setAssetScript",mod:"setAssetScript",locals:assetId,titleContent:'<span w-i18n="'.concat("modal.setAssetScript.title",'"></span>'),controller:"SetAssetScriptModalCtrl",contentUrl:"modules/utils/modals/setAssetScript/setAssetScript.html"})}},{key:"showSponsorshipStopModal",value:function(assetId,onShowBuyFiatModal){var _this103=this,waves=$injector.get("waves");return Promise.all([ds.api.assets.get(assetId),waves.node.getFee({type:SIGN_TYPE.SPONSORSHIP})]).then(function(_ref57){var _ref58=_slicedToArray(_ref57,2),asset=_ref58[0],fee=_ref58[1],money=new Money(0,asset),tx=waves.node.transactions.createTransaction({type:SIGN_TYPE.SPONSORSHIP,assetId:assetId,asset:asset,minSponsoredAssetFee:money,fee:fee}),signable=ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx});return _this103.showConfirmTx(signable,void 0,onShowBuyFiatModal)})}},{key:"showImportAccountsModal",value:function(){return this._getModal({id:"import-accounts",mod:"import-accounts",controller:"ImportAccountsCtrl",contentUrl:"modules/utils/modals/importAccounts/importAccounts.html"})}},{key:"showConfirmLogout",value:function(){return this._getModal({id:"logout-modal",contentUrl:"modules/utils/modals/confirmLogout/confirmLogout.modal.html",title:""})}},{key:"showLockPairWarning",value:function(amountTicker,priceTicker){return this._getModal({id:"logout-modal",controller:"LockPairWarningCtrl",contentUrl:"modules/utils/modals/lockPairWarning/lockPairWarning.modal.html",locals:{amountTicker:amountTicker,priceTicker:priceTicker}})}},{key:"showMigrateModal",value:function(){return this._getModal({id:"migrate-modal",controller:"MigrateModalCtrl",contentUrl:"modules/utils/modals/migrateModal/migrationFailed.hrml"})}},{key:"showMigrationFailedModal",value:function(){return this._getModal({id:"migration-failed",controller:"MigrationFailed",contentUrl:"modules/utils/modals/migrationFailed/migrationFailed.html"})}},{key:"showMigrationAchivementModal",value:function(){return analytics.send({name:"Congratulation"}),this._getModal({id:"migration-achivement-modal",controller:"MigrationAchivementModalCtrl",contentUrl:"modules/utils/modals/migrationAchivementModal/migrationAchivement.modal.html"})}},{key:"showDexStartModal",value:function(){return this._getModal({id:"dex-start",contentUrl:"modules/utils/modals/dexStart/dexStart.html",clickOutsideToClose:!1})}},{key:"showUpdateModal",value:function(options){return this._getModal(_objectSpread({id:"update-client",controller:"UpdateClientCtrl",contentUrl:"modules/utils/modals/updateClient/updateClient.html",clickOutsideToClose:!0},options))}},{key:"showEmailSubscribeModal",value:function(){return this._getModal({id:"email-subscribe",controller:"EmailSubscribeCtrl",contentUrl:"modules/utils/modals/emailSubscribe/emailSubscribe.html",clickOutsideToClose:!1})}},{key:"showDialogModal",value:function(options){var ns=options.ns||DEFAULT_OPTIONS.ns;options.message.ns=options.message.ns||ns,options.buttons.forEach(function(button){button.text.ns=button.text.ns||ns});var controller=function($scope,$mdDialog){Object.assign($scope,options),this.applyClick=function(button){var method=button.success?"hide":"cancel";button.click&&button.click(),$mdDialog[method](button.data)}};return controller.$inject=["$scope","$mdDialog"],this._getModal(tsUtils.merge({},DEFAULT_OPTIONS,options,{contentUrl:"modules/utils/modals/templates/dialog-content.html",controller:controller}))}},{key:"showCustomModal",value:function(options){return this._getModal(tsUtils.merge({},DEFAULT_OPTIONS,options))}},{key:"showReactModal",value:function(options){return options=_objectSpread({contentUrl:"modules/utils/modals/reactModal/reactModal.html",controller:"ReactModalCtrl"},options),this._getModal(tsUtils.merge({},DEFAULT_OPTIONS,options))}},{key:"showWalletDebugModal",value:function(){return this._getModal({id:"wallet-debug-modal",controller:"WalletDebugModalCtrl",contentUrl:"modules/utils/modals/walletDebug/walletDebugModal.html"})}},{key:"showSmartPairModal",value:function(amountTicker,priceTicker){return this._getModal({id:"smart-asset",controller:"smartPairCtrl",contentUrl:"modules/utils/modals/smartPair/smartPair.html",locals:{amountTicker:amountTicker,priceTicker:priceTicker}})}},{key:"showAccessSecurityInformationModal",value:function(onValid){return this._getModal({id:"access-security-information-modal",ns:"app.utils",title:"modal.accessSecurityInformation.title",locals:{onValid:onValid},focusOnOpen:!1,controller:"AccessSecurityInformationCtrl",contentUrl:"modules/utils/modals/accessSecurityInformation/access-security-information.html"})}},{key:"showStakingInfoModal",value:function(){return this._getModal({id:"staking-info-modal",controller:"StakingInfoModalCtrl",contentUrl:"modules/utils/modals/stakingInfoModal/stakingInfoModal.html"})}},{key:"closeModals",value:function(){for(var counter=this._counter,i=0;i<counter;i++)$mdDialog.cancel()}},{key:"_getUser",value:function(){return $injector.get("user")}},{key:"_getModal",value:function(options){var _this104=this,target=_objectSpread({},DEFAULT_OPTIONS,{},options);target.locals&&(target.bindToController=!0);var modalPromise=ModalManager._getTemplate(target).then(function(template){var _ModalManager$_getCon=ModalManager._getController(options),controller=_ModalManager$_getCon.controller,controllerAs=_ModalManager$_getCon.controllerAs,changeCounter=function(){_this104._counter--,options.id};target.controller=controller,target.controllerAs=controllerAs,target.template=template,_this104._counter++;var modal=$mdDialog.show(target);return options.id,modal.then(changeCounter,changeCounter),_this104.openModal.dispatch(modal),modal});return modalPromise.catch(function(e){return e}),modalPromise}}],[{key:"_getTemplate",value:function(options){return options.template?Promise.resolve(options.template):options.templateUrl?ModalManager._loadTemplate(options.templateUrl):ModalManager._createTemplate(options)}},{key:"_getController",value:function(options){if(!options.controller)return{controller:ModalManager._wrapController(function(){return{}}),controllerAs:null};var controllerAs,controller=null;if("function"==typeof options.controller)controller=ModalManager._wrapController(options.controller);else{var parts=options.controller.split(" as ");controller=ModalManager._wrapController(WavesApp.getController(parts[0])),controllerAs=parts[1]}return{controller:controller,controllerAs:controllerAs=controllerAs||DEFAULT_OPTIONS.controllerAs}}},{key:"_wrapController",value:function(controller){var $ctrl=function($element,$mdDialog){$element.on("click","[w-modal-close]",function(){$mdDialog.cancel()}),$element.on("click","[w-modal-hide]",function(){$mdDialog.hide()});for(var _len9=arguments.length,args=new Array(2<_len9?_len9-2:0),_key9=2;_key9<_len9;_key9++)args[_key9-2]=arguments[_key9];return controller.call.apply(controller,[this].concat(args))};return $ctrl.$inject=["$element","$mdDialog"].concat(_toConsumableArray(controller.$inject||[])),$ctrl}},{key:"_createTemplate",value:function(options){return Promise.all([ModalManager._getHeader(options).then(ModalManager._wrapTemplate("md-toolbar")),ModalManager._getContent(options).then(ModalManager._wrapTemplate("md-dialog-content")),ModalManager._getFooter(options)]).then(function(templateParts){var mod=options.mod,ns=options.ns,content=templateParts.filter(Boolean).join("");return ModalManager._getWrapTemplate({ns:ns,mod:mod,content:content})})}},{key:"_getHeader",value:function(options){if(options.title){var params=options.titleParams?JSON.stringify(options.titleParams):"",title='<div class="headline-2 user-wallet-info" params=\''.concat(params,"'\n                    w-i18n=\"").concat(options.title,'"></div>');return ModalManager._loadTemplate(DEFAULT_TEMPLATES_URLS_HEADER).then(function(template){return template.replace("{{title}}",title)})}return options.titleContent||options.titleContentUrl?Promise.all([ModalManager._getTemplateOption(options,"titleContent"),ModalManager._loadTemplate(DEFAULT_TEMPLATES_URLS_HEADER)]).then(function(_ref59){var _ref60=_slicedToArray(_ref59,2),titleContent=_ref60[0];return _ref60[1].replace("{{title}}",titleContent)}):ModalManager._getTemplateOption(options,"header")}},{key:"_getContent",value:function(options){return ModalManager._getTemplateOption(options,"content")}},{key:"_getFooter",value:function(options){return ModalManager._getTemplateOption(options,"footer")}},{key:"_getTemplateOption",value:function(options,name){return options[name]?Promise.resolve(options[name]):options["".concat(name,"Url")]?ModalManager._loadTemplate(options["".concat(name,"Url")]):Promise.resolve(null)}},{key:"_wrapTemplate",value:function(tagName){return function(template){return template=template&&"<".concat(tagName,">").concat(template,"</").concat(tagName,">")}}},{key:"_getWrapTemplate",value:function(_ref61){var ns=_ref61.ns,mod=_ref61.mod,content=_ref61.content,namespace=ns?'w-i18n-ns="'.concat(ns,'"'):"",classes=mod?'class="'.concat(mod,'"'):"";return"<md-dialog ".concat(namespace," ").concat(classes,' aria-label="modal">').concat(content,"</md-dialog>")}},{key:"_loadTemplate",value:function(url){return $templateRequest(url)}}]),ModalManager}();return utils.bind(new ModalManager)};factory.$inject=["$mdDialog","utils","decorators","$templateRequest","$rootScope","$injector","state","storage","user"],angular.module("app.utils").factory("modalManager",factory)}(),function(){var tsUtils=require("ts-utils"),factory=function(timeLine){return{readonly:function(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];var result=origin.call.apply(origin,[this].concat(args));return tsUtils.getPaths(result).forEach(function(path){Object.freeze(tsUtils.get(result,path))}),result}},scope:function(defaults){return function(target,key,descriptor){var cache=defaults||Object.create(null),origin=descriptor.value;descriptor.value=function(){for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++)args[_key11]=arguments[_key11];return args.push(cache),origin.call.apply(origin,[this].concat(args))}}},async:function(timeout){var addTimeout,dropTimeout;return dropTimeout=timeout?(addTimeout=function(cb){return setTimeout(cb,timeout)},clearTimeout):(addTimeout=requestAnimationFrame,cancelAnimationFrame),function(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _this105=this,_len12=arguments.length,args=new Array(_len12),_key12=0;_key12<_len12;_key12++)args[_key12]=arguments[_key12];this["__".concat(key,"_timer")]&&dropTimeout(this["__".concat(key,"_timer")]),this["__".concat(key,"_timer")]=addTimeout(function(){_this105["__".concat(key,"_timer")]=null,origin.call.apply(origin,[_this105].concat(args))})}}},cachable:function(time,toString){return function(target,key,descriptor){var origin=descriptor.value,cache=Object.create(null),timeout=1e3*time;descriptor.value=0<time?function(){for(var _len13=arguments.length,args=new Array(_len13),_key13=0;_key13<_len13;_key13++)args[_key13]=arguments[_key13];var key=toString?toString(args):stringify(args);return cache[key]&&cache[key].value||(cache[key]=Object.create(null),cache[key].value=origin.call.apply(origin,[this].concat(args)),cache[key].value&&cache[key].value.then&&"function"==typeof cache[key].value.then?cache[key].value.then(function(){cache[key].timer=timeLine.timeout(function(){delete cache[key]},timeout)},function(){timeLine.cancel(cache[key].timer),delete cache[key]}):cache[key].timer=timeLine.timeout(function(){delete cache[key]},timeout)),cache[key].value}:function(){for(var _len14=arguments.length,args=new Array(_len14),_key14=0;_key14<_len14;_key14++)args[_key14]=arguments[_key14];var key=toString?toString(args):stringify(args);return cache[key]||(cache[key]=origin.call.apply(origin,[this].concat(args))),cache[key]}}}}};function stringify(some){try{return JSON.stringify(some)}catch(e){return String(some)}}factory.$inject=["timeLine"],angular.module("app.utils").factory("decorators",factory)}(),function(){var BaseConfigService=require("data-service").utils.ConfigService,factory=function(Poll){return new(function(){function ConfigService(){var _this106=this;_classCallCheck(this,ConfigService),this.change=void 0,this.configReady=void 0,this.configReadyPromise=void 0,this.service=new BaseConfigService(WavesApp),this.change=this.service.change,this.configReadyPromise=this.service.configReady,this.configReady=new Poll(function(){return _this106.service.fetchConfig()},function(){return null},3e4)}return _createClass(ConfigService,[{key:"get",value:function(path){return this.service.getConfig(path)}},{key:"getFeeConfig",value:function(){return this.service.getFeeConfig()}},{key:"getUserNotifications",value:function(){return this.service.getUserNotifications()}}]),ConfigService}())};factory.$inject=["Poll"],angular.module("app").factory("configService",factory)}(),function(){var Signal=require("ts-utils").Signal,ds=require("data-service"),OrdersWatcher=function(){function OrdersWatcher(){var _this107=this;_classCallCheck(this,OrdersWatcher),this._changeSignal=new Signal,ds.dataManager.addressSubject.subscribe(function(address){_this107._changeSignal.off(),address&&ds.dataManager.matcherService.signals.changeOrders.on(_this107._changeSignal.dispatch,_this107._changeSignal)})}return _createClass(OrdersWatcher,[{key:"getState",value:function(){return{ready:!0,error:!1,orders:ds.dataManager.matcherService.getOrders()}}},{key:"subscribe",value:function(cb,ctx){this._changeSignal.on(cb,ctx)}},{key:"unsubscribe",value:function(cb){this._changeSignal.off(cb)}},{key:"restart",value:function(){}}]),OrdersWatcher}();angular.module("app").service("ordersWatcher",OrdersWatcher)}(),function(){var factory=function(user,utils){var tsUtils=require("ts-utils");return new(function(){function SessionBridge(){var _this108=this;_classCallCheck(this,SessionBridge),this._sessionId="s_".concat(Date.now()),this._key="__sb",this._messageHash=Object.create(null),this.signals=utils.liteObject({changeSessions:new tsUtils.Signal}),this._api=utils.liteObject({getLoginData:function(commandData){return _this108._getLoginData(commandData)},sign:function(commandData){return _this108._sign(commandData)},response:function(commandData){return _this108._onResponse(commandData)}}),this._setHandlers(),user.onLogin().then(function(){return _this108._handleLogin()},function(){return _this108._handleLogout()})}return _createClass(SessionBridge,[{key:"_sessionListKey",get:function(){return"".concat(this._key,"-sessionList")}}]),_createClass(SessionBridge,[{key:"getSessionsData",value:function(){var _this109=this,userDataHash=this._getOtherSessions().reduce(function(result,sessionId){var userData=_this109._getUserDataBySession(sessionId);return userData?result[userData.address]=userData:_this109._clearCommand(_this109._getSessionDataKey(sessionId)),result},Object.create(null));return Object.values(userDataHash)}},{key:"login",value:function(sessionId){return this._runCommand("getLoginData",sessionId).then(function(response){"success"===response.status&&user.login(response.data)})}},{key:"sign",value:function(type,tx){var master=this._getMasterSessionId(user.address);return this._runCommand("sign",master&&master.id,{type:type,tx:tx})}},{key:"_handleLogin",value:function(){this._addSession(),this._addUserData(),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._destroy(),user.loginSignal.once(this._handleLogin,this)}},{key:"_getLoginData",value:function(request){return this._setResponseSuccess(request,{address:user.address})}},{key:"_sign",value:function(){}},{key:"_setResponseSuccess",value:function(request,body){this._setResponse(request,"success",{data:body})}},{key:"_setResponseError",value:function(request,message){this._setResponse(request,"error",{message:message})}},{key:"_setResponse",value:function(request,status,data){var _this110=this,command=this._getCommandKey(request.referer,"response");this._dispatch(command,{id:request.id,referer:this._sessionId,data:_objectSpread({status:status},data)}),setTimeout(function(){_this110._clearCommand(command)},100)}},{key:"_runCommand",value:function(apiMethod,targetSessionId,data){var _this111=this;return new Promise(function(resolve){var id=tsUtils.uniqueId("cmd__"),params={id:id,data:data,referer:_this111._sessionId},command=_this111._getCommandKey(targetSessionId,apiMethod);_this111._messageHash[id]=function(result){delete _this111._messageHash[id],_this111._clearCommand(command),resolve(result)},_this111._dispatch(command,params),setTimeout(function(){_this111._messageHash[id]&&_this111._messageHash[id]({status:"error",message:new Error("Timeout limit error!")})},1e3)})}},{key:"_dispatch",value:function(storageKey,data){localStorage.setItem(storageKey,JSON.stringify(data))}},{key:"_clearCommand",value:function(storageKey){localStorage.removeItem(storageKey)}},{key:"_onResponse",value:function(commandData){this._messageHash[commandData.id]&&this._messageHash[commandData.id](commandData.data)}},{key:"_setHandlers",value:function(){var _this112=this;window.addEventListener("storage",function(event){return _this112._onStorageEvent(event)},!1),window.addEventListener("unload",function(){return _this112._destroy()},!1)}},{key:"_onStorageEvent",value:function(event){if(event.newValue){var cmd=this._parseCommand(event.key);if(cmd&&cmd in this._api){var commandData=JSON.parse(localStorage.getItem(event.key));try{this._api[cmd](commandData)}catch(e){"response"!==cmd&&this._setResponseError(commandData,e)}}else event.key===this._sessionListKey&&this.signals.changeSessions.dispatch(this.getSessionsData())}}},{key:"_destroy",value:function(){this._removeSession(),this._removeUserData()}},{key:"_addSession",value:function(){var sessions=JSON.parse(localStorage.getItem(this._sessionListKey)||"[]");sessions.push(this._sessionId),localStorage.setItem(this._sessionListKey,JSON.stringify(sessions))}},{key:"_removeSession",value:function(){var sessions=JSON.parse(localStorage.getItem(this._sessionListKey)||"[]"),index=sessions.indexOf(this._sessionId);-1!==index&&(sessions.splice(index,1),localStorage.setItem(this._sessionListKey,JSON.stringify(sessions)))}},{key:"_addUserData",value:function(){localStorage.setItem(this._getSessionDataKey(),JSON.stringify({name:user.name,address:user.address,id:this._sessionId,isMaster:user.isMaster()}))}},{key:"_getMasterSessionId",value:function(address){return tsUtils.find(this.getSessionsData(),{address:address,isMaster:!0})}},{key:"_getAllSessions",value:function(){return JSON.parse(localStorage.getItem(this._sessionListKey)||"[]")}},{key:"_getOtherSessions",value:function(){var _this113=this;return this._getAllSessions().filter(function(sessionId){return sessionId!==_this113._sessionId})}},{key:"_removeUserData",value:function(sessionId){localStorage.removeItem(this._getSessionDataKey(sessionId))}},{key:"_getUserDataBySession",value:function(sessionId){return JSON.parse(localStorage.getItem(this._getSessionDataKey(sessionId)))}},{key:"_getSessionDataKey",value:function(argument_0){var sessionId=0<arguments.length&&void 0!==argument_0?argument_0:this._sessionId;return"".concat(this._key,"-").concat(sessionId)}},{key:"_getCommandKey",value:function(sessionId,cmd){return"".concat(this._getSessionDataKey(sessionId),"-").concat(cmd,"-cmd")}},{key:"_parseCommand",value:function(localStorageKey){var _localStorageKey$spli2=_slicedToArray(localStorageKey.split("-").slice(1,-1),2),sessionId=_localStorageKey$spli2[0],cmd=_localStorageKey$spli2[1];return sessionId&&cmd&&sessionId===this._sessionId?cmd:null}}]),SessionBridge}())};factory.$inject=["user","utils"],angular.module("app").factory("sessionBridge",factory)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,configService,user,modalManager){return reactDirective(rc.BuyUSDN,void 0,void 0,{$state:$state,configService:configService,user:user,modalManager:modalManager})};controller.$inject=["reactDirective","$state","configService","user","modalManager"],angular.module("app.buyUsdn").directive("wBuyUsdn",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.DefoFaq,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.defoFaq").directive("wDefoFaq",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,configService,$state){return reactDirective(rc.Page404,void 0,void 0,{configService:configService,$state:$state})};controller.$inject=["reactDirective","configService","$state"],angular.module("app.page404").directive("wReactPage404",controller)}(),function(){var controller=function(Base,$scope,userNotification,notification){return new(function(){function StandCtrl(){var _this114;_classCallCheck(this,StandCtrl);return(_this114=_possibleConstructorReturn(this,_getPrototypeOf(StandCtrl).call(this,$scope))).tab="monkey1",_this114.tabSideBar="tab1",_this114.rangeOne=0,_this114.rangeTwo=0,_this114.rangeThree=0,_this114.qrData="Keep on waving, we`ll take care of the bad guys",_this114.info=_this114.dataCopy="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",_this114.invalid=!0,_this114.warning=!0,_this114.success=!0,_this114.error=!0,_this114.active=!0,_this114.inactive=!0,_this114.seedConfirmWasFilled=!1,_this114.seedIsValid=!1,_this114.seed="merry evil keep lost fox tech absent trololo both field get input div cosmic",_this114.mdTemplate="###Заголовок",_this114.mdText={en:_this114.mdTemplate},_this114}return _inherits(StandCtrl,Base),_createClass(StandCtrl,[{key:"onMdInputChange",value:function(){this.mdText={ru:this.mdTemplate}}},{key:"showUserInfoNotification",value:function(){userNotification.info({body:{literal:1}})}},{key:"showUserErrorNotification",value:function(){userNotification.error({body:{literal:2}})}},{key:"showUserSuccessNotification",value:function(){userNotification.success({body:{literal:3}})}},{key:"showUserWarnNotification",value:function(){userNotification.warn({body:{literal:4}})}},{key:"showInfoNotification",value:function(){notification.info({title:{literal:"Title info"},body:{literal:"Text body info"}})}},{key:"showErrorNotification",value:function(){notification.error({title:{literal:"Title error"},body:{literal:"Text body error"}})}}]),StandCtrl}())};controller.$inject=["Base","$scope","userNotification","notification"],angular.module("app.stand").controller("StandCtrl",controller)}(),function(){var RESOLUTIONS_FULL_HD={width:1920,height:1080},RESOLUTIONS_HD={width:1280,height:720},RESOLUTIONS_VGA={width:640,height:480},RESOLUTIONS_QVGA={width:320,height:240},factory=function($q){var MediaStream=function(){function MediaStream(stream){_classCallCheck(this,MediaStream),this.stream=stream}return _createClass(MediaStream,[{key:"stop",value:function(){this.stream.getTracks()[0].stop()}}]),MediaStream}();function getConstraints(deviceList,resolution){var constraints={video:{width:{exact:resolution.width},height:{exact:resolution.height}}};if(navigator.mediaDevices.getSupportedConstraints().facingMode)constraints.video.facingMode="environment";else{var deviceInfo=function(devices){var facingBackCamera=devices.find(function(device){return device.label.includes("back")});if(!facingBackCamera){var videoInputDevices=devices.filter(function(device){return"videoinput"===device.kind});facingBackCamera=videoInputDevices[videoInputDevices.length-1]}return facingBackCamera||null}(deviceList);constraints.video.deviceId={exact:deviceInfo.deviceId}}return constraints}return{create:function(){return $q(function(resolve,reject){if(!navigator.mediaDevices)return reject(new Error("navigator.mediaDevices is undefined"));navigator.mediaDevices.enumerateDevices().then(function(deviceList){var mediaDevices=navigator.mediaDevices,checkResolution=function(res){return mediaDevices.getUserMedia(getConstraints(deviceList,res)).catch(function(){return mediaDevices.getUserMedia(getConstraints(deviceList,function(resolution){return{width:resolution.height,height:resolution.width}}(res)))})};return checkResolution(RESOLUTIONS_FULL_HD).catch(function(){return checkResolution(RESOLUTIONS_HD)}).catch(function(){return checkResolution(RESOLUTIONS_VGA)}).catch(function(){return checkResolution(RESOLUTIONS_QVGA)})}).then(function(stream){resolve(new MediaStream(stream))},reject)})}}};factory.$inject=["$q"],angular.module("app.utils").factory("mediaStream",factory)}(),function(){var Signal=require("ts-utils").Signal,Money=require("@waves/data-entities").Money,_require29=require("ramda"),path=_require29.path,indexBy=_require29.indexBy,ds=require("data-service"),factory=function(user,waves,utils){return new(function(){function BalanceWatcher(){var _this115=this;_classCallCheck(this,BalanceWatcher),this.change=new Signal,this.ready=void 0,this._resolve=void 0,this._reject=void 0,this._auth=!1,this.ready=new Promise(function(resolve,reject){_this115._resolve=resolve,_this115._reject=reject});var addListeners=function(){user.loginSignal.on(_this115._handleLogin,_this115),user.logoutSignal.on(_this115._handleLogout,_this115)};user.onLogin().then(function(){addListeners(),_this115._handleLogin()},function(){addListeners(),_this115._handleLogout()})}return _createClass(BalanceWatcher,[{key:"getBalance",value:function(){return this._getHash()}},{key:"getBalanceByAsset",value:function(asset){var hash=this.getBalance();return hash[asset.id]?hash[asset.id]:new Money(0,asset)}},{key:"getBalanceByAssetList",value:function(assetList){return assetList.map(this.getBalanceByAsset,this)}},{key:"getBalanceByAssetId",value:function(id){return waves.node.assets.getAsset(id).then(this.getBalanceByAsset.bind(this))}},{key:"getFullBalanceByAssetId",value:function(ids){var _ds$dataManager,_ds$dataManager$match,hash=indexBy(path(["asset","id"]),(null===(_ds$dataManager=ds.dataManager)||void 0===_ds$dataManager?void 0:null===(_ds$dataManager$match=_ds$dataManager.matcherService)||void 0===_ds$dataManager$match?void 0:_ds$dataManager$match.getBalances())||[]),isList=Array.isArray(ids);return waves.node.assets.getAsset(utils.toArray(ids)).then(function(assets){return assets.map(function(asset){if(hash[asset.id])return hash[asset.id];var empty=new Money(0,asset);return{asset:asset,regular:empty,available:empty,inOrders:empty,leasedOut:empty,leasedIn:empty}})}).then(function(data){return isList?data:data[0]})}},{key:"getFullBalanceList",value:function(){return ds.dataManager.matcherService?ds.dataManager.matcherService.getBalances():[]}},{key:"_handleLogin",value:function(){!0===this._auth&&this._handleLogout(),this._auth=!0,this._watch()}},{key:"_handleLogout",value:function(){var _this116=this;this._auth=!1,this._poll&&this._poll.destroy(),this.ready=new Promise(function(resolve,reject){_this116._resolve=resolve,_this116._reject=reject})}},{key:"_watch",value:function(){var _this117=this;this._dispatch(),ds.dataManager.matcherService.signals.changeBalance.on(function(){_this117._dispatch()})}},{key:"_dispatch",value:function(){this._resolve&&(this._resolve(),this._resolve=null),this.change.dispatch(this._getHash())}},{key:"_getHash",value:function(){var _ds$dataManager2,_ds$dataManager2$matc,_ds$dataManager2$matc2;return(null===(_ds$dataManager2=ds.dataManager)||void 0===_ds$dataManager2?void 0:null===(_ds$dataManager2$matc=_ds$dataManager2.matcherService)||void 0===_ds$dataManager2$matc?void 0:null===(_ds$dataManager2$matc2=_ds$dataManager2$matc.getBalances())||void 0===_ds$dataManager2$matc2?void 0:_ds$dataManager2$matc2.reduce(function(acc,balance){return Object.assign(acc,_defineProperty({},balance.asset.id,balance.available))},{}))||{}}}]),BalanceWatcher}())};factory.$inject=["user","waves","utils"],angular.module("app").factory("balanceWatcher",factory)}(),function(){var factory=function(){return function(){function TxEvent(id,moneyList){_classCallCheck(this,TxEvent),this.id=id,this.moneyList=moneyList}return _createClass(TxEvent,[{key:"getReservedMoneyList",value:function(){return this.moneyList}}]),TxEvent}()};factory.$inject=[],angular.module("app").factory("TxEvent",factory)}(),function(){var _require30=require("ramda"),flatten=_require30.flatten,pipe=_require30.pipe,prop=_require30.prop,map=_require30.map,factory=function(utils,timeLine,symbolInfoService,waves,matcher,configService){return new(function(){function CandlesService(){_classCallCheck(this,CandlesService),this._lastTime=0,this._subscriber=null,this.onLoadError=angular.noop}return _createClass(CandlesService,[{key:"onReady",value:function(callback){setTimeout(function(){return callback({supported_resolutions:WavesApp.dex.resolutions,supports_time:!0,supports_marks:!1,supports_timescale_marks:!1})},0)}},{key:"resolveSymbol",value:function(symbolName,resolve,reject){var _this118=this;symbolName.match(/^DEX:/)||symbolInfoService.get(symbolName).then(resolve).catch(function(){_this118.onLoadError(),reject()})}},{key:"getBars",value:function(symbolInfo,resolution,from,to,onHistoryCallback,onErrorCallback){var _this119=this;from=CandlesService.convertToMilliseconds(from),to=CandlesService.convertToMilliseconds(to);CandlesService._getAndHandleCandles(symbolInfo,from,to,resolution,function(candles){candles.length?(_this119._updateLastTime(candles),onHistoryCallback(candles)):onHistoryCallback([],{noData:!0})},onErrorCallback)}},{key:"subscribeBars",value:function(symbolInfo,resolution,onRealtimeCallback,subscriberUID,onResetCacheNeededCallback){var _this120=this;this._subscriber=subscriberUID;var to=Date.now(),from=this._lastTime,handleCandles=function(candles){_this120._subscriber===subscriberUID&&(_this120.subscribeBars(symbolInfo,resolution,onRealtimeCallback,subscriberUID,onResetCacheNeededCallback),candles.length&&(_this120._updateLastTime(candles),candles.forEach(onRealtimeCallback)))};timeLine.timeout(function(){CandlesService._getAndHandleCandles(symbolInfo,from,to,resolution,handleCandles)},2e3)}},{key:"unsubscribeBars",value:function(){this._subscriber=null}},{key:"_updateLastTime",value:function(candles){var lastTime=candles[candles.length-1].time;if(this._lastTime&&this._lastTime>=lastTime)return!1;this._lastTime=lastTime}}],[{key:"_getAndHandleCandles",value:function(symbolInfo,from,to,resolution,handleCandles,argument_5){var handleError=5<arguments.length&&void 0!==argument_5?argument_5:angular.noop;CandlesService._getCandles(symbolInfo,from,to,resolution).then(handleCandles).catch(handleError)}},{key:"_getCandles",value:function(symbolInfo,from,to,interval){from=from||to;var amountId=symbolInfo._wavesData.amountAsset.id,priceId=symbolInfo._wavesData.priceAsset.id,dayX=new Date(configService.get("CONCAT_MATCHER_DATE")).getTime(),_utils$concatCandles=utils.concatCandles({to:to,from:from,amountId:amountId,priceId:priceId,dayX:dayX,interval:interval,oldMatcher:matcher.oldMatcherAddress,currentMatcher:matcher.currentMatcherAddress}),promisesWithCandles=_utils$concatCandles.promisesWithCandles,candleConfig=_utils$concatCandles.candleConfig,convertBigNumber=function(num){return num.isNaN()?null:Number(num.toFixed())};return Promise.all(promisesWithCandles).then(pipe(map(prop("data")),flatten)).then(function(list){return list.map(function(candle){return{txsCount:candle.txsCount||0,high:convertBigNumber(candle.high),low:convertBigNumber(candle.low),close:convertBigNumber(candle.close),open:convertBigNumber(candle.open),volume:convertBigNumber(candle.volume),time:new Date(candle.time).getTime()}})}).then(function(candles){var lastTrade=ds.dataManager.orderbookSubject.getValue().lastTrade;if(1===candles.length){var lastCandle=candles[candles.length-1],lastTradeClose=lastTrade.price.toNumber();if(lastTradeClose===lastCandle.close)return[];lastCandle.close=lastTradeClose}else candles=candleConfig.converter(candles);return candles.filter(function(candle){return null!=candle.open})}).catch(function(){return utils.wait(5e3).then(function(){return[]})})}},{key:"convertToMilliseconds",value:function(seconds){return Number(seconds)?1e3*seconds:Date.now()}}]),CandlesService}())};factory.$inject=["utils","timeLine","symbolInfoService","waves","matcher","configService"],angular.module("app.dex").factory("candlesService",factory)}(),function(){var tsUtils=require("ts-utils"),factory=function(Base){return new(function(){function DexDataService(){var _this121;return _classCallCheck(this,DexDataService),(_this121=_possibleConstructorReturn(this,_getPrototypeOf(DexDataService).call(this))).chooseOrderBook=new tsUtils.Signal,_this121.showSpread=new tsUtils.Signal,_this121.createOrder=new tsUtils.Signal,_this121}return _inherits(DexDataService,Base),DexDataService}())};factory.$inject=["Base"],angular.module("app.dex").factory("dexDataService",factory)}(),function(){var controller=function(user){return new function NsbtFaqCtrl(){_classCallCheck(this,NsbtFaqCtrl),this.isLogined=!!user.address}};controller.$inject=["user"],angular.module("app.nsbtFaq").controller("NsbtFaqCtrl",controller)}(),function(){var controller=function(user){return new function Page404Ctrl(){_classCallCheck(this,Page404Ctrl),this.isLogined=!!user.address}};controller.$inject=["user"],angular.module("app.page404").controller("Page404Ctrl",controller)}(),angular.module("app.swapWavesUsdn",[]).controller("SwapWavesUsdnCtrl",function(){}),function(){var controller=function(Base,$q,$scope,user,waves){return new(function(){function Avatar(){var _getPrototypeOf3,_this122;_classCallCheck(this,Avatar);for(var _len15=arguments.length,args=new Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];return(_this122=_possibleConstructorReturn(this,(_getPrototypeOf3=_getPrototypeOf(Avatar)).call.apply(_getPrototypeOf3,[this].concat(args)))).hasScript=!1,_this122.size=null,_this122.address=null,_this122.src=null,_this122}return _inherits(Avatar,Base),_createClass(Avatar,[{key:"$postLink",value:function(){var _this123=this;this.style={width:"".concat(this.size,"px"),height:"".concat(this.size,"px")},this.receive(user.changeScript,function(){_this123.$onChanges()})}},{key:"$onChanges",value:function(){var _this124=this;this.size||(this.size=67),this.address?(waves.node.scriptInfo(this.address).then(function(data){_this124.hasScript=!!data.script,$scope.$apply()}).catch(function(){return null}),$q(function(resolve){resolve(identityImg.create(_this124.address,{size:3*_this124.size}))}).then(function(data){_this124.src=data})):this.hasScript=!1}}]),Avatar}())};controller.$inject=["Base","$q","$scope","user","waves"],angular.module("app.ui").component("wAvatar",{bindings:{size:"@",address:"<"},controller:controller,templateUrl:"modules/ui/directives/avatar/avatar.html"})}(),function(){var module=angular.module("app.ui"),controller=function(Base,$element,$attrs,utils,createPromise,$scope){var SYNC_ATTRS=["type","class"];return new(function(){function Button(){var _this125;if(_classCallCheck(this,Button),(_this125=_possibleConstructorReturn(this,_getPrototypeOf(Button).call(this)))._disabled=!1,_this125.pending=!1,_this125._pending=!1,_this125._canClick=!0,_this125._$button=null,$element.attr("ng-click"))throw new Error("Wrong use w-button component! Use on-click!");return _this125.observe(["_disabled","_pending"],_this125._currentCanClick),_this125.observe("_pending",_this125._togglePendingClass),_this125.observe("pending",_this125._togglePending),_this125.observe("_canClick",utils.debounceRequestAnimationFrame(_this125._onChangeDisabled)),_this125}return _inherits(Button,Base),_createClass(Button,[{key:"$postLink",value:function(){var _this126=this;this._$button=$element.find("button:first"),SYNC_ATTRS.forEach(function(name){name in $attrs&&_this126._$button.attr(name,$attrs[name])}),$element.get(0).addEventListener("click",function(e){if(_this126._canClick){var result=_this126.onClick({$event:e});_this126._applyClick(result),$scope.$apply()}else e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()},!1),this._togglePending()}},{key:"_currentCanClick",value:function(){this._canClick=!(this._disabled||this._pending||this.pending)}},{key:"_applyClick",value:function(result){var _this127=this;this._pending=!0;var onEnd=function(){if(!_this127._pending)throw new Error("Already drop pending state!");_this127._pending=!1};result&&"function"==typeof result.then?createPromise(this,result).then(onEnd,onEnd):createPromise(this,utils.wait(700)).then(onEnd)}},{key:"_togglePending",value:function(){this._$button&&(this._togglePendingClass(),this._onChangeDisabled())}},{key:"_togglePendingClass",value:function(){$element.toggleClass("pending",this._pending||!!this.pending)}},{key:"_onChangeDisabled",value:function(){this._$button.prop("disabled",!this._canClick||!!this.pending)}}]),Button}())};controller.$inject=["Base","$element","$attrs","utils","createPromise","$scope"],module.component("wButton",{templateUrl:"modules/ui/directives/button/button.html",transclude:!0,bindings:{_disabled:"<disabled",onClick:"&",pending:"<"},controller:controller})}(),function(){var controller=function(Base,$scope,$element,utils,storage,configService,notification){var ds=require("data-service"),analytics=ds.analytics;return new(function(){function FooterCtrl(){var _this128;_classCallCheck(this,FooterCtrl),(_this128=_possibleConstructorReturn(this,_getPrototypeOf(FooterCtrl).call(this))).mobileAppLink=void 0,_this128.telegramLink=void 0,_this128.lang=void 0,_this128.telegramClickEventLang="",_this128.isToasterMobilesVisible=void 0,_this128.supportLink="",_this128.email="",_this128.docsLink="",_this128._toasterMobilesStorageKey="toasterMobilesHidden",_this128.appVersion=WavesApp.version,_this128.hovered=!1;var config=configService.get();return _this128.termsAndConditions=config.termsAndConditions,_this128.privacyPolicy=config.privacyPolicy,_this128.mobileAppLink=navigator.userAgent.match(/iPhone|iPad|iPod/i)?"https://itunes.apple.com/us/app/waves-wallet/id1233158971?mt=8":"https://play.google.com/store/apps/details?id=com.wavesplatform.wallet",_this128._onChangeLanguge=_this128._onChangeLang.bind(_assertThisInitialized(_this128)),i18next.on("languageChanged",_this128._onChangeLanguge),_this128._onChangeLang(),_this128}return _inherits(FooterCtrl,Base),_createClass(FooterCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(FooterCtrl.prototype),"$onDestroy",this).call(this),i18next.off("languageChanged",this._onChangeLanguge)}},{key:"sendEmail",value:function(){if(ds.analytics.footer.subscribe(),this.emailError=!ds.api.email.emailValidators.isEmail(this.email),this.emailError)return null;ds.api.email.sendEmail({email:this.email,type:"subscribe"}).then(function(){notification.info({ns:"app.ui",title:{literal:"successSubscribe"}})}).catch(function(){notification.error({ns:"app.ui",title:{literal:"somethingWrongNotification"}})}),ds.analytics.addGtmEvent("Profile",{action:"Email_subscribe_success"}),this.email=""}},{key:"hideToaster",value:function(){analytics.send({name:"Download Mobile Close",target:"all"}),$element.find(".toaster-mobiles").addClass("hidden-toaster"),storage.save(this._toasterMobilesStorageKey,!0)}},{key:"sendShareAnalytics",value:function(label){ds.analytics.footer.share(label)}},{key:"sendExternalLinkAnalytics",value:function(label){ds.analytics.footer.externalLinkClick(label)}},{key:"onOtcClick",value:function(){ds.analytics.otc.useOtcClick("DOWN")}},{key:"_onChangeLang",value:function(){this.lang="ru"===i18next.language?"ru":"en",this.telegramClickEventLang="ru"===this.lang?"Ru":"Global",this.supportLink="https://support.waves.exchange/?lang=".concat(this.lang,"/?utm_medium=referral&utm_source=waves.exchange"),this.docsLink="https://docs.waves.exchange/".concat(this.lang,"/?utm_medium=referral&utm_source=waves.exchange"),this.docsApiLink="https://docs.waves.exchange/".concat(this.lang,"/waves-exchange/waves-exchange-client-api/?utm_medium=referral&utm_source=waves.exchange"),utils.safeApply($scope)}}]),FooterCtrl}())};controller.$inject=["Base","$scope","$element","utils","storage","configService","notification"],angular.module("app.ui").component("wFooter",{templateUrl:"modules/ui/directives/footer/footer.html",controller:controller})}(),angular.module("app.ui").component("wLoader",{templateUrl:"modules/ui/directives/loader/loader.html"}),function(){var controller=function(Base,permissionManager){return new(function(){function Permit(){return _classCallCheck(this,Permit),_possibleConstructorReturn(this,_getPrototypeOf(Permit).apply(this,arguments))}return _inherits(Permit,Base),_createClass(Permit,[{key:"$postLink",value:function(){this.receive(permissionManager.change,this._onChange,this),this._onChange()}},{key:"_onChange",value:function(){var isPermitted=permissionManager.isPermitted(this.name);this.isVisible=!isPermitted&&"off"===this.mode||isPermitted&&"on"===this.mode}}]),Permit}())};controller.$inject=["Base","permissionManager"],angular.module("app.ui").component("wPermit",{bindings:{name:"@",mode:"@"},template:'<div ng-transclude class="w-permit" ng-if="$ctrl.isVisible"></div>',transclude:!0,controller:controller})}(),function(){var controller=function($element){return new(function(){function QrCode(){_classCallCheck(this,QrCode),this.url=null,this.size=null,this.qrNode=document.createElement("DIV"),$element.append(this.qrNode)}return _createClass(QrCode,[{key:"$onChanges",value:function(){var _this129=this;if(!this.url)return null;QRCode.toDataURL(this.url,function(error,encrypted){_this129.qrNode.classList.add("qr-code-wrap"),_this129.qrNode.style.width="".concat(_this129.size,"px"),_this129.qrNode.style.height="".concat(_this129.size,"px"),_this129.qrNode.innerHTML='<img style="display: block" src="'.concat(encrypted,'">')})}}]),QrCode}())};controller.$inject=["$element"],angular.module("app.ui").component("wQrCode",{bindings:{size:"@",url:"<"},controller:controller})}(),function(){var directive=function(Base,utils){return{scope:{value:"<",searchValue:"="},require:{select:"^wSelect"},transclude:!0,template:'<div class="option" ng-transclude></div>',link:function($scope,$element,$attrs,_ref62,$transclude){var select=_ref62.select,tsUtils=require("ts-utils");return new(function(){function Option(){var _this130;return _classCallCheck(this,Option),(_this130=_possibleConstructorReturn(this,_getPrototypeOf(Option).call(this,$scope))).wSelect=select,_this130.changeValue=new tsUtils.Signal,_this130.index=1,_this130._setHandlers(),_this130.wSelect.registerOption(_assertThisInitialized(_this130)),_this130}return _inherits(Option,Base),_createClass(Option,[{key:"value",get:function(){return $scope.value}}]),_createClass(Option,[{key:"getContent",value:function(){var $element=$(Option._getContentHTML());return $transclude($scope.$parent,function($clone){$element.append($clone)}),$element}},{key:"onClick",value:function(){this.wSelect.setActive(this),$scope.$apply()}},{key:"setActive",value:function(active){var index=this.wSelect.getOptionIndex(this);$element.css("order",active?-index:0).toggleClass("active",active)}},{key:"filterAndSort",value:function(query){var searchValue=utils.toArray($scope.searchValue.filter(Boolean)),queryValue=query.toLocaleLowerCase();this.index=searchValue.findIndex(function(str){return str.toLocaleLowerCase().includes(queryValue)}),$element.css("order",this.index),-1<this.index?$element.show():$element.hide()}},{key:"show",value:function(){$element.show()}},{key:"_setHandlers",value:function(){var _this131=this;this.observe("value",function(){var value=_this131.value;if(tsUtils.isEmpty(value))throw new Error("Value is empty!");_this131.changeValue.dispatch(_this131)}),$element.on("click",this.onClick.bind(this))}}],[{key:"_getContentHTML",value:function(){return'<div class="select__title-content"></div>'}}]),Option}())}}};directive.$inject=["Base","utils"],angular.module("app.ui").directive("wOption",directive)}(),function(){var controller=function(Base,ComponentList,$element,utils,$scope){var tsUtils=require("ts-utils"),$_DOCUMENT=$(document);return new(function(){function Select(){var _this132;return _classCallCheck(this,Select),(_this132=_possibleConstructorReturn(this,_getPrototypeOf(Select).call(this)))._options=new ComponentList,_this132._activeNode=null,_this132._selectList=null,_this132._select=null,_this132.isOpend=!1,_this132.disabled=!1,_this132.oneItem=!1,_this132.hideActive=!0,_this132.filter="",_this132.canSearch=!1,_this132._render=utils.debounce(function(){_this132._initializeSelected(),$scope.$apply()},100),_this132.observe("disabled",function(){$element.toggleClass("disabled",!!_this132.disabled)}),_this132.observe("oneItem",function(){$element.toggleClass("disabled one-item",!!_this132.oneItem)}),_this132.observeOnce("hideActive",function(){_this132.hideActive||void 0===_this132.hideActive?$element.addClass("hide-active"):$element.removeClass("hide-active")}),_this132.observe("filter",function(){var filter=_this132.filter;_this132._options.forEach(function(option){filter?option.filterAndSort(filter):option.show()})}),_this132}return _inherits(Select,Base),_createClass(Select,[{key:"$postLink",value:function(){this._select=$element.find(".select__wrap:first"),this._activeNode=this._select.find(".select__title:first"),this._selectList=this._select.find(".select__list:first"),this._render(),this._setHandlers()}},{key:"registerOption",value:function(option){this._options.add(option),this._render()}},{key:"getOptionIndex",value:function(option){return this._options.components.indexOf(option)}},{key:"setActive",value:function(option){this._activateTransactionMode=!0,this._options.forEach(function(item){item!==option&&item.setActive(!1)}),this._activeNode.empty(),this.ngModel=option.value,this._activeNode.append(option.getContent()),option.setActive(!0),this._toggleList(!1),this._activateTransactionMode=!1}},{key:"_setHandlers",value:function(){var _this133=this;this.listenEventEmitter(this._activeNode,"click",function(){return _this133._onClick()}),this.observe("disabled",this._onChangeDisabled),this.receive(this._options.signals.remove,this._render,this),this.receive(this._options.signals.add,this._render,this),this.observe("ngModel",this._render)}},{key:"_initializeSelected",value:function(){if(!this._options.length)return null;if(tsUtils.isEmpty(this.ngModel))return this.setActive(this._options.first()),null;var active=_slicedToArray(this._options.where({value:this.ngModel}).components,1)[0];active?this.setActive(active):(this.setActive(this._options.first()),$scope.$apply())}},{key:"_onClick",value:function(){this.disabled||this._toggleList()}},{key:"_checkOutClick",value:function(event){0===$(event.target).closest($element).length&&this._toggleList(!1)}},{key:"_onChangeDisabled",value:function(){this._select.toggleClass("disabled",this.disabled),this._toggleList(!1)}},{key:"_toggleList",value:function(state){var _this134=this,targetState=tsUtils.isEmpty(state)?!this.isOpend:state;targetState!==this.isOpend&&(this.isOpend=targetState,this._select.toggleClass("expanded",this.isOpend),this._animate(),this.isOpend?this.listenEventEmitter($_DOCUMENT,"click",function(e){return _this134._checkOutClick(e)}):(this.filter="",this.stopListenEventEmitter("click",$_DOCUMENT),$scope.$apply()))}},{key:"_animate",value:function(){var _this135=this,fromCss={height:0,top:this.upDirection?0:void 0};if(this.isOpend){this._selectList.css({display:"flex",height:"auto"});var height=this._selectList.outerHeight(),toCss={height:height,top:this.upDirection?-height:void 0};return this._selectList.css(fromCss),utils.animate(this._selectList,toCss,{duration:100})}return utils.animate(this._selectList,fromCss,{duration:100}).then(function(){_this135._selectList.css("display","none")})}}]),Select}())};controller.$inject=["Base","ComponentList","$element","utils","$scope"],angular.module("app.ui").component("wSelect",{bindings:{ngModel:"=",disabled:"<",upDirection:"<",canSearch:"<",oneItem:"<",hideActive:"<"},templateUrl:"modules/ui/directives/select/select.html",transclude:!0,controller:controller})}(),function(){var controller=function($element,$scope,Base){return new(function(){function Slider(){var _this136;return _classCallCheck(this,Slider),(_this136=_possibleConstructorReturn(this,_getPrototypeOf(Slider).call(this))).interval=null,_this136.active=0,_this136.slides=null,_this136._length=null,_this136._timer=null,_this136._contentEl=null,_this136.autoScroll=!0,_this136.controlType="dots",_this136._offset=0,_this136}return _inherits(Slider,Base),_createClass(Slider,[{key:"$postLink",value:function(){var _this137=this;this.interval=Number(this.interval)||0,this._initSlides(),this.autoScroll&&($element.hover(function(){_this137.stopInterval()},function(){_this137.initializeInterval()}),this.initializeInterval()),this.listenEventEmitter($(window),"resize",function(){_this137._initSlides()});this.mutationObserver=new MutationObserver(function(mutationsList){mutationsList.forEach(function(mutation){"childList"===mutation.type&&_this137._initSlides()})}),this.mutationObserver.observe($element[0],{attributes:!0,childList:!0,subtree:!0})}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(Slider.prototype),"$onDestroy",this).call(this),this._contentEl.off(),this.mutationObserver.disconnect()}},{key:"_initSlides",value:function(){this._contentEl=$element.find(".ui-slider__content"),this.slides=this._contentEl.children(),this._length=this.slides.length,this._contentEl.css("transform","translateX(0)")}},{key:"slideTo",value:function(index,event){if(0<=index&&index<this._length&&index!==this.active&&this._shouldMove(index)){var prev=this.active;this.active=index,this.stopInterval(),this._offset=this._calcOffset(prev,index,this._offset),this._contentEl.css("transform","translateX(-".concat(this._offset,"px)")),this._contentEl.on("transitionend webkitTransitionEnd oTransitionEnd",function(){$scope.$digest()}),this.autoScroll&&this.initializeInterval(),event||$scope.$digest()}}},{key:"next",value:function(event){this.slideTo(this.active+1,event)}},{key:"prev",value:function(event){this.slideTo(this.active-1,event)}},{key:"initializeInterval",value:function(){var _this138=this;this.interval&&(this.stopInterval(),this._timer=setTimeout(function(){return _this138._step()},this.interval))}},{key:"stopInterval",value:function(){this.interval&&this._timer&&(clearTimeout(this._timer),this._timer=null)}},{key:"_step",value:function(){this.active===this._length-1?this.slideTo(0):this.next()}},{key:"_calcOffset",value:function(prev,cur,offset){var getWidth=function(el){return $(el).outerWidth(!0)};switch(!0){case this.active>prev:return offset+getWidth(this.slides.eq(prev));case 0===cur:return 0;default:return offset-getWidth(this.slides.eq(this.active))}}},{key:"_shouldMove",value:function(index){var shouldMove=!0,parent=$element.parents(".js-slider-wrapper")[0];if(parent){var parentRightPos=parent.getBoundingClientRect().right;shouldMove=this.slides.toArray().some(function(slide){return parentRightPos<slide.getBoundingClientRect().right})}return index<this.active||shouldMove}},{key:"isDisabledControls",value:function(){var parent=$element.parents(".js-slider-wrapper")[0];if(parent){var parentRightPos=parent.getBoundingClientRect().right;return this.slides.toArray().every(function(slide){return parentRightPos>slide.getBoundingClientRect().right})}return!1}},{key:"offset",get:function(){return this._offset}}]),Slider}())};controller.$inject=["$element","$scope","Base"],angular.module("app.ui").component("wSlider",{transclude:!0,bindings:{interval:"<",autoScroll:"<",controlType:"<"},controller:controller,templateUrl:"modules/ui/directives/slider/slider.html"})}(),function(){var factory=function($q){return new(function(){function CarouselManager(){_classCallCheck(this,CarouselManager),this.slidersHash=Object.create(null),this.promiseHash=Object.create(null),this.defersHash=Object.create(null)}return _createClass(CarouselManager,[{key:"registerSlider",value:function(id,slider){this.slidersHash[id]=slider,this.defersHash[id]&&(this.defersHash[id].resolve(slider),delete this.promiseHash[id]),this.promiseHash[id]&&delete this.promiseHash[id]}},{key:"removeSlider",value:function(id){this.slidersHash[id]&&delete this.slidersHash[id],this.promiseHash[id]&&delete this.promiseHash[id],this.defersHash[id]&&delete this.defersHash[id]}},{key:"getSlider",value:function(id){if(this.slidersHash[id])return $q.when(this.slidersHash[id]);if(this.promiseHash[id])return this.promiseHash[id];var defer=$q.defer();return this.promiseHash[id]=defer.promise,this.defersHash[id]=defer,this.promiseHash[id]}}]),CarouselManager}())};factory.$inject=["$q"],angular.module("app.ui").factory("carouselManager",factory)}(),function(){var factory=function(user,utils){return new(function(){function UserNameService(){var _this139=this;_classCallCheck(this,UserNameService),this.name=void 0,this.MAX_USER_NAME_LENGTH=24,user.loginSignal.on(function(){_this139.name=user.name}),user.logoutSignal.on(function(){_this139.name=""}),utils.observe(user,"name").on(function(){_this139.name=user.name})}return _createClass(UserNameService,[{key:"save",value:function(){var _this140=this;return this.isUniqueName().then(function(isUniqueName){isUniqueName&&_this140._isNameLengthValid()?user.name=_this140.name:_this140.name=user.name})}},{key:"setName",value:function(name){this.name=name}},{key:"isUniqueName",value:function(){var _this141=this;return this._getUserList().then(function(list){var isUnique=list.filter(function(item){return item.address!==user.address}).every(function(item){return item.name!==_this141.name});return!_this141.name||isUnique})}},{key:"_isNameLengthValid",value:function(){return!this.name||this.name.length<=this.MAX_USER_NAME_LENGTH}},{key:"_getUserList",value:function(){return Promise.all([user.getFilteredUserList(),user.getMultiAccountUsers()]).then(function(_ref63){var _ref64=_slicedToArray(_ref63,2),_ref64$=_ref64[0],legacyUsers=void 0===_ref64$?[]:_ref64$,_ref64$2=_ref64[1],users=void 0===_ref64$2?[]:_ref64$2;return[].concat(_toConsumableArray(legacyUsers),_toConsumableArray(users))})}}]),UserNameService}())};factory.$inject=["user","utils"],angular.module("app.ui").factory("userNameService",factory)}(),function(){var factory=function(){var StyleManager=function(){function StyleManager(root){_classCallCheck(this,StyleManager),this.root=root,this.stylesHash=Object.create(null)}return _createClass(StyleManager,[{key:"addStyle",value:function(path,style){this.removeStyle(path);var content=".".concat(this.root," ").concat(path," { ").concat(this._parseStyle(style)," }"),styleTag=document.createElement("style");styleTag.innerText=content,styleTag.id=path,document.head.appendChild(styleTag),this.stylesHash[path]=styleTag}},{key:"removeStyle",value:function(path){this.hasStyle(path)&&document.head.removeChild(this.stylesHash[path])}},{key:"realStyleTransaction",value:function(path,cb){var element=this.stylesHash[path];element?(document.head.removeChild(element),cb(),document.head.appendChild(element)):cb()}},{key:"destroy",value:function(){Object.keys(this.stylesHash).forEach(this.removeStyle,this)}},{key:"hasStyle",value:function(path){return!!this.stylesHash[path]}},{key:"_parseStyle",value:function(style){var template="";return tsUtils.each(style,function(value,key){template+="".concat(key,": ").concat(value,";").replace(";;",";")}),template}}]),StyleManager}();return window.StyleManager=StyleManager};factory.$inject=[],angular.module("app.utils").factory("StyleManager",factory)}(),function(){var controller=function($element,$attrs,i18n,$scope,Base,utils){return new(function(){function I18nAttr(){var _this142;return _classCallCheck(this,I18nAttr),(_this142=_possibleConstructorReturn(this,_getPrototypeOf(I18nAttr).call(this,$scope)))._forStop=[],_this142._watchers=Object.create(null),_this142._toTranslate=$attrs.wI18nAttr.split(","),_this142._literalTemplatesHash=_this142._toTranslate.reduce(function(acc,attrName){return acc[attrName]=$element.attr(attrName).trim(),acc},Object.create(null)),_this142._partsHash=_this142._toTranslate.reduce(function(acc,attrName){return acc[attrName]=I18nAttr._getParts($attrs[attrName]),acc},Object.create(null)),_this142._handler=utils.debounce(_this142._getHandler()),_this142.listenEventEmitter(i18next,"languageChanged",_this142._handler),_this142._addWatchers(),_this142._handler(),_this142}return _inherits(I18nAttr,Base),_createClass(I18nAttr,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(I18nAttr.prototype),"$onDestroy",this).call(this),this._forStop.forEach(function(cb){return cb()}),this._forStop=[]}},{key:"_getHandler",value:function(){var _this143=this,ns=this._getNs();return function(){_this143._toTranslate.forEach(function(attrName){var params=$attrs.params&&$scope.$eval($attrs.attrParams)||void 0,value=i18n.translate(_this143._compile(attrName),ns,params,!1);$element.attr(attrName,value)})}}},{key:"_compile",value:function(attrName){var template=this._literalTemplatesHash[attrName],parts=this._partsHash[attrName],literal=template;return parts&&parts.forEach(function(_ref65){var part=_ref65.part,evalTpl=_ref65.evalTpl;literal=literal.replace(part,$scope.$eval(evalTpl))}),literal}},{key:"_getNs",value:function(){return $attrs.wI18nNs?$attrs.wI18nNs:i18n.getNs($element)}},{key:"_addWatchers",value:function(){var _this144=this;Object.values(this._partsHash).forEach(function(parts){(parts||[]).forEach(function(_ref66){var part=_ref66.part,needWatch=_ref66.needWatch,evalTpl=_ref66.evalTpl;needWatch&&!_this144._watchers[part]&&(_this144._forStop.push($scope.$watch(evalTpl,_this144._handler)),_this144._watchers[part]=!0)})})}}],[{key:"_getParts",value:function(template){var parts=template.match(/{{.*?(}})/g);return parts?parts.map(function(part){return{part:part,evalTpl:part.replace("{{","").replace("}}","").replace("::",""),needWatch:-1===part.indexOf("::")}}):null}}]),I18nAttr}())};controller.$inject=["$element","$attrs","i18n","$scope","Base","utils"],angular.module("app").directive("wI18nAttr",function(){return{scope:!1,restrict:"A",controller:controller}})}(),function(){var factory=function(utils,$injector){var _require31=require("ts-utils"),get=_require31.get,_set=_require31.set,isEmpty=_require31.isEmpty,unset=_require31.unset,Signal=_require31.Signal,ds=require("data-service"),configs=ds.utils.ConfigService,DefaultSettings=function(){function DefaultSettings(settings,commonSettings){_classCallCheck(this,DefaultSettings),this.commonSettings=commonSettings||Object.create(null),this.settings=settings||Object.create(null),this.change=new Signal}return _createClass(DefaultSettings,[{key:"commonDefaults",get:function(){return{theme:"default",advancedMode:!1,lastOpenVersion:"",whatsNewList:[],network:_objectSpread({},WavesApp.network,{node:ds.config.get("node"),matcher:ds.config.get("matcher"),api:ds.config.get("api"),apiVersion:ds.config.get("apiVersion"),code:ds.config.get("code"),oracleWaves:ds.config.get("oracleWaves"),oracleTokenomica:ds.config.get("oracleTokenomica"),WESTNetworkByte:ds.config.get("WESTNetworkByte")}),dontShowSpam:!0,logoutAfterMin:5,termsAccepted:!0,needReadNewTerms:!1,closedNotification:[],closedUserNotification:[],withScam:!1,scamListUrl:configs.getConfig("NETWORK.scamListUrl"),tokensNameListUrl:configs.getConfig("NETWORK.tokensNameListUrl"),tradeWithScriptAssets:!1,events:Object.create(null)}}},{key:"defaults",get:function(){var baseAssetService=$injector.get("baseAssetService");return{encryptionRounds:5e3,hasBackup:!0,lastInterval:WavesApp.dex.defaultResolution,send:{defaultTab:"singleSend"},orderLimit:.05,unpinnedDefaultAssetIdList:[],pinnedAssetIdList:[],lastState:{name:"main.wallet.assets"},wallet:{activeState:"assets",assets:{chartMode:"month",activeChartAssetId:baseAssetService.WavesAssetId,chartAssetIdList:baseAssetService.getChartAssetIdList()},transactions:{filter:"all"},leasing:{filter:"all"},portfolio:{spam:[],filter:"active"}},dex:{assetIdPair:{amount:baseAssetService.WavesAssetId,price:baseAssetService.getIdByTicker("BTC")},createOrder:{expirationName:"30day"},watchlist:{showOnlyFavorite:!1,favourite:[[baseAssetService.WavesAssetId,baseAssetService.getIdByTicker("BTC")]],activeTab:"all"},layout:{watchlist:{collapsed:!1},orderbook:{collapsed:!1},tradevolume:{collapsed:!0}}}}}}]),_createClass(DefaultSettings,[{key:"getPinnedAssetIdList",value:function(){return this.getUserSettings("pinnedAssetIdList").filter(Boolean)}},{key:"getUnpinnedDefaultAssetIdList",value:function(){return this.getUserSettings("unpinnedDefaultAssetIdList").filter(Boolean).filter(function(id){return"WAVES"!==id})}},{key:"getDexAssetPair",value:function(){var value=get(this.settings,"dex.assetIdPair");return!isEmpty(value)&&value.amount&&value.price?value:get(this.defaults,"dex.assetIdPair")}},{key:"getDexFavourite",value:function(){var path="dex.watchlist.favourite",value=get(this.settings,path),trueValue=Array.isArray(value)?value.filter(function(item){return Array.isArray(item)&&2===item.filter(Boolean).length}):[];return 0===trueValue.length?get(this.defaults,path):trueValue}},{key:"getCommon",value:function(path){var valueCommon=get(this.commonSettings,path);return isEmpty(valueCommon)?get(this.commonDefaults,path):valueCommon}},{key:"getUserSettings",value:function(path){var value=get(this.settings,path);return isEmpty(value)?get(this.defaults,path):value}},{key:"get",value:function(path){switch(!0){case this._isDexAssetPair(path):return this.getDexAssetPair();case this._isDexFavourite(path):return this.getDexFavourite();case this._isPinnedAssetList(path):return this.getPinnedAssetIdList();case this._isUnpinnedDefaultAssetIdList(path):return this.getUnpinnedDefaultAssetIdList();case this._isCommon(path):return this.getCommon(path);default:return this.getUserSettings(path)}}},{key:"set",value:function(path,value){if(utils.isEqual(this.get(path),value))return null;this._isCommon(path)?utils.isEqual(get(this.commonDefaults,path),value)?unset(this.commonSettings,path):_set(this.commonSettings,path,value):utils.isEqual(get(this.defaults,path),value)?unset(this.settings,path):_set(this.settings,path,value),this.change.dispatch(path)}},{key:"setCommonSettings",value:function(commonSettings){this.commonSettings=commonSettings}},{key:"getSettings",value:function(){return{common:this.commonSettings,settings:this.settings}}},{key:"_isDexFavourite",value:function(path){return"dex.watchlist.favourite"===path}},{key:"_isPinnedAssetList",value:function(path){return"pinnedAssetIdList"===path}},{key:"_isUnpinnedDefaultAssetIdList",value:function(path){return"unpinnedDefaultAssetIdList"===path}},{key:"_isDexAssetPair",value:function(path){return"dex.assetIdPair"===path}},{key:"_isCommon",value:function(path){var start=_slicedToArray(path.split("."),1)[0];return Object.prototype.hasOwnProperty.call(this.commonDefaults,start)}}]),DefaultSettings}();return{create:function(settings,commonSettings){return new DefaultSettings(settings,commonSettings)}}};factory.$inject=["utils","$injector"],angular.module("app").factory("defaultSettings",factory)}(),function(){var decryptSeed=require("@waves/waves-transactions").libs.crypto.decryptSeed,difference=require("ramda").difference,StorageImporter=function(){function StorageImporter($log,$state,storage,user,multiAccount,configService,utils,baseAssetService){_classCallCheck(this,StorageImporter),this.$log=$log,this.$state=$state,this.storage=storage,this.user=user,this.multiAccount=multiAccount,this.utils=utils,this.baseAssetService=baseAssetService,this.defaultPinnedAssets=baseAssetService.getDefaultPinnedAssets()}var _importUserList2,_importMultiAccountSettings2,_importMultiAccountUsers2,_importDataItem2,_importData2,_import2,_export2;return _createClass(StorageImporter,[{key:"export",value:(_export2=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(privateKeyFrom,publicKeyTo){var storageData,_i4,_keys,key,value;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:storageData={},_i4=0,_keys=["multiAccountData","multiAccountUsers","multiAccountSettings","multiAccountHash","userList","openClientMode"];case 3:if(_i4<_keys.length)return key=_keys[_i4],_context5.prev=5,_context5.next=8,this.storage.load(key);_context5.next=18;break;case 8:value=_context5.sent,storageData[key]=value,_context5.next=15;break;case 12:_context5.prev=12,_context5.t0=_context5.catch(5),this.$log.error('Could not read key "'.concat(key,'" from storage. Error:'),_context5.t0);case 15:_i4++,_context5.next=3;break;case 18:return _context5.abrupt("return",this.multiAccount.export(privateKeyFrom,publicKeyTo,storageData));case 19:case"end":return _context5.stop()}},_callee5,this,[[5,12]])})),function(_x2,_x3){return _export2.apply(this,arguments)})},{key:"import",value:(_import2=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(data){var signUpResult;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,this.user.getMultiAccountData();case 2:if(!_context6.sent&&data.password)return _context6.next=6,this.multiAccount.signUp(data.password,this.user.getSetting("encryptionRounds"));_context6.next=9;break;case 6:return signUpResult=_context6.sent,_context6.next=9,this.user.saveMultiAccount(signUpResult);case 9:return _context6.next=11,this._importData(data);case 11:case"end":return _context6.stop()}},_callee6,this)})),function(_x4){return _import2.apply(this,arguments)})},{key:"_importData",value:(_importData2=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(data){var _data$storageData,multiAccountData,multiAccountUsers,multiAccountSettings,userList,rest,_i5,_Object$entries3,_Object$entries3$_i,key,value;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _data$storageData=data.storageData,multiAccountData=_data$storageData.multiAccountData,multiAccountUsers=_data$storageData.multiAccountUsers,multiAccountSettings=_data$storageData.multiAccountSettings,userList=_data$storageData.userList,rest=_objectWithoutProperties(_data$storageData,["multiAccountData","multiAccountUsers","multiAccountSettings","userList"]),_context7.next=3,this._importMultiAccountUsers(multiAccountData,multiAccountUsers,data.password);case 3:return _context7.next=5,this._importMultiAccountSettings(multiAccountSettings);case 5:return _context7.next=7,this._importUserList(userList);case 7:_i5=0,_Object$entries3=Object.entries(rest);case 8:if(_i5<_Object$entries3.length)return _Object$entries3$_i=_slicedToArray(_Object$entries3[_i5],2),key=_Object$entries3$_i[0],value=_Object$entries3$_i[1],_context7.prev=10,_context7.next=13,this._importDataItem(key,value);_context7.next=21;break;case 13:_context7.next=18;break;case 15:_context7.prev=15,_context7.t0=_context7.catch(10),this.$log.error(_context7.t0);case 18:_i5++,_context7.next=8;break;case 21:case"end":return _context7.stop()}},_callee7,this,[[10,15]])})),function(_x5){return _importData2.apply(this,arguments)})},{key:"_importDataItem",value:(_importDataItem2=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(key,value){var valueFromStorage;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,this.storage.load(key);case 2:return valueFromStorage=_context8.sent,_context8.abrupt("return",valueFromStorage?Promise.resolve():this.storage.save(key,value));case 4:case"end":return _context8.stop()}},_callee8,this)})),function(_x6,_x7){return _importDataItem2.apply(this,arguments)})},{key:"_importMultiAccountUsers",value:(_importMultiAccountUsers2=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(multiAccountData,multiAccountUsers,password){var currentMultiAccountUsers,users,_i6,_Object$entries4,_Object$entries4$_i,hash,user,_ref67,_multiAccountData,multiAccountHash;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,this.storage.load("multiAccountUsers");case 2:currentMultiAccountUsers=(currentMultiAccountUsers=_context9.sent)||Object.create(null),_context9.prev=4,users=password?JSON.parse(decryptSeed(multiAccountData,password,this.user.getSetting("encryptionRounds"))):{},_i6=0,_Object$entries4=Object.entries(users);case 7:if(!(_i6<_Object$entries4.length)){_context9.next=22;break}if(_Object$entries4$_i=_slicedToArray(_Object$entries4[_i6],2),hash=_Object$entries4$_i[0],user=_Object$entries4$_i[1],currentMultiAccountUsers[hash]){_context9.next=19;break}return multiAccountUsers[hash].settings&&Array.isArray(multiAccountUsers[hash].settings.pinnedAssetIdList)&&this._remapPinned(multiAccountUsers[hash].settings),currentMultiAccountUsers[hash]=multiAccountUsers[hash],_context9.next=14,this.multiAccount.addUser(user);case 14:return _ref67=_context9.sent,_multiAccountData=_ref67.multiAccountData,multiAccountHash=_ref67.multiAccountHash,_context9.next=19,this.user.saveMultiAccount({multiAccountData:_multiAccountData,multiAccountHash:multiAccountHash});case 19:_i6++,_context9.next=7;break;case 22:return _context9.next=24,this.user.saveMultiAccountUsers(currentMultiAccountUsers);case 24:_context9.next=30;break;case 26:return _context9.prev=26,_context9.t0=_context9.catch(4),this.$log.error(_context9.t0),_context9.abrupt("return",Promise.resolve());case 30:case"end":return _context9.stop()}},_callee9,this,[[4,26]])})),function(_x8,_x9,_x10){return _importMultiAccountUsers2.apply(this,arguments)})},{key:"_importMultiAccountSettings",value:(_importMultiAccountSettings2=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(multiAccountSettings){var currentMultiAccountSettings,mergedSettings;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(multiAccountSettings){_context10.next=2;break}return _context10.abrupt("return");case 2:return delete multiAccountSettings.lastOpenVersion,delete multiAccountSettings.termsAccepted,delete multiAccountSettings.lng,delete multiAccountSettings.theme,delete multiAccountSettings.network,_context10.next=9,this.user.getMultiAccountSettings();case 9:return currentMultiAccountSettings=_context10.sent,mergedSettings=_objectSpread({},multiAccountSettings,{},currentMultiAccountSettings),_context10.next=13,this.user.saveMultiAccountSettings(mergedSettings);case 13:this.user.setMultiAccountSettings(mergedSettings);case 14:case"end":return _context10.stop()}},_callee10,this)})),function(_x11){return _importMultiAccountSettings2.apply(this,arguments)})},{key:"_importUserList",value:(_importUserList2=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(userList){var currentUserList,userMap,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step2,user;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return _context11.next=2,this.storage.load("userList");case 2:if(!(currentUserList=_context11.sent)||!currentUserList.length){_context11.next=27;break}for(userMap=currentUserList.reduce(function(acc,user){return acc["".concat(user.userType,":").concat(user.address)]=user,acc},Object.create(null)),_didIteratorError=!(_iteratorNormalCompletion=!0),_iteratorError=void 0,_context11.prev=8,_iterator=userList[Symbol.iterator]();!(_iteratorNormalCompletion=(_step2=_iterator.next()).done);_iteratorNormalCompletion=!0)user=_step2.value,userMap["".concat(user.userType,":").concat(user.address)]||(user.settings.pinnedAssetIdList&&this._remapPinned(user.settings),currentUserList.push(user));_context11.next=16;break;case 12:_context11.prev=12,_context11.t0=_context11.catch(8),_didIteratorError=!0,_iteratorError=_context11.t0;case 16:_context11.prev=16,_context11.prev=17,_iteratorNormalCompletion||null==_iterator.return||_iterator.return();case 19:if(_context11.prev=19,_didIteratorError)throw _iteratorError;_context11.next=22;break;case 22:return _context11.finish(19);case 23:return _context11.finish(16);case 24:return _context11.abrupt("return",this.storage.save("userList",currentUserList));case 27:return _context11.abrupt("return",this.storage.save("userList",userList));case 28:case"end":return _context11.stop()}},_callee11,this,[[8,12,16,24],[17,,19,23]])})),function(_x12){return _importUserList2.apply(this,arguments)})},{key:"_remapPinned",value:function(settings){var pinnedAssetIdList=_objectSpread({},settings).pinnedAssetIdList||[];Array.isArray(pinnedAssetIdList)?(pinnedAssetIdList=this.utils.filterPinnedAssets(pinnedAssetIdList).map(function(assetId){return"9wTCRypSjVwedqNTwLSq5TrePGg2JjP79htfaYyoNRNN"===assetId?"34N9YcEETLWn93qYQ64EsP1x89tSruJU44RrEMSXXEPJ":assetId}),settings.pinnedAssetIdList=difference(pinnedAssetIdList,this.defaultPinnedAssets),settings.unpinnedDefaultAssetIdList=difference(this.defaultPinnedAssets,pinnedAssetIdList)):(settings.pinnedAssetIdList=void 0,settings.unpinnedDefaultAssetIdList=void 0)}}]),StorageImporter}();StorageImporter.$inject=["$log","$state","storage","user","multiAccount","configService","utils","baseAssetService"],angular.module("app").service("storageImporter",StorageImporter)}(),function(){var factory=function(BaseNodeComponent,aliases,transactions,assets,user,utils,decorators){var _dec2,_class3,ds=require("data-service"),Node=(_dec2=decorators.cachable(2),_applyDecoratedDescriptor((_class3=function(){function Node(){var _this145;return _classCallCheck(this,Node),(_this145=_possibleConstructorReturn(this,_getPrototypeOf(Node).call(this))).aliases=aliases,_this145.assets=assets,_this145.transactions=transactions,_this145}return _inherits(Node,BaseNodeComponent),_createClass(Node,[{key:"scriptInfo",value:function(address){return ds.api.address.getScriptInfo(address)}},{key:"isValidAddress",value:function(address){try{return user.isValidAddress(address)}catch(e){return!1}}},{key:"isValidAddressWithNetworkByte",value:function(address,_byte){try{return ds.isValidAddress(address,Node.toByte(_byte))}catch(e){return!1}}},{key:"height",value:function(){return ds.fetch("".concat(this.node,"/blocks/height")).then(function(res){return res.height})}}],[{key:"toByte",value:function(data){return"number"==typeof data?data:data.charCodeAt(0)}}]),Node}()).prototype,"scriptInfo",[_dec2],Object.getOwnPropertyDescriptor(_class3.prototype,"scriptInfo"),_class3.prototype),_class3);return utils.bind(new Node)};factory.$inject=["BaseNodeComponent","aliases","transactions","assets","user","utils","decorators"],angular.module("app").factory("node",factory)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,configService,user,modalManager){return reactDirective(rc.BuyWAVES,void 0,void 0,{$state:$state,configService:configService,user:user,modalManager:modalManager})};controller.$inject=["reactDirective","$state","configService","user","modalManager"],angular.module("app.buyWaves").directive("wBuyWaves",controller)}(),function(){var controller=function(Base,$q,$element,utils,$rootScope,visibleService,decorators){var _dec3,_class4;return new(_dec3=decorators.async(300),_applyDecoratedDescriptor((_class4=function(){function Layout(){var _this146;return _classCallCheck(this,Layout),(_this146=_possibleConstructorReturn(this,_getPrototypeOf(Layout).call(this)))._ready=$q.defer(),_this146._dom=null,_this146._children={watchlist:null,candlechart:null,orderbook:null,tradehistory:null,createorder:null,tradevolume:null},_this146._node=null,_this146._watchlistCollapsed=null,_this146._orderbookCollapsed=null,_this146.isPhone=$rootScope.isPhone,_this146.isTablet=$rootScope.isTablet,_this146.isDesktop=$rootScope.isDesktop,_this146.isNotPhone=$rootScope.isNotPhone,_this146.isNotDesktop=$rootScope.isNotDesktop,_this146.syncSettings({_watchlistCollapsed:"dex.layout.watchlist.collapsed",_orderbookCollapsed:"dex.layout.orderbook.collapsed"}),_this146.observe(["_watchlistCollapsed","_orderbookCollapsed"],_this146._onChangeCollapsed),_this146}return _inherits(Layout,Base),_createClass(Layout,[{key:"$postLink",value:function(){this._node=$element.find(".dex-layout"),this._dom={watchlist:Layout._getColumn("watchlist"),candlechart:Layout._getColumn("candlechart"),orderbook:Layout._getColumn("orderbook"),tradehistory:Layout._getColumn("tradehistory"),createorder:Layout._getColumn("createorder"),tradevolume:Layout._getColumn("tradevolume")};var watchlistCollapsed=this._watchlistCollapsed,orderbookCollapsed=this._orderbookCollapsed,base="dex-layout";this._node.get(0).className="dex-layout",this._node.toggleClass("".concat(base,"_watchlist-collapsed"),watchlistCollapsed),this._node.toggleClass("".concat(base,"_orderbook-collapsed"),orderbookCollapsed),this._dom.watchlist.$slider.toggleClass("".concat(base,"__sidebar-toggle-open"),!watchlistCollapsed),this._dom.orderbook.$slider.toggleClass("".concat(base,"__sidebar-toggle-open"),!orderbookCollapsed),this._ready.resolve()}},{key:"registerItem",value:function($element,item){var _this147=this,block=item.block;if(!block)throw new Error("Wrong item address!");this._ready.promise.then(function(){if(_this147._children[block])throw new Error("Duplicate child block!");_this147._children[block]=item,_this147._dom[block].$container.append($element)})}},{key:"closeCreateOrder",value:function($event){angular.element($event.delegateTarget).parent().removeClass("expanded")}},{key:"collapseBlock",value:function(block,collapsed){this._node.toggleClass("dex-layout_".concat(block,"-collapsed"),collapsed)}},{key:"toggleColumn",value:function(column){switch(column){case"watchlist":this._watchlistCollapsed=!this._watchlistCollapsed;break;case"orderbook":this._orderbookCollapsed=!this._orderbookCollapsed;break;default:throw new Error("Wrong column name!")}}},{key:"updateVisible",value:function(){visibleService.updateSort()}},{key:"_onChangeCollapsed",value:function(){var _this148=this,watchlist=this._watchlistCollapsed,orderbook=this._orderbookCollapsed,base="dex-layout";utils.animateByClass(this._dom.candlechart.$wrapper,"ghost",!0,"opacity").then(function(){_this148._dom.candlechart.$wrapper.hide(),_this148._dom.watchlist.$slider.toggleClass("".concat(base,"__sidebar-toggle-open"),!watchlist),_this148._dom.orderbook.$slider.toggleClass("".concat(base,"__sidebar-toggle-open"),!orderbook);var endCollapseAnimations=utils.whenAll([utils.animateByClass(_this148._node,"".concat(base,"_watchlist-collapsed"),watchlist,"transform"),utils.animateByClass(_this148._node,"".concat(base,"_orderbook-collapsed"),orderbook,"transform")]),notWorking=new Promise(function(resolve,reject){setTimeout(reject,3e3)});return Promise.race([endCollapseAnimations,notWorking]).catch(function(){console.warn("Not working css animation end event!")})}).then(function(){return _this148._dom.candlechart.$wrapper.show(),utils.wait(0)}).then(function(){utils.animateByClass(_this148._dom.candlechart.$wrapper,"ghost",!1,"opacity")})}}],[{key:"_getColumn",value:function(type){var $container=$element.find('[data-block="'.concat(type,'"]')),$wrapper=$container.parent(),$slider=$wrapper.find("[data-slider]");return{$wrapper:$wrapper,$container:$container,$slider:$slider}}}]),Layout}()).prototype,"updateVisible",[_dec3],Object.getOwnPropertyDescriptor(_class4.prototype,"updateVisible"),_class4.prototype),_class4)};controller.$inject=["Base","$q","$element","utils","$rootScope","visibleService","decorators"],angular.module("app.dex").component("wLayout",{scope:!1,bindings:{},templateUrl:"modules/dex/directives/layout/layout.html",transclude:!0,controller:controller})}(),angular.module("app.ui").component("wActionItem",{require:{parent:"^wActions"},scope:!1,templateUrl:"modules/ui/directives/actions/action-item.html",transclude:!0}),function(){var _ANALYTICS_TX_NAMES,ds=require("data-service"),_require34=require("@waves/data-entities"),Asset=_require34.Asset,Money=_require34.Money,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("data-service").analytics,NO_EXPORT_TYPES=[SIGN_TYPE.MASS_TRANSFER,SIGN_TYPE.CREATE_ORDER,SIGN_TYPE.DATA,SIGN_TYPE.SCRIPT_INVOCATION],ANALYTICS_TX_NAMES=(_defineProperty(_ANALYTICS_TX_NAMES={},SIGN_TYPE.CREATE_ORDER,"Create order"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.ISSUE,"Token Generation"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.TRANSFER,"Transfer"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.REISSUE,"Reissue Token"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.BURN,"Burn Token"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.EXCHANGE,"Exchange"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.LEASE,"Leasing"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.CANCEL_LEASING,"Leasing cancel"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.CREATE_ALIAS,"Create Alias"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.MASS_TRANSFER,"Mass Transfer"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.DATA,"Data"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.SET_SCRIPT,"Set Script"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.SPONSORSHIP,"Sponsorship"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.SET_ASSET_SCRIPT,"Set Asset Script"),_ANALYTICS_TX_NAMES),factory=function(Base,waves,utils,$mdDialog,modalManager,balanceWatcher){return function(){function ConfirmTxService($scope){var _this149;return _classCallCheck(this,ConfirmTxService),(_this149=_possibleConstructorReturn(this,_getPrototypeOf(ConfirmTxService).call(this,$scope))).onTxSent=null,_this149.step=0,_this149.txId="",_this149.signable=null,_this149.advancedMode=!1,_this149.activeTab="details",_this149.canCreateLink=!1,_this149.exportLink=WavesApp.origin,_this149.errorType=null,_this149.errorMessage=null,_this149.errorParams=Object.create(null),_this149.isTransaction=!1,_this149.__$scope=null,_this149.__$scope=$scope,_this149.syncSettings({advancedMode:"advancedMode"}),_this149.observe("signable",_this149.onChangeSignable),_this149}return _inherits(ConfirmTxService,Base),_createClass(ConfirmTxService,[{key:"getWait",value:function(sec,data,promise){var wait=new Promise(function(res){setTimeout(function(){return res(data)},1e3*sec||1500)});return Promise.race([promise,wait])}},{key:"sendTransaction",value:function(){var _this150=this,method=ConfirmTxService._getSendMethod(this.signable.type);return this.pendingBroadcast=!0,this.signable.getDataForApi().then(function(data){return _this150.getWait(1.5,data,method(data))}).then(function(data){return _this150.pendingBroadcast=!1,analytics.send(_this150.getAnalytics(data,!0)),data},function(error){return _this150.pendingBroadcast=!1,analytics.send(_this150.getAnalytics(_this150.signable.getTxData(),!1)),Promise.reject(error)})}},{key:"getEventName",value:function(data){return data.type?data.type in ANALYTICS_TX_NAMES?ANALYTICS_TX_NAMES[data.type]:"Unknown":ANALYTICS_TX_NAMES[SIGN_TYPE.CREATE_ORDER]}},{key:"getAnalytics",value:function(data,success){var NAME=this.getEventName(data);return{name:"".concat(NAME,success?" Transaction Success":" Transaction Error"),params:{type:data.type}}}},{key:"confirm",value:function(){var _this151=this;return this.sendTransaction().then(function(tx){ConfirmTxService._isIssueTx(tx)&&_this151._saveIssueAsset(tx),ConfirmTxService._isSponsorshipTx(tx)&&(tx.minSponsoredAssetFee?_this151._setTransferFee(tx):_this151._resetTransferFee(tx)),_this151.step++,_this151.onTxSent({id:tx.id}),_this151.__$scope.$apply()}).catch(function(e){e.error&&utils.checkIsScriptError(e.error)?(_this151.errorType=e.error,_this151.errorParams=e.params):_this151.errorMessage=e.message,_this151.__$scope.$apply()})}},{key:"showTxInfo",value:function(){this.signable.getId().then(function(id){$mdDialog.hide(),setTimeout(function(){modalManager.showTransactionInfo(id)},1e3)})}},{key:"_saveIssueAsset",value:function(tx){waves.node.height().then(function(height){ds.assetStorage.save(tx.id,new Asset(_objectSpread({},tx,{ticker:null,precision:tx.decimals,hasScript:!(!tx.script||!tx.script.replace("base64:","")),height:height})))})}},{key:"_setTransferFee",value:function(tx){waves.node.transactions.getAlways(tx.id).then(function(data){ds.api.assets.getAssetFromNode(data.assetId).then(function(asset){var balance=balanceWatcher.getBalanceByAsset(asset),fee=new Money(data.minSponsoredAssetFee.getCoins(),asset);ds.utils.setTransferFeeItem({balance:balance,fee:fee,isMy:!0})})})}},{key:"_resetTransferFee",value:function(tx){waves.node.transactions.getAlways(tx.id).then(function(data){ds.utils.resetTransferFeeItem(data.minSponsoredAssetFee.asset.id)})}},{key:"initExportLink",value:function(){var _this152=this,type=this.signable.type;this.signable.getDataForApi().then(function(data){_this152.exportLink="".concat(WavesApp.origin,"/#tx").concat(utils.createQS(data)),_this152.canCreateLink=!NO_EXPORT_TYPES.includes(type)&&_this152.exportLink.length<=WavesApp.MAX_URL_LENGTH,_this152.__$scope.$apply()})}},{key:"onChangeSignable",value:function(){var _this153=this;this.signable?(this.isTransaction=this.signable.type<100,this.advancedMode&&this.signable.hasMySignature().then(function(state){state&&_this153.initExportLink()}),this.tx=waves.node.transactions.createTransaction(this.signable.getTxData()),this.signable.getId().then(function(id){_this153.txId=id,_this153.__$scope.$digest()})):(this.txId="",this.tx=null)}}],[{key:"_isIssueTx",value:function(tx){return tx.type===SIGN_TYPE.ISSUE}},{key:"_isSponsorshipTx",value:function(tx){return tx.type===SIGN_TYPE.SPONSORSHIP}},{key:"_getSendMethod",value:function(type){switch(type){case SIGN_TYPE.CREATE_ORDER:return ds.createOrder;case SIGN_TYPE.CANCEL_ORDER:return ds.cancelOrder;default:return ds.broadcast}}},{key:"toBigNumber",value:function(amount){return amount&&amount.getTokens().toFixed()||void 0}}]),ConfirmTxService}()};factory.$inject=["Base","waves","utils","$mdDialog","modalManager","balanceWatcher"],angular.module("app.ui").factory("ConfirmTxService",factory)}(),function(){var Money=require("@waves/data-entities").Money,analytics=require("data-service").analytics,controller=function(Base,$scope,gatewayService,user){return new(function(){function ReceiveCtrl(_ref68){var _this154,asset=_ref68.asset;return _classCallCheck(this,ReceiveCtrl),(_this154=_possibleConstructorReturn(this,_getPrototypeOf(ReceiveCtrl).call(this,$scope))).gatewayAddress="",_this154.minAmount=void 0,_this154.maxAmount=void 0,_this154.assetKeyName=void 0,analytics.sendV2("Receive",{action:"Show",label:asset.id}),_this154.asset=asset,_this154.isCryptocurrency=gatewayService.hasSupportOf(_this154.asset,"deposit"),_this154.wavesAddress=user.address,_this154.gatewayServerError=!1,_this154.gatewayServerPending=!1,_this154.getGatewayDetails(),_this154}return _inherits(ReceiveCtrl,Base),_createClass(ReceiveCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(ReceiveCtrl.prototype),"$onDestroy",this).call(this),this.gatewayServerPending=!1}},{key:"getGatewayDetails",value:function(){var _this155=this;if(this.isCryptocurrency){this.gatewayServerPending=!0;var depositDetails=gatewayService.getDepositDetails(this.asset,user.address);depositDetails&&depositDetails.then(function(details){_this155.gatewayAddress=details.address,_this155.minAmount=Money.fromTokens(details.minimumAmount.toFixed(_this155.asset.precision),_this155.asset),_this155.maxAmount=Money.fromTokens(details.maximumAmount.toFixed(_this155.asset.precision),_this155.asset),_this155.assetKeyName=gatewayService.getAssetKeyName(_this155.asset,"deposit"),_this155.gatewayServerPending=!1,$scope.$apply()}).catch(function(){_this155.gatewayServerError=!0,_this155.gatewayServerPending=!1,$scope.$apply()})}else this.gatewayServerError=!1}}]),ReceiveCtrl}())(this.locals)};controller.$inject=["Base","$scope","gatewayService","user","waves","baseAssetService"],angular.module("app.utils").controller("ReceiveCtrl",controller)}(),function(){var factory=function(utils){var tsUtils=require("ts-utils"),ComponentList=function(){function ComponentList(components){_classCallCheck(this,ComponentList),this._hash=Object.create(null),this.signals=utils.liteObject({add:new tsUtils.Signal,remove:new tsUtils.Signal}),this.components=[],components&&components.length&&this.add(components)}return _createClass(ComponentList,[{key:"length",get:function(){return this.components.length}}]),_createClass(ComponentList,[{key:"add",value:function(components){utils.toArray(components).forEach(this._add,this)}},{key:"remove",value:function(components){utils.toArray(components).forEach(this._remove,this)}},{key:"push",value:function(){for(var _len16=arguments.length,components=new Array(_len16),_key16=0;_key16<_len16;_key16++)components[_key16]=arguments[_key16];this.add(components)}},{key:"forEach",value:function(cb,context){this.components.forEach(cb,context)}},{key:"map",value:function(cb,context){return this.components.map(cb,context)}},{key:"filter",value:function(cb,context){return new ComponentList(this.components.filter(cb,context))}},{key:"where",value:function(props){var keys=Object.keys(props);return new ComponentList(this.components.filter(function(item){return keys.every(function(key){return utils.isEqual(props[key],item[key])})}))}},{key:"some",value:function(cb,context){return"function"==typeof cb?this.components.some(cb,context):this.components.some(tsUtils.contains(cb))}},{key:"every",value:function(cb,context){return"function"==typeof cb?this.components.every(cb,context):this.components.every(tsUtils.contains(cb))}},{key:"get",value:function(index){return this.components[index]}},{key:"first",value:function(){return this.components[0]}},{key:"last",value:function(){return this.components[this.components.length-1]}},{key:"index",value:function(id,field){return this.components.indexOf(tsUtils.find(this.components,_defineProperty({},field,id)))}},{key:"_add",value:function(component){var _this156=this;this.receiveOnce(component.signals.destroy,function(){return _this156.remove(component)}),this._hash[component.cid]=component,this.components.push(component),this.signals.add.dispatch(component)}},{key:"_remove",value:function(component){delete this._hash[component.cid];var index=this.components.indexOf(component);-1!==index&&(this.components.splice(index,1),this.signals.remove.dispatch(component))}}]),ComponentList}();return ComponentList.prototype.receive=tsUtils.Receiver.prototype.receive,ComponentList.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,ComponentList.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,ComponentList};factory.$inject=["utils"],angular.module("app.utils").factory("ComponentList",factory)}(),function(){var ds=require("data-service");angular.module("app.utils").factory("explorerLinks",function(){return new(function(){function ExplorerLinks(){_classCallCheck(this,ExplorerLinks)}return _createClass(ExplorerLinks,[{key:"getTxLink",value:function(transactionId){var baseExplorerUrl=ds.utils.ConfigService.getInstance().getConfig("NETWORK.explorer");return"".concat(baseExplorerUrl,"/").concat("tx","/").concat(transactionId)}}]),ExplorerLinks}())})}(),angular.module("app.wallet.assets",[]),clipboard=require("clipboard-polyfill"),(ClipboardService=function(){function ClipboardService(notification){_classCallCheck(this,ClipboardService),this.notification=notification}return _createClass(ClipboardService,[{key:"copy",value:function(text){var _this157=this;return clipboard.writeText(text).then(function(){_this157.notification.info({ns:"app.ui",title:{literal:"copySuccess"}})}).catch(function(){_this157.notification.error({ns:"app.ui",title:{literal:"copyError"}})})}}]),ClipboardService}()).$inject=["notification"],angular.module("app").service("clipboardService",ClipboardService),function(){var ds=require("data-service"),_require37=require("@waves/waves-transactions"),libs=_require37.libs,seedUtils=_require37.seedUtils,_libs$crypto3=libs.crypto,keyPair=_libs$crypto3.keyPair,sharedKey=_libs$crypto3.sharedKey,messageDecrypt=_libs$crypto3.messageDecrypt,base64Decode=_libs$crypto3.base64Decode,noop=function(){},MigrationService=function(){function MigrationService(storage,$templateRequest){_classCallCheck(this,MigrationService),this.data=null,this.connectProvider=null,this._onConnect=noop,this._onData=noop,this._onDataError=noop,this._$templateRequest=void 0,this.storage=storage,this._$templateRequest=$templateRequest}return _createClass(MigrationService,[{key:"onConnect",value:function(cb){this._onConnect=cb}},{key:"onData",value:function(cb,errCb){this._onData=cb,this._onDataError=errCb}},{key:"onEnd",value:function(){this._onData=noop,this._onDataError=noop}},{key:"listen",value:function(){var _this158=this,port=ds.utils.ConfigService.getInstance().getConfig("MIGRATION.desktopPort");this.connectProvider=WavesApp.isDesktop()?new ds.connect.HttpConnectProvider({port:port,origins:"*"}):new ds.connect.PostMessageConnectProvider({win:window.opener||window.parent,mode:"import",origins:"*"});var privateKeyTo=null;this.connectProvider.listen(function(message,url,res){return WavesApp.isDesktop()&&"/"===url.pathname?(res.setHeader("Content-Type","text/html"),_this158._$templateRequest("modules/app/services/migration-window.html")):new Promise(function(resolve,reject){if(!message)return reject();switch(message.event){case"connect":var _keyPair=keyPair(seedUtils.generateNewSeed(20)),publicKey=_keyPair.publicKey,privateKey=_keyPair.privateKey;return privateKeyTo=privateKey,_this158._onConnect(),resolve(JSON.stringify({event:"connect",payload:publicKey}));case"data":var encryptedData=base64Decode(message.payload.data),publicKeyFrom=message.payload.publicKey;if(!privateKeyTo)return reject("Key pair does not exist");try{var data=JSON.parse(messageDecrypt(sharedKey(privateKeyTo,publicKeyFrom,"waves_migration_token"),encryptedData));return _this158._onData(data),resolve(JSON.stringify({event:"data",payload:"ok"}))}catch(e){return _this158._onDataError(e),reject(String(e))}finally{privateKeyTo=null}default:return reject("Invalid message")}})})}}]),MigrationService}();MigrationService.$inject=["storage","$templateRequest"],angular.module("app").service("migrationService",MigrationService)}(),function(){var factory=function(assets,utils,decorators,transactions,matcher,configService,$injector){var _dec4,_dec5,_dec6,_dec7,_dec8,_class5,ds=require("data-service"),entities=require("@waves/data-entities"),BigNumber=require("@waves/bignumber").BigNumber,_require39=require("ramda"),flatten=_require39.flatten,pipe=_require39.pipe,map=_require39.map,path=_require39.path,where=_require39.where,prop=_require39.prop,gte=_require39.gte,allPass=_require39.allPass,lte=_require39.lte,filter=_require39.filter,length=_require39.length,equals=_require39.equals,isNil=_require39.isNil,not=_require39.not,find=_require39.find,__=_require39.__;return new(_dec4=decorators.cachable(5),_dec5=decorators.cachable(350),_dec6=decorators.cachable(60),_dec7=decorators.cachable(60),_dec8=decorators.cachable(60),_applyDecoratedDescriptor((_class5=function(){function WavesUtils(){_classCallCheck(this,WavesUtils),this.rateListCache=[],this.rateListCacheMaxAge=12e4}return _createClass(WavesUtils,[{key:"searchAsset",value:function(userInput){return ds.fetch("".concat(ds.config.get("api"),"/assets/search/").concat(userInput))}},{key:"getRate",value:function(assetFrom,assetTo,date){var WavesId=$injector.get("baseAssetService").WavesAssetId,from=WavesUtils.toId(assetFrom),to=WavesUtils.toId(assetTo);return from===to?Promise.resolve(new BigNumber(1)):date?void 0:from===WavesId||to===WavesId?this._getRate(from,to):utils.whenAll([this._getRate(from,WavesId),this._getRate(to,WavesId)]).then(function(_ref69){var _ref70=_slicedToArray(_ref69,2),rateFrom=_ref70[0],rateTo=_ref70[1];return rateTo.eq(0)?rateTo:rateFrom.div(rateTo)})}},{key:"_selectCachedRateList",value:function(pairs,baseAssetId,date){var _this159=this;return this._invalidateRateListCache(),pairs.reduce(function(_ref71,pair){var _ref72=_slicedToArray(_ref71,2),cachedResults=_ref72[0],notCachedPairs=_ref72[1],getRate=path(["rates",pair]),rateExist=pipe(getRate,isNil,not),cacheMatches=where({baseAssetId:equals(baseAssetId),date:equals(date)}),rate=pipe(find(allPass([rateExist,cacheMatches])),getRate)(_this159.rateListCache);return rate?cachedResults.push(rate):notCachedPairs.push(pair),[cachedResults,notCachedPairs]},[[],[]])}},{key:"_invalidateRateListCache",value:function(){var _this160=this;this.rateListCache=this.rateListCache.filter(function(entry){return entry.timestamp>Date.now()-_this160.rateListCacheMaxAge})}},{key:"_cacheRateListRequest",value:function(_ref73){var pairs=_ref73.pairs,date=_ref73.date,baseAssetId=_ref73.baseAssetId,rates=_ref73.rates,timestamp=_ref73.timestamp;this.rateListCache.push({date:date,baseAssetId:baseAssetId,timestamp:timestamp,rates:rates.data.reduce(function(acc,rate,index){return acc[pairs[index]]=rate,acc},{})})}},{key:"getRateList",value:function(assetList,baseAssetId,date){var _this161=this,pairs=assetList.map(function(asset){return"".concat(WavesUtils.toId(asset),"/").concat(baseAssetId)}),_this$_selectCachedRa2=_slicedToArray(this._selectCachedRateList(pairs,baseAssetId,date),2),cachedResults=_this$_selectCachedRa2[0],notCachedPairs=_this$_selectCachedRa2[1];if(0===notCachedPairs.length)return Promise.resolve({data:cachedResults});var requestBody={pairs:notCachedPairs,timestamp:date},version=ds.config.get("apiVersion"),api="".concat(ds.config.get("api"),"/").concat(version);return ds.fetch("".concat(api,"/matchers/").concat(matcher.currentMatcherAddress,"/rates"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf8"},body:JSON.stringify(requestBody)}).then(function(rates){return _this161._cacheRateListRequest({pairs:notCachedPairs,date:date,rates:rates,baseAssetId:baseAssetId,timestamp:Date.now()}),{data:cachedResults.concat(rates.data)}}).catch(function(){return Promise.resolve()})}},{key:"getRateApi",value:function(assetFrom,assetTo){var _this162=this;return utils.whenAll([assets.getAsset(WavesUtils.toId(assetFrom)),assets.getAsset(WavesUtils.toId(assetTo)),this.getRate(assetFrom,assetTo)]).then(function(_ref74){var _ref75=_slicedToArray(_ref74,3),from=_ref75[0],to=_ref75[1],rate=_ref75[2];return _this162._generateRateApi(from,to,rate)})}},{key:"getRateHistory",value:function(assetFrom,assetTo,from,to){var idFrom=WavesUtils.toId(assetFrom),idTo=WavesUtils.toId(assetTo),wavesId=$injector.get("baseAssetService").WavesAssetId;return to=to||Date.now(),idFrom===idTo?Promise.resolve([]):idFrom===wavesId||idTo===wavesId?this._getRateHistory(idFrom,idTo,utils.moment(from),utils.moment(to)):Promise.all([this._getRateHistory(idFrom,wavesId,utils.moment(from),utils.moment(to)),this._getRateHistory(idTo,wavesId,utils.moment(from),utils.moment(to))]).then(function(_ref76){var _ref77=_slicedToArray(_ref76,2),from=_ref77[0],to=_ref77[1],hash=to.reduce(function(result,item){return result[item.timestamp.valueOf()]=item,result},Object.create(null));return from.reduce(function(result,item){return hash[item.timestamp.valueOf()]&&(item.rate=item.rate.div(hash[item.timestamp.valueOf()].rate),result.push(item)),result},[])})}},{key:"getChange",value:function(assetFrom,assetTo){var idFrom=WavesUtils.toId(assetFrom),idTo=WavesUtils.toId(assetTo);return idFrom===idTo?Promise.resolve(new BigNumber(0)):this._getChange(idFrom,idTo)}},{key:"getVolume",value:function(pair){return this._getVolume(pair,matcher.currentMatcherAddress)}},{key:"_getVolume",value:function(pair,currentMatcherAddress){return ds.api.pairs.info(currentMatcherAddress,[pair]).then(function(data){var _data$filter2$=_slicedToArray(data.filter(Boolean),1)[0],pair=void 0===_data$filter2$?{}:_data$filter2$;return pair&&String(pair.volume)||"0"})}},{key:"_getChange",value:function(from,to){return ds.api.pairs.get(from,to).then(function(pair){return ds.api.pairs.info(matcher.currentMatcherAddress,[pair]).then(function(_ref78){var data=_slicedToArray(_ref78,1)[0];if(!data||"error"===data.status)return 0;var open=data.firstPrice||new entities.Money(0,pair.priceAsset),close=data.lastPrice||new entities.Money(0,pair.priceAsset),change24=Number(function(open,close){return open.eq(0)?new BigNumber(0):close.sub(open).div(open).mul(100).roundTo(2)}(open.getTokens(),close.getTokens()).toFixed());return pair.amountAsset.id===from?change24:-change24})}).catch(function(){return 0})}},{key:"_getRate",value:function(fromId,toId){var currentRate=function(trades){return trades&&trades.length?function(trades){return trades.reduce(function(result,item){return result.add(new BigNumber(item.price.getTokens()))},new BigNumber(0)).div(trades.length)}(trades):new BigNumber(0)};return ds.api.pairs.get(fromId,toId).then(function(pair){return transactions.getExchangeTxList({limit:5,amountAsset:pair.amountAsset,priceAsset:pair.priceAsset}).then(currentRate).then(function(rate){return fromId!==pair.priceAsset.id?rate:rate.eq(0)?rate:new BigNumber(1).div(rate)}).catch(function(){return new BigNumber(0)})})}},{key:"_getRateHistory",value:function(fromId,toId,from,to){var formattedFrom=from.valueOf(),formattedTo=to.valueOf();return ds.api.pairs.get(fromId,toId).then(function(pair){var amountId=pair.amountAsset.id,priceId=pair.priceAsset.id,interval=utils.getMaxInterval(formattedFrom,formattedTo),dayX=new Date(configService.get("CONCAT_MATCHER_DATE")).getTime(),promisesWithCandles=utils.concatCandles({to:to,from:from,amountId:amountId,priceId:priceId,dayX:dayX,interval:interval,oldMatcher:matcher.oldMatcherAddress,currentMatcher:matcher.currentMatcherAddress}).promisesWithCandles;return Promise.all(promisesWithCandles).then(pipe(map(prop("data")),flatten)).then(map(function(item){return{close:item.close,timestamp:new Date(item.time).getTime()}})).then(filter(where({close:function(_close){return _close.gt(0)},timestamp:allPass([gte(__,formattedFrom),lte(__,formattedTo)])}))).then(function(list){return equals(length(list),0)?Promise.reject(new Error("Nor found by pair ".concat(pair))):list}).then(map(function(_ref80){var timestamp=_ref80.timestamp,close=_ref80.close;return{timestamp:new Date(timestamp),rate:fromId!==pair.priceAsset.id?close:new BigNumber(1).div(close)}}))})}},{key:"_generateRateApi",value:function(from,to,rate){return{exchange:function(balance){return balance.mul(rate.toFixed(8)).roundTo(to.precision)},exchangeReverse:function(balance){return(rate?balance.div(rate):new BigNumber(0)).roundTo(from.precision)},rate:rate}}}],[{key:"toId",value:function(asset){return"string"==typeof asset?asset:asset.id}}]),WavesUtils}()).prototype,"searchAsset",[_dec4],Object.getOwnPropertyDescriptor(_class5.prototype,"searchAsset"),_class5.prototype),_applyDecoratedDescriptor(_class5.prototype,"getRate",[_dec5],Object.getOwnPropertyDescriptor(_class5.prototype,"getRate"),_class5.prototype),_applyDecoratedDescriptor(_class5.prototype,"getRateHistory",[_dec6],Object.getOwnPropertyDescriptor(_class5.prototype,"getRateHistory"),_class5.prototype),_applyDecoratedDescriptor(_class5.prototype,"getChange",[_dec7],Object.getOwnPropertyDescriptor(_class5.prototype,"getChange"),_class5.prototype),_applyDecoratedDescriptor(_class5.prototype,"_getVolume",[_dec8],Object.getOwnPropertyDescriptor(_class5.prototype,"_getVolume"),_class5.prototype),_class5)};factory.$inject=["assets","utils","decorators","transactions","matcher","configService","$injector"],angular.module("app").factory("wavesUtils",factory)}(),function(){var controller=function(Base,$scope,user){return new(function(){function BuyBTCCtrl(){var _this163;return _classCallCheck(this,BuyBTCCtrl),(_this163=_possibleConstructorReturn(this,_getPrototypeOf(BuyBTCCtrl).call(this,$scope))).isLogined=!!user.address,_this163}return _inherits(BuyBTCCtrl,Base),BuyBTCCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.buyBTC").controller("BuyBTCCtrl",controller)}(),function(){var controller=function(Base,$scope,$q,$state,user,modalManager,seedService,$location){var ds=require("data-service"),analytics=ds.analytics,ORDER_LIST=["createAccount","createAccountData"],STATE_HASH_CREATE_ACCOUNT_DATA=1,STATE_HASH_SHOW_NO_BACKUP_NOW_MONEY=2,STATE_HASH_BACKUP=3,STATE_HASH_CONFIRM_BACKUP=4;return new(function(){function CreateCtrl(){var _this164;_classCallCheck(this,CreateCtrl),_this164=_possibleConstructorReturn(this,_getPrototypeOf(CreateCtrl).call(this,$scope));var createNew=!!$location.search().new;return _this164.invitationStep=createNew?1:0,_this164.stepIndex=0,_this164.name="",_this164.seed="",_this164.address="",_this164.seedList=[],_this164.seedIsValid=!1,_this164.seedConfirmWasFilled=!1,_this164.saveUserData=!0,_this164.resetAddress(),_this164}return _inherits(CreateCtrl,Base),_createClass(CreateCtrl,[{key:"onSeedConfirmFulfilled",value:function(isValid){this.seedIsValid=isValid,this.seedConfirmWasFilled=!0,this.observeOnce("stepIndex",this.clearSeedConfirm)}},{key:"seedOnTouch",value:function(){this.seedConfirmWasFilled=!1}},{key:"clearSeedConfirm",value:function(){seedService.clear.dispatch(),this.seedIsValid=!1,this.seedConfirmWasFilled=!1}},{key:"setActiveSeed",value:function(item){var old=tsUtils.find(this.seedList,{active:!0});old&&(item.active||analytics.user.chooseAccountClick(),old.active=!1),item.active=!0,this.seed=item.seed,this.address=item.address}},{key:"getStepUrl",value:function(){return"".concat("modules/create/templates","/").concat(ORDER_LIST[this.stepIndex],".html")}},{key:"create",value:function(){return analytics.send({name:"Create Confirm Phrase Confirm Click"}),this._create(!0)}},{key:"createWithoutBackup",value:function(){return analytics.send({name:"Create Do It Later Click"}),analytics.addGtmEvent("Profile",{action:"Enter_account_name_Click"}),this._create(!1)}},{key:"clickCopySeed",value:function(){analytics.send({name:"Create Backup Phrase Copy Click"})}},{key:"next",value:function(index){var _this165=this;if((index=index||this.stepIndex+1)<0&&(index=this.stepIndex+index),index===STATE_HASH_CREATE_ACCOUNT_DATA&&analytics.user.chooseAvatarContinueClick(),this.stepIndex===STATE_HASH_CREATE_ACCOUNT_DATA&&index>this.stepIndex&&analytics.send({name:"Create Protect Your Account Continue Click"}),index===STATE_HASH_SHOW_NO_BACKUP_NOW_MONEY&&analytics.send({name:"Create No Backup Show"}),this.stepIndex===STATE_HASH_SHOW_NO_BACKUP_NOW_MONEY&&index>this.stepIndex&&analytics.send({name:"Create Back Up Now Click"}),index===STATE_HASH_BACKUP&&analytics.send({name:"Create Backup Phrase Show"}),this.stepIndex===STATE_HASH_BACKUP&&index>this.stepIndex&&analytics.send({name:"Create Backup Phrase I Written Click"}),index===STATE_HASH_CONFIRM_BACKUP&&analytics.send({name:"Create Confirm Phrase Show"}),ORDER_LIST[index])return this.checkNext().then(function(){(_this165.stepIndex=index)===STATE_HASH_BACKUP&&analytics.send({name:"Create Backup Phrase Show"}),index===STATE_HASH_CONFIRM_BACKUP&&analytics.send({name:"Create Confirm Phrase Show"})});throw new Error("Wrong order list index!")}},{key:"nextInvitationStep",value:function(){analytics.user.createAccountClick(),this.invitationStep+=1}},{key:"checkNext",value:function(){return"noBackupNoMoney"===ORDER_LIST[this.stepIndex]?(analytics.send({name:"Create Warning Show"}),this.showBackupWarningPopup().then(function(){analytics.send({name:"Create Warning I Understand Click"})})):$q.when()}},{key:"resetAddress",value:function(){for(var list=[],i=0;i<5;i++){var phrase=ds.Seed.create().phrase,seedData=new ds.Seed(phrase,ds.config.get("code"));list.push({seed:seedData.phrase,address:seedData.address})}this.setActiveSeed(list[0]),this.seedList=list}},{key:"showBackupWarningPopup",value:function(){return modalManager.showCustomModal({templateUrl:"modules/create/templates/noBackupNoMoney.modal.html",clickOutsideToClose:!1,escapeToClose:!1})}},{key:"_create",value:function(hasBackup){var newUser={userType:"seed",networkByte:ds.config.get("code").charCodeAt(0),name:this.name,seed:this.seed};return user.create(newUser,hasBackup).then(function(){analytics.user.createAddressSuccess("generate"),user.goToActiveState("wallet")})}}]),CreateCtrl}())};controller.$inject=["Base","$scope","$q","$state","user","modalManager","seedService","$location"],angular.module("app.create").controller("CreateCtrl",controller)}(),angular.module("app.defoInvestment",[]),angular.module("app.defoStakingFaq",[]),function(){var analytics=require("data-service").analytics,controller=function(Base,$scope,user){return new(function(){function ImportCtrl(){return _classCallCheck(this,ImportCtrl),_possibleConstructorReturn(this,_getPrototypeOf(ImportCtrl).call(this,$scope))}return _inherits(ImportCtrl,Base),_createClass(ImportCtrl,[{key:"backState",value:function(){return user.getLastState()}},{key:"addGtmEvent",value:function(event,params){analytics.addGtmEvent(event,params)}}]),ImportCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.import").controller("ImportCtrl",controller)}(),function(){var controller=function(Base,$scope,$state,user,utils){var signatureAdapter=require("@waves/signature-adapter"),ds=require("data-service"),analytics=ds.analytics;return new(function(){function KeeperCtrl(){var _this166;return _classCallCheck(this,KeeperCtrl),(_this166=_possibleConstructorReturn(this,_getPrototypeOf(KeeperCtrl).call(this,$scope))).isInit=!1,_this166.noKeeper=!1,_this166.noKeeperPermission=!1,_this166.noKeeperAccounts=!1,_this166.incorrectKeeperNetwork=!1,_this166.lockedKeeper=!1,_this166.adapter=signatureAdapter.WavesKeeperAdapter,_this166.loading=!1,_this166.error=!1,_this166.selectedUser=Object.create(null),_this166.saveUserData=!0,_this166.name="",_this166.isPriorityUserTypeExists=!1,_this166.userExisted=Object.create(null),_this166._usersInStorage=[],_this166._type="wavesKeeper",_this166._priorityMap=utils.getImportPriorityMap(),_this166._onUpdateAdapter=function(state){return _this166.onUpdateState(state)},_this166.observe("selectedUser",_this166._onSelectUser),_this166.adapter.onUpdate(_this166._onUpdateAdapter),Promise.all([user.getFilteredUserList(),user.getMultiAccountUsers()]).then(function(_ref81){var _ref82=_slicedToArray(_ref81,2),_ref82$=_ref82[0],legacyUsers=void 0===_ref82$?[]:_ref82$,_ref82$2=_ref82[1],users=void 0===_ref82$2?[]:_ref82$2;_this166._usersInStorage=[].concat(_toConsumableArray(legacyUsers),_toConsumableArray(users))}),analytics.send({name:"Import Keeper Click",target:"ui"}),_this166.getUsers(),_this166}return _inherits(KeeperCtrl,Base),_createClass(KeeperCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(KeeperCtrl.prototype),"$onDestroy",this).call(this),this.adapter.offUpdate(this._onUpdateAdapter)}},{key:"isAvilableAdapter",value:function(){return this.adapter.isAvailable()}},{key:"onError",value:function(error){switch(error.code){case 0:this.noKeeper=!0;break;case 1:this.noKeeperPermission=!0;break;case 2:this.noKeeperAccounts=!0;break;case 3:this.incorrectKeeperNetwork=!0;break;case"locked":this.lockedKeeper=!0}this.error=!0}},{key:"onUpdateState",value:function(){var _this167=this;this.loading||(clearTimeout(this._time),this._time=setTimeout(function(){return _this167.getUsers()},500))}},{key:"getUsers",value:function(){var _this168=this;this.loading=!0,this.error=!1,this.noKeeper=!1,this.noKeeperPermission=!1,this.noKeeperAccounts=!1,this.incorrectKeeperNetwork=!1,this.lockedKeeper=!1,this.isAvilableAdapter().then(function(){return _this168.adapter.getUserList()}).then(function(_ref83){var user=_slicedToArray(_ref83,1)[0];if(!user)return Promise.reject({code:"locked"});_this168.selectedUser=user,_this168.receive(utils.observe(_this168.selectedUser,"name"),_this168._onChangeName,_this168),delete _this168.selectedUser.type}).catch(function(e){return _this168.onError(e)}).finally(function(){_this168.isInit=!0,_this168.loading=!1,$scope.$apply(),_this168._onSelectUser()})}},{key:"login",value:function(){var _this169=this,newUser=_objectSpread({},this.selectedUser,{userType:this.adapter.type,networkByte:ds.config.get("code").charCodeAt(0)});return user.create(newUser,!0,!0).then(function(){$state.go(user.goToActiveState()),analytics.user.importAddressSuccess("keeper")}).catch(function(){_this169.error=!0,$scope.$digest()})}},{key:"_onSelectUser",value:function(){this._onChangeAddress(),this._onChangeName()}},{key:"_onChangeAddress",value:function(){var _this170=this;this.userExisted=this._usersInStorage.find(function(user){return user.address===_this170.selectedUser.address})||null,this.isPriorityUserTypeExists=!!this.userExisted&&this._priorityMap[this._type]<=this._priorityMap[this.userExisted.userType]}},{key:"_onChangeName",value:function(){var _this171=this,isUnique=this._usersInStorage.some(function(user){return user.name===_this171.selectedUser.name&&user.address!==_this171.selectedUser.address});this.importForm&&this.importForm.userName.$setValidity("isUnique",!isUnique)}}]),KeeperCtrl}())};controller.$inject=["Base","$scope","$state","user","utils"],angular.module("app.keeper").controller("KeeperCtrl",controller)}(),function(){var signatureAdapter=require("@waves/signature-adapter"),controller=function(Base,$scope,$state,user,modalManager,utils){var ds=require("data-service"),analytics=ds.analytics;return new(function(){function LedgerCtrl(){var _this172;return _classCallCheck(this,LedgerCtrl),(_this172=_possibleConstructorReturn(this,_getPrototypeOf(LedgerCtrl).call(this,$scope))).adapter=signatureAdapter.LedgerAdapter,_this172.loading=!1,_this172.error=!1,_this172.visibleUsers=[],_this172.selectedUser=null,_this172.offset=0,_this172.isInit=!1,_this172.disabledLogin=!0,_this172.disabledRight=!0,_this172.disabledLeft=!0,_this172.selectDefault=!1,_this172.saveUserData=!0,_this172.id="",_this172.name="",_this172._runLedgerCommand="",_this172._users={},_this172._usersInStorage=[],_this172.isPriorityUserTypeExists=!1,_this172._type="ledger",_this172.userExisted=Object.create(null),_this172._priorityMap=utils.getImportPriorityMap(),Promise.all([user.getFilteredUserList(),user.getMultiAccountUsers()]).then(function(_ref85){var _ref86=_slicedToArray(_ref85,2),_ref86$=_ref86[0],legacyUsers=void 0===_ref86$?[]:_ref86$,_ref86$2=_ref86[1],users=void 0===_ref86$2?[]:_ref86$2;_this172._usersInStorage=[].concat(_toConsumableArray(legacyUsers),_toConsumableArray(users))}),_this172.observe("selectDefault",_this172._onChangeSelectDefault),_this172.getUsers(5),_this172.observe("selectedUser",_this172._onSelectUser),_this172.observe("name",_this172._onChangeName),analytics.send({name:"Import Ledger Click",target:"ui"}),_this172}return _inherits(LedgerCtrl,Base),_createClass(LedgerCtrl,[{key:"getUsers",value:function(count){var _this173=this;this._runLedgerCommand="getUsers",this.loading=!0,this.error=!1;var countUsers=(count||5)-1,promise=utils.timeoutPromise(this.adapter.getUserList(this.offset,countUsers),25e3),modalPromise=this.isInit?Promise.resolve():modalManager.showLoginByDevice(promise,this.adapter.type);return Promise.all([promise,modalPromise]).then(function(_ref87){var users=_slicedToArray(_ref87,1)[0];_this173.isInit=!0,_this173.loading=!1,_this173.error=!1,(users||[]).forEach(function(curUser){_this173._users[curUser.id]=curUser}),_this173.showVisibleUsers(),_this173.selectUser(),$scope.$digest()}).catch(function(){var err=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},error=_objectSpread({},err,{count:count});throw _this173.loading=!1,_this173.error=error,err instanceof RangeError&&(_this173.offset=0,_this173.id=""),$scope.$digest(),error})}},{key:"retryGetUsers",value:function(){this[this._runLedgerCommand](this.error&&this.error.count)}},{key:"selectUser",value:function(user){if(this.selectDefault)return null;user||this.selectedUser||!this._users[0]?user&&(this.selectedUser=user):this.selectedUser=this._users[0],this._calculateDisabled()}},{key:"stepLeft",value:function(){if(!this.selectDefault&&!this.disabledLeft){if(this.offset=this._normalizeOffset(this.offset-5),this._hasUsersInCache(this.offset,this.offset+5-1))this.showVisibleUsers();else{if(this.loading)return;this.getUsers()}this._calculateDisabled()}}},{key:"stepRight",value:function(){if(!this.selectDefault&&!this.disabledRight){if(this.offset=this._normalizeOffset(this.offset+5),this._hasUsersInCache(this.offset,this.offset+5-1))this.showVisibleUsers();else{if(this.loading)return;this.getUsers()}this._calculateDisabled()}}},{key:"showVisibleUsers",value:function(){for(var tmp=[],i=this.offset;i<this.offset+5;i++)tmp.push(this._users[i]);this.visibleUsers=tmp}},{key:"login",value:function(){var _this174=this;this._runLedgerCommand="login";var newUser=_objectSpread({},this.selectedUser,{userType:this.adapter.type,name:this.name,networkByte:ds.config.get("code").charCodeAt(0)});return this._calculateDisabled(!0),user.create(newUser,!0,!0).then(function(){analytics.user.importAddressSuccess("ledger"),$state.go(user.goToActiveState())}).catch(function(){_this174.error=!0,$scope.$digest()})}},{key:"isUserDisable",value:function(index){return 0!==index&&this.selectDefault}},{key:"onChangeId",value:function(){var _this175=this,id=parseInt(this.selectDefault?this.selectedUser.id:this.id,10);(isNaN(id)||id<0)&&(id=0),2147483647<id&&(id=2147483647),this.id=String(id),this.offset=this._normalizeOffset(id-Math.floor(2.5)),this._hasUsersInCache(this.offset,this.offset+5-1)?(this.showVisibleUsers(),this.selectUser(this._users[id])):this.getUsers().then(function(){_this175.selectUser(_this175._users[id])})}},{key:"_calculateDisabled",value:function(disable){this.disabledLogin=disable||this.loading||!this.selectedUser,this.disabledRight=disable||this.selectDefault||this.loading||2147483643===this.offset,this.disabledLeft=disable||this.selectDefault||this.loading||0===this.offset}},{key:"_onChangeSelectDefault",value:function(){this.selectDefault&&(this.offset=0,this.selectedUser=this._users[0],this.id=this.selectedUser.id),this._calculateDisabled(),this.showVisibleUsers()}},{key:"_onSelectUser",value:function(){var _this176=this;this.id=this.selectedUser.id,this.userExisted=this._usersInStorage.find(function(user){return user.address===_this176.selectedUser.address})||null,this.isPriorityUserTypeExists=!!this.userExisted&&this._priorityMap[this._type]<=this._priorityMap[this.userExisted.userType]}},{key:"_onChangeName",value:function(){var _this177=this,isUnique=this._usersInStorage.some(function(user){return user.name===_this177.name&&user.address!==_this177.selectedUser.address});this.importForm.userName.$setValidity("isUnique",!isUnique)}},{key:"_hasUsersInCache",value:function(from,to){for(var i=from;i<=to;i++)if(!this._users[i])return!1;return!0}},{key:"_normalizeOffset",value:function(offset){return 2147483643<offset?2147483643:offset<0?0:offset}}]),LedgerCtrl}())};controller.$inject=["Base","$scope","$state","user","modalManager","utils"],angular.module("app.ledger").controller("LedgerCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function OtcFaqCtrl(){var _this178;return _classCallCheck(this,OtcFaqCtrl),(_this178=_possibleConstructorReturn(this,_getPrototypeOf(OtcFaqCtrl).call(this,$scope))).isLogined=!!user.address,_this178}return _inherits(OtcFaqCtrl,Base),OtcFaqCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.otcFaq").controller("OtcFaqCtrl",controller)}(),function(){var analytics=require("data-service").analytics,controller=function(Base,$scope,$state,user){return new(function(){function SignInCtrl(){var _this179;return _classCallCheck(this,SignInCtrl),(_this179=_possibleConstructorReturn(this,_getPrototypeOf(SignInCtrl).call(this,$scope))).legacyUserList=null,analytics.send({name:"Onboarding Sign In Show",target:"ui",params:{from:"sign-in"}}),Promise.all([user.getMultiAccountData(),user.getFilteredUserList()]).then(function(_ref89){var _ref90=_slicedToArray(_ref89,2),multiAccountData=_ref90[0],userList=_ref90[1];multiAccountData?_this179.legacyUserList=userList:$state.go("signUp")}),_this179}return _inherits(SignInCtrl,Base),_createClass(SignInCtrl,[{key:"onLogin",value:function(){var _this180=this;if(this.loginInProgress)return null;this.pending=!0,this.loginInProgress=!0,analytics.user.login(),Promise.all([user.getMultiAccountUsers(),user.getMultiAccountSettings()]).then(function(_ref91){var _ref92=_slicedToArray(_ref91,2),multiAccountUsers=_ref92[0],commonSettings=_ref92[1],firstUser=_slicedToArray(multiAccountUsers,1)[0];if(user.setMultiAccountSettings(commonSettings),firstUser)return user.login(firstUser).then(function(){analytics.addGtmEvent("Profile",{action:"Login_Success"}),user.goToActiveState()});_this180.legacyUserList&&_this180.legacyUserList.length?$state.go("migrate"):$state.go("create")}).catch(function(){return _this180.pending=!1,$scope.$apply(),null}).then(function(){_this180.loginInProgress=!1,_this180.pending=!1,$scope.$apply()})}},{key:"onResetPassword",value:function(){$state.go("welcome")}}]),SignInCtrl}())};controller.$inject=["Base","$scope","$state","user","multiAccount","modalManager"],angular.module("app.signIn").controller("SignInCtrl",controller)}(),function(){var analytics=require("data-service").analytics,SignUpCtrl=function(){function SignUpCtrl($state,user,multiAccount,storage,$scope,utils){_classCallCheck(this,SignUpCtrl),this.activeStep=0,this.hasLegacyUsers=!1,this.$state=$state,this.$scope=$scope,this.utils=utils,this.user=user,this.multiAccount=multiAccount,this.storage=storage}return _createClass(SignUpCtrl,[{key:"$onInit",value:function(){var _this181=this;Promise.all([this.user.getMultiAccountData(),this.user.getFilteredUserList()]).then(function(_ref93){var _ref94=_slicedToArray(_ref93,2),multiAccountData=_ref94[0],userList=_ref94[1];multiAccountData?_this181.user.isAuthorised?_this181.$state.go(_this181.user.goToActiveState()):_this181.$state.go("signIn"):(_this181.hasLegacyUsers=userList&&0<userList.length,_this181.activeStep=_this181.hasLegacyUsers?0:1,_this181.utils.safeApply(_this181.$scope))})}},{key:"nextStep",value:function(){this.activeStep+=1}},{key:"onSubmit",value:function(password){var _this182=this;this.multiAccount.signUp(password,this.user.getSetting("encryptionRounds")).then(function(data){return Promise.all([_this182.user.saveMultiAccount(data),_this182.storage.save("termsAccepted",!0)])}).then(function(){_this182.hasLegacyUsers?_this182.$state.go("migrate"):_this182.$state.go("create")}).then(function(){analytics.user.createAccountSuccess()})}}]),SignUpCtrl}();SignUpCtrl.$inject=["$state","user","multiAccount","storage","$scope","utils"],angular.module("app.signUp").controller("SignUpCtrl",SignUpCtrl)}(),function(){var controller=function($window,$timeout){return new function SwitchCtrl(){_classCallCheck(this,SwitchCtrl),$timeout(function(){$window.history.back()},100)}};controller.$inject=["$window","$timeout"],angular.module("app.switch").controller("SwitchCtrl",controller)}(),function(){var controller=function(Base,$scope,modalManager,waves,balanceWatcher,user,utils,PromiseControl){var _require40=require("@waves/signature-adapter"),SIGN_TYPE=_require40.SIGN_TYPE,WAVES_ID=_require40.WAVES_ID,BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),$=require("jquery");return new(function(){function TokensCtrl(){var _this183;_classCallCheck(this,TokensCtrl),(_this183=_possibleConstructorReturn(this,_getPrototypeOf(TokensCtrl).call(this,$scope))).focusName=!1,_this183._findNamePC=null,_this183.agreeConditions=!1,_this183.nameWarning=!1,_this183.createForm=null,_this183.assetId="",_this183.name="",_this183.description="",_this183.issue=!0,_this183.count=null,_this183.precision=0,_this183.maxCoinsCount=WavesApp.maxCoinsCount,_this183.invalid=!1,_this183.script="",_this183.isValidScript=!0,_this183.scriptPending=!1,_this183.fee=null,_this183.hasAssetScript=!1,_this183.signable=null,_this183.buyParams=void 0,_this183.showBuyFiatModal=!1,_this183.generateBtnClicked=!1,_this183._scriptValidationXHR=null,_this183._balance=void 0,_this183.isNFT=!1,_this183.signPending=!1,_this183._listeners=[],_this183.receive(balanceWatcher.change,_this183._onChangeBalance,_assertThisInitialized(_this183)),_this183._setBuyParams(),_this183.observe("precision",_this183._onChangePrecision),_this183.observe("script",_this183._onChangeScript),_this183.observe(["name","count","script","precision","description","issue","hasAssetScript","fee"],_this183.createSignable),_this183.observe(["count","precision","issue"],_this183._setIsNFT),_this183._getFee(),_this183.observe("isNFT",_this183._getFee),_this183.observeOnce("createForm",function(){_this183.receive(utils.observe(_this183.createForm,"$valid"),_this183.createSignable,_assertThisInitialized(_this183))});var signPendingListener=$scope.$on("signPendingChange",function(event,data){_this183.signPending=data});return _this183._listeners.push(signPendingListener),_this183}return _inherits(TokensCtrl,Base),_createClass(TokensCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(TokensCtrl.prototype),"$onDestroy",this).call(this),this._listeners.forEach(function(listener){return listener()})}},{key:"onNameFocus",value:function(focus){this.focusName=!!focus}},{key:"generate",value:function(signable){var _this184=this;return modalManager.showConfirmTx(signable).then(function(){return _this184._reset()})}},{key:"getSignable",value:function(){return this.generateBtnClicked=!0,this.invalid?Promise.reject():(ds.analytics.send({name:"Token Generation Info Show",target:"ui"}),this.signable)}},{key:"createSignable",value:function(){var _this185=this;if(this._verifyName().then(function(res){_this185.nameWarning=res,$scope.$apply()}),!this.name||!this.createForm||!this.createForm.$valid)return this.assetId="",null;var precision=Number(this.precision.toString()),quantity=(this.count||new BigNumber(0)).mul(Math.pow(10,precision)),script=this.hasAssetScript&&this.script?"".concat("base64:").concat(this.script):"",tx=waves.node.transactions.createTransaction({type:SIGN_TYPE.ISSUE,name:this.name,description:this.description,reissuable:this.issue,quantity:quantity,precision:precision,script:script,fee:this.fee});this.signable=ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx}),this.signable.getId().then(function(id){_this185.assetId=id,utils.safeApply($scope)})}},{key:"onShowBuyFiatModal",value:function(){this.showBuyFiatModal=!0}},{key:"_verifyName",value:function(){var _this186=this;return null!=this._findNamePC&&this._findNamePC.abort(),this._findNamePC=new PromiseControl(utils.wait(1e3)),this._findNamePC.then(function(){return utils.assetNameWarning(_this186.name)})}},{key:"_onChangeScript",value:function(){var _this187=this;this._scriptValidationXHR&&(this._scriptValidationXHR.abort(),this.scriptPending=!1);var script=this.script.replace("base64:","");if(!script)return this.isValidScript=!0,this.scriptPending=!1,null;this.isValidScript=!0,this.scriptPending=!0,this._scriptValidationXHR=$.ajax({method:"POST",url:"".concat(ds.config.get("node"),"/utils/script/estimate"),data:script}),this._scriptValidationXHR.then(function(){_this187.isValidScript=!0}).catch(function(){_this187.isValidScript=!1}).always(function(){_this187.scriptPending=!1,$scope.$apply()})}},{key:"_onChangePrecision",value:function(_ref95){var value=_ref95.value;value<=8&&(this.maxCoinsCount=WavesApp.maxCoinsCount.div(Math.pow(10,Number(value||0))))}},{key:"_onChangeBalance",value:function(){this._balance=balanceWatcher.getBalance()[WAVES_ID],this.invalid=!this.fee||!this._balance||this._balance.getTokens().lt(this.fee.getTokens()),$scope.$apply()}},{key:"_reset",value:function(){this.name="",this.description="",this.issue=!0,this.count=new BigNumber(0),this.precision=0,this.maxCoinsCount=WavesApp.maxCoinsCount,this.script="",this.hasAssetScript=!1,this.createForm.$setPristine(),this.createForm.$setUntouched(),$scope.$apply()}},{key:"_setIsNFT",value:function(){var count=this.count,precision=this.precision,issue=this.issue,nftCount=count&&count.eq(1),nftPrecision=0===precision;this.isNFT=!issue&&nftCount&&nftPrecision}},{key:"_getFee",value:function(){var _this188=this;waves.node.getFee({type:SIGN_TYPE.ISSUE,reissue:this.issue,precision:this.precision,quantity:this.count}).then(function(money){_this188.fee=money,_this188._onChangeBalance(),$scope.$apply()})}},{key:"_setBuyParams",value:function(){var _this189=this;Promise.all([ds.gateway.getAcashCryptoAssets(),ds.gateway.getAcashFiatAssets()]).then(function(_ref96){var _ref97=_slicedToArray(_ref96,2),cryptoAssets=_ref97[0],fiatAssets=_ref97[1],wavesAcash=cryptoAssets.find(function(_ref98){return"WAVES"===_ref98.id});fiatAssets.length&&(_this189.buyParams={onClose:function(){return _this189._onCloseBuyModal()},initValues:{fiatAsset:fiatAssets[0],fiatAmount:"",cryptoAsset:wavesAcash,cryptoAmount:"",rate:0,disableCryptoSelect:!0}})}).catch(function(){_this189.buyParams={onClose:function(){return _this189._onCloseBuyModal()}}})}},{key:"_onCloseBuyModal",value:function(){this.showBuyFiatModal=!1,utils.safeApply($scope)}}]),TokensCtrl}())};controller.$inject=["Base","$scope","modalManager","waves","balanceWatcher","user","utils","PromiseControl"],angular.module("app.tokens").controller("TokensCtrl",controller)}(),function(){var controller=function(Base,$timeout,$element,$scope){var analytics=require("data-service").analytics;return new(function(){function Actions(){var _this190;return _classCallCheck(this,Actions),(_this190=_possibleConstructorReturn(this,_getPrototypeOf(Actions).call(this))).placement=void 0,_this190.expanded=!1,_this190.collapseTimer=null,_this190.DROP_DOWN_CLASS="actions__container",_this190.openUp=!1,_this190._handler=function(e){0===$(e.target).closest($element).length&&_this190.close()},_this190.observe("expanded",function(){_this190.expanded?(_this190.analyticsText&&analytics.send({name:_this190.analyticsText,target:"ui"}),$(document).on("mousedown",_this190._handler)):$(document).off("mousedown",_this190._handler)}),_this190}return _inherits(Actions,Base),_createClass(Actions,[{key:"$postLink",value:function(){this.placement="horizontal"===this.placement?"horizontal":"vertical"}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(Actions.prototype),"$onDestroy",this).call(this),$(document).off("mousedown",this._handler)}},{key:"toggleActions",value:function(){var _this191=this;this.expanded=!this.expanded,this.expanded?requestAnimationFrame(function(){var dropDown=$element[0].querySelector(".".concat(_this191.DROP_DOWN_CLASS))||{getBoundingClientRect:function(){return{bottom:0}}};_this191.setActionsOpeningStyle(dropDown),_this191.preventBlink(dropDown)}):this.openUp=!1}},{key:"setActionsOpeningStyle",value:function(dropDown){var _this192=this;setTimeout(function(){var dropDownPosition=dropDown.getBoundingClientRect(),bodyPosition=document.body.getBoundingClientRect();dropDownPosition.bottom>bodyPosition.bottom&&(_this192.openUp=!0,$scope.$digest())},0)}},{key:"preventBlink",value:function(dropDown){dropDown.style.visibility="hidden",setTimeout(function(){dropDown.style.visibility=""},0)}},{key:"onClick",value:function(){var _this193=this;$timeout(function(){_this193.close()},0)}},{key:"onMouseLeave",value:function(){var _this194=this;this.collapseTimer=$timeout(function(){_this194.close()},900)}},{key:"onMouseEnter",value:function(){$timeout.cancel(this.collapseTimer)}},{key:"close",value:function(){this.expanded=!1,this.openUp=!1}}]),Actions}())};controller.$inject=["Base","$timeout","$element","$scope"],angular.module("app.ui").component("wActions",{bindings:{analyticsText:"<",placement:"@"},templateUrl:"modules/ui/directives/actions/actions.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base){return new(function(){function Balance(){var _this195;return _classCallCheck(this,Balance),(_this195=_possibleConstructorReturn(this,_getPrototypeOf(Balance).call(this))).money=null,_this195.tokens=null,_this195.observe("money",_this195._onChangeMoney,{set:function(val){return val||null}}),_this195}return _inherits(Balance,Base),_createClass(Balance,[{key:"_onChangeMoney",value:function(_ref99){var value=_ref99.value;this.tokens=value?value.getTokens():null}}]),Balance}())};controller.$inject=["Base"];angular.module("app.ui").component("wBalance",{template:"<span ".concat(['w-nice-number="$ctrl.tokens"','short-mode="$ctrl.shortMode"','precision="$ctrl.money.asset.precision"'].join(" "),"></span>"),bindings:{money:"<",shortMode:"<"},controller:controller})}(),function(){var controller=function(Base,utils,$scope,user,$state,baseAssetService){var ds=require("data-service"),isEmpty=require("ramda").isEmpty,BigNumber=require("@waves/bignumber").BigNumber,NEUTRINO_ASSET={id:baseAssetService.getBaseAssetId(),ticker:"USDN"},ACASH_NEUTRINO_ASSET={id:"USD",name:"USDN",decimals:6};return new(function(){function BuyFiat(){var _this196;return _classCallCheck(this,BuyFiat),(_this196=_possibleConstructorReturn(this,_getPrototypeOf(BuyFiat).call(this,$scope))).isShowModal=!1,_this196.buyParams=null,_this196.page=null,_this196.value="",_this196.trueValue="",_this196.assetName="USDN",_this196.asset=void 0,_this196.acashCryptoAssets=[],ds.gateway.getAcashCryptoAssets().then(function(assets){_this196.acashCryptoAssets=assets}).catch(function(){return null}),user.clickStakeNowSignal.on(function(_ref100){var _stateValues$cryptoAs,stateValues=_ref100.stateValues;_this196.assetName=null==stateValues?void 0:null===(_stateValues$cryptoAs=stateValues.cryptoAsset)||void 0===_stateValues$cryptoAs?void 0:_stateValues$cryptoAs.name,$scope.$digest()}),_this196}return _inherits(BuyFiat,Base),_createClass(BuyFiat,[{key:"$postLink",value:function(){this.asset=this.asset||NEUTRINO_ASSET;var buyOptions=user.buyOptions;this.isHidden()&&user.isAuthorised&&buyOptions&&buyOptions.cryptoAsset&&buyOptions.isRedirectedForOpenBuyModal?(this.trueValue=buyOptions.buyInit||"",this.buy()):user.buyOptions={}}},{key:"onChange",value:function(){this.value=this.value.replace(/[^!\d]/g,""),this.trueValue=parseInt(this.value,10)}},{key:"buyFiat",value:function(e){var _this197=this;if(e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation(),!user.buyOptions||isEmpty(user.buyOptions)){var acashAsset=this.acashCryptoAssets.find(function(asset){return asset.id===_this197.asset.ticker})||ACASH_NEUTRINO_ASSET;user.buyOptions={cryptoAsset:acashAsset}}this._sendAnalytics(),user.isAuthorised?this.buy():this._redirect()}},{key:"buy",value:function(){var _this198=this;"main.wallet.assets"===$state.current.name&&(user.buyOptions.disableCryptoSelect=!0);var id=baseAssetService.getIdByTicker(user.buyOptions.cryptoAsset.id)||NEUTRINO_ASSET.id;Promise.all([ds.dataManager.matcherService.getBalances(),ds.api.assets.get(["WAVES",id])]).then(function(_ref101){var _ref102=_slicedToArray(_ref101,2),balances=_ref102[0],_ref102$=_slicedToArray(_ref102[1],2),wavesAsset=_ref102$[0],fiatAsset=_ref102$[1],wavesBalance=balances.find(function(balance){return"WAVES"===balance.asset.id}),fiatBalance=balances.find(function(balance){return balance.asset.id===id});_this198.buyParams={wavesBalance:wavesBalance,fiatBalance:fiatBalance,fiatId:_this198.fiatId,wavesAsset:wavesAsset,initValue:_this198._getInitValue(),fiatAsset:fiatAsset,onClose:function(){return _this198.onClose()},initValues:user.buyOptions},$scope.buyParams=_this198.buyParams,_this198.isShowModal=!0,utils.safeApply($scope)})}},{key:"onClose",value:function(){this.isShowModal=!1,user.buyOptions=null,utils.safeApply($scope)}},{key:"isExtended",value:function(){return!!this.extended&&!this.isHidden()}},{key:"isButton",value:function(){return!this.extended&&!this.hidden}},{key:"isHidden",value:function(){return!!this.hidden}},{key:"_getInitValue",value:function(){return this.isExtended()&&this.trueValue||""}},{key:"_sendAnalytics",value:function(){var assetLabel=user.buyOptions.cryptoAsset.name||"";if("welcome"===$state.current.name){var _user$buyOptions=user.buyOptions,fiatAsset=_user$buyOptions.fiatAsset,fiatAmount=_user$buyOptions.fiatAmount;ds.protoApi.getAssetsExchangeRate({senderAsset:fiatAsset.id,recipientAsset:"USD",senderAssetAmount:Number(fiatAmount)||0,paymentSystem:"ACASH"}).then(function(_ref103){var rate=_ref103.rate;ds.analytics.buyCrypto.landingMainBuyClick(user.buyOptions.fiatAsset.id,new BigNumber(fiatAmount||0).mul(rate).toString(),{buyCurrency:assetLabel})})}else{var assetName=this.asset?this.asset.ticker||this.asset.id:assetLabel;ds.analytics.buyCrypto.openBuyDialog(assetName)}}},{key:"_redirect",value:function(){var currentState=$state.current.name,cryptoId=user.buyOptions.cryptoAsset.id;"welcome"===currentState&&cryptoId===ACASH_NEUTRINO_ASSET.id||"staking"===currentState?(user.buyOptions.disableCryptoSelect=!0,user.forceInitRouteState("staking")):user.forceInitRouteState("main.wallet"),user.getMultiAccountData().then(function(data){$state.go(data?"signIn":"signUp")}),user.buyOptions.isRedirectedForOpenBuyModal=!0}}]),BuyFiat}())};controller.$inject=["Base","utils","$scope","user","$state","baseAssetService"],angular.module("app.ui").component("wBuyFiat",{bindings:{fiatId:"<",type:"<",page:"<",extended:"<",hidden:"<",asset:"<"},controller:controller,templateUrl:"modules/ui/directives/buyFiat/buyFiat.html"})}(),function(){var controller=function(Base,$scope,utils,baseAssetService){return new(function(){function BuyLira(){var _getPrototypeOf4,_this199;_classCallCheck(this,BuyLira);for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];return(_this199=_possibleConstructorReturn(this,(_getPrototypeOf4=_getPrototypeOf(BuyLira)).call.apply(_getPrototypeOf4,[this].concat(args)))).isShownModal=!1,_this199}return _inherits(BuyLira,Base),_createClass(BuyLira,[{key:"$postLink",value:function(){var _this200=this,liraLogo=baseAssetService.getDefaultAssetsIconMap()[this.asset.id];this.liraModalProps={asset:this.asset,onClose:function(){return _this200.onClose()},liraLogo:liraLogo},$scope.liraModalProps=this.liraModalProps}},{key:"showModalLira",value:function(){this.isShownModal=!0,utils.safeApply($scope)}},{key:"onClose",value:function(){this.isShownModal=!1,utils.safeApply($scope)}}]),BuyLira}())};controller.$inject=["Base","$scope","utils","baseAssetService"],angular.module("app.ui").component("wBuyLira",{bindings:{asset:"<"},controller:controller,templateUrl:"modules/ui/directives/buyLira/buyLira.html"})}(),function(){var ds=require("data-service"),Money=require("@waves/data-entities").Money,controller=function(Base,waves,$scope,user){return new(function(){function FeeList(){var _this201;return _classCallCheck(this,FeeList),(_this201=_possibleConstructorReturn(this,_getPrototypeOf(FeeList).call(this))).tx=null,_this201.fee=null,_this201.feeList=[],_this201.balanceHash=null,_this201.sendFee=!1,$scope.$watch("$ctrl.tx",function(){return _this201._onChangeTx()},!0),_this201.observe("balanceHash",_this201._onChangeBalanceHash),_this201}return _inherits(FeeList,Base),_createClass(FeeList,[{key:"$postLink",value:function(){var _this202=this;this.fee?this.observe("fee",this._onChangeFee):function setFeeObserver(){_this202.observeOnce("fee",function(){_this202.fee?_this202.observe("fee",_this202._onChangeFee):setFeeObserver()})}()}},{key:"_onChangeTx",value:function(){var _this203=this;if(!this.tx)return null;this._getFilledTx(this.tx).then(function(filledTx){ds.api.fee.getFeeListByTx({tx:filledTx,userPublicKey:user.publicKey,hasScript:user.hasScript()}).then(function(list){_this203.originalFeeList=list,_this203._setActualFeeList();if(_this203.fee&&list.some(function(item){return function(money1,money2){return function(asset1,asset2){return asset1.id===asset2.id}(money1.asset,money2.asset)&&money1.eq(money2)}(item,_this203.fee)})||(_this203.fee=null),!_this203.fee||!list.find(function(item){return item.asset.id===_this203.fee.asset.id})){var fee=_this203.balanceHash&&Object.keys(_this203.balanceHash).length&&_this203.feeList.find(function(item){var balance=_this203.balanceHash[item.asset.id];return balance&&balance.gte(item)});_this203.fee=fee||_this203.feeList[0]}!_this203.sendFee&&_this203.fee&&_this203.fee.asset.id!==_this203.feeList[0].asset.id&&(_this203.sendFee=!0),$scope.$apply()}).catch(function(){return null})})}},{key:"onChangeFeeCheckbox",value:function(){this.sendFee&&(this.fee=this.feeList[0]),this.onToggleShow&&this.onToggleShow({isOpen:!this.sendFee})}},{key:"_onChangeBalanceHash",value:function(){var _this204=this;if(!this.fee)return null;if(this._setActualFeeList(),1===this.feeList.length)return null;var feeBalance=this.balanceHash[this.fee.asset.id];feeBalance&&!feeBalance.lt(this.fee)||(this.fee=this.balanceHash&&Object.keys(this.balanceHash).length&&this.feeList.find(function(item){var balance=_this204.balanceHash[item.asset.id];return balance&&balance.gte(item)})||this.fee)}},{key:"_setActualFeeList",value:function(argument_0){var _this205=this,list=0<arguments.length&&void 0!==argument_0?argument_0:this.originalFeeList,hasBalances=this.balanceHash&&Object.keys(this.balanceHash).length;if(!list||list.length<2||!hasBalances)return this.feeList=_toConsumableArray(list||[]),null;var wavesFee=list.find(function(item){return"WAVES"===item.asset.id}),filteredList=list.filter(function(fee){var feeBalance=_this205.balanceHash[fee.asset.id],canUseOwnFee=user.address!==fee.asset.sender||_this205.balanceHash.WAVES.gte(wavesFee);return hasBalances&&feeBalance&&feeBalance.gte(fee)&&canUseOwnFee});filteredList.length||filteredList.push(wavesFee),this.feeList=filteredList}},{key:"_onChangeFee",value:function(){this.onChange&&this.onChange({feeMoney:this.fee})}},{key:"_getFilledTx",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,recipient:tx.recipient||user.address,amount:tx.amount||new Money(1,asset),fee:tx.fee||new Money(1,asset),attachment:tx.attachment instanceof Uint8Array?Array.from(tx.attachment):String(tx.attachment),senderPublicKey:tx.senderPublicKey||user.publicKey,assetId:tx.assetId||asset.id}})}}]),FeeList}())};controller.$inject=["Base","waves","$scope","user"],angular.module("app.ui").component("wFeeList",{bindings:{tx:"<",balanceHash:"<",disabled:"<",fee:"=",onToggleShow:"&",onChange:"&"},scope:!1,transclude:!1,templateUrl:"modules/ui/directives/feeList/feeList.html",controller:controller})}(),function(){var controller=function(Base){return new(function(){function RadioWrap(){var _this206;return _classCallCheck(this,RadioWrap),(_this206=_possibleConstructorReturn(this,_getPrototypeOf(RadioWrap).call(this))).children=[],_this206.name="name-".concat(Math.random(),"-").concat(Date.now()),_this206.observe("value",function(){_this206.children.forEach(function(item){return item.init()})}),_this206}return _inherits(RadioWrap,Base),_createClass(RadioWrap,[{key:"addRadio",value:function(item){item.name=this.name,this.children.push(item)}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(newValue){this.value=newValue}}]),RadioWrap}())};controller.$inject=["Base"],angular.module("app.ui").component("wRadioWrap",{bindings:{value:"=ngModel"},transclude:!0,template:'<div ng-transclude class="btn-wrap btn-group"></div>',controller:controller})}(),function(){var controller=function(Base,$element){return new(function(){function Step(){var _this207;return _classCallCheck(this,Step),(_this207=_possibleConstructorReturn(this,_getPrototypeOf(Step).call(this))).id=null,_this207.list=null,_this207.state=!1,_this207}return _inherits(Step,Base),_createClass(Step,[{key:"$postLink",value:function(){this.list.registerStep(this),$element.attr("step",this.id)}},{key:"displayToggle",value:function(state){this.state=state}}]),Step}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wStep",{bindings:{id:"@stepId"},require:{list:"^wStepByStep"},template:'<div ng-if="$ctrl.state" ng-transclude></div>',transclude:!0,controller:controller})}(),function(){var controller=function(Base,$scope,$element,$document,i18n,utils,$templateRequest,$compile){return new(function(){function Tooltip(){var _this208;return _classCallCheck(this,Tooltip),(_this208=_possibleConstructorReturn(this,_getPrototypeOf(Tooltip).call(this,$scope)))._hasMouseEvent=!1,void 0===$scope.tipOffset&&($scope.tipOffset=0),_this208.receive(utils.observe($scope,"isShow"),_this208._onChangeShow,_assertThisInitialized(_this208)),_this208._onChangeShow(),_this208}return _inherits(Tooltip,Base),_createClass(Tooltip,[{key:"_render",value:function(){var _this209=this;$templateRequest("modules/ui/directives/tooltip/tooltip.html").then(function(template){_this209.$tooltip=$compile(template)($scope),_this209.$tooltip.find(".js-tooltip-content").append($compile($scope.tipContent)($scope.$parent)),_this209.listenEventEmitter($element,"mouseenter",function(){return _this209._onHover()}),_this209.listenEventEmitter($element,"mouseleave",function(){return _this209._onLeave()})}),this._hasMouseEvent=!0}},{key:"_onHover",value:function(){$document.find("body").append(this.$tooltip),this.$tooltip.css(Tooltip._getPosition()),$scope.$parent.$digest()}},{key:"_onLeave",value:function(){this.$tooltip.remove()}},{key:"_onChangeShow",value:function(){$scope.isShow&&!this._hasMouseEvent&&this._render()}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(Tooltip.prototype),"$onDestroy",this).call(this),this.$tooltip&&this.$tooltip.remove()}}],[{key:"_getPosition",value:function(){var _$element$0$getBoundi=$element[0].getBoundingClientRect(),elementWidth=_$element$0$getBoundi.width,elementHeight=_$element$0$getBoundi.height,elemLeft=_$element$0$getBoundi.left,elemTop=_$element$0$getBoundi.top,centerLeft=elemLeft+elementWidth/2,centerTop=elemTop+elementHeight/2;switch($scope.direction){case"top":return{left:centerLeft,top:elemTop-$scope.tipOffset-5};case"bottom":return{left:centerLeft,top:elemTop+elementHeight+$scope.tipOffset+5};case"left":return{left:elemLeft-$scope.tipOffset-5,top:centerTop};case"right":return{left:elemLeft+elementWidth+$scope.tipOffset+5,top:centerTop};default:return{left:centerLeft,top:elemTop-$scope.tipOffset-5}}}}]),Tooltip}())};controller.$inject=["Base","$scope","$element","$document","i18n","utils","$templateRequest","$compile"],angular.module("app").directive("wTooltip",function(){return{restrict:"AE",scope:{direction:"<",tipContent:"<",tipOffset:"<",isShow:"<"},controller:controller}})}(),function(){var directive=function(Base,visibleService){return{restrict:"E",replace:!0,template:'<div class="w-visible"></div>',transclude:!0,scope:!1,link:function($scope,$element,$attrs,$ctrl,$transclude){var once=""===$attrs.once||"true"===$attrs.once,root=$attrs.scrollRootSelector;new(function(){function Visible(){var _this210;_classCallCheck(this,Visible),(_this210=_possibleConstructorReturn(this,_getPrototypeOf(Visible).call(this,$scope))).$node=$element,_this210.content=null,_this210.node=$element.get(0),_this210.visible=!1,_this210._appendPromise=null;var $scrollRootElement=root?$element.closest(root):$element.parent();return visibleService.registerVisibleComponent(_assertThisInitialized(_this210),$scrollRootElement),_this210.observe("visible",_this210._onChangeVisible),_this210.signals.destroy.once(function(){_this210.content&&(_this210.content.$scope.$destroy(),_this210.content.$element.remove(),_this210.content=null),_this210.$node.remove()}),_this210}return _inherits(Visible,Base),_createClass(Visible,[{key:"currentVisibleState",value:function(){var rect=this.node.getBoundingClientRect(),visible=0<rect.top&&rect.top<innerHeight;return this.visible=visible}},{key:"_onChangeVisible",value:function(){var _this211=this;if(this._appendPromise)return this._appendPromise.then(function(){return _this211._onChangeVisible()}),null;this.visible?(this._appendPromise=this._append().then(function(){_this211._appendPromise=null}),once&&visibleService.unregisterVisibleComponent(this)):(this.content.$element.remove(),this.content.$scope.$destroy())}},{key:"_append",value:function(){var _this212=this;return new Promise(function(resolve){$transclude(function($element,$scope){_this212.$node.append($element),_this212.content={$element:$element,$scope:$scope},resolve()})})}}]),Visible}())}}};directive.$inject=["Base","visibleService"],angular.module("app.ui").directive("wVisible",directive)}(),angular.module("app.ui").component("wWebOnly",{scope:!1,transclude:!0,template:'<div ng-if="::'.concat(WavesApp.isWeb(),'" ng-transclude></div>')}),function(){var factory=function(configService){var Signal=require("ts-utils").Signal;return new(function(){function PermissionManager(){_classCallCheck(this,PermissionManager),this.change=new Signal,this._permissions=Object.create(null),this._permissions=configService.get("PERMISSIONS")||Object.create(null),configService.change.on(this._onChangeConfig,this)}return _createClass(PermissionManager,[{key:"isPermitted",value:function(name){var permission=this._permissions[name];return null==permission||permission}},{key:"_onChangeConfig",value:function(path){if(!path.includes("PERMISSIONS"))return null;var permissions=configService.get("PERMISSIONS")||Object.create(null);this._permissions=PermissionManager._parsePermissions(permissions),this.change.dispatch()}}],[{key:"_parsePermissions",value:function(raw){return Object.keys(raw).reduce(function(acc,key){return"boolean"==typeof raw[key]?acc[key]=raw[key]:raw[key]instanceof Array&&raw[key].forEach(function(item){acc["".concat(key,".").concat(item)]=!0}),acc},{})}}]),PermissionManager}())};factory.$inject=["configService"],angular.module("app.ui").factory("permissionManager",factory)}(),function(){var factory=function(){return function(){function PromiseControl(promise){_classCallCheck(this,PromiseControl),this.id=null,this._resolveCallbacks=[],this._rejectCallbacks=[],this._data=null,this._state=null,this._dropped=!1,(this._promise=promise).then(this._getPromiseCallback(!0),this._getPromiseCallback(!1))}return _createClass(PromiseControl,[{key:"promise",value:function(){return this._promise}},{key:"abort",value:function(error){this._getPromiseCallback(!1)(error)}},{key:"then",value:function(resolve,reject){var _this213=this;return new PromiseControl(new Promise(function(res,rej){_this213._resolveCallbacks.push(function(data){var result=resolve?resolve(data):data;PromiseControl.isPromise(result)?result.then(res,rej):res(result)}),_this213._rejectCallbacks.push(function(data){var result=reject?reject(data):data;PromiseControl.isPromise(result)?result.then(res,rej):rej(result)})}))}},{key:"always",value:function(cb){return this.then(cb,cb),this}},{key:"catch",value:function(callback){return this.then(null,callback)}},{key:"drop",value:function(){this._removeHandlers(),this._dropped=!0}},{key:"_getPromiseCallback",value:function(state){var _this214=this;return function(data){null===_this214._state&&(_this214._data=data,_this214._state=state,_this214._run())}}},{key:"_run",value:function(){var _this215=this;if(this._dropped||null===this._state)return null;var list=(this._state?this._resolveCallbacks:this._rejectCallbacks).slice();this._removeHandlers(),list.forEach(function(cb){return cb(_this215._data)})}},{key:"_removeHandlers",value:function(){this._rejectCallbacks=[],this._rejectCallbacks=[]}}],[{key:"isPromise",value:function(some){return some&&some.then&&"function"==typeof some.then}}]),PromiseControl}()};factory.$inject=[],angular.module("app.utils").factory("PromiseControl",factory)}(),function(){var factory=function(){return function(){function UserRouteState(base,name,child){_classCallCheck(this,UserRouteState),this.base=base,this.name=name,this.child=child}return _createClass(UserRouteState,[{key:"state",get:function(){var base="".concat(this.base,".").concat(this.name);return this.child?"".concat(base,".").concat(this.child):base}}]),_createClass(UserRouteState,[{key:"applyState",value:function(state,user){return!!this._hitTest(state.name)&&(this.child=state.name.split(".")[2],user.setSetting("".concat(this.name,".activeState"),this.child),!0)}},{key:"_hitTest",value:function(stateName){var _stateName$split2=_slicedToArray(stateName.split("."),2),base=_stateName$split2[0],name=_stateName$split2[1];return base===this.base&&name===this.name}}]),UserRouteState}()};factory.$inject=[],angular.module("app.utils").factory("UserRouteState",factory)}(),function(){var DEFAULT_SYMBOL_INFO={session:"24x7",exchange:"DEX",listed_exchange:"DEX",timezone:"Europe/London",minmov:1,has_intraday:!0,supported_resolutions:WavesApp.dex.resolutions,has_seconds:!1,has_daily:!0,has_weekly_and_monthly:!0,has_empty_bars:!0,force_session_rebuild:!1,has_no_volume:!1,data_status:"pulsed"},factory=function(waves,decorators){var _dec9,_class6;return new(_dec9=decorators.cachable(1440),_applyDecoratedDescriptor((_class6=function(){function SymbolInfoService(){_classCallCheck(this,SymbolInfoService)}return _createClass(SymbolInfoService,[{key:"get",value:function(symbolName){var _symbolName$split2=_slicedToArray(symbolName.split("/"),2),partOne=_symbolName$split2[0],partTwo=_symbolName$split2[1];return partOne&&partTwo?this._createSymbolInfo(partOne,partTwo):Promise.reject()}},{key:"_createSymbolInfo",value:function(assetOneId,assetTwoId){return ds.api.pairs.get(assetOneId,assetTwoId).then(function(pair){var amount=pair.amountAsset,price=pair.priceAsset;return Promise.all([waves.node.assets.getAsset(amount.id),waves.node.assets.getAsset(price.id)]).then(function(_ref104){var _ref105=_slicedToArray(_ref104,2),amountInfo=_ref105[0],priceInfo=_ref105[1],amountName=amountInfo.ticker?amountInfo.ticker:amountInfo.name,priceName=priceInfo.ticker?priceInfo.ticker:priceInfo.name,ticker="".concat(amountInfo.id,"/").concat(priceInfo.id),symbolName="".concat(amountName,"/").concat(priceName);return _objectSpread({},DEFAULT_SYMBOL_INFO,{pricescale:Math.pow(10,price.precision),volume_precision:amount.precision,description:symbolName,name:symbolName,ticker:ticker,_wavesData:{amountAsset:amountInfo,priceAsset:priceInfo}})})})}}]),SymbolInfoService}()).prototype,"_createSymbolInfo",[_dec9],Object.getOwnPropertyDescriptor(_class6.prototype,"_createSymbolInfo"),_class6.prototype),_class6)};factory.$inject=["waves","decorators"],angular.module("app.dex").factory("symbolInfoService",factory)}(),function(){var factory=function(BaseClassComponent,Poll,modalManager,eventManager,Base){var pollComponents=Object.create(null),tsUtils=require("ts-utils");return function(){function PollComponent(parent){var _this216;return _classCallCheck(this,PollComponent),(_this216=_possibleConstructorReturn(this,_getPrototypeOf(PollComponent).call(this,parent)))._polls=Object.create(null),_this216.receive(modalManager.openModal,_this216._onOpenModal,_assertThisInitialized(_this216)),_this216}return _inherits(PollComponent,BaseClassComponent),_createClass(PollComponent,[{key:"createPoll",value:function(getter,setter,time,options){var _this217=this;"string"==typeof setter?setter=PollComponent._getSetterHandler(setter,this.parent,options):setter=PollComponent._wrapSetterHandler(setter,this.parent,options);var poll=new Poll(getter.bind(this.parent),setter,time);return this._polls[poll.id]=poll,options&&options.isBalance&&this.receive(eventManager.signals.changeBalanceEvent,function(){return poll.restart()}),this.receiveOnce(poll.signals.destroy,function(){delete _this217._polls[poll.id]}),poll}},{key:"remove",value:function(){_get(_getPrototypeOf(PollComponent.prototype),"remove",this).call(this),delete pollComponents[this.parent.cid],tsUtils.each(this._polls,function(poll){poll&&poll.destroy()})}},{key:"_onOpenModal",value:function(modal){tsUtils.each(this._polls,function(poll){poll.pause(modal)})}}],[{key:"create",value:function(base,getter,setter,time,options){if(!(base instanceof Base))throw new Error("Component must be an instance of Base");if(base.wasDestroed)return null;var poll=PollComponent._getPoll(base).createPoll(getter,setter,time,options);return base.signals.logout.once(poll.destroy,poll),poll}},{key:"_getSetterHandler",value:function(path,parent,options){return options&&options.$scope?function(data){tsUtils.set(parent,path,data),options.$scope.$apply()}:function(data){tsUtils.set(parent,path,data)}}},{key:"_wrapSetterHandler",value:function(handler,parent,options){return options&&options.$scope?function(data){handler.call(parent,data),options.$scope.$apply()}:handler.bind(parent)}},{key:"_getPoll",value:function(base){if(pollComponents[base.cid])return pollComponents[base.cid];var poll=new PollComponent(base);return pollComponents[base.cid]=poll}}]),PollComponent}().create};factory.$inject=["BaseClassComponent","Poll","modalManager","eventManager","Base"],angular.module("app.utils").factory("createPoll",factory)}(),angular.module("app.wallet.leasing",[]),function(){var rc=require("react-components"),controller=function(reactDirective,$state,configService,user,modalManager){return reactDirective(rc.BuyBTC,void 0,void 0,{$state:$state,configService:configService,user:user,modalManager:modalManager})};controller.$inject=["reactDirective","$state","configService","user","modalManager"],angular.module("app.buyBTC").directive("wBuyBtc",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function BuyUsdnCtrl(){var _this218;return _classCallCheck(this,BuyUsdnCtrl),(_this218=_possibleConstructorReturn(this,_getPrototypeOf(BuyUsdnCtrl).call(this,$scope))).isLogined=!!user.address,_this218}return _inherits(BuyUsdnCtrl,Base),BuyUsdnCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.buyUsdn").controller("BuyUsdnCtrl",controller)}(),function(){var factory=function(Base,$q){return function(){function SeedBase($container){var _this219;return _classCallCheck(this,SeedBase),(_this219=_possibleConstructorReturn(this,_getPrototypeOf(SeedBase).call(this))).$root=$container,_this219.seed=null,_this219.parts=null,_this219}return _inherits(SeedBase,Base),_createClass(SeedBase,[{key:"$postLink",value:function(){if(!this.seed)throw new Error("Has no seed!");this.parts=this.seed.split(/\s/)}},{key:"animate",value:function($element,properties,options){return $q(function(resolve){if((options=options||{duration:100}).duration||(options.duration=100),options.complete){var origin=options.complete;options.complete=function(){resolve(),origin()}}else options.complete=resolve;$element.stop(!0,!0).animate(properties,options)})}},{key:"createClone",value:function($forClone){var $clone=$forClone.clone().removeClass("write").removeClass("full").removeClass("moved").addClass("read"),offset=$forClone.offset();return this.$root.append($clone),$clone.addClass("clone"),$clone.css({position:"absolute",margin:"0"}),$clone.offset(offset),$forClone.addClass("moved"),$clone}},{key:"animateOut",value:function($element){return this.animate($element,{opacity:0},{progress:function(tween,_progress2){$element.css("transform","scale(".concat(1-_progress2,")"))}})}},{key:"animateIn",value:function($element){return $element.css("opacity",0),this.animate($element,{opacity:1},{progress:function(tween,_progress3){$element.css("transform","scale(".concat(_progress3,")"))}})}}]),SeedBase}()};factory.$inject=["Base","$q"],angular.module("app.create").factory("SeedBase",factory)}(),function(){var AVAILABLE_TYPES=["read","random"],controller=function(SeedBase,seedService,$element,user,utils){return new(function(){function Seed(){var _this220;return _classCallCheck(this,Seed),(_this220=_possibleConstructorReturn(this,_getPrototypeOf(Seed).call(this,$element))).type=null,_this220}return _inherits(Seed,SeedBase),_createClass(Seed,[{key:"$postLink",value:function(){if(_get(_getPrototypeOf(Seed.prototype),"$postLink",this).call(this),!AVAILABLE_TYPES.includes(this.type))throw new Error("Wrong type!");this._initialize()}},{key:"downloadSeed",value:function(){utils.downloadFile("".concat(user.name,".txt"),this.seed)}},{key:"_initialize",value:function(){"random"===this.type&&(this._mixSeed(),this.receive(seedService.revert,this._revert,this))}},{key:"_revert",value:function(index){var $target=$element.find(".seed-item").eq(index),$clone=this.createClone($target);this.animateIn($clone).then(function(){$target.removeClass("moved"),$clone.remove()})}},{key:"_onClick",value:function(e,index){var $target=$(e.target);if($target.hasClass("moved"))return null;var word=$target.text().trim(),$clone=this.createClone($target);this.animateOut($clone).then(function(){$clone.remove(),seedService.pick.dispatch({index:index,word:word})})}},{key:"_mixSeed",value:function(){for(var i=0;i<100;i++)this.parts.sort(function(){var num=Math.random();return num<.33?-1:.66<num?1:0})}}]),Seed}())};controller.$inject=["SeedBase","seedService","$element","user","utils"],angular.module("app.create").component("wSeedRead",{bindings:{type:"@",seed:"@"},controller:controller,templateUrl:"modules/create/directives/seed/seed.html"})}(),function(){var controller=function(Base,$scope,user){return new(function(){function DefoFaqCtrl(){var _this221;return _classCallCheck(this,DefoFaqCtrl),(_this221=_possibleConstructorReturn(this,_getPrototypeOf(DefoFaqCtrl).call(this,$scope))).isLogined=!!user.address,_this221}return _inherits(DefoFaqCtrl,Base),DefoFaqCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.defoFaq").controller("DefoFaqCtrl",controller)}(),function(){var controller=function(modalManager,$state,Base,storage){return new(function(){function DesktopCtrl(){var _this222;return _classCallCheck(this,DesktopCtrl),(_this222=_possibleConstructorReturn(this,_getPrototypeOf(DesktopCtrl).call(this))).openClientMode=null,storage.load("openClientMode").then(function(mode){_this222.openClientMode=mode}),_this222}return _inherits(DesktopCtrl,Base),_createClass(DesktopCtrl,[{key:"openLinkViaDesktop",get:function(){return"desktop"===this.openClientMode},set:function(value){this.openClientMode=value?"desktop":null,storage.save("openClientMode",this.openClientMode)}}]),_createClass(DesktopCtrl,[{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"openMainPage",value:function(){return $state.go("welcome")}}]),DesktopCtrl}())};controller.$inject=["modalManager","$state","Base","storage"],angular.module("app.desktop").controller("DesktopCtrl",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state){return reactDirective(rc.Faq,void 0,void 0,{$state:$state})};controller.$inject=["reactDirective","$state"],angular.module("app.faq").directive("wReactFaq",controller)}(),function(){var controller=function($state,user){return new(function(){function MigrateCtrl(){_classCallCheck(this,MigrateCtrl)}return _createClass(MigrateCtrl,[{key:"finish",value:function(firstUser){user.login(firstUser).then(function(){$state.go(user.goToActiveState())})}}]),MigrateCtrl}())};controller.$inject=["$state","user"],angular.module("app.migrate").controller("MigrateCtrl",controller)}(),function(){var ds=require("data-service"),analytics=ds.analytics,_require46=require("@waves/waves-transactions"),validators=_require46.validators,libs=_require46.libs,isPublicKey=validators.isPublicKey,_libs$crypto4=libs.crypto,address=_libs$crypto4.address,publicKey=_libs$crypto4.publicKey,base58Decode=_libs$crypto4.base58Decode,TABS={seed:"seed",encodedSeed:"encodedSeed",key:"key"},controller=function(Base,$scope,$state,user,utils,modalManager){return new(function(){function RestoreCtrl(){var _this223;return _classCallCheck(this,RestoreCtrl),_this223=_possibleConstructorReturn(this,_getPrototypeOf(RestoreCtrl).call(this,$scope)),$scope.TABS=TABS,_this223.seedForm=null,_this223.encodedSeedForm=null,_this223.keyForm=null,_this223.seed="",_this223.encodedSeed="",_this223.key="",_this223.address="",_this223.name="",_this223.saveUserData=!0,_this223.activeStep=0,_this223.tabs=Object.values(TABS),_this223.activeTab=TABS.seed,_this223.isPriorityUserTypeExists=!1,_this223.userExisted=Object.create(null),_this223._usersInStorage=[],_this223._priorityMap=utils.getImportPriorityMap(),Promise.all([user.getFilteredUserList(),user.getMultiAccountUsers()]).then(function(_ref106){var _ref107=_slicedToArray(_ref106,2),_ref107$=_ref107[0],legacyUsers=void 0===_ref107$?[]:_ref107$,_ref107$2=_ref107[1],users=void 0===_ref107$2?[]:_ref107$2;_this223._usersInStorage=[].concat(_toConsumableArray(legacyUsers),_toConsumableArray(users))}),_this223._setFormObservers(),_this223.observe("address",_this223._onChangeAddress),_this223.observe("activeTab",_this223._onChangeActiveTab),_this223}return _inherits(RestoreCtrl,Base),_createClass(RestoreCtrl,[{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"restore",value:function(){var _this224=this;this.saveUserData&&analytics.send({name:"Import Backup Protect Your Account Continue Click",target:"ui"});var _this$_getEncryptedAn=this._getEncryptedAndType(),keyOrSeed=_this$_getEncryptedAn.keyOrSeed,newUser=_objectSpread({userType:_this$_getEncryptedAn.type,name:this.name,networkByte:ds.config.get("code").charCodeAt(0)},keyOrSeed);return user.create(newUser,!0,!0).then(function(){analytics.user.createAddressSuccess(RestoreCtrl._getRestoreLabel(_this224.activeTab)),$state.go(user.goToActiveState())})}},{key:"resetNameAndPassword",value:function(){this.name="",this.password=""}},{key:"nextStep",value:function(){if(analytics.send({name:"Import Backup Continue Click",params:{guestMode:!this.saveUserData},target:"ui"}),!this.saveUserData)return this.restore();this.activeStep++,analytics.send({name:"Import Backup Protect Your Account Show",target:"ui"})}},{key:"importAccounts",value:function(){return modalManager.showImportAccountsModal()}},{key:"setActiveTab",value:function(tab){this.activeTab=tab}},{key:"_setFormObservers",value:function(){var _this225=this;this.observe("seed",this._onChangeSeed),this.observeOnce("seedForm",function(){_this225.receive(utils.observe(_this225.seedForm,"$valid"),function(){_this225.activeTab===TABS.seed&&_this225._onChangeSeed()})}),this.observe("encodedSeed",this._onChangeEncodedSeed),this.observeOnce("encodedSeedForm",function(){_this225.receive(utils.observe(_this225.encodedSeedForm,"$valid"),function(){_this225.activeTab===TABS.encodedSeed&&_this225._onChangeEncodedSeed()})}),this.observe("key",this._onChangeKey),this.observeOnce("keyForm",function(){_this225.receive(utils.observe(_this225.keyForm,"$valid"),function(){_this225.activeTab===TABS.key&&_this225._onChangeKey()})})}},{key:"_onChangeSeed",value:function(){this.seedForm.$valid?this.address=new ds.Seed(this.seed,ds.config.get("code")).address:this.address=""}},{key:"_onChangeEncodedSeed",value:function(){if(this.encodedSeedForm.$valid&&RestoreCtrl._isEncoded(this.encodedSeed))try{this.address=new ds.Seed(base58Decode(this.encodedSeed),ds.config.get("code")).address}catch(e){this.address=""}else this.address=""}},{key:"_onChangeAddress",value:function(){var _this226=this;this.userExisted=this._usersInStorage.find(function(user){return user.address===_this226.address})||null,this.isPriorityUserTypeExists=!!this.userExisted&&this._priorityMap[this.activeTab]<=this._priorityMap[this.userExisted.userType]}},{key:"_onChangeKey",value:function(){if(this.keyForm.$valid&&isPublicKey(this.key)){var pubKey=publicKey({privateKey:this.key});this.address=address({publicKey:pubKey},ds.config.get("code"))}else this.address=""}},{key:"_onChangeActiveTab",value:function(){var tab=this.activeTab[0].toUpperCase()+this.activeTab.substring(1);this["_onChange".concat(tab)]()}},{key:"_getEncryptedAndType",value:function(){switch(this.activeTab){case TABS.key:return{keyOrSeed:{privateKey:this.key},type:"privateKey"};case TABS.encodedSeed:return{keyOrSeed:{seed:"base58:".concat(this.encodedSeed),publicKey:publicKey(base58Decode(this.encodedSeed))},type:"seed"};default:return{keyOrSeed:{seed:this.seed},type:"seed"}}}}],[{key:"_isEncoded",value:function(seed){try{return!!base58Decode(seed)}catch(e){return!1}}},{key:"_getRestoreLabel",value:function(type){switch(type){case"key":return"private";case"encodedSeed":return"encoded";default:return"seed"}}}]),RestoreCtrl}())};controller.$inject=["Base","$scope","$state","user","utils","modalManager"],angular.module("app.restore").controller("RestoreCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function StakingCtrl(){var _this227;return _classCallCheck(this,StakingCtrl),(_this227=_possibleConstructorReturn(this,_getPrototypeOf(StakingCtrl).call(this,$scope))).isLogined=!!user.address,_this227}return _inherits(StakingCtrl,Base),StakingCtrl}())};controller.$inject=["Base","$scope","user","$state"],angular.module("app.staking").controller("StakingCtrl",controller)}(),function(){var controller=function($element,$timeout,carouselManager,utils,Base,$scope,ChartFactory){var last=require("ramda").last,chartOptions={red:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#e5494d",fillColor:"#292f3c",gradientColor:["#e5494d","#292f3c"],lineWidth:4}}},blue:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#5a81ea",fillColor:"#292f3c",gradientColor:["#5a81ea","#292f3c"],lineWidth:4}}}};return new(function(){function Carousel(){var _getPrototypeOf5,_this228;_classCallCheck(this,Carousel);for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];return(_this228=_possibleConstructorReturn(this,(_getPrototypeOf5=_getPrototypeOf(Carousel)).call.apply(_getPrototypeOf5,[this].concat(args)))).length=null,_this228.id=null,_this228.interval=null,_this228.timer=null,_this228._diff=null,_this228.$slides=null,_this228._coords=null,_this228}return _inherits(Carousel,Base),_createClass(Carousel,[{key:"$postLink",value:function(){var _this229=this;this.observeOnce("pairsInfoList",function(){utils.postDigest($scope).then(function(){carouselManager.registerSlider(_this229.id,_this229),_this229.interval=Number(_this229.interval)||0,_this229.$slidesContainer=$element.find(".carousel-content:first"),_this229.$slides=$element.find(".carousel-content:first").children(),_this229._mapSlides=_this229.$slides.toArray().map(function(slide){return{$slide:$(slide),translateX:null}}),_this229._fillGraphs(),_this229._remapSlides();var onResize=utils.debounceRequestAnimationFrame(function(){_this229._remapSlides(),_this229.initializeInterval()});_this229.listenEventEmitter($(window),"resize",onResize),$element.hover(function(){_this229.stopInterval()},function(){_this229.initializeInterval()}),_this229.initializeInterval()})})}},{key:"$onDestroy",value:function(){carouselManager.removeSlider(this.id)}},{key:"initializeInterval",value:function(){var _this230=this;this.interval&&(this.timer&&this.stopInterval(),this.timer=$timeout(function(){return _this230._step()},this.interval))}},{key:"stopInterval",value:function(){this.interval&&this.timer&&($timeout.cancel(this.timer),this.timer=null)}},{key:"goToDexDemo",value:function(pairAssets){utils.openDex(pairAssets.assetId1,pairAssets.assetId2)}},{key:"_fillGraphs",value:function(){var _this231=this;this._mapSlides.forEach(function(_ref108,i){var $slide=_ref108.$slide,info=_this231.pairsInfoList[i],options=info.change24.gt(0)?chartOptions.blue:chartOptions.red,chartData={rate:info.rateHistory};new ChartFactory($slide.find(".graph"),options,chartData)})}},{key:"_remapSlides",value:function(){var _this232=this;this._stopSlides(),this.slidesAmount=Carousel._getSlidesInWindowAmount(window.innerWidth);var _this$_getWidthAndSta=this._getWidthAndStart(),width=_this$_getWidthAndSta.width,startCoords=_this$_getWidthAndSta.startCoords;this._diff=1<startCoords.length?startCoords[1]-startCoords[0]:width+10,this._coords=this.$slides.toArray().map(function(element,i){return(i-1)*_this232._diff}),this._mapSlides.forEach(function(slide,i){slide.translateX=_this232._coords[i],slide.$slide.css({transform:"translateX(".concat(_this232._coords[i],"px)")})}),this.$slides.addClass("absolute")}},{key:"_getWidthAndStart",value:function(){var tempSlidesContainer=this.$slidesContainer.clone();tempSlidesContainer.find(".carousel-slide").slice(this.slidesAmount).remove();var slides=tempSlidesContainer.find(".carousel-slide");slides.removeAttr("style").removeClass("absolute"),tempSlidesContainer.appendTo($element.find(".carousel-inner"));var width=slides.outerWidth(),startCoords=slides.toArray().map(function(slide){return Math.round($(slide).offset().left)});return tempSlidesContainer.remove(),{width:width,startCoords:startCoords}}},{key:"_move",value:function(){var _this233=this,lastPos=last(this._coords);return Promise.all(this._mapSlides.map(function(slide){var $slide=slide.$slide,start=slide.translateX,end=start-_this233._diff;slide.translateX=end;var opacity=_this233._switchOpacity(end);return utils.animate($slide,{opacity:opacity,progress:1},{duration:1e3,progress:_this233._animateProgress(start,end,$slide),complete:function(){end<-_this233._diff&&($slide.css("transform","translateX(".concat(lastPos,"px)")),slide.translateX=lastPos)}})}))}},{key:"_animateProgress",value:function(start,end,slide){return function(animation,progress){slide.css("transform","translateX(".concat(start+(end-start)*progress,"px)"))}}},{key:"_step",value:function(){var _this234=this;this.stopInterval(),this._move().then(function(){_this234.initializeInterval()})}},{key:"_switchOpacity",value:function(newPos){switch(!0){case newPos<-this._diff||newPos>this._coords[this.slidesAmount+1]:return 0;case newPos<0||newPos>this._coords[this.slidesAmount]:return.2;default:return 1}}},{key:"_stopSlides",value:function(){this._mapSlides.forEach(function(slide){slide.$slide.stop()})}}],[{key:"_getSlidesInWindowAmount",value:function(width){switch(!0){case width<620:return 1;case width<1e3:return 2;case width<1440:return 3;default:return 4}}}]),Carousel}())};controller.$inject=["$element","$timeout","carouselManager","utils","Base","$scope","ChartFactory"],angular.module("app.ui").component("wCarousel",{transclude:!0,bindings:{id:"@",interval:"@",pairsInfoList:"<"},controller:controller,templateUrl:"modules/ui/directives/carousel/carousel.html"})}(),function(){var controller=function(Base,$attrs,createPoll,$element,waves){return new(function(){function Change24(){var _this235;return _classCallCheck(this,Change24),(_this235=_possibleConstructorReturn(this,_getPrototypeOf(Change24).call(this))).assetFrom=null,_this235.assetTo=null,_this235.precision=null,_this235.interval=null,_this235.directionByPair=null,_this235}return _inherits(Change24,Base),_createClass(Change24,[{key:"$postLink",value:function(){var _this236=this;this.precision=Number(this.precision)||2,this.interval=Number(this.interval)||5e3;var handler=null;if($attrs.noUpdate){var apply=function(){var onFulfilled=_this236._setChange.bind(_this236);_this236._getChange().then(onFulfilled,onFulfilled)};apply(),handler=apply}else{var poll=createPoll(this,this._getChange,this._setChange,this.interval);handler=function(){poll.restart()}}this.observe(["assetFrom","assetTo"],handler)}},{key:"_getChange",value:function(){return this.assetFrom&&this.assetTo?this.directionByPair?ds.api.pairs.get(this.assetFrom,this.assetTo).then(function(pair){return waves.utils.getChange(pair.amountAsset.id,pair.priceAsset.id)}):waves.utils.getChange(this.assetFrom,this.assetTo):Promise.resolve(null)}},{key:"_setChange",value:function(data){"number"==typeof data?($element.toggleClass("green",0<data),$element.toggleClass("red",data<0),$element.html(data.toFixed(this.precision))):$element.html("—")}}]),Change24}())};controller.$inject=["Base","$attrs","createPoll","$element","waves","i18n"],angular.module("app.ui").component("wChange24",{bindings:{assetFrom:"<",assetTo:"<",directionByPair:"<",precision:"@",noUpdate:"@",interval:"@",ns:"@"},transclude:!1,controller:controller})}(),function(){var controller=function(Base,$element){return new(function(){function Checkbox(){var _this237;return _classCallCheck(this,Checkbox),(_this237=_possibleConstructorReturn(this,_getPrototypeOf(Checkbox).call(this))).mode="",_this237.disabled=!1,_this237}return _inherits(Checkbox,Base),_createClass(Checkbox,[{key:"$postLink",value:function(){$element.removeAttr("id")}}]),Checkbox}())};controller.$inject=["Base","$element"];var getComponentData=function(type){var attrs;return{bindings:{mode:"@",id:"@",disabled:"<",ngModel:"="},template:(attrs=['ng-model="$ctrl.ngModel"','ng-class="$ctrl.mode"','ng-disabled="$ctrl.disabled"'],'<input type="checkbox" id="{{::$ctrl.id}}" '.concat(attrs.join(" "),' class="checkbox-').concat(type,'__input">')),transclude:!1,controller:controller}};angular.module("app.ui").component("wCheckboxSubmit",getComponentData("submit")),angular.module("app.ui").component("wCheckboxSuccess",getComponentData("success")),angular.module("app.ui").component("wCheckboxSwitcher",getComponentData("switcher"))}(),angular.module("app.ui").component("wCopyWrap",{bindings:{info:"<",onCopy:"&"},template:"".concat('<div class="copy-wrap__container" ng-transclude></div>').concat('<div ng-click="$ctrl.onCopy()" w-copy="$ctrl.info" class="copy-wrap__icon"></div>'),transclude:!0}),function(){var controller=function(Base,createPoll,user,waves,utils,$element,$scope,baseAssetService){return new(function(){function Exchange(){var _this238;return _classCallCheck(this,Exchange),(_this238=_possibleConstructorReturn(this,_getPrototypeOf(Exchange).call(this))).balance=null,_this238.mirrorBalance=null,_this238.interval=null,_this238.mirror=null,_this238.targetAssetId=null,_this238.noUpdate=null,_this238.rateDate=null,_this238.poll=null,_this238}return _inherits(Exchange,Base),_createClass(Exchange,[{key:"$postLink",value:function(){var _this239=this;this.interval=Number(this.interval)||5e3,this.noUpdate=null==this.noUpdate;var baseAssetId=baseAssetService.getBaseAssetId();waves.node.assets.getAsset(this.targetAssetId||baseAssetId).then(function(mirror){_this239.mirror=mirror,_this239.noUpdate?_this239._getMirrorBalance().then(function(balance){_this239.mirrorBalance=balance,$scope.$digest()}):_this239.poll=createPoll(_this239,_this239._getMirrorBalance,"mirrorBalance",_this239.interval,{$scope:$scope}),_this239.observe("balance",_this239._onChangeBalance),_this239.observe("mirrorBalance",_this239._onChangeMirrorBalance),_this239._onChangeBalance()})}},{key:"_onChangeBalance",value:function(){var _this240=this;this.balance&&(this.noUpdate?this._getMirrorBalance().then(function(balance){_this240.mirrorBalance=balance}):this.poll.restart())}},{key:"_getMirrorBalance",value:function(){var _this241=this;return this.balance?waves.utils.getRateApi(this.balance.asset.id,this.mirror.id).then(function(api){return _this241.balance&&api.exchange(_this241.balance.getTokens())||0}):Promise.resolve(null)}},{key:"_onChangeMirrorBalance",value:function(){var baseAssetPrecision=baseAssetService.getBaseAssetPrecision(),rate=this.mirrorBalance.toFixed(Number(this.precision)||baseAssetPrecision,BigNumber.BigNumber.ROUND_MODE.ROUND_UP);$element.html(this.mirrorBalance?rate:"")}}]),Exchange}())};controller.$inject=["Base","createPoll","user","waves","utils","$element","$scope","baseAssetService"],angular.module("app.ui").component("wExchange",{bindings:{balance:"<",interval:"@",rateDate:"@",noUpdate:"@",targetAssetId:"@",precision:"@"},transclude:!1,controller:controller})}(),function(){var controller=function(Base,$scope,$element){return new(function(){function HelpIconController(){var _this242;return _classCallCheck(this,HelpIconController),(_this242=_possibleConstructorReturn(this,_getPrototypeOf(HelpIconController).call(this))).hovered=!1,_this242}return _inherits(HelpIconController,Base),_createClass(HelpIconController,[{key:"hoverIn",value:function(){this.hovered=!0,clearTimeout(this.timer),$scope.$apply()}},{key:"hoverOut",value:function(){var _this243=this;clearTimeout(this.timer),this.timer=setTimeout(function(){_this243.hovered=!1,$scope.$apply()},Number(this.delay)||1e3)}},{key:"$postLink",value:function(){var _this244=this;$element.on("mouseover",function(){return _this244.hoverIn()}),$element.on("mouseout",function(){return _this244.hoverOut()})}}]),HelpIconController}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wHelpIcon",{templateUrl:"modules/ui/directives/helpIcon/helpIcon.html",transclude:!0,bindings:{delay:"="},controller:controller})}(),function(){var controller=function(Base,$element,$scope){return new(function(){function ShowCode(){return _classCallCheck(this,ShowCode),_possibleConstructorReturn(this,_getPrototypeOf(ShowCode).apply(this,arguments))}return _inherits(ShowCode,Base),_createClass(ShowCode,[{key:"$postLink",value:function(){var templateEl=$element.find("script").get(0),lines=templateEl.innerText.split("\n"),indent=lines[lines.length-1].indexOf("<"),code=[lines[0]].concat(_toConsumableArray(lines.slice(1).map(function(line){return line.slice(indent)}))).join("\n");this.code=code,this.codeId=templateEl.id,$scope.$ctrl=$scope.$parent.$ctrl}}]),ShowCode}())};controller.$inject=["Base","$element","$scope"],angular.module("app.ui").component("wShowCode",{templateUrl:"modules/ui/directives/showCode/showCode.html",transclude:!0,controller:controller,controllerAs:"$codeCtrl"})}(),function(){var factory=function(user,decorators,waves,configService){var ds=require("data-service");return new(function(){function BaseAssetService(){var _this245=this;_classCallCheck(this,BaseAssetService),this.defaultAssets=null,this.defaultAssetsById=null,this.defaultIconAssetsById=null,configService.change.on(function(){return _this245.initService()}),this.initService()}return _createClass(BaseAssetService,[{key:"initService",value:function(){this.defaultAssets=null,this.defaultAssetsById=null,this.defaultIconAssetsById=null,ds.config.set("rewriteAssets",this._getRewriteAssetData())}},{key:"getDefaultAssetsIconMap",value:function(){return this.defaultIconAssetsById||(this.defaultIconAssetsById=this.getDefaultAssetsList().reduce(function(acc,item){return acc[item.assetId]=item.icon,acc},{})),this.defaultIconAssetsById}},{key:"getDefaultAssetsList",value:function(){return configService.get("defaultAssets")||[]}},{key:"getGateWaysAssetHash",value:function(){return this.getDefaultAssetsList().reduce(function(acc,item){return item.isGateway&&(acc[item.assetId]=!0),acc},{})}},{key:"getDefaultAssetsHash",value:function(){return this.defaultAssets||(this.defaultAssets=this.getDefaultAssetsList().reduce(function(acc,item){return acc[item.label||item.ticker||item.name]=item,acc},{})),this.defaultAssets}},{key:"getDefaultAssetsHashById",value:function(){return this.defaultAssets||(this.defaultAssets=this.getDefaultAssetsList().reduce(function(acc,item){return acc[item.assetId]=item,acc},{})),this.defaultAssets}},{key:"getDefaultAssetsHashId",value:function(){return this.defaultAssetsById||(this.defaultAssetsById=this.getDefaultAssetsList().reduce(function(acc,item){return acc[item.label||item.ticker||item.name]=item.assetId,acc},{})),this.defaultAssetsById}},{key:"getIdByTicker",value:function(ticker){var isArray=Array.isArray(ticker),hash=this.getDefaultAssetsHashId(),idList=(isArray?ticker:[ticker]).map(function(ticker){return hash[ticker]||ticker});return isArray?idList:idList[0]}},{key:"getDefaultPinnedAssets",value:function(){var defaultPinned=configService.get("SETTINGS.DEFAULT_PINNED_ASSET_ID_LIST")||[];return this.getIdByTicker(defaultPinned)}},{key:"getChartAssetIdList",value:function(){var defaultPinned=configService.get("SETTINGS.CHART_ASSET_LIST")||[];return this.getIdByTicker(defaultPinned)}},{key:"getBaseAssetId",value:function(){return configService.get("baseAsset").assetId}},{key:"getBaseAssetName",value:function(){return configService.get("baseAsset").name}},{key:"getBaseAssetPrecision",value:function(){return Number(configService.get("baseAsset").precision)||2}},{key:"getBaseAssetLabel",value:function(){return configService.get("baseAsset").label}},{key:"getBaseAsset",value:function(){return waves.node.assets.getAsset(this.getBaseAssetId())}},{key:"convertToBaseAsset",value:function(money){return this.getBaseAsset().then(function(baseAsset){return waves.utils.getRateApi(money.asset.id,baseAsset.id).then(function(api){return api.exchange(money.getTokens())}).then(function(balance){return ds.moneyFromTokens(balance,baseAsset)})})}},{key:"_getRewriteAssetData",value:function(){return this.getDefaultAssetsList().map(function(_ref109){var assetId=_ref109.assetId,ticker=_ref109.ticker,name=_ref109.name,description=_ref109.description,icon=_ref109.icon,rewriteAsset={id:assetId};return icon&&(rewriteAsset.icon=icon),ticker&&(rewriteAsset.ticker=ticker),name&&(rewriteAsset.name=name),description&&(rewriteAsset.description=description),rewriteAsset.displayName=ticker||name,rewriteAsset}).reduce(function(acc,item){return acc[item.id]=item,acc},{})}},{key:"defaultAsset",get:function(){return this.getIdByTicker(configService.get("defaultAsset")||"WAVES")}},{key:"WavesAssetId",get:function(){return this.getIdByTicker("WAVES")}},{key:"WESTAssetId",get:function(){return this.getIdByTicker("WEST")}},{key:"WCTAssetId",get:function(){return this.getIdByTicker("WCT")}}]),BaseAssetService}())};factory.$inject=["user","decorators","waves","configService"],angular.module("app.utils").factory("baseAssetService",factory)}(),function(){var ds=require("data-service"),factory=function(waves,baseAssetService){var validateRegexp=function(address,regexTemplate){return function(str){var params=(str=str.trim()).replace(/\/.+\/(.*)/,"$1"),regExpString=str.replace(/\/(.+)\/.*/,"$1");return new RegExp(regExpString,params)}(regexTemplate).test(address)},getValidator=function(asset){return function(address){if(asset.assetId===baseAssetService.WESTAssetId)return waves.node.isValidAddressWithNetworkByte(address,ds.config.get("WESTNetworkByte"));var validBech32=asset.bech32&&function(address,prefix){try{return ds.bech32.decode(address).prefix===prefix}catch(e){return!1}}(address,asset.bech32),validRegexp=asset.gwAddressRegExp&&validateRegexp(address,asset.gwAddressRegExp);return validBech32||validRegexp}};return baseAssetService.getDefaultAssetsList().reduce(function(acc,asset){return(asset.isGateway||asset.isOuterSource)&&(acc[asset.assetId]={isValidAddress:getValidator(asset)}),acc},{})};factory.$inject=["waves","baseAssetService"],angular.module("app.utils").factory("outerBlockchains",factory)}(),function(){var controller=function(Base,$scope,user,modalManager,utils,waves,$element,ChartFactory,storage,matcher,configService,baseAssetService){var ds=require("data-service"),Money=require("@waves/data-entities").Money,uniqBy=require("ramda").uniqBy,BigNumber=require("@waves/bignumber").BigNumber,chartOptions={red:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#e5494d",fillColor:"#292f3c",gradientColor:["#e5494d","#292f3c"],lineWidth:4}}},blue:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#5a81ea",fillColor:"#292f3c",gradientColor:["#5a81ea","#292f3c"],lineWidth:4}}}};return new(function(){function WelcomeCtrl(){var _this246;_classCallCheck(this,WelcomeCtrl),(_this246=_possibleConstructorReturn(this,_getPrototypeOf(WelcomeCtrl).call(this,$scope))).pairsInfoList=[],_this246.hasMultiAccount=!1,_this246.appUrls={google:"https://play.google.com/store/apps/details?id=com.wavesplatform.wallet",android:"https://waves.exchange/files/Waves.Exchange-app.apk",appStore:"https://apps.apple.com/us/app/waves-wallet/id1233158971"},_this246.newsSliderIsOpen=!1,_this246.lang="",_this246.bannerTwoLink="",_this246.bannerThreeLink="",_this246.isMobile=!1,_this246._initDeviceTypes(),user.getMultiAccountData().then(function(data){_this246.hasMultiAccount=!!data,!_this246.hasMultiAccount&&_this246.isWeb&&storage.load("accountImportComplete").then(function(complete){complete||_this246._loadUserListFromOldOrigin()})}),_this246.baseAssetId=baseAssetService.getBaseAssetId(),_this246.baseAssetPrecision=baseAssetService.getBaseAssetPrecision(),_this246.baseAssetLabel=baseAssetService.getBaseAssetLabel(),_this246._initPairs();var APP_URLS=configService.get("APP_URLS");if(APP_URLS){var google=APP_URLS.google,android=APP_URLS.android,appStore=APP_URLS.appStore;_this246.appUrls={google:google||_this246.appUrls.google,android:android||_this246.appUrls.android,appStore:appStore||_this246.appUrls.appStore}}return _this246._setIsMobile(),_this246.listenEventEmitter($(window),"resize",function(){_this246._setIsMobile(),$scope.$digest()}),_this246._onChangeLanguge=_this246._onChangeLang.bind(_assertThisInitialized(_this246)),i18next.on("languageChanged",_this246._onChangeLanguge),_this246._onChangeLang(),_this246}return _inherits(WelcomeCtrl,Base),_createClass(WelcomeCtrl,[{key:"_addScrollHandler",value:function(){var scrolledView=$element.find(".scrolled-view"),header=$element.find("w-main-header");scrolledView.on("scroll",function(){header.toggleClass("fixed",60<scrolledView.scrollTop()),header.toggleClass("unfixed",scrolledView.scrollTop()<=60)})}},{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"goToDexDemo",value:function(pairAssets){utils.openDex(pairAssets.assetId1,pairAssets.assetId2)}},{key:"toggleNewsSlider",value:function(){this.newsSliderIsOpen=!this.newsSliderIsOpen}},{key:"forceInitRouteState",value:function(){ds.analytics.welcome.stakeNowClick(),user.forceInitRouteState("staking")}},{key:"onTradeNowClick",value:function(){ds.analytics.welcome.tradeNowClick()}},{key:"onTradeClick",value:function(){ds.analytics.welcome.tradingLinkClick()}},{key:"onLoginClick",value:function(){ds.analytics.welcome.loginClick()}},{key:"sendAnalytics",value:function(label){ds.analytics.mobileApp.downloadClick(label)}},{key:"_initPairs",value:function(){var _this247=this,FAKE_RATE_HISTORY=[{rate:new BigNumber(0),timestamp:ds.utils.normalizeTime(Date.now())}],sortedInfoList=[];ds.api.pairs.getPairsFromMarketData().then(function(pairs){return Promise.all(pairs.map(function(pair){return ds.api.pairs.get(pair.amountAsset.id,pair.priceAsset.id)}))}).then(function(pairs){return ds.api.pairs.info(matcher.currentMatcherAddress,pairs)}).then(function(infoList){return infoList.sort(function(a,b){return a.volume||b.volume?a.volume?b.volume?b.volume.getTokens().sub(a.volume.getTokens()).toNumber():-1:1:0})}).then(function(sortedInfoList){return sortedInfoList.slice(0,10)}).then(function(infoList){sortedInfoList=infoList;var startDate=utils.moment().add(-7,"days");return Promise.all(infoList.map(function(_ref110){var amountAsset=_ref110.amountAsset,priceAsset=_ref110.priceAsset;return waves.utils.getRateHistory(amountAsset,priceAsset,startDate)}).map(function(promise){return promise.catch(function(){return FAKE_RATE_HISTORY})}))}).then(function(rateHistory){_this247.pairsInfoList=rateHistory.map(WelcomeCtrl._fillValues(sortedInfoList))}).then(function(){utils.safeApply($scope),_this247._insertCharts(),_this247._addScrollHandler()})}},{key:"_onChangeLang",value:function(){this.lang=i18next.language,this.bannerTwoLink="ru"===this.lang?"https://medium.com/wavesexchange/waves-exchange-%D1%81%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82-%D0%B2-%D0%B1%D1%83%D0%B4%D1%83%D1%89%D0%B5%D0%B5-76e9b27e2967":"https://medium.com/wavesexchange/waves-exchange-looks-to-the-future-5a0286e0afc4",this.bannerThreeLink="ru"===this.lang?"https://medium.com/wavesexchange/%D1%87%D0%B5%D0%B3%D0%BE-%D0%B6%D0%B4%D0%B0%D1%82%D1%8C-%D0%BD%D0%B0-waves-exchange-422d96a0068e":"https://medium.com/wavesexchange/what-you-can-expect-on-waves-exchange-b6e614096126",utils.safeApply($scope)}},{key:"_insertCharts",value:function(){var marketRows=$element.find(".js-table-markets .js-row-content");this.pairsInfoList.forEach(function(pairInfo,i){var options=pairInfo.change24.gt(0)?chartOptions.blue:chartOptions.red,chartData={rate:pairInfo.rateHistory};new ChartFactory(marketRows.eq(i).find(".graph"),options,chartData)})}},{key:"_initDeviceTypes",value:function(){this.isDesktop=WavesApp.isDesktop(),this.isWeb=WavesApp.isWeb()}},{key:"_loadUserListFromOldOrigin",value:function(){var _this248=this;this.pendingRestore=!0,utils.importAccountByIframe("https://client.wavesplatform.com",5e3).then(function(userList){user.getFilteredUserList().then(function(list){_this248.pendingRestore=!1;var newUserList=uniqBy(function(user){return user.name},userList.concat(list)||list);storage.save("accountImportComplete",!0),storage.save("userList",newUserList),utils.postDigest($scope).then(function(){$scope.$apply()})})}).catch(function(){_this248.pendingRestore=!1,storage.save("accountImportComplete",!0)})}},{key:"_setIsMobile",value:function(){this.isMobile=window.innerWidth<=860}}],[{key:"_fillValues",value:function(infoList){return function(rateHistory,i){var info=infoList[i],volume=info.volumeWaves||new Money(0,info.priceAsset);return _objectSpread({},info,{ticker:info.ticker||info.displayName,change24:info.change24||new BigNumber(0),high:info.high||new Money(0,info.priceAsset),lastPrice:info.lastPrice||new Money(0,info.priceAsset),low:info.low||new Money(0,info.priceAsset),volume:volume,rateHistory:rateHistory,volumeBigNum:volume.getTokens()})}}}]),WelcomeCtrl}())};controller.$inject=["Base","$scope","user","modalManager","utils","waves","$element","ChartFactory","storage","matcher","configService","baseAssetService"],angular.module("app.welcome").controller("WelcomeCtrl",controller)}(),function(){var ds=require("data-service"),factory=function(Base,user,storage,waves){return new(function(){function ReferralLinkService(props){var _this249;return _classCallCheck(this,ReferralLinkService),(_this249=_possibleConstructorReturn(this,_getPrototypeOf(ReferralLinkService).call(this,props))).hasReferral=void 0,_this249.observe("hasReferral",function(){_this249.hasReferral?_this249.subscribeOnLogin():_this249.unsubscribeLogin()}),_this249._checkHasReferral(),_this249}return _inherits(ReferralLinkService,Base),_createClass(ReferralLinkService,[{key:"save",value:function(address){var _this250=this;return storage.load("multiAccountUsers").then(function(userList){if(userList&&0<Object.keys(userList).length)return Promise.reject()}).then(function(){return user.isValidAddress(address)?Promise.resolve():Promise.reject()}).then(function(){return storage.save("referralAddress",address)}).then(function(){return _this250.hasReferral=!0,Promise.resolve()}).catch(function(){return null})}},{key:"load",value:function(){return storage.load("referralAddress")}},{key:"subscribeOnLogin",value:function(){var _this251=this;Promise.all([this.load(),user.getMultiAccountUsers()]).then(function(_ref111){var _ref112=_slicedToArray(_ref111,2),referralAddress=_ref112[0],userList=_ref112[1],notNewUser=Array.isArray(userList)&&0<userList.length;return!referralAddress||notNewUser?Promise.reject():(_this251.loginHandler=function(){_this251._sendAddress(referralAddress)},user.loginSignal.on(_this251.loginHandler,_this251),Promise.resolve())}).catch(function(){return null})}},{key:"unsubscribeLogin",value:function(){this.loginHandler&&user.loginSignal.off(this.loginHandler)}},{key:"_sendAddress",value:function(address){var _this252=this;return user.getMultiAccountUsers().then(function(userList){return Array.isArray(userList)&&1===userList.length?Promise.resolve():Promise.reject()}).then(function(){return waves.node.transactions.list(1).then(function(list){return list&&list.length?Promise.reject():Promise.resolve()})}).then(function(){return ds.api.referral.set(address)}).then(function(){ds.analytics.sendV2("Referral",{action:"Create Account"})}).finally(function(){storage.save("referralAddress",""),_this252.hasReferral=!1})}},{key:"_checkHasReferral",value:function(){var _this253=this;storage.load("referralAddress").then(function(referralAddress){_this253.hasReferral=!!referralAddress})}}]),ReferralLinkService}())};factory.$inject=["Base","user","storage","waves"],angular.module("app").factory("referralLinkService",factory)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.BuyUSDNFaq,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.buyUSDNFaq").directive("wBuyUsdnFaq",controller)}(),function(){var controller=function(SeedBase,$element,seedService,$scope,createPromise){var tsUtils=require("ts-utils");return new(function(){function SeedWrite(){var _this254;return _classCallCheck(this,SeedWrite),(_this254=_possibleConstructorReturn(this,_getPrototypeOf(SeedWrite).call(this,$element))).onFulfilled=null,_this254.onTouch=null,_this254._$container=null,_this254._children=[],_this254._containerWidth=null,_this254}return _inherits(SeedWrite,SeedBase),_createClass(SeedWrite,[{key:"$postLink",value:function(){_get(_getPrototypeOf(SeedWrite.prototype),"$postLink",this).call(this),this._$container=$element.find(".seed-container"),this._containerWidth=this._$container.width(),this.receive(seedService.pick,this._show,this),this.receive(seedService.clear,this._clear,this)}},{key:"_clear",value:function(){this._children.forEach(this._removePart,this)}},{key:"_removePart",value:function(child){var _this255=this;createPromise(this,this.animateOut(child.$element)).then(function(){seedService.revert.dispatch(child.randomIndex);var filter=tsUtils.notContains(_this255._getChildByElement(child.$element));_this255._children=_this255._children.filter(filter),child.$element.remove(),_this255._resetPositions()})}},{key:"_resetPositions",value:function(){var _this256=this,currentLine=SeedWrite._getPropertyGetter(this._$container,"padding-top")(),currentWidth=0,lines={};this._children.forEach(function(child){currentWidth+child.width<_this256._containerWidth?currentWidth+=child.width:(currentWidth=child.width,currentLine+=child.height),lines[currentLine]||(lines[currentLine]=[]),lines[currentLine].push(child)}),Object.keys(lines).forEach(function(lineName){var line=lines[lineName],width=_this256._getLineWidth(line),left=(_this256._$container.outerWidth()-width)/2;line.forEach(function(child){var itemLeft=left;child.line?child.line!==Number(lineName)?_this256.animateOut(child.$element).then(function(){child.$element.css({left:itemLeft,top:child.line}),_this256.animateIn(child.$element)}):_this256.animate(child.$element,{left:left,top:child.line}):(child.$element.css({left:itemLeft,top:Number(lineName)}),_this256.animateIn(child.$element)),child.line=Number(lineName),left+=child.width})})}},{key:"_show",value:function(_ref113){var _this257=this,index=_ref113.index,word=_ref113.word,$element=$('<span class="seed-item ghost">'.concat(word,"</span>"));this._$container.append($element);var child=this._createChild({index:index,word:word,$element:$element});if(this._children.push(child),$element.removeClass("ghost"),this._resetPositions(),$element.on("click",function(){_this257._removePart(child),_this257.onTouch(),$scope.$digest()}),this.onFulfilled&&this._children.length===this.parts.length){var isValid=this._children.map(function(child){return child.word}).join(" ")===this.seed;this.onFulfilled({isValid:isValid}),isValid&&this._$container.children().each(function(i,element){$(element).off("click"),_this257._$container.addClass("seed-confirmed")})}else this.onTouch()}},{key:"_createChild",value:function(_ref114){var index=_ref114.index,word=_ref114.word,$element=_ref114.$element,margin=SeedWrite._getPropertyGetter($element,"margin-left")(),child={randomIndex:index,word:word,width:$element.outerWidth()+2*margin,height:$element.outerHeight()+2*margin,$element:$element,line:null};return[{name:"left",get:SeedWrite._getPropertyGetter($element,"left")},{name:"top",get:SeedWrite._getPropertyGetter($element,"top")}].forEach(function(item){Object.defineProperty(child,item.name,{get:item.get})}),child}},{key:"_getLineWidth",value:function(line){return line.reduce(function(result,child){return result+child.width},0)}},{key:"_getChildByElement",value:function($element){return tsUtils.find(this._children,function(child){return child.$element.get(0)===$element.get(0)})}}],[{key:"_getPropertyGetter",value:function($element,property){return function(){return parseInt($element.css(property),10)}}}]),SeedWrite}())};controller.$inject=["SeedBase","$element","seedService","$scope","createPromise"],angular.module("app.create").component("wSeedWrite",{bindings:{seed:"@",onFulfilled:"&",onTouch:"&"},template:'<div class="seed-container"></div>',transclude:!1,controller:controller})}(),function(){var controller=function(Base,$element,utils,i18n){var analytics=require("data-service").analytics;return new(function(){function DexBlock(){var _this258;return _classCallCheck(this,DexBlock),(_this258=_possibleConstructorReturn(this,_getPrototypeOf(DexBlock).call(this))).search="",_this258.titleLiteral=null,_this258.collapsed=!1,_this258.focused=!1,_this258.block=null,_this258._parent=null,i18n.translateField(_assertThisInitialized(_this258),"titleLiteral","title","app.dex"),_this258}return _inherits(DexBlock,Base),_createClass(DexBlock,[{key:"$postLink",value:function(){this.syncSettings({collapsed:"dex.layout.".concat(this.block,".collapsed")});try{this._parent.registerItem($element,this),this._parent.collapseBlock(this.block,this.collapsed)}catch(e){return this}}},{key:"toggleCollapse",value:function(){var _this259=this,collapsed=this.collapsed;collapsed?(this.collapsed=!collapsed,utils.wait(100).then(function(){analytics.send({name:"".concat(_this259.analyticsText," Show"),target:"ui"}),_this259._parent.collapseBlock(_this259.block,_this259.collapsed)})):(this._parent.collapseBlock(this.block,!this.collapsed),utils.wait(300).then(function(){analytics.send({name:"".concat(_this259.analyticsText," Hide"),target:"ui"}),_this259.collapsed=!collapsed}))}}]),DexBlock}())};controller.$inject=["Base","$element","utils","i18n"],angular.module("app.dex").component("wDexBlock",{require:{_parent:"^wLayout"},bindings:{titleLiteral:"@titleName",block:"@",hasSearch:"@",canCollapse:"@",analyticsText:"<"},templateUrl:"modules/dex/directives/dexBlock/dexBlock.html",transclude:!0,controller:controller})}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state){return reactDirective(rc.LeasingFaq,void 0,void 0,{$state:$state})};controller.$inject=["reactDirective","$state"],angular.module("app.leasingFaq").directive("wReactLeasingFaq",controller)}(),function(){var controller=function(Base,$scope,sessionBridge){return new(function(){function SessionsCtrl(){var _this260;return _classCallCheck(this,SessionsCtrl),(_this260=_possibleConstructorReturn(this,_getPrototypeOf(SessionsCtrl).call(this,$scope))).sessions=sessionBridge.getSessionsData(),_this260.receive(sessionBridge.signals.changeSessions,function(sessions){_this260.sessions=sessions,$scope.$digest()}),_this260}return _inherits(SessionsCtrl,Base),_createClass(SessionsCtrl,[{key:"chooseSession",value:function(session){sessionBridge.login(session.id)}}]),SessionsCtrl}())};controller.$inject=["Base","$scope","sessionBridge"],angular.module("app.sessions").controller("SessionsCtrl",controller)}(),function(){var factory=function(Base,utils,createPoll){var Money=require("@waves/data-entities").Money,_require52=require("ramda"),equals=_require52.equals,isEmpty=_require52.isEmpty,range=_require52.range,last=_require52.last,head=_require52.head,pipe=_require52.pipe,not=_require52.not,prop=_require52.prop,allPass=_require52.allPass,Signal=require("ts-utils").Signal,BigNumber=require("@waves/bignumber").BigNumber,SCALE=devicePixelRatio||1,isNotEmptyPoint=pipe(allPass([pipe(prop("x"),isEmpty,not),pipe(prop("y"),isEmpty,not)])),ChartFactory=function(){function ChartFactory($element,options,data){var _this261;_classCallCheck(this,ChartFactory),(_this261=_possibleConstructorReturn(this,_getPrototypeOf(ChartFactory).call(this))).changeLanguageHandler=function(){return _this261._setAxisCoords()},_this261.legendItemsObjects=void 0,_this261.canvas=void 0,_this261.signals=Object.assign(_this261.signals,{mouseMove:new Signal,mouseLeave:new Signal}),_this261.$parent=$element,_this261.options=Object.assign(Object.create(null),ChartFactory.defaultOptions,options),_this261.data=data,_this261._initializeCanvasElement($element),_this261.ctx=_this261.canvas.getContext("2d"),_this261._lastEvent=null;var checkInterval=_this261.options.checkWidth;if(checkInterval){var interval="number"==typeof checkInterval&&checkInterval||1e3;createPoll(_assertThisInitialized(_this261),function(){return null},_this261._checkAndUpdateSize,interval)}return _this261._render(),_this261._setHandlers(),_this261}return _inherits(ChartFactory,Base),_createClass(ChartFactory,[{key:"setOptions",value:function(options){this.options=Object.assign(Object.create(null),ChartFactory.defaultOptions,options),this._render()}},{key:"setData",value:function(data){this.data=data,this._render(),this._lastEvent&&this._findIntersection(this._lastEvent.event)}},{key:"_initializeCanvasElement",value:function($element){var canvas=document.createElement("canvas"),width=Math.round($element.width()),height=Math.round($element.height());canvas.style.position="absolute",canvas.style.left="0",canvas.style.top="0","static"===$element.css("position")&&$element.css("position","relative"),$element.append(canvas),this.canvas=canvas,this._setSize(width,height)}},{key:"_setHandlers",value:function(){var _this262=this,onMouseMove=utils.debounceRequestAnimationFrame(function(mouseOrTouchEvent){var event=utils.getEventInfo(mouseOrTouchEvent);_this262._findIntersection(event)}),onMouseLeave=utils.debounceRequestAnimationFrame(function(event){_this262.signals.mouseLeave.dispatch({event:event}),_this262._lastEvent=null}),onResize=utils.debounceRequestAnimationFrame(function(){_this262._checkAndUpdateSize()});this.listenEventEmitter(this.$parent,"mousemove",onMouseMove),this.listenEventEmitter(this.$parent,"mouseleave",onMouseLeave),this.listenEventEmitter(window,"resize",onResize,{on:"addEventListener",off:"removeEventListener"})}},{key:"_checkAndUpdateSize",value:function(){this.canvas.width===this.$parent.outerWidth()&&this.canvas.height===this.$parent.outerHeight()||(this._setSize(this.$parent.outerWidth(),this.$parent.outerHeight()),this._render(),this._lastEvent&&this.signals.mouseMove.dispatch(this._lastEvent))}},{key:"_setSize",value:function(width,height){this.canvas.width=width*SCALE,this.canvas.height=height*SCALE,this.canvas.style.width="".concat(width,"px"),this.canvas.style.height="".concat(height,"px")}},{key:"_clear",value:function(){this.canvas.width=this.canvas.width}},{key:"_render",value:function(){var _this263=this;this._clear();var keys=this.data&&Object.keys(this.data);return keys&&keys.length&&keys.some(function(id){return _this263.data[id]&&_this263.data[id].length})&&this.options?(this.chartData=this._getChartData(this.data),this._drawChart(this.chartData),void(this.options.hasDates&&(this.legendItemsObjects||this._createBottomLegend(this._getLegendItemsWithCoords()),this._updateLegendObject()))):null}},{key:"_drawChart",value:function(data){var ctx=this.ctx,options=this.options;Object.entries(data.coordinates).forEach(function(_ref115){var _ref116=_slicedToArray(_ref115,2),id=_ref116[0],chartCoords=_ref116[1],viewOptions=options.view[id],first=chartCoords[0];if(ctx.strokeStyle=viewOptions.lineColor,ctx.lineWidth=viewOptions.lineWidth*SCALE,ctx.beginPath(),viewOptions.isDashed?ctx.setLineDash([7,6]):ctx.setLineDash([]),ctx.moveTo(first.x,first.y),chartCoords.forEach(function(_ref117){var x=_ref117.x,y=_ref117.y;ctx.lineTo(x,y)}),ctx.stroke(),viewOptions.fillColor){if(viewOptions.gradientColor){var grd=ctx.createLinearGradient(0,0,0,data.height.toNumber());grd.addColorStop(0,viewOptions.gradientColor[0]),grd.addColorStop(1,viewOptions.gradientColor[1]),ctx.fillStyle=grd}else ctx.fillStyle=viewOptions.fillColor;var _last=chartCoords[chartCoords.length-1];ctx.lineTo(_last.x,data.height.toNumber()),ctx.lineTo(first.x,data.height.toNumber()),ctx.lineTo(first.x,first.y),ctx.fill()}})}},{key:"_getChartData",value:function(data){var _this264=this,height=new BigNumber(this.canvas.height),width=new BigNumber(this.canvas.width),maxChartHeight=height.mul(this.options.heightFactor),marginBottom=this.options.marginBottom,min={x:new BigNumber(1/0),y:new BigNumber(1/0)},max={x:new BigNumber(-1/0),y:new BigNumber(-1/0)},pointsHash=Object.entries(data).reduce(function(acc,_ref118){var _ref119=_slicedToArray(_ref118,2),id=_ref119[0],chart=_ref119[1],points=acc[id]=[];return chart.forEach(function(item){var itemX=item[_this264.options.axisX],itemY=item[_this264.options.axisY],point={x:ChartFactory._getValues(itemX),y:ChartFactory._getValues(itemY)};isNotEmptyPoint(point)&&(min.x=BigNumber.min(min.x,point.x),min.y=BigNumber.min(min.y,point.y),max.x=BigNumber.max(max.x,point.x),max.y=BigNumber.max(max.y,point.y),points.push(point)),points.sort(utils.comparators.process(prop("x")).bigNumber.asc)}),acc},Object.create(null)),delta={x:max.x.sub(min.x),y:max.y.sub(min.y)},factor={x:width.div(delta.x),y:maxChartHeight.div(delta.y)},coordinates=Object.create(null);return Object.entries(pointsHash).forEach(function(_ref120){var _ref121=_slicedToArray(_ref120,2),id=_ref121[0],points=_ref121[1];coordinates[id]=[],points.forEach(function(value){var xValue=value.x,yValue=value.y,x=Number(xValue.sub(min.x).mul(factor.x).toFixed()),y=Number(height.sub(yValue.sub(min.y).mul(factor.y)).toFixed())-marginBottom*SCALE;coordinates[id].push({x:x,y:y,xValue:xValue,yValue:yValue})})}),{height:height,maxChartHeight:maxChartHeight,width:width,min:min,max:max,delta:delta,factor:factor,coordinates:coordinates}}},{key:"_findIntersection",value:function(event){if(!this.chartData||!this.chartData.coordinates)return null;var eventOffsetX=event.pageX-$(event.target).offset().left,intersection=Object.entries(this.chartData.coordinates).reduce(function(acc,_ref122){var _ref123=_slicedToArray(_ref122,2),id=_ref123[0],points=_ref123[1],point=function binarySearch(data,target,start,end){if(end<1)return data[0];if(end-1===start)return Math.abs(data[start].x-target)>Math.abs(data[end].x-target)?data[end]:data[start];var middle=Math.floor(start+(end-start)/2);return target===data[middle].x?data[middle]:target>data[middle].x?binarySearch(data,target,middle,end):target<data[middle].x?binarySearch(data,target,start,middle):void 0}(points,eventOffsetX*SCALE,0,points.length-1),data={id:id,point:point,event:_objectSpread({},event,{offsetX:eventOffsetX})};return!acc||Math.abs(point.x-eventOffsetX*SCALE)<Math.abs(acc.point.x-eventOffsetX*SCALE)?data:acc},null);intersection&&this._dispatchMouseMove(intersection)}},{key:"_dispatchMouseMove",value:function(intersection){this._lastEvent&&equals(this._lastEvent.point,intersection.point)||(this.signals.mouseMove.dispatch(intersection),this._lastEvent=intersection)}},{key:"_getLegendItemsWithCoords",value:function(){var _Array$prototype,_this265=this,width=this.$parent.outerWidth()/4,exactCoords=range(0,4).map(function(i){return width*i+width/2}),combinedCoordinates=(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,_toConsumableArray(Object.keys(this.chartData.coordinates).map(function(key){return _this265.chartData.coordinates[key]}))),xCoords=combinedCoordinates.map(prop("x")),combinedXValues=combinedCoordinates.map(prop("xValue"));return exactCoords.map(function(x){return xCoords.reduce(function(prevXCoord,currentXCoord){return Math.abs(currentXCoord/SCALE-x)<Math.abs(prevXCoord/SCALE-x)?currentXCoord:prevXCoord})}).map(function(foundX){var dateIndex=combinedCoordinates.findIndex(function(_ref124){var x=_ref124.x;return foundX===x});return{coords:foundX/SCALE,value:new Date(combinedXValues[dateIndex].toNumber())}})}},{key:"_createBottomLegend",value:function(axisItemsWithCoords){var _this266=this;this.legendItemsObjects=axisItemsWithCoords.map(function(_ref125){var value=_ref125.value,x=_ref125.x,$legendItem=$('<div class="chart-legend">'.concat(ChartFactory._localDate(value),"</div>"));_this266.$parent.append($legendItem);var coords=Math.round(x-$legendItem.width()/2);return $legendItem.css({left:coords}),{$legendItem:$legendItem,legendValue:value,coords:coords}}),this.listenEventEmitter(i18next,"languageChanged",this.changeLanguageHandler)}},{key:"_updateLegendObject",value:function(){var newCoords=this._getLegendItemsWithCoords();this.legendItemsObjects=this.legendItemsObjects.map(function(object,i){return{$legendItem:object.$legendItem,legendValue:newCoords[i].value,coords:newCoords[i].coords}}),this._setAxisCoords()}},{key:"_setAxisCoords",value:function(){var isTime=last(this.legendItemsObjects).legendValue-head(this.legendItemsObjects).legendValue<1728e5;this.legendItemsObjects.forEach(function(object){var legendDate=isTime?tsUtils.date("hh:mm")(object.legendValue):ChartFactory._localDate(object.legendValue);object.$legendItem.html(legendDate).css({left:object.coords})})}}],[{key:"_getValues",value:function(item){switch(!0){case item instanceof Date:return new BigNumber(item.getTime());case item instanceof Money:return item.getTokens();case item instanceof BigNumber:return item;case"number"==typeof item:return new BigNumber(item);default:throw new Error("Wrong value type!")}}},{key:"_localDate",value:function(date,argument_1){return 1<arguments.length&&void 0!==argument_1&&argument_1?tsUtils.date("DD.MM.YYYY")(date):tsUtils.date("DD.MM")(date)}}]),ChartFactory}();return ChartFactory.defaultOptions={axisX:"timestamp",axisY:"rate",marginBottom:0,hasDates:!1,checkWidth:!1,heightFactor:.9,view:{rate:{lineColor:"#e5494d",fillColor:"#292f3c",gradientColor:!1,isDashed:!1,lineWidth:2}}},ChartFactory};factory.$inject=["Base","utils","createPoll"],angular.module("app.ui").factory("ChartFactory",factory)}(),function(){var controller=function(Base,$scope,user){return new(function(){function BuyWAVESCtrl(){var _this267;return _classCallCheck(this,BuyWAVESCtrl),(_this267=_possibleConstructorReturn(this,_getPrototypeOf(BuyWAVESCtrl).call(this,$scope))).isLogined=!!user.address,_this267}return _inherits(BuyWAVESCtrl,Base),BuyWAVESCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.buyWaves").controller("BuyWavesCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function LeverageCtrl(){var _this268;return _classCallCheck(this,LeverageCtrl),(_this268=_possibleConstructorReturn(this,_getPrototypeOf(LeverageCtrl).call(this,$scope))).isLogined=!!user.address,_this268}return _inherits(LeverageCtrl,Base),LeverageCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.leverage").controller("LeverageCtrl",controller)}(),MAX_HEIGHT_COLLAPSED=0,MAX_HEIGHT_OPENED=300,(NewsItemCtrl=function(){function NewsItemCtrl($scope,$element,$filter,utils){_classCallCheck(this,NewsItemCtrl),this.item={},this.time="",this.opened=!1,this.id={},this.isOpen=!1,this.$scope=$scope,this.$element=$element,this.$filter=$filter,this.utils=utils}return _createClass(NewsItemCtrl,[{key:"$onInit",value:function(){this.time=this.$filter("date")(this.item.timestamp,"HH:mm"),this.id={title:"".concat(this.item.id,"-title"),text:"".concat(this.item.id,"-text")},this.opened=this.isOpen}},{key:"$postLink",value:function(){this._setHeight()}},{key:"toggleOpened",value:function(){this.opened=!this.opened,this._setHeight()}},{key:"_setHeight",value:function(){var text=this.$element.find(".js-text");this.opened?text.css({maxHeight:MAX_HEIGHT_OPENED}):text.css({maxHeight:MAX_HEIGHT_COLLAPSED})}}]),NewsItemCtrl}()).$inject=["$scope","$element","$filter","utils"],angular.module("app.news").component("wNewsItem",{templateUrl:"modules/news/components/newsItem/newsItem.html",controller:NewsItemCtrl,bindings:{item:"<",isOpen:"<"}}),function(){var controller=function(Base,$scope,$state,user,modalManager,utils){var ds=require("data-service"),PATH="modules/saveSeed/templates";return new(function(){function SaveSeedCtrl(){var _this269;return _classCallCheck(this,SaveSeedCtrl),(_this269=_possibleConstructorReturn(this,_getPrototypeOf(SaveSeedCtrl).call(this,$scope))).networkError=!1,_this269.password="",_this269.loginForm=null,_this269.activeUserAddress=null,_this269.needPassword=!0,_this269._activeUserIndex=null,_this269.isVisibleSeed=!1,_this269.observe("activeUserAddress",_this269._calculateActiveIndex),_this269.observe("password",_this269._updatePassword),_this269._initUserList(),_this269}return _inherits(SaveSeedCtrl,Base),_createClass(SaveSeedCtrl,[{key:"user",get:function(){return this.userList[this._activeUserIndex]}},{key:"encryptedSeed",get:function(){return this.user.encryptedSeed}}]),_createClass(SaveSeedCtrl,[{key:"_updatePassword",value:function(){this.password&&(this.showPasswordError=!1,this.networkError=!1)}},{key:"showSeed",value:function(){var _this270=this;try{this.networkError=!1,this.showPasswordError=!1;var userSettings=user.getSettingsByUser(this.user),activeUser=_objectSpread({},this.user,{password:this.password,settings:userSettings}),api=ds.signature.getDefaultSignatureApi(activeUser),adapterAvailablePromise=api.isAvailable(!0);return(this._isSeedAdapter(api)||this._isPrivateKey(api)?adapterAvailablePromise.then(function(){return api.getAddress()}).then(function(address){return address===activeUser.address||Promise.reject("Wrong address!")}):modalManager.showLoginByDevice(adapterAvailablePromise,api.type)).then(function(){_this270.isVisibleSeed=!0,ds.app.login(activeUser.address,api),ds.signature.getSignatureApi().getSeed().then(function(seed){_this270.seed=seed})},function(){if(!_this270._isSeedAdapter(api)){var errorData={error:"load-user-error",userType:api.type,address:activeUser.address};return modalManager.showSignDeviceError(errorData).catch(function(){return Promise.resolve()})}_this270._showPasswordError()})}catch(e){this._showPasswordError()}}},{key:"backToUsersList",value:function(){this.password="",this.isVisibleSeed=!1,ds.app.logOut()}},{key:"clickCopySeed",value:function(){analytics.send({name:"Migration Import Continue Click",target:"ui"})}},{key:"_isSeedAdapter",value:function(api){return api.type&&"seed"===api.type}},{key:"_isPrivateKey",value:function(api){return api.type&&"privateKey"===api.type}},{key:"_showPasswordError",value:function(){this.password="",this.showPasswordError=!0,this.networkError=this.user.networkError}},{key:"_initUserList",value:function(){var _this271=this;user.getFilteredUserList().then(function(list){_this271.userList=list,_this271.pendingRestore=!1,_this271._updateActiveUserAddress(),utils.postDigest($scope).then(function(){$scope.$apply()})})}},{key:"_updateActiveUserAddress",value:function(){this.userList.length?(this.activeUserAddress=this.userList[0].address,this.needPassword=!this.userList[0].userType||"seed"===this.userList[0].userType||"privateKey"===this.userList[0].userType):(this.activeUserAddress=null,this.needPassword=!0),this._updatePageUrl()}},{key:"_updatePageUrl",value:function(){this.userList.length?this.pageUrl="".concat(PATH,"/saveSeedHasUsers.html"):this.pageUrl="".concat(PATH,"/saveSeedNoUsers.html")}},{key:"_calculateActiveIndex",value:function(){var activeAddress=this.activeUserAddress,index=null;if(!activeAddress)return null;this.userList.some(function(_ref126,i){return _ref126.address===activeAddress&&(index=i,!0)}),this._activeUserIndex=index,this.needPassword=!this.userList[index].userType||"seed"===this.userList[index].userType||"privateKey"===this.userList[index].userType}}]),SaveSeedCtrl}())};controller.$inject=["Base","$scope","$state","user","modalManager","utils"],angular.module("app.saveSeed").controller("SaveSeedCtrl",controller)}(),function(){var controller=function(Base,$location,$rootScope,$element){return new(function(){function Accordion(){var _this272;return _classCallCheck(this,Accordion),(_this272=_possibleConstructorReturn(this,_getPrototypeOf(Accordion).call(this))).allOpen=!1,_this272.items=[],_this272.observe("items",function(){_this272.allOpen?_this272._accordeonItems=_this272.items.map(function(item){return _objectSpread({},item,{isOpen:!0})}):_this272._accordeonItems=_this272.items}),_this272.scrollToNode=_this272.scrollToNode.bind(_assertThisInitialized(_this272)),_this272.autoScrollUnsubscribe=$rootScope.$watch(function(){return angular.element(".accordion__arrow.up",$element).get(0)},_this272.scrollToNode),_this272.observeOnce("hash",function(){if("string"==typeof _this272.hash){var hashItemIndex=_this272.items.findIndex(function(item){return item.hash===_this272.hash});-1<hashItemIndex?_this272._accordeonItems[hashItemIndex].isOpen=!0:_this272.autoScrollUnsubscribe()}}),_this272}return _inherits(Accordion,Base),_createClass(Accordion,[{key:"scrollToNode",value:function(node){node&&(node.scrollIntoView({block:"center",behavior:"smooth"}),this.autoScrollUnsubscribe())}},{key:"toggleOpen",value:function(item){this._accordeonItems.forEach(function(element){element.isOpen=element===item&&!element.isOpen}),item.hash&&$location.hash(item.hash)}}]),Accordion}())};controller.$inject=["Base","$location","$rootScope","$element"],angular.module("app.ui").component("wAccordion",{bindings:{allOpen:"<",items:"<",hash:"<"},templateUrl:"modules/ui/directives/accordion/accordion.html",controller:controller})}(),function(){var ds=require("data-service"),isEmpty=require("ts-utils").isEmpty,controller=function(Base,$element,utils,waves){return new(function(){function AssetLogo(){var _this273;return _classCallCheck(this,AssetLogo),(_this273=_possibleConstructorReturn(this,_getPrototypeOf(AssetLogo).call(this))).assetId=void 0,_this273.assetName=void 0,_this273.size=void 0,_this273.hasScript=void 0,_this273.isNew=!1,_this273._canPayFee=!1,_this273._isSmart=!1,_this273.observe("_canPayFee",_this273._onChangeCanPayFee),_this273.observe(["_isSmart","hasScript"],_this273._onChangeIsSmart),_this273}return _inherits(AssetLogo,Base),_createClass(AssetLogo,[{key:"$postLink",value:function(){var _this274=this;if(!this.size)throw new Error("Wrong params!");if(!this.isNew){if(!this.assetName&&!this.assetId)throw new Error("Wrong params!");this._canPayFee=!!ds.utils.getTransferFeeList().find(function(money){return money.asset.id===_this274.assetId}),this.assetId&&waves.node.assets.getAsset(this.assetId).then(function(asset){_this274._isSmart=asset.hasScript})}$element.find(".asset-logo__logo").css({width:"".concat(this.size,"px"),height:"".concat(this.size,"px")}),this._addLogo()}},{key:"_addLogo",value:function(){var _this275=this;if(!this.isNew&&this.assetId){var logo=utils.getDataFromOracles(this.assetId).logo;if(logo)return $element.find(".asset-logo__logo").addClass("asset-logo_custom").css("backgroundImage","url(".concat(logo,")")),null;waves.node.assets.getAsset(this.assetId).then(function(asset){var logo=utils.getAssetLogo(_this275.assetId);logo?utils.loadImage(logo).then(function(){$element.find(".asset-logo__logo").css("backgroundImage","url(".concat(logo,")"))}).catch(function(){return _this275._addLetter(asset.name)}):_this275._addLetter(asset.name)})}else $element.addClass("asset-logo_new"),this.observe(["assetName","assetId"],function(){return _this275._addLetter(_this275.assetName)}),this._addLetter(this.assetName)}},{key:"_addLetter",value:function(name){var letter=name.charAt(0).toUpperCase(),color=utils.getAssetLogoBackground(this.assetId),fontSize=Math.round(.43*(Number(this.size)||0));$element.find(".asset-logo__logo, .asset-logo__marker").css({"background-color":color}),$element.find(".asset-logo__letter").text(letter).css({"font-size":"".concat(fontSize,"px")})}},{key:"_onChangeCanPayFee",value:function(){$element.find(".asset-logo__marker").toggleClass("asset-logo__marker_sponsored",this._canPayFee)}},{key:"_onChangeIsSmart",value:function(){var isSmart=isEmpty(this.hasScript)?this._isSmart:this.hasScript;$element.find(".asset-logo__marker").toggleClass("asset-logo__marker_smart",isSmart)}}]),AssetLogo}())};controller.$inject=["Base","$element","utils","waves"],angular.module("app.ui").component("wAssetLogo",{templateUrl:"modules/ui/directives/assetLogo/asset-logo.html",controller:controller,bindings:{assetId:"<",hasScript:"<",assetName:"<",isNew:"<",size:"@"}})}(),angular.module("app.ui").directive("wAutofocus",function(){return{restrict:"A",link:function($scope,$element){var tagName=$element.get(0).tagName.toLowerCase();"input"!==tagName&&"textarea"!==tagName||setTimeout(function(){$element.focus()},100)}}}),function(){var MOUSE_EVENTS_MOVE="mousemove",MOUSE_EVENTS_UP="mouseup",TOUCH_EVENTS_START="touchstart",TOUCH_EVENTS_MOVE="touchmove",TOUCH_EVENTS_END="touchend",POINTER_EVENTS={START:"".concat("mousedown"," ").concat(TOUCH_EVENTS_START),MOVE:"".concat(MOUSE_EVENTS_MOVE," ").concat(TOUCH_EVENTS_MOVE),END:"".concat(MOUSE_EVENTS_UP," ").concat(TOUCH_EVENTS_END)},directive=function(utils,$document,Base){return{scope:!1,link:function($scope,$element){new(function(){function Draggable(){var _this276;_classCallCheck(this,Draggable),_this276=_possibleConstructorReturn(this,_getPrototypeOf(Draggable).call(this,$scope));var element=$element.get(0),startRect=element.getBoundingClientRect();return _this276.x=startRect.left,_this276.y=startRect.top,_this276.delta={x:0,y:0},_this276.touchId=0,_this276.element=element,_this276.$overlay=$('<div class="drag-overlay">'),_this276.moveHandler=_this276._getMoveHandler(),_this276.resizeHandler=utils.debounceRequestAnimationFrame(function(){return _this276._onResize()}),_this276._initializeElementPosition(),_this276._setHandlers(),_this276._draw(),_this276}return _inherits(Draggable,Base),_createClass(Draggable,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(Draggable.prototype),"$onDestroy",this).call(this),$element.remove()}},{key:"_initializeElementPosition",value:function(){var position=$element.css("position");"static"!==position&&"relative"!==position||$element.css("position","absolute"),$element.addClass("drag-element"),document.body.appendChild(this.element)}},{key:"_setHandlers",value:function(){var _this277=this;this.listenEventEmitter($element,POINTER_EVENTS.START,function(e){return _this277._onStart(e)}),this.listenEventEmitter($(window),"resize",this.resizeHandler),$scope.$watch(function(){return _this277._getElementSize()},this.resizeHandler)}},{key:"_onStart",value:function(e){var _this278=this,event=this._getDistilledEvent(e);if(event.type!==TOUCH_EVENTS_START&&event.preventDefault(),0!==event.button)return!1;this.$overlay.insertBefore($element);var rect=this.element.getBoundingClientRect();this.delta.x=event.pageX-rect.left,this.delta.y=event.pageY-rect.top,this.listenEventEmitter($document,POINTER_EVENTS.MOVE,this.moveHandler),this.listenEventEmitter($document,POINTER_EVENTS.END,function(){return _this278._onEnd()})}},{key:"_onMove",value:function(e){var rect=this.element.getBoundingClientRect(),x=e.pageX-this.delta.x,y=e.pageY-this.delta.y;this._updateTranslation(rect,{x:x,y:y}),this._draw()}},{key:"_onResize",value:function(){var rect=this.element.getBoundingClientRect();this._updateTranslation(rect),this._draw()}},{key:"_onEnd",value:function(){this.$overlay.detach(),this.stopListenEventEmitter(POINTER_EVENTS.MOVE,$document),this.stopListenEventEmitter(POINTER_EVENTS.END,$document)}},{key:"_updateTranslation",value:function(rect,argument_1){var coordinates=1<arguments.length&&void 0!==argument_1?argument_1:{x:rect.left,y:rect.top};this.x=Draggable._getValueInRange({min:0,max:innerWidth-rect.width,value:coordinates.x}),this.y=Draggable._getValueInRange({min:0,max:innerHeight-rect.height,value:coordinates.y})}},{key:"_getDistilledEvent",value:function(e){var touch=this._getTouch(e.originalEvent);return{preventDefault:function(){return e.originalEvent.preventDefault()},button:e.button||0,pageX:Draggable._getCoordinateValue(e,touch,"pageX"),pageY:Draggable._getCoordinateValue(e,touch,"pageY"),type:e.type}}},{key:"_getMoveHandler",value:function(){var _this279=this;return utils.debounceRequestAnimationFrame(function(e){return _this279._onMove(_this279._getDistilledEvent(e))})}},{key:"_getTouch",value:function(event){switch(event.type){case TOUCH_EVENTS_START:return this.touchId=event.targetTouches[0].identifier,this._getTouchEventById(event);case TOUCH_EVENTS_MOVE:return this._getTouchEventById(event);case TOUCH_EVENTS_END:return this.touchId=0,event.changedTouches[0];default:return{}}}},{key:"_getTouchEventById",value:function(event){var _this280=this;return Array.prototype.filter.call(event.targetTouches,function(_ref127){return _ref127.identifier===_this280.touchId})[0]}},{key:"_draw",value:function(){$element.css("transform","translate(".concat(this.x,"px, ").concat(this.y,"px)"))}},{key:"_getElementSize",value:function(){return"".concat(this.element.clientWidth," / ").concat(this.element.clientHeight)}}],[{key:"_getValueInRange",value:function(parameters){var min=parameters.min,max=parameters.max,value=parameters.value;return Math.min(Math.max(value,min),max)}},{key:"_getCoordinateValue",value:function(event,touch,coordinate){return"number"!=typeof event[coordinate]?touch[coordinate]:event[coordinate]}}]),Draggable}())}}};directive.$inject=["utils","$document","Base"],angular.module("app.ui").directive("wDraggable",directive)}(),function(){var controller=function(Base){return new(function(){function ExpandBtn(){var _getPrototypeOf6,_this281;_classCallCheck(this,ExpandBtn);for(var _len19=arguments.length,args=new Array(_len19),_key19=0;_key19<_len19;_key19++)args[_key19]=arguments[_key19];return(_this281=_possibleConstructorReturn(this,(_getPrototypeOf6=_getPrototypeOf(ExpandBtn)).call.apply(_getPrototypeOf6,[this].concat(args)))).btnTxt=void 0,_this281.i18key=void 0,_this281.i18nParams=void 0,_this281.isUp=void 0,_this281}return _inherits(ExpandBtn,Base),_createClass(ExpandBtn,[{key:"toggleOpen",value:function(){this.isUp=!this.isUp}}]),ExpandBtn}())};controller.$inject=["Base"],angular.module("app.ui").component("wExpandBtn",{templateUrl:"modules/ui/directives/expandBtn/expandBtn.html",transclude:!0,bindings:{btnTxt:"<",i18key:"<",isUp:"<",i18nParams:"<"},controller:controller})}(),(Row=function(){function Row($element,stService){_classCallCheck(this,Row),this.stService=stService,this._children=[],this.parentCid=$element.closest("[data-cid]").attr("data-cid")}return _createClass(Row,[{key:"registerCell",value:function($element,id){this._children.push({$element:$element,id:id}),this._children.forEach(this._updateId,this)}},{key:"_updateId",value:function(_ref128){var $element=_ref128.$element,id=_ref128.id,index=$element.index(),element=$element.get(0);try{element.parentElement?$element.attr("data-column-id",this.stService.getTableByCid(this.parentCid).getIdByIndex(index)):$element.attr("data-column-id",id)}catch(e){return null}}}]),Row}()).$inject=["$element","stService"],angular.module("app.ui").directive("wTableRow",function(){return{bindings:{},replace:!0,template:'<div class="smart-table__row" ng-transclude></div>',transclude:!0,controller:Row}}),function(){var factory=function(BaseClassComponent,PromiseControl){var componentsHash=Object.create(null);return function(){function PromiseComponent(base){var _this282;return _classCallCheck(this,PromiseComponent),(_this282=_possibleConstructorReturn(this,_getPrototypeOf(PromiseComponent).call(this,base)))._promiseList=[],_this282}return _inherits(PromiseComponent,BaseClassComponent),_createClass(PromiseComponent,[{key:"remove",value:function(){_get(_getPrototypeOf(PromiseComponent.prototype),"remove",this).call(this),delete componentsHash[this.parent.cid],this._promiseList.forEach(function(promise){promise.drop()}),this._promiseList=[]}},{key:"wrap",value:function(promise){var _this283=this,control=new PromiseControl(promise);return this._promiseList.push(control),control.always(function(){var index=_this283._promiseList.indexOf(control);-1!==index&&_this283._promiseList.splice(index,1)}),control}}],[{key:"create",value:function(base,promise){return PromiseComponent._getComponent(base).wrap(promise)}},{key:"_getComponent",value:function(base){return componentsHash[base.cid]||(componentsHash[base.cid]=new PromiseComponent(base)),componentsHash[base.cid]}}]),PromiseComponent}().create};factory.$inject=["BaseClassComponent","PromiseControl"],angular.module("app.utils").factory("createPromise",factory)}(),function(){var factory=function(){var WebStorage=function(){function WebStorage(){_classCallCheck(this,WebStorage)}return _createClass(WebStorage,[{key:"read",value:function(key){return WebStorage._getStorage().readStorage(key).then(function(result){try{return JSON.parse(result)}catch(e){return result}})}},{key:"write",value:function(key,value){return WebStorage._getStorage().writeStorage(key,JSON.stringify(value))}},{key:"clear",value:function(){return WebStorage._getStorage().clearStorage()}},{key:"onUpdate",value:function(){return null}},{key:"init",value:function(){WebStorage._getStorage()}}],[{key:"_getStorage",value:function(){return WebStorage.storage||(WebStorage.storage=_getStorageApi()),WebStorage.storage}}]),WebStorage}();return WebStorage.storage=null,new WebStorage};function _getStorageApi(){return WebStorage}factory.$inject=[],angular.module("app.utils").factory("webStorage",factory)}(),function(){var factory=function(configService,modalManager){var UpdateService=require("data-service").utils.UpdateService,Signal=require("ts-utils").Signal;return new(function(){function ConfigsActionsService(){_classCallCheck(this,ConfigsActionsService),this._timeOutTimerId=void 0,this.change=new Signal,this.initUpdateService()}return _createClass(ConfigsActionsService,[{key:"initUpdateService",value:function(){this._updateService=new UpdateService(6e4)}},{key:"run",value:function(){var _this284=this;this._handleTimers(this._getTimers()),clearTimeout(this._timeOutTimerId),this._timeOutTimerId=setTimeout(function(){return _this284.run()},1e3)}},{key:"_getTimers",value:function(){return configService.get("ACTION_TIMERS")||[]}},{key:"_handleTimers",value:function(timers){var _this285=this,now=Date.now();this.checkUpdateService(),timers.forEach(function(timer){var start=new Date(timer.start).getTime()||0,end=timer.end?new Date(timer.end).getTime():0;start<=now&&now<=end&&(timer.once&&localStorage.getItem(timer.action)||(_this285[timer.action](),localStorage.setItem(timer.action,"1")))})}},{key:"checkUpdateService",value:function(){if(this._updateService.hasUpdate&&!this.isOpen&&this._updateService.getLastUpdate()){var msg=this._updateService.getLastUpdate();this.showUpdateModal(msg)}if(this._updateService.hasUpdate&&!this.isOpen&&this._updateService.isRollback){var title=i18next.t("rollbackTitle",{ns:"app.utils"}),text=i18next.t("rollbackText",{ns:"app.utils"});this.showUpdateModal({title:{ru:"####".concat(title),en:"####".concat(title)},text:{en:"".concat(text),ru:"".concat(text)},isForce:!0})}}},{key:"reloadPage",value:function(){WavesApp.isDesktop()?transfer("reload"):location.reload(!0)}},{key:"showUpdateModal",value:function(msg){var _this286=this;this.isOpen=!0,this._updateService.resetChanges(),msg&&modalManager.showUpdateModal({locals:msg,clickOutsideToClose:!msg.isForce,escapeToClose:!msg.isForce}).catch(function(){return null}).then(function(){return _this286.isOpen=!1,null})}},{key:"updateService",get:function(){return this._updateService}}]),ConfigsActionsService}())};factory.$inject=["configService","modalManager"],angular.module("app").factory("configsActionsService",factory)}(),function(){var ds=require("data-service"),Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,currentCreateOrderFactory=require("@waves/signature-adapter").currentCreateOrderFactory,libs=require("@waves/waves-transactions").libs,address=libs.crypto.address,factory=function(utils,decorators,user,PollCache,configService){var _dec10,_dec11,_dec12,_class7;return new(_dec10=decorators.cachable(.5),_dec11=decorators.cachable(2),_dec12=decorators.cachable(5),_applyDecoratedDescriptor((_class7=function(){function Matcher(){var _this287=this;_classCallCheck(this,Matcher),this.currentMatcherAddress="",this.currentMatcherPublicKey="",this.oldMatcherAddress="",this.pairRestrictions=null,this._orderBookCacheHash=Object.create(null),user.onLogin().then(function(){return _this287._handleLogin()},function(){return _this287._handleLogout()}),ds.api.matcher.matcherData.change.on(function(){return _this287._updateMatcherAddress()}),this._updateOldMatcherAddress(),this._updateMatcherAddress()}return _createClass(Matcher,[{key:"getOrders",value:function(options){return this._getOrders(options,user.address)}},{key:"getPairRestrictions",value:function(pair){var _this288=this;return ds.api.matcher.getPairRestrictions(pair).then(function(restrictions){return _this288.pairRestrictions=restrictions})}},{key:"_scriptInfo",value:function(address){return ds.api.address.getScriptInfo(address)}},{key:"getCreateOrderFee",value:function(order){var _this289=this,config=configService.getFeeConfig();return this.getMinOrderFee().then(function(minFee){var currentFee=currentCreateOrderFactory(config,minFee),matcherAddress=address({publicKey:order.matcherPublicKey},ds.config.get("code"));return Promise.all([_this289._scriptInfo(matcherAddress),ds.api.assets.get("WAVES")]).then(function(_ref129){var _ref130=_slicedToArray(_ref129,2),info=_ref130[0];return{asset:_ref130[1],hasScript:info.extraFee.getTokens().gt(0),currentFee:currentFee}})}).then(function(_ref131){var hasScript=_ref131.hasScript,currentFee=_ref131.currentFee,asset=_ref131.asset,smartAssetIdList=[order.amount.asset,order.price.asset].filter(function(asset){return asset.hasScript}).map(function(asset){return asset.id}),fee=currentFee({assetPair:{amountAsset:order.amount.asset.id,priceAsset:order.price.asset.id},matcherPublicKey:order.matcherPublicKey},hasScript,smartAssetIdList);return new Money(fee,asset)})}},{key:"calculateCustomFeeMap",value:function(order){var smartAssetExtraFee=new BigNumber(configService.getFeeConfig().smart_asset_extra_fee),wavesBaseFee=new BigNumber(order.baseFee),wavesAsset=order.wavesAsset,hasScript=order.matcherInfo.extraFee.getTokens().gt(0),smartPairAssets=[order.pair.amountAsset,order.pair.priceAsset].filter(function(asset){return asset.hasScript});return order.feeAssets.reduce(function(acc,asset){var fee=wavesBaseFee.add(smartAssetExtraFee.mul(function(feeAsset){var feeIsSmartAndNotInPair=feeAsset.hasScript&&smartPairAssets.some(function(asset){return asset.id===feeAsset.id});return smartPairAssets.length+Number(feeIsSmartAndNotInPair)}(asset))).add(smartAssetExtraFee.mul(Number(hasScript)));return acc[asset.id]=new Money(0,asset).cloneWithTokens(new Money(fee,wavesAsset).toTokens()).toCoins(),acc},Object.create(null))}},{key:"getMinOrderFee",value:function(){return Promise.resolve(new BigNumber(3e5))}},{key:"getFeeRates",value:function(){return ds.api.matcher.getFeeRates()}},{key:"getSettings",value:function(){return ds.api.matcher.getSettings()}},{key:"getCreateOrderSettings",value:function(pair,matcherPublicKey){var _this290=this;return this.getSettings().then(function(data){var matcherPublicKeyBytes=libs.crypto.base58Decode(matcherPublicKey),matcherAddress=libs.crypto.address({publicKey:matcherPublicKeyBytes},ds.config.get("code"));if(data.orderFee.dynamic)return Promise.all([_this290._scriptInfo(matcherAddress)].concat(_toConsumableArray(["WAVES"].concat(_toConsumableArray(Object.keys(data.orderFee.dynamic.rates))).map(function(id){return ds.api.assets.get(id)})))).then(function(_ref132){var _ref133=function(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_nonIterableRest()}(_ref132),matcherInfo=_ref133[0],wavesAsset=_ref133[1],feeAssets=_ref133.slice(2);if(!feeAssets.length)throw new Error("Fee list is empty");return{basedCustomFee:_this290.calculateCustomFeeMap({pair:pair,wavesAsset:wavesAsset,matcherInfo:matcherInfo,feeAssets:feeAssets,baseFee:data.orderFee.dynamic.baseFee}),feeMode:"dynamic"}});if(data.orderFee.fixed){var feeValue=data.orderFee.fixed["min-fee"],feeAsset=data.orderFee.fixed.asset;return{fee:new Money(feeValue,feeAsset),feeMode:"fixed"}}throw new Error("Matcher settings are incorrect")}).catch(function(){return _this290.getCreateOrderFee({amount:new Money(0,pair.amountAsset),price:new Money(0,pair.priceAsset),matcherPublicKey:matcherPublicKey}).then(function(fee){return{feeMode:"waves",fee:fee}})})}},{key:"_getOrders",value:function(options,address){return address?ds.api.matcher.getOrders(options).then(ds.processOrdersWithStore):Promise.resolve([])}},{key:"_updateOldMatcherAddress",value:function(){this.oldMatcherAddress="3PJaDyprvekvPXPuAtxrapacuDJopgJRaU3"}},{key:"_updateMatcherAddress",value:function(){this.currentMatcherPublicKey=ds.api.matcher.matcherData.publicKey||"9cpfKN9suPNvfeUNphzxXMjcnn974eme8ZhWUjaktzU5";var matcherPublicKeyBytes=libs.crypto.base58Decode(this.currentMatcherPublicKey),matcherAddress=libs.crypto.address({publicKey:matcherPublicKeyBytes},ds.config.get("code"));this.currentMatcherAddress=matcherAddress}},{key:"_handleLogin",value:function(){this._onUserChangeSetting(),ds.config.change.on(this._onUserChangeSetting,this),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){ds.config.change.off(this._onUserChangeSetting),user.loginSignal.once(this._handleLogin,this)}},{key:"_onUserChangeSetting",value:function(path){"matcher"===path&&this._updateCurrentMatcherAddress()}}],[{key:"_remapOrderBook",value:function(_ref134){var bids=_ref134.bids,asks=_ref134.asks,pair=_ref134.pair;return{pair:pair,bids:Matcher._remapBidAsks(bids,pair),asks:Matcher._remapBidAsks(asks,pair)}}}]),Matcher}()).prototype,"getPairRestrictions",[_dec10],Object.getOwnPropertyDescriptor(_class7.prototype,"getPairRestrictions"),_class7.prototype),_applyDecoratedDescriptor(_class7.prototype,"_scriptInfo",[_dec11],Object.getOwnPropertyDescriptor(_class7.prototype,"_scriptInfo"),_class7.prototype),_applyDecoratedDescriptor(_class7.prototype,"getFeeRates",[_dec12],Object.getOwnPropertyDescriptor(_class7.prototype,"getFeeRates"),_class7.prototype),_class7)};factory.$inject=["utils","decorators","user","PollCache","configService"],angular.module("app").factory("matcher",factory)}(),function(){var factory=function(){return{revert:new tsUtils.Signal,pick:new tsUtils.Signal,clear:new tsUtils.Signal}};factory.$inject=[],angular.module("app.create").factory("seedService",factory)}(),function(){var controller=function(Base,$scope,user,modalManager,balanceWatcher,utils,stService,visibleService,baseAssetService){return new(function(){function MyBalance(){var _this291;return _classCallCheck(this,MyBalance),(_this291=_possibleConstructorReturn(this,_getPrototypeOf(MyBalance).call(this))).balanceList=[],_this291.isDemo=!user.address,_this291.pending=!!user.address,_this291.headers=[{id:"asset",search:function(key,value,list){var serchValue=(key[value]||"").trim(),serachTxt=serchValue.toLowerCase();return serachTxt?list.filter(function(item){return item.asset.id===serchValue||((item.asset.ticker||"")+(item.asset.name||"")).toLowerCase().includes(serachTxt)}):list},sort:!0,placeholder:"directives.filter",valuePath:"item.asset.displayName"},{id:"assetId",sort:!1,title:{literal:"directives.balance.assetId"},valuePath:"item.assetId"},{id:"available",sort:!0,title:{literal:"directives.balance.available"},valuePath:"item.available"},{id:"inOrders",sort:!0,title:{literal:"directives.balance.inOrdersFull"},valuePath:"item.inOrders"},{id:"total",sort:!0,title:{literal:"directives.balance.total"},valuePath:"item.regular"}],_this291.userList=[],_this291.dontShowSpam=user.getSetting("dontShowSpam"),_this291.syncSettings({_assetIdPair:"dex.assetIdPair",dontShowSpam:"dontShowSpam"}),_this291.isDemo||(_this291.balanceList=_this291._getBalanceList(),_this291.receive(balanceWatcher.change,_this291._onChangeBalance,_assertThisInitialized(_this291)),_this291.pending=!0,utils.when(balanceWatcher.ready).then(function(){_this291.pending=!1})),user.getMultiAccountUsers().then(function(list){_this291.userList=list}),_this291.receive(stService.draw,_this291._updateVisible,_assertThisInitialized(_this291)),_this291.observe("dontShowSpam",_this291._onChangeBalance),_this291}return _inherits(MyBalance,Base),_createClass(MyBalance,[{key:"showAssetInfo",value:function(asset){return modalManager.showAssetInfo(asset)}},{key:"isSelected",value:function(asset){return this._assetIdPair.amount===asset.id||this._assetIdPair.price===asset.id}},{key:"isLockedPair",value:function(assetID){return utils.isLockedInDex(assetID)}},{key:"isLockedInDexSmartAssets",value:function(assetA,assetB){return utils.isLockedInDexSmartAssets(assetA,assetB)}},{key:"setPair",value:function(assetId){var _this292=this;if(this.isLockedPair(assetId))return null;var wavesId=baseAssetService.WavesAssetId,btcId=baseAssetService.getIdByTicker("BTC"),assetId2=assetId===wavesId?btcId:wavesId;ds.api.pairs.get(assetId,assetId2).then(function(pair){var amountAsset=pair.amountAsset,priceAsset=pair.priceAsset;_this292.isLockedInDexSmartAssets(amountAsset,priceAsset)?modalManager.showSmartPairModal(amountAsset.ticker||amountAsset.displayName,priceAsset.ticker||priceAsset.displayName):(ds.analytics.dex.changePairFromBalances("".concat(amountAsset.ticker||amountAsset.id," / ").concat(priceAsset.ticker||priceAsset.id)),user.setSetting("dex.assetIdPair",{amount:amountAsset.id,price:priceAsset.id}))})}},{key:"_updateVisible",value:function(name){"balanceList"===name&&visibleService.updateSort()}},{key:"_getBalanceList",value:function(){return this.dontShowSpam?balanceWatcher.getFullBalanceList().filter(MyBalance._isNotScam()):balanceWatcher.getFullBalanceList()}},{key:"_onChangeBalance",value:function(){this.balanceList=this._getBalanceList(),$scope.$apply()}}],[{key:"_isNotScam",value:function(){var spamHash=(user.getSetting("wallet.portfolio.spam")||[]).reduce(function(r,id){return r[id]=!0,r},Object.create(null));return function(item){return!user.scam[item.asset.id]&&!spamHash[item.asset.id]}}}]),MyBalance}())};controller.$inject=["Base","$scope","user","modalManager","balanceWatcher","utils","stService","visibleService","baseAssetService"],angular.module("app.dex").component("wDexMyBalance",{bindings:{},templateUrl:"modules/dex/directives/myBalance/myBalance.html",transclude:!1,controller:controller})}(),function(){var rc=require("react-components"),orderbook=function(reactDirective,matcher,dexDataService,ordersWatcher,user){return reactDirective(rc.OrderBook,void 0,void 0,{matcher:matcher,dexDataService:dexDataService,ordersWatcher:ordersWatcher,user:user})};orderbook.$inject=["reactDirective","matcher","dexDataService","ordersWatcher","user"],angular.module("app.dex").directive("wDexOrderBook",orderbook)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state){return reactDirective(rc.NsbtFaq,void 0,void 0,{$state:$state})};controller.$inject=["reactDirective","$state"],angular.module("app.nsbtFaq").directive("wReactNsbtFaq",controller)}(),angular.module("app.ui").directive("wTableCell",function(){return{require:{parent:"?^wTableRow"},replace:!0,template:'<div class="smart-table__cell" ng-transclude></div>',transclude:!0,link:{post:function($scope,$element,_,_ref135){var parent=_ref135.parent;parent?parent.registerCell($element,$scope.id):$element.attr("data-column-id",$scope.id)}}}}),angular.module("app.ui").directive("wAddClass",function(){return{scope:!1,require:"^^wToggleClassContainer",restrict:"A",link:function($scope,$element,$attrs,$container){$element.on("click",function(){$container.addClass($element.attr("w-toggle-class")||"active")})}}}),angular.module("app.ui").directive("wWebOnlyClass",function(){return{restrict:"A",scope:!1,link:function($scope,$element,$attr){WavesApp.isWeb()&&$element.addClass($attr.wWebOnlyClass)}}}),function(){var controller=function(Base,$element){return new(function(){function Delegate(){var _this293;return _classCallCheck(this,Delegate),(_this293=_possibleConstructorReturn(this,_getPrototypeOf(Delegate).call(this))).event=null,_this293.selector=null,_this293.handler=null,_this293.observe(["event","selector","handler"],_this293._onChangeParams),_this293}return _inherits(Delegate,Base),_createClass(Delegate,[{key:"_onChangeParams",value:function(){var _this294=this;if($element.off(),!this.selector||!this.handler)return null;$element.on(this.event||"click",this.selector,function(e){_this294.handler({$event:e})})}}]),Delegate}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wDelegate",{bindings:{event:"<",selector:"<",handler:"&"},template:"<ng-transclude></ng-transclude>",transclude:!0,controller:controller})}();var SignUpFormCtrl,ShowHidePassword,accessSecurityInformationCtrl,ds=require("data-service"),R=require("ramda");!function(){var controller=function(Base,$scope,waves,PromiseControl,$mdDialog,user,configService,baseAssetService){var analytics=require("data-service").analytics,VISIBLE_ASSETS=["WAVES"];return new(function(){function PinAssetCtrl(){var _this295;return _classCallCheck(this,PinAssetCtrl),(_this295=_possibleConstructorReturn(this,_getPrototypeOf(PinAssetCtrl).call(this,$scope))).search="",_this295.withScam=null,_this295.dontShowSpam=null,_this295.pinnedAssetNewList=[],_this295.pinnedAssetIdList=[],_this295.spam=[],_this295.selectedHash={},_this295.defaultPinnedAssets=baseAssetService.getDefaultPinnedAssets(),_this295.syncSettings({pinnedAssetIdList:"pinnedAssetIdList",unpinnedDefaultAssetIdList:"unpinnedDefaultAssetIdList",spam:"wallet.portfolio.spam",withScam:"withScam",dontShowSpam:"dontShowSpam"}),_this295.observe("search",_this295._fillList),_this295.loadPromise=_this295._getAvilableAssets(),_this295._fillList(),$scope.$watch("$ctrl.pinnedAssetNewList",function(){return _this295.checkChecked()},!0),_this295}var _fillList2,_getAvilableAssets2;return _inherits(PinAssetCtrl,Base),_createClass(PinAssetCtrl,[{key:"checkChecked",value:function(){var _this296=this;this.selected=0,this.pinnedAssetNewList.forEach(function(asset){asset.pinned?_this296.selectedHash[asset.id]=!0:delete _this296.selectedHash[asset.id]}),this.selected=Object.keys(this.selectedHash).length}},{key:"onSubmit",value:function(){var _this297=this,selectedAssets=Object.keys(this.selectedHash);analytics.send({name:"Wallet Assets Pin",params:{Currency:selectedAssets},target:"ui"});var notDefaultAssets=selectedAssets.filter(function(asset){return function(asset){_this297.unpinnedDefaultAssetIdList=_this297.unpinnedDefaultAssetIdList.filter(function(unPinnedAsset){return asset!==unPinnedAsset})}(asset),!_this297.defaultPinnedAssets.includes(asset)});this.pinnedAssetIdList=R.uniq([].concat(_toConsumableArray(this.pinnedAssetIdList),_toConsumableArray(notDefaultAssets))),this.spam=this.spam.filter(function(spamId){return!_this297.pinnedAssetIdList.includes(spamId)}),$mdDialog.hide({selected:this.selected.length})}},{key:"_isSpam",value:function(asset){return(this.spam||[]).includes(asset.id)}},{key:"_getAvilableAssets",value:(_getAvilableAssets2=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(){var defaultAssetsHashId,myAssets,defaultAssets,_this298=this;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return defaultAssetsHashId=baseAssetService.getDefaultAssetsHashId(),_context12.next=3,ds.dataManager.matcherService.getBalances();case 3:return myAssets=_context12.sent,_context12.next=6,waves.node.assets.getAsset(Object.values(defaultAssetsHashId));case 6:return defaultAssets=_context12.sent,_context12.abrupt("return",R.uniqBy(R.prop("id"),[].concat(_toConsumableArray(defaultAssets),_toConsumableArray(myAssets.map(function(x){return x.asset})))).map(function(asset){return _objectSpread({},asset,{pinned:_this298.pinnedAssetIdList.includes(asset.id)})}));case 8:case"end":return _context12.stop()}},_callee12)})),function(){return _getAvilableAssets2.apply(this,arguments)})},{key:"_fillList",value:(_fillList2=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(){var assetsList,searchList;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.t0=this,_context13.next=3,this.loadPromise;case 3:return _context13.t1=_context13.sent,assetsList=_context13.t0._filterAndSort.call(_context13.t0,_context13.t1),_context13.t2=this,_context13.next=8,this._searchByApi();case 8:_context13.t3=_context13.sent,searchList=_context13.t2._filterAndSort.call(_context13.t2,_context13.t3),this.pinnedAssetNewList=R.uniqBy(R.prop("id"),[].concat(_toConsumableArray(assetsList),_toConsumableArray(searchList))),$scope.$digest();case 12:case"end":return _context13.stop()}},_callee13,this)})),function(){return _fillList2.apply(this,arguments)})},{key:"_filterAndSort",value:function(assetsList){var assetId,_this299=this,filteredList=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step3,_iterator2=assetsList[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step3=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var asset=_step3.value;this.pinnedAssetIdList.includes(asset.id)||(assetId=asset.id,_this299.defaultPinnedAssets.includes(assetId)&&!_this299.unpinnedDefaultAssetIdList.includes(assetId)||VISIBLE_ASSETS.includes(asset.id)||(this.withScam||!PinAssetCtrl._isScam(asset)&&!this._isSpam(asset))&&this._isInSearch(asset)&&filteredList.push(asset))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return filteredList}},{key:"_searchByApi",value:function(){return this.search&&this.search.trim().length?(this._searchPromise&&this._searchPromise.drop(),this._searchPromise=new PromiseControl(waves.node.assets.search(this.search.trim())),this._searchPromise.then(function(list){return list},function(){return[]})):[]}},{key:"_isInSearch",value:function(asset){var search=this.search.toUpperCase().trim();return!search||!this.search.length||"".concat(asset.id," ").concat(asset.name," ").concat(asset.ticker).toUpperCase().includes(search)}}],[{key:"_isScam",value:function(asset){return(user.scam||{})[asset.id]}}]),PinAssetCtrl}())};controller.$inject=["Base","$scope","waves","PromiseControl","$mdDialog","user","configService","baseAssetService"],angular.module("app.utils").controller("PinAssetCtrl",controller)}(),function(){var ds=require("data-service"),libs=require("@waves/waves-transactions").libs,path=require("ramda").path,analytics=ds.analytics,controller=function(Base,$scope,waves,user,createPoll,$templateRequest,utils,storage,modalManager,configService,clipboardService){var configs=ds.utils.ConfigService;return new(function(){function SettingsCtrl(){var _this300;_classCallCheck(this,SettingsCtrl),(_this300=_possibleConstructorReturn(this,_getPrototypeOf(SettingsCtrl).call(this,$scope))).allowParing=!0,_this300.encodedSeed="",_this300.shownEncodedSeed=!1,_this300.oracleWaves="",_this300.tab="general",_this300.address=user.address,_this300.publicKey=user.publicKey,_this300.id=user.id,_this300.shownSeed=!1,_this300.shownPrivateKey=!1,_this300.apiToken="",_this300.apiTokenTryAgain=!1,_this300.refreshTokenTryAgain=!1,_this300.shownApiToken=!1,_this300.apiTokenError=!1,_this300.shownRefreshToken=!1,_this300.refreshTokenError=!1,_this300.node="",_this300.matcher="",_this300.api="",_this300.scamListUrl="",_this300.tokensNameListUrl="",_this300.dontShowSpam=!0,_this300.theme=user.getSetting("theme"),_this300.candle=user.getSetting("candle"),_this300.templatePromise=$templateRequest("modules/utils/modals/settings/loader.html"),_this300.openClientMode=null,_this300.logoutAfterMin=null,_this300.termsAndConditionsLink="",_this300.privacyPolicy="",_this300.appName=WavesApp.name,_this300.appVersion=WavesApp.version,_this300.blockHeight=0,_this300.assetsOracleTmp="",_this300.oracleWavesData=path(["oracle"],ds.dataManager.getOracleData("oracleWaves")),_this300.oracleError=!1,_this300.oraclePending=!1,_this300.oracleSuccess=!1,_this300.termsAndConditionsLink=configs.getConfig("termsAndConditions"),_this300.privacyPolicy=configs.getConfig("privacyPolicy"),analytics.send({name:"Settings General Show",target:"ui"}),_this300.observe("tab",function(){var tabName=_this300.tab.slice(0,1).toUpperCase()+_this300.tab.slice(1);analytics.send({name:"Settings ".concat(tabName," Show"),target:"ui"})}),_this300.isScript=user.hasScript(),_this300.node=ds.config.get("node"),_this300.matcher=ds.config.get("matcher"),_this300.api=ds.config.get("api"),_this300.oracleWaves=ds.config.get("oracleWaves"),_this300.syncSettings({logoutAfterMin:"logoutAfterMin",scamListUrl:"scamListUrl",tokensNameListUrl:"tokensNameListUrl",dontShowSpam:"dontShowSpam",theme:"theme",candle:"candle"}),_this300.assetsOracleTmp=_this300.oracleWaves,storage.load("openClientMode").then(function(mode){_this300.openClientMode=mode}),_this300.observe("theme",function(){_this300.templatePromise.then(function(template){template=template.replace("{{bgColor}}",user.getThemeSettings().bgColor),_this300.showLoader(template),utils.wait(1e3).then(function(){return user.changeTheme(_this300.theme)})},function(){return user.changeTheme(_this300.theme)})}),_this300.observe("oracleWaves",function(){ds.config.set("oracleWaves",_this300.oracleWaves),_this300.assetsOracleTmp=_this300.oracleWaves}),_this300.observe("assetsOracleTmp",function(){var address=_this300.assetsOracleTmp;_this300.oraclePending=!0,ds.api.data.getOracleData(address).then(function(data){data.oracle&&(_this300.oracleWavesData=data.oracle,ds.config.set("oracleWaves",address),_this300.oracleWaves=_this300.assetsOracleTmp,_this300.oracleError=!1,_this300.oracleSuccess=!0,setTimeout(function(){_this300.oracleSuccess=!1,$scope.$apply()},1500))}).catch(function(){_this300.oracleError=!0}).then(function(){_this300.oraclePending=!1,$scope.$apply()})}),_this300.observe("dontShowSpam",function(){var dontShowSpam=_this300.dontShowSpam;user.setSetting("dontShowSpam",dontShowSpam)}),_this300.observe("scamListUrl",function(){ds.config.setConfig({scamListUrl:_this300.scamListUrl}),waves.node.assets.stopScam()}),_this300.observe("tokensNameListUrl",function(){ds.config.setConfig({tokensNameListUrl:_this300.tokensNameListUrl}),waves.node.assets.tokensNameList()}),_this300.observe("shownSeed",function(){}),_this300.observe("shownPrivateKey",function(){}),_this300.observe("logoutAfterMin",function(){analytics.user.settingsChangeSessionTime(_this300.logoutAfterMin)}),createPoll(_assertThisInitialized(_this300),waves.node.height,function(height){_this300.blockHeight=height,$scope.$digest()},5e3);var catchProcessor=function(method){try{return method().catch(function(){return null})}catch(e){return Promise.resolve(null)}},api=ds.signature.getSignatureApi();return Promise.all([catchProcessor(function(){return api.getSeed()}),catchProcessor(function(){return api.getPrivateKey()}),catchProcessor(function(){return api.getPublicKey()}),catchProcessor(function(){return api.getEncodedSeed()})]).then(function(_ref136){var _ref137=_slicedToArray(_ref136,4),seed=_ref137[0],privateKey=_ref137[1],publicKey=_ref137[2],encodedSeed=_ref137[3],canSeed=encodedSeed&&seed&&"string"==typeof seed;try{canSeed=canSeed&&libs.crypto.stringToBytes(seed).join(",")===libs.crypto.base58Decode(encodedSeed).join(",")}catch(e){canSeed=!1}_this300.phrase=canSeed?seed:null,_this300.encodedSeed=encodedSeed,_this300.privateKey=privateKey,_this300.publicKey=publicKey,_this300.allowParing=canSeed,_this300.setApiAndRefreshTokens(),$scope.$digest()}),_this300}return _inherits(SettingsCtrl,Base),_createClass(SettingsCtrl,[{key:"openLinkViaWeb",get:function(){return"web"===this.openClientMode},set:function(value){this.openClientMode=value?"web":null,storage.save("openClientMode",this.openClientMode)}},{key:"advancedMode",get:function(){return user.getSetting("advancedMode")},set:function(mode){analytics.send({name:"Settings Advanced Features ".concat(mode?"On":"Off"),target:"ui"}),user.setSetting("advancedMode",mode)}},{key:"supportLink",get:function(){return configs.getConfig("NETWORK.support")}},{key:"supportLinkName",get:function(){return this.supportLink.replace(/^https?:\/\//,"")}}]),_createClass(SettingsCtrl,[{key:"getToken",value:function(){var _this301=this;return ds.utils.ApiTokenService.getInstance().getTokenById().then(function(_ref138){var accessToken=_ref138.accessToken,refreshToken=_ref138.refreshToken;_this301.apiToken=accessToken,_this301.refreshToken=refreshToken})}},{key:"setApiAndRefreshTokens",value:function(){var _this302=this;this.getToken().catch(function(){_this302.apiTokenTryAgain=!0,_this302.refreshTokenTryAgain=!0})}},{key:"setApiToken",value:function(){var _this303=this;this.getToken().then(function(){_this303.apiTokenTryAgain=!1}).catch(function(){_this303.apiTokenTryAgain=!0})}},{key:"setRefreshToken",value:function(){var _this304=this;this.getToken().then(function(){_this304.refreshTokenTryAgain=!1}).catch(function(){_this304.refreshTokenTryAgain=!0})}},{key:"setNetworkDefault",value:function(){this.node=configs.getConfig("NETWORK.node"),this.matcher=configs.getConfig("NETWORK.matcher"),this.dontShowSpam=!0,this.scamListUrl=configs.getConfig("NETWORK.scamListUrl"),this.tokensNameListUrl=configs.getConfig("NETWORK.tokensNameListUrl"),this.oracleWaves=configs.getConfig("NETWORK.oracles.waves"),this.assetsOracleTmp=this.oracleWaves,this.api=configs.getConfig("NETWORK.api")}},{key:"showAccessSecurityInformationModal",value:function(onValid){return modalManager.showAccessSecurityInformationModal(onValid)}},{key:"showSeed",value:function(){var _this305=this;analytics.user.settingsShowSeed(),this.showAccessSecurityInformationModal().then(function(){_this305.shownSeed=!0,analytics.user.settingsShowSeedConfirm()}).catch(function(){_this305.shownSeed=!1})}},{key:"showEncodedSeed",value:function(){var _this306=this;this.showAccessSecurityInformationModal().then(function(){_this306.shownEncodedSeed=!0}).catch(function(){_this306.shownEncodedSeed=!1})}},{key:"showPrivateKey",value:function(){var _this307=this;analytics.user.settingsShowPrivate(),this.showAccessSecurityInformationModal().then(function(){analytics.user.settingsShowPrivateSuccess(),_this307.shownPrivateKey=!0}).catch(function(){_this307.shownPrivateKey=!1})}},{key:"secureCopy",value:function(text){return this.showAccessSecurityInformationModal(function(){return clipboardService.copy(text)})}},{key:"secureCopySeed",value:function(){return this.shownSeed?clipboardService.copy(this.phrase).then(function(){return analytics.user.settingsCopySeedSuccess()}):(analytics.user.settingsCopySeed(),this.secureCopy(this.phrase).then(function(){return analytics.user.settingsCopySeedSuccess()}))}},{key:"secureCopyEncodedSeed",value:function(){return this.shownEncodedSeed?clipboardService.copy(this.encodedSeed):this.secureCopy(this.encodedSeed)}},{key:"secureCopyPrivateKey",value:function(){return this.shownPrivateKey?clipboardService.copy(this.privateKey).then(function(){return analytics.user.settingsCopyPrivateSuccess()}):(analytics.user.settingsCopyPrivate(),this.secureCopy(this.privateKey).then(function(){return analytics.user.settingsCopyPrivateSuccess()}))}},{key:"showApiToken",value:function(){this.shownApiToken=!0,analytics.user.settingsShowToken("Private")}},{key:"showRefreshToken",value:function(){this.shownRefreshToken=!0,analytics.user.settingsShowToken("Refresh")}},{key:"copyApiToken",value:function(){clipboardService.copy(this.apiToken).then(function(){return analytics.user.settingsCopyToken("Private")})}},{key:"copyRefreshToken",value:function(){clipboardService.copy(this.refreshToken).then(function(){return analytics.user.settingsCopyToken("Refresh")})}},{key:"showExportAccountModal",value:function(){return modalManager.showExportAccount()}},{key:"showPairingWithMobile",value:function(){return modalManager.showPairingWithMobile()}},{key:"showLoader",value:function(template){var loaderEl=document.createElement("div");loaderEl.innerHTML=template,document.body.appendChild(loaderEl),setTimeout(function(){document.body.removeChild(loaderEl)},4100)}},{key:"showScriptModal",value:function(){modalManager.showScriptModal()}},{key:"showPasswordModal",value:function(){modalManager.showPasswordModal()}},{key:"showConfirmDeleteUser",value:function(){modalManager.showConfirmDeleteUser(user).then(function(){user.deleteMultiAccountUser(user.hash).then(function(){Promise.all([user.getMultiAccountUsers(),user.getFilteredUserList()]).then(function(_ref139){var _ref140=_slicedToArray(_ref139,2),multiAccountUsers=_ref140[0],userListLocked=_ref140[1];multiAccountUsers&&multiAccountUsers.length?(user.logout("switch",!0),user.login(multiAccountUsers[0])):userListLocked&&userListLocked.length?user.logout("migrate",!0):user.logout("create",!0)})})})}},{key:"onBlurSetting",value:function(prop){this[prop]=this[prop]?this[prop]:void 0}}]),SettingsCtrl}())};controller.$inject=["Base","$scope","waves","user","createPoll","$templateRequest","utils","storage","modalManager","configService","clipboardService"],angular.module("app.utils").controller("SettingsCtrl",controller)}(),angular.module("app.wallet.portfolio",[]),angular.module("app.defoInvestmentFaq",[]),function(){var _require63=require("data-service"),analytics=_require63.analytics,ConfigService=_require63.utils.ConfigService,controller=function(Base,$scope,$document,$state,user,multiAccount,storageImporter,storage,modalManager,migrationService){var getConfig=function(argument_0){var path=0<arguments.length&&void 0!==argument_0?argument_0:void 0;return ConfigService.getInstance().getConfig(path)};return new(function(){function MigrationCtrl(){var _this308;_classCallCheck(this,MigrationCtrl),(_this308=_possibleConstructorReturn(this,_getPrototypeOf(MigrationCtrl).call(this,$scope))).state="idle",_this308.hasAccount=!1,_this308.termsAccepted=!1,_this308.termsAgreement=!1,_this308.privacyPolicyAgreement=!1,_this308.isImportInProgress=!1,_this308.data=null;var config=getConfig();if(_this308.privacyPolicyUrl=config.privacyPolicy,_this308.termsAgreementUrl=config.termsAndConditions,WavesApp.isWeb())try{_this308.isMigration?(history.replaceState("exportProcessed","",location.toString()),user.getMultiAccountData().then(function(multiAccountData){multiAccountData&&(_this308.hasAccount=!0)})):_this308.state="faq"}catch(e){_this308.state="faq"}else user.getMultiAccountData().then(function(multiAccountData){multiAccountData&&(_this308.hasAccount=!0)});return $state.params.faq&&(_this308.state="faq"),"idle"===_this308.state&&_this308._listen(),storage.load("termsAccepted").then(function(termsAccepted){_this308.termsAccepted=termsAccepted}),_this308}var _changeLang2,_loginToFirstUser2,_login2;return _inherits(MigrationCtrl,Base),_createClass(MigrationCtrl,[{key:"migrationError",get:function(){return("error"===this.state||"faq"===this.state)&&"exportProcessed"===history.state}},{key:"isMigration",get:function(){var hasOpener=!!window.opener,isFirsEnter=history&&"exportProcessed"!==history.state;return hasOpener&&isFirsEnter}}]),_createClass(MigrationCtrl,[{key:"importAccount",value:function(){var _this309=this;return this.isImportInProgress=!0,analytics.send({name:"End migration"}),storageImporter.import(this.data).then(function(){return _this309.isImportInProgress=!1,storage.save("migrationStatus","success")}).catch(function(){return _this309.state="error",_this309.isImportInProgress=!1,storage.save("migrationStatus",_this309.state)})}},{key:"signUp",value:function(password){var _this310=this;if(!this.isImportInProgress){var _this$data$storageDat=this.data.storageData,userList=_this$data$storageDat.userList,multiAccountUsers=_this$data$storageDat.multiAccountUsers,hasLegacyUsers=Array.isArray(userList)&&0<userList.length;return multiAccount.signUp(password,user.getSetting("encryptionRounds")).then(function(data){return user.saveMultiAccount(data)}).then(function(){return storage.save("termsAccepted",!0)}).then(function(){return _this310.importAccount()}).then(function(){!hasLegacyUsers||multiAccountUsers&&0!==Object.keys(multiAccountUsers).length?_this310._loginToFirstUser():(_this310.state="unlock",$scope.$digest())}).catch(function(){_this310.state="error",$scope.$digest()})}}},{key:"login",value:(_login2=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(){var multiAccountData,multiAccountHash;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(this.isImportInProgress)return _context14.abrupt("return");_context14.next=2;break;case 2:if(multiAccount.isSignedIn){_context14.next=11;break}return _context14.next=5,user.getMultiAccountData();case 5:return multiAccountData=_context14.sent,_context14.next=8,user.getMultiAccountHash();case 8:return multiAccountHash=_context14.sent,_context14.next=11,multiAccount.signIn(multiAccountData,this.data.password,user.getSetting("encryptionRounds"),multiAccountHash);case 11:this._loginToFirstUser(),history.replaceState("","",location.toString());case 13:case"end":return _context14.stop()}},_callee14,this)})),function(){return _login2.apply(this,arguments)})},{key:"onResetPassword",value:function(){this.hasAccount=!1;var multiAccountUsers=this.data.storageData.multiAccountUsers;this.termsAccepted||this.termsAgreement&&this.privacyPolicyAgreement?multiAccountUsers&&0!==Object.keys(multiAccountUsers).length?this.importAccountAndLogin():this.state="signup":this.state="ready"}},{key:"onFinishUnlock",value:function(){this._loginToFirstUser()}},{key:"importAccountAndLogin",value:function(){var _this311=this;if(!this.isImportInProgress)return this.hasAccount?this.importAccount().then(function(){return _this311.login()}).then(function(){return storage.save("termsAccepted",!0)}):this.signUp(this.data.password).then(function(){return storage.save("termsAccepted",!0)})}},{key:"_loginToFirstUser",value:(_loginToFirstUser2=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(){var _ref141,_ref142,firstUser;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,user.getMultiAccountUsers();case 2:if(_ref141=_context15.sent,_ref142=_slicedToArray(_ref141,1),firstUser=_ref142[0])return _context15.next=8,user.logout("switch",!0);_context15.next=14;break;case 8:return _context15.next=10,user.login(firstUser);case 10:modalManager.showMigrationAchivementModal(),user.goToActiveState(),_context15.next=16;break;case 14:modalManager.showMigrationAchivementModal(),$state.go("create");case 16:case"end":return _context15.stop()}},_callee15)})),function(){return _loginToFirstUser2.apply(this,arguments)})},{key:"_listen",value:function(){var _this312=this;WavesApp.isWeb()?(migrationService.listen(),migrationService.onConnect(function(){_this312._awaitData()})):this._awaitData(),this.state="progress"}},{key:"_awaitData",value:function(){var _this313=this;clearTimeout(this._timer),migrationService.onEnd(),analytics.send({name:"Channel connection"}),WavesApp.isWeb()&&(this._timer=setTimeout(function(){migrationService.onEnd(),_this313.state="faq",$scope.$digest()},2e4)),migrationService.onData(function(data){if(clearTimeout(_this313._timer),_this313.data=data,_this313._changeLang(data),_this313.hasAccount)_this313.state="signin";else{var _this313$data$storage=_this313.data.storageData,userList=_this313$data$storage.userList,multiAccountUsers=_this313$data$storage.multiAccountUsers;!userList||multiAccountUsers&&0!==Object.keys(multiAccountUsers).length?_this313.termsAccepted?(_this313.state="success",_this313.importAccountAndLogin()):_this313.state="ready":_this313.state="signup"}analytics.send({name:"Data transfer success"}),storage.save("migrationStatus",_this313.state),migrationService.onEnd(),$scope.$digest()},function(){analytics.send({name:"Data transfer failure"}),storage.save("migrationStatus",_this313.state),migrationService.onEnd(),$scope.$digest()})}},{key:"_checkRefferer",value:function(){var referrer=document.referrer;if(!referrer)return!1;var origin=new URL(referrer).origin,config=getConfig("MIGRATION");return!(WavesApp.isProduction()&&config&&Array.isArray(config.origins))||config.origins.includes(origin)}},{key:"_changeLang",value:(_changeLang2=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(data){return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if(data&&data.storageData&&data.storageData.multiAccountSettings&&data.storageData.multiAccountSettings.lng)return _context16.next=3,storage.load("lng");_context16.next=5;break;case 3:_context16.sent||i18next.changeLanguage(data.storageData.multiAccountSettings.lng);case 5:case"end":return _context16.stop()}},_callee16)})),function(_x13){return _changeLang2.apply(this,arguments)})}]),MigrationCtrl}())};controller.$inject=["Base","$scope","$document","$state","user","multiAccount","storageImporter","storage","modalManager","migrationService"],angular.module("app.migration").controller("MigrationCtrl",controller)}(),function(){var BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),controller=function(Base,waves,user,createPoll,$scope,baseAssetService){return new(function(){function ChangeRate(){var _this314;return _classCallCheck(this,ChangeRate),(_this314=_possibleConstructorReturn(this,_getPrototypeOf(ChangeRate).call(this))).rate=null,_this314.assetId=null,_this314.precision=null,_this314.viewPrecision=2,_this314.mirror=null,_this314.date=null,_this314.poll=null,_this314.observe("assetId",_this314._onChangeAssetId),_this314.observe("precision",_this314._onChangeAssetId),_this314}return _inherits(ChangeRate,Base),_createClass(ChangeRate,[{key:"$postLink",value:function(){var _this315=this;this.interval=Number(this.interval)||5e3;var baseAssetId=baseAssetService.getBaseAssetId();this.mirrorPrecision=baseAssetService.getBaseAssetPrecision(),waves.node.assets.getAsset(baseAssetId).then(function(mirror){_this315.mirror=mirror,_this315.noUpdate?_this315._onChangeAssetId():_this315.poll=createPoll(_this315,_this315._getRate,"rate",_this315.interval,{$scope:$scope})})}},{key:"_onChangeAssetId",value:function(){var _this316=this,mirrorPrecision=null==this.mirrorPrecision?this.precision:this.mirrorPrecision;this.mirror&&(this.viewPrecision=null==this.precision?mirrorPrecision:this.precision),this.assetId&&(this.poll?this.poll.restart():this._getRate().then(function(rate){_this316.rate=rate,$scope.$digest()}))}},{key:"_getRate",value:function(){return this.assetId&&this.mirror&&ds.api.rate.getRate(this.assetId,this.mirror.id).then(function(rate){return rate})||Promise.resolve(new BigNumber(0))}}]),ChangeRate}())};controller.$inject=["Base","waves","user","createPoll","$scope","baseAssetService"],angular.module("app.ui").component("wChangeRate",{bindings:{assetId:"<",precision:"<",noUpdate:"@",interval:"@",date:"@"},template:'<span w-nice-number="$ctrl.rate" precision="$ctrl.viewPrecision" class="z-top"></span>',transclude:!1,controller:controller})}(),function(){var controller=function(Base,$element){var SELECTORS_plate=".chart-plate",SELECTORS_marker=".chart-plate__marker",SCALE=devicePixelRatio||1;return new(function(){function ChartPlate(){var _getPrototypeOf7,_this317;_classCallCheck(this,ChartPlate);for(var _len20=arguments.length,args=new Array(_len20),_key20=0;_key20<_len20;_key20++)args[_key20]=arguments[_key20];return(_this317=_possibleConstructorReturn(this,(_getPrototypeOf7=_getPrototypeOf(ChartPlate)).call.apply(_getPrototypeOf7,[this].concat(args)))).options=void 0,_this317}return _inherits(ChartPlate,Base),_createClass(ChartPlate,[{key:"$postLink",value:function(){this.plate=$element.find(SELECTORS_plate),this.marker=$element.find(SELECTORS_marker),this.receive(this.wChart.signals.mouseMove,this._onMove,this),this.receive(this.wChart.signals.mouseLeave,this._onLeave,this)}},{key:"_onMove",value:function(data){this._setMarkerAndPlatePosition(data)}},{key:"_onLeave",value:function(){this.plate.removeClass("visible"),this.marker.removeClass("visible")}},{key:"_setMarkerAndPlatePosition",value:function(_ref144){var plateX,event=_ref144.event,point=_ref144.point,id=_ref144.id,x=point.x,y=point.y,markerX=x/SCALE-this.marker.outerWidth()/2,markerY=y/SCALE-this.marker.outerHeight()/2;event.offsetX<$element.closest("w-chart").innerWidth()/2?(plateX=x/SCALE+this.marker.outerWidth()/2+5,this.plate.addClass("to-right")):(plateX=markerX-this.plate.outerWidth()-5,this.plate.removeClass("to-right"));var plateY=y/SCALE-this.plate.outerHeight()/2;if(this.plate.css("transform","translate(".concat(plateX,"px,").concat(plateY,"px)")),this.marker.css("transform","translate(".concat(markerX,"px,").concat(markerY,"px)")),this.plate.addClass("visible"),this.marker.addClass("visible"),this.options&&this.options.markerColors){var markerColors=this.options.markerColors,color="string"==typeof markerColors&&markerColors||markerColors[id];this.marker.css("border-color",color)}}}]),ChartPlate}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wChartPlate",{transclude:!0,require:{wChart:"^wChart"},bindings:{options:"<"},templateUrl:"modules/ui/directives/chartPlate/chartPlate.html",controller:controller})}(),angular.module("app.ui").component("wEmptyBlock",{templateUrl:"modules/ui/directives/emptyBlock/emptyBlock.html"}),angular.module("app.ui").component("wErrorBlock",{templateUrl:"modules/ui/directives/errorBlock/errorBlock.html"}),function(){var controller=function(Base,$element,utils){var tsUtils=require("ts-utils");return new(function(){function ImportFile(){var _this318;return _classCallCheck(this,ImportFile),(_this318=_possibleConstructorReturn(this,_getPrototypeOf(ImportFile).call(this))).extensionList=null,_this318.onChange=null,_this318._input=ImportFile._createInput(),_this318._setHandlers(),_this318}return _inherits(ImportFile,Base),_createClass(ImportFile,[{key:"$onDestroy",value:function(){document.body.removeChild(this._input),_get(_getPrototypeOf(ImportFile.prototype),"$onDestroy",this).call(this)}},{key:"_setHandlers",value:function(){var _this319=this;this.listenEventEmitter($element,"click",function(){return _this319._onClick()}),this.listenEventEmitter(this._input,"change",function(){return _this319._onChange()},{on:"addEventListener",off:"removeEventListener"})}},{key:"_onChange",value:function(){var file=_slicedToArray(this._input.files,1)[0];if(file){if(!this._isFileValid(file))return this.onChange({data:{status:"error",type:"extension",message:"Wrong extension",file:file}}),null;this.onChange({data:{status:"ok",file:file}})}this._input.value=""}},{key:"_onClick",value:function(){this._input.click()}},{key:"_isFileValid",value:function(file){if(tsUtils.isNotEmpty(this.extensionList)){var extensionList=utils.toArray(this.extensionList),fileExtension=file.name.split(".")[1];return fileExtension&&extensionList.some(function(ext){return ext===fileExtension})}return!0}}],[{key:"_createInput",value:function(){var input=document.createElement("input");return input.type="file",input.style.position="absolute",input.style.left="-100px",input.style.top="-100px",document.body.appendChild(input),input}}]),ImportFile}())};controller.$inject=["Base","$element","utils"],angular.module("app.ui").component("wImportFile",{bindings:{extensionList:"<",onChange:"&"},template:"<ng-transclude></ng-transclude>",transclude:!0,controller:controller})}(),function(){var analytics=require("data-service").analytics,SELECTORS={MAIN_HEADER_USER:"js-main-header-user",MAIN_HEADER_FADER:"js-main-header-fader",TOOLTIP_RENAME:"js-tooltip-rename",HEADER:"js-header"},controller=function(Base,stateManager,modalManager,user,$state,$element,$document,utils,$scope,userNameService,multiAccount,configService,referralLinkService,storage){var pathOr=require("ramda").pathOr,PATH="modules/ui/directives/mainHeader/templates";return new(function(){function MainHeaderCtrl(){var _this320;_classCallCheck(this,MainHeaderCtrl),(_this320=_possibleConstructorReturn(this,_getPrototypeOf(MainHeaderCtrl).call(this,$scope))).userName=void 0,_this320.userList=[],_this320.userListLocked=[],_this320.hasMultiAccount=!1,_this320.isUniqueUserName=!0,_this320.showInput=!1,_this320.isMenuOpen=!1,_this320.isShowAccounts=!1,_this320.logoRef="",_this320.lang="",_this320.telegramLink="",_this320.hasReferral=!1,$scope.ERROR_DISPLAY_INTERVAL=3,$scope.user=user,$scope.SELECTORS=SELECTORS,$scope.MAX_USER_NAME_LENGTH=userNameService.MAX_USER_NAME_LENGTH,_this320.userName=userNameService.name,_this320.address=user.address||"3PHBX4uXhCyaANUxccLHNXw3sqyksV7YnDz",_this320.isLogined=!!user.address,_this320.userType=user.userType,_this320.isDesktop=WavesApp.isDesktop(),_this320.isScript=user.hasScript(),_this320.isKeeper="wavesKeeper"===user.userType,_this320.isLedger="ledger"===user.userType,_this320.hasTypeHelp=_this320.isScript&&(_this320.isLedger||_this320.isKeeper),_this320.largeTemplate="".concat(PATH,"/largeHeader.html"),_this320.mobileTemplate="".concat(PATH,"/mobileHeader.html");var desktopUrls=configService.get("DESKTOP_URLS")||{};return _this320.electronWindows=desktopUrls.win,_this320.electronLinux=desktopUrls.linux,_this320.electronMac=desktopUrls.mac,user.onLogin().then(function(){return _this320._handleLogin()},function(){return _this320._handleLogout()}),_this320.observe("userName",function(){userNameService.setName(_this320.userName),userNameService.isUniqueName().then(function(data){_this320.isUniqueUserName=data})}),_this320.receive(utils.observe(userNameService,"name"),function(){_this320.userName=userNameService.name},_assertThisInitialized(_this320)),_this320.observe("isUniqueUserName",function(){_this320.setUserName&&_this320.setUserName.userName.$setValidity("user-name-unique",_this320.isUniqueUserName)}),user.getMultiAccountData().then(function(data){_this320.hasMultiAccount=!!data}),_this320.receive(utils.observe($state.current,"url"),_this320.onChangeLoginedOrUrl),_this320.observe("isLogined",_this320.onChangeLoginedOrUrl),_this320.onChangeLoginedOrUrl(),_this320.isMigration="migration"===$state.current.name,_this320._onChangeLanguge=_this320._onChangeLang.bind(_assertThisInitialized(_this320)),i18next.on("languageChanged",_this320._onChangeLanguge),_this320._onChangeLang(),_this320.hasReferral=referralLinkService.hasReferral,_this320.receive(utils.observe(referralLinkService,"hasReferral"),function(){_this320.hasReferral=referralLinkService.hasReferral},_assertThisInitialized(_this320)),_this320.syncSettings({_userTradingPair:"dex.assetIdPair"}),_this320.tradingPair=_this320._getTradingPairFromUserSettings(),_this320.observe("_userTradingPair",function(){_this320.tradingPair=_this320._getTradingPairFromUserSettings()}),_this320}return _inherits(MainHeaderCtrl,Base),_createClass(MainHeaderCtrl,[{key:"hasAddressMigrationAchievement",value:function(address){return address?user.hasAddressMigrationAchievement(address):user.hasAddressMigrationAchievement(pathOr("",["currentUser","address"],user))}},{key:"hideTooltip",value:function(){$element.find(".".concat(SELECTORS.TOOLTIP_RENAME)).hide()}},{key:"onFocus",value:function(){this.hideTooltip()}},{key:"onBlur",value:function(){var _this321=this;this.userName?this.showInput&&userNameService.save().then(function(){_this321._onUserNameSave()}):this.onCancel()}},{key:"showTooltip",value:function(){$element.find(".".concat(SELECTORS.TOOLTIP_RENAME)).show()}},{key:"onCancel",value:function(){this.showTooltip(),this.setNameView(),this._resetUserName()}},{key:"onSave",value:function(){var _this322=this;userNameService.save().then(function(){_this322._onUserNameSave()})}},{key:"logout",value:function(){user.logout("signIn")}},{key:"showAliases",value:function(){this.removeBodyClass(),this.closeDropdown(),this.isLogined?modalManager.showAccountInfo():this._getDialogModal("account",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"changeName",value:function(){this.removeBodyClass(),this.isLogined?modalManager.showAccountChangeName():this._getDialogModal("account",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"showAddress",value:function(){this.removeBodyClass(),this.isLogined?modalManager.showAccountAddress():this._getDialogModal("account",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(MainHeaderCtrl.prototype),"$onDestroy",this).call(this),i18next.off("languageChanged",this._onChangeLanguge)}},{key:"showSettings",value:function(){this.removeBodyClass(),this.isLogined?(this.closeDropdown(),modalManager.showSettings()):this._getDialogModal("settings",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"toggleAccounts",value:function(){this.isMenuOpen=!this.isMenuOpen,this.isShowAccounts=!this.isShowAccounts}},{key:"removeInnerMenu",value:function(){$document.find(".".concat(SELECTORS.HEADER)).removeClass("show-wallet show-aliases show-downloads show-address show-news show-defi")}},{key:"removeBodyClass",value:function(){$document.find("body").removeClass("menu-is-shown")}},{key:"toggleBodyClass",value:function(){$document.find("body").toggleClass("menu-is-shown")}},{key:"setNameView",value:function(value){var _this323=this;this.showInput=void 0!==value?value:!this.showInput,utils.postDigest($scope).then(function(){_this323.showInput&&_this323.setUserName.userName.$$element.focus()})}},{key:"toggleDropdown",value:function(){var mainHeaderUser=$element.find(".".concat(SELECTORS.MAIN_HEADER_USER));mainHeaderUser.hasClass("open")&&(this.isShowAccounts=!1,this.isMenuOpen=!1),mainHeaderUser.toggleClass("open"),$element.find(".".concat(SELECTORS.MAIN_HEADER_FADER)).toggleClass("show-fader")}},{key:"closeDropdown",value:function(){var mainHeaderUser=$element.find(".".concat(SELECTORS.MAIN_HEADER_USER));mainHeaderUser.hasClass("open")&&(this.onBlur(),this.isShowAccounts=!1,this.isMenuOpen=!1),mainHeaderUser.removeClass("open"),$element.find(".".concat(SELECTORS.MAIN_HEADER_FADER)).removeClass("show-fader")}},{key:"onMobileTogglerClick",value:function(){this.removeInnerMenu(),$element.find(".".concat(SELECTORS.HEADER)).toggleClass("expanded"),this.toggleBodyClass()}},{key:"onMobileFaderClick",value:function(){$element.find(".".concat(SELECTORS.HEADER)).removeClass("expanded"),this.removeBodyClass()}},{key:"switchUser",value:function(toUser){toUser.hash!==user.hash&&(this.closeDropdown(),this.removeBodyClass(),user.logout("switch",!0),user.login(toUser),analytics.user.switchAddressSuccess())}},{key:"unlockUser",value:function(userToUnlock){$state.go("migrate",{id:multiAccount.hash(userToUnlock.address)})}},{key:"deleteUser",value:function(userToDelete){var _this324=this;this.closeDropdown(),modalManager.showConfirmDeleteUser(userToDelete).then(function(){return userToDelete.hash?user.deleteMultiAccountUser(userToDelete.hash).then(function(){_this324.userList=_this324.userList.filter(function(userInList){return userInList.hash!==userToDelete.hash}),0===_this324.userList.length?0===_this324.userListLocked.length?user.logout("create",!0):user.logout("migrate",!0):userToDelete.hash===user.hash&&_this324.switchUser(_this324.userList[0])}):user.removeUserByAddress(userToDelete.address).then(function(){_this324.userListLocked=_this324.userListLocked.filter(function(userInList){return userInList.address!==userToDelete.address})})})}},{key:"isCurrentUser",value:function(userInList){return userInList.hash===user.hash}},{key:"onChangeLoginedOrUrl",value:function(){this._setLogoRef()}},{key:"addGtmEvent",value:function(event,params){analytics.addGtmEvent(event,params)}},{key:"onDownloadClick",value:function(label){this.removeBodyClass(),analytics.mobileApp.downloadClick(label)}},{key:"onNewsClick",value:function(notViewedAmount){analytics.header.goToNews(0<notViewedAmount?"Has news":"No News")}},{key:"logoClick",value:function(){analytics.header.wavesExchangeClick()}},{key:"investmentsClick",value:function(){"investments"!==$state.$current.name&&(this.removeBodyClass(),analytics.header.investmentsClick())}},{key:"tradeClick",value:function(){"main.trade"!==$state.$current.name&&(this.removeBodyClass(),analytics.header.tradingClick())}},{key:"downloadDesktopClick",value:function(label){analytics.header.downloadDesktopClick(label)}},{key:"onOtcClick",value:function(){analytics.otc.useOtcClick("UP"),this.removeBodyClass()}},{key:"_onUserNameSave",value:function(){this.showTooltip(),this.setNameView(),this.userList.find(function(cur){return cur.hash===user.hash}).name=user.name,$scope.$digest()}},{key:"_handleLogin",value:function(){var _this325=this;this._resetUserFields(),user.getMultiAccountUsers().then(function(){var users=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_this325.userList=users.reduce(function(acc,userInList){return userInList.hash===user.hash?acc.unshift(userInList):acc.push(userInList),acc},[])}),user.getFilteredUserList().then(function(){var users=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_this325.userListLocked=users}),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._resetUserFields(),user.loginSignal.once(this._handleLogin,this)}},{key:"_resetUserFields",value:function(){var _this326=this;this.address=user.address||"3PHBX4uXhCyaANUxccLHNXw3sqyksV7YnDz",this.isLogined=!!user.address,this.userName=user.name,this.userType=user.userType,this.isScript=user.hasScript(),this.isKeeper="wavesKeeper"===user.userType,this.isLedger="ledger"===user.userType,this.hasTypeHelp=this.isScript&&(this.isLedger||this.isKeeper),this.userList=[],user.getMultiAccountData().then(function(data){_this326.hasMultiAccount=!!data}),this._onChangeLang()}},{key:"_getDialogModal",value:function(type,success,error){return modalManager.showDialogModal({iconClass:"".concat(type.replace(/\./g,"-"),"-account-info"),message:{literal:"modal.".concat(type,".message")},buttons:[{success:!1,classes:"big",text:{literal:"modal.".concat(type,".cancel")},click:error},{success:!0,classes:"big submit",text:{literal:"modal.".concat(type,".ok")},click:success}]})}},{key:"_resetUserName",value:function(){userNameService.setName(user.name)}},{key:"getShortId",value:function(id){return id?utils.getShortId(id):""}},{key:"_setLogoRef",value:function(){-1===$state.current.url.indexOf("migration")?this.isLogined?this.logoRef="main.wallet":this.logoRef="welcome":this.logoRef="",this.isCreate=-1<$state.current.url.indexOf("create"),this.isImport=-1<$state.current.url.indexOf("import"),this.canShowLogin=!(this.isCreate||this.isImport||this.isLogined)}},{key:"enterFromState",value:function(name,argument_1,argument_2){var stateName=2<arguments.length&&void 0!==argument_2?argument_2:"staking";1<arguments.length&&void 0!==argument_1&&argument_1&&this.removeBodyClass(),user.forceInitRouteState(stateName),$state.go(name)}},{key:"onClickSignIn",value:function(){analytics.header.loginClick();["investments","prediction","buyBTC"].includes($state.current.name)?this.enterFromState("signIn",!0,$state.current.name):"stakingLanding"!==$state.current.name?"defoLanding"!==$state.current.name?$state.go("signIn"):this.enterFromState("signIn",!0,"defo"):this.enterFromState("signIn",!0,"staking")}},{key:"onClickSignUp",value:function(){storage.load("termsAccepted").then(function(termsAccepted){analytics.user.signUpPageShow(!!termsAccepted)}),analytics.header.signUpClick(),"prediction"!==$state.current.name?"stakingLanding"!==$state.current.name?"defoLanding"!==$state.current.name?$state.go("signUp"):this.enterFromState("signUp",!0,"defo"):this.enterFromState("signUp",!0,"staking"):this.enterFromState("signUp",!0,"prediction")}},{key:"_onChangeLang",value:function(){this.lang=i18next.language,this.telegramLink="https://t.me/wavesexchange".concat("ru"===this.lang?"ru":""),utils.safeApply($scope)}},{key:"_getTradingPairFromUserSettings",value:function(){if(!this._userTradingPair)return"";var _this$_userTradingPai=this._userTradingPair,amount=_this$_userTradingPai.amount,price=_this$_userTradingPai.price;return amount&&price?"".concat(amount,"_").concat(price):""}},{key:"isSignedIn",get:function(){return multiAccount.isSignedIn}}]),MainHeaderCtrl}())};controller.$inject=["Base","stateManager","modalManager","user","$state","$element","$document","utils","$scope","userNameService","multiAccount","configService","referralLinkService","storage"],angular.module("app.ui").component("wMainHeader",{templateUrl:"modules/ui/directives/mainHeader/templates/mainHeader.html",transclude:!1,controller:controller})}(),angular.module("app.ui").component("wNavigation",{transclude:!0,bindings:{type:"@type"},template:'<div class="navigation {{$ctrl.type}}" ng-transclude></div>'}),function(){var controller=function(Base,$scope,$element,utils,decorators){var _dec13,_class9;return new(_dec13=decorators.async(),_applyDecoratedDescriptor((_class9=function(){function NiceNumber(){var _this327;return _classCallCheck(this,NiceNumber),(_this327=_possibleConstructorReturn(this,_getPrototypeOf(NiceNumber).call(this,$scope))).listenEventEmitter(i18next,"languageChanged",function(){return _this327.$onChanges()}),_this327.receive(utils.observe($scope,"number"),_this327.$onChanges,_assertThisInitialized(_this327)),_this327.receive(utils.observe($scope,"precision"),_this327.$onChanges,_assertThisInitialized(_this327)),_this327}return _inherits(NiceNumber,Base),_createClass(NiceNumber,[{key:"$onChanges",value:function(){if(null==$scope.number)return $element.html("");$element.html(utils.getNiceNumberTemplate($scope.number,$scope.precision,$scope.shortMode))}}]),NiceNumber}()).prototype,"$onChanges",[_dec13],Object.getOwnPropertyDescriptor(_class9.prototype,"$onChanges"),_class9.prototype),_class9)};controller.$inject=["Base","$scope","$element","utils","decorators"],angular.module("app").directive("wNiceNumber",function(){return{restrict:"A",scope:{number:"<wNiceNumber",precision:"<",shortMode:"<"},controller:controller}})}(),function(){var controller=function(Base,$element,QrCodeReadService,$templateRequest,utils,$compile,$scope,decorators){var _dec14,_dec15,_dec16,_class10;return new(_dec14=decorators.async(),_dec15=decorators.async(),_dec16=decorators.async(),_applyDecoratedDescriptor((_class10=function(){function QrCodeRead(){var _this328;_classCallCheck(this,QrCodeRead),(_this328=_possibleConstructorReturn(this,_getPrototypeOf(QrCodeRead).call(this))).maxWidth=null,_this328.maxHeight=null,_this328.isWatched=!1,_this328.popupNode=null,_this328.onRead=null,_this328.readService=null,_this328.videoSize=null,_this328.templatePromise=$templateRequest("".concat("modules/ui/directives/qrCodeRead","/cameraPopup.html")),_this328.videoError=!1,_this328.isFlip=!1,_this328.observe("isWatched",_this328._dropLastVideoSize),_this328.observe(["isWatched","videoSize"],_this328._onChangeWatched),_this328.observe("videoSize",_this328._onChangeVideoSize);var positionHandler=utils.debounceRequestAnimationFrame(function(){return _this328._onChangePosition()});return _this328.listenEventEmitter(window,"resize",positionHandler,{on:"addEventListener",off:"removeEventListener"}),_this328.listenEventEmitter(document,"scroll",positionHandler,{on:"addEventListener",off:"removeEventListener",capture:!0}),_this328}return _inherits(QrCodeRead,Base),_createClass(QrCodeRead,[{key:"videoPending",get:function(){return!this.isWatched||!this.videoSize&&!this.videoError}}]),_createClass(QrCodeRead,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(QrCodeRead.prototype),"$onDestroy",this).call(this),this._removeReadQrService(),this._removePopup()}},{key:"turnVideo",value:function(){this.videoError||(this.isFlip=!this.isFlip)}},{key:"toggleWatchQrCode",value:function(){var _this329=this;if(this.isWatched)return this.stopWatchQrCode(),null;this.videoError=!1,this.isWatched=!0,this.webCamError=!1,this.onWatchQr&&this.onWatchQr(),this._createPopup().then(function(){return _this329._createReadQrService()})}},{key:"stopWatchQrCode",value:function(){this.isWatched=!1,this._removeReadQrService()}},{key:"_onChangePosition",value:function(){this.isWatched&&this._setPopupPosition()}},{key:"_createReadQrService",value:function(){if(!this.readService){var maxSize,_$element=$(this.popupNode).find(".js-camera-wrapper");maxSize=WavesApp.device.phone()?{width:window.innerWidth,height:window.innerHeight}:{width:this.maxWidth,height:this.maxHeight},this.readService=new QrCodeReadService({$element:_$element,maxSize:maxSize}),this.receiveOnce(this.readService.onRead,this._onSuccessReadQrCode,this),this.receiveOnce(this.readService.onError,this._onErrorRead,this),this.receiveOnce(this.readService.onHasSize,this._onAddVideoSize,this)}return this}},{key:"_onErrorRead",value:function(){this.videoError=!0,this._setPopupPosition(),$scope.$apply()}},{key:"_onAddVideoSize",value:function(size){this.videoSize=size,$scope.$apply()}},{key:"_onSuccessReadQrCode",value:function(text){this.onRead({text:text}),this.isWatched=!1}},{key:"_removeReadQrService",value:function(){return this.readService&&(this.stopReceive(this.readService.onRead),this.stopReceive(this.readService.onError),this.stopReceive(this.readService.onHasSize),this.readService.destroy(),this.readService=null,this.videoSize=null),this}},{key:"_onChangeVideoSize",value:function(){this._addPopupSize(),this._setPopupPosition()}},{key:"_createPopup",value:function(){var _this330=this;return this.popupNode?Promise.resolve():this.templatePromise.then(function(template){var $node=$compile(template)($scope);_this330.popupNode=$node.get(0),document.body.appendChild(_this330.popupNode),_this330._onChangeWatched(),_this330._setPopupPosition()})}},{key:"_removePopup",value:function(){this.popupNode&&document.body.removeChild(this.popupNode)}},{key:"_onChangeWatched",value:function(){this.popupNode&&(this.popupNode.classList.toggle("active",this.isWatched),this.isWatched&&this._setPopupPosition())}},{key:"_dropLastVideoSize",value:function(){this.isWatched||this.stopWatchQrCode()}},{key:"_setPopupPosition",value:function(){var $btn=$element.find(".btn"),offset=$btn.offset(),videoWrapper=this.popupNode.querySelector(".js-camera-wrapper"),width=videoWrapper.clientWidth,height=videoWrapper.clientHeight,top=offset.top-height/2+$btn.height()/2,left=offset.left-(width+10);$(this.popupNode).find(".js-camera-wrapper").offset({top:top,left:left})}},{key:"_addPopupSize",value:function(){if(!this.videoSize)return null;var videoWrapper=this.popupNode.querySelector(".js-camera-wrapper"),factor=Math.min(this.maxWidth/this.videoSize.width,this.maxHeight/this.videoSize.height),width=Math.round(this.videoSize.width*factor),height=Math.round(this.videoSize.height*factor);videoWrapper.style.width="".concat(width,"px"),videoWrapper.style.height="".concat(height,"px")}}]),QrCodeRead}()).prototype,"_onErrorRead",[_dec14],Object.getOwnPropertyDescriptor(_class10.prototype,"_onErrorRead"),_class10.prototype),_applyDecoratedDescriptor(_class10.prototype,"_onAddVideoSize",[_dec15],Object.getOwnPropertyDescriptor(_class10.prototype,"_onAddVideoSize"),_class10.prototype),_applyDecoratedDescriptor(_class10.prototype,"_onSuccessReadQrCode",[_dec16],Object.getOwnPropertyDescriptor(_class10.prototype,"_onSuccessReadQrCode"),_class10.prototype),_class10)};controller.$inject=["Base","$element","QrCodeReadService","$templateRequest","utils","$compile","$scope","decorators"],angular.module("app.ui").component("wQrCodeRead",{bindings:{maxWidth:"<",maxHeight:"<",onRead:"&",onWatchQr:"&"},templateUrl:"".concat("modules/ui/directives/qrCodeRead","/qrCodeRead.html"),controller:controller})}(),function(){var controller=function(Base,$scope,$element){return new(function(){function SignButton(){var _this331;return _classCallCheck(this,SignButton),(_this331=_possibleConstructorReturn(this,_getPrototypeOf(SignButton).call(this))).disabled=!1,_this331.signable=null,_this331.onSuccess=null,_this331.onCancel=null,_this331.onClick=null,_this331.signPending=!1,_this331.ns=null,_this331.observe("ns",_this331._updateNs),_this331._updateNs(),_this331.observe("signPending",function(){$scope.$emit("signPendingChange",_this331.signPending)}),_this331}return _inherits(SignButton,Base),_createClass(SignButton,[{key:"onSignSuccess",value:function(){this.signPending=!1;var signable=this.signable;this.signable=null,this.onSuccess({signable:signable})}},{key:"onSignCancel",value:function(){this.signPending=!1,this.signable=null,this.onCancel()}},{key:"onClickButton",value:function(){var _this332=this,some=this.onClick();if(!some)throw new Error("Has no signable!");SignButton.isPromiseLike(some)?some.then(function(signable){_this332.signable=signable,$scope.$apply()}).catch(function(){_this332.signPending=!1}):this.signable=some,this.signPending=!0}},{key:"_getNs",value:function(){return this.ns||"app.ui"}},{key:"_updateNs",value:function(){$element.attr("w-i18n-ns",this._getNs())}}],[{key:"isPromiseLike",value:function(some){return some&&some.then&&"function"==typeof some.then}}]),SignButton}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wSignButton",{controller:controller,scope:!1,bindings:{ns:"<",disabled:"<",hideId:"<",onClick:"&",onSuccess:"&",onCancel:"&"},transclude:!0,templateUrl:"modules/ui/directives/signButton/sign-button.html"})}(),function(){var PATH="modules/ui/directives/smartTable/templates",controller=function(Base,$scope,$element,decorators,$templateRequest,$compile,utils,stService,i18n){var _dec17,_dec18,_dec19,_class12,tsUtils=require("ts-utils");return new(_dec17=decorators.async(),_dec18=decorators.async(),_dec19=decorators.async(),_applyDecoratedDescriptor((_class12=function(){function SmartTable(){var _this333;return _classCallCheck(this,SmartTable),(_this333=_possibleConstructorReturn(this,_getPrototypeOf(SmartTable).call(this))).data=null,_this333.headerInfo=null,_this333._filterList=[],_this333.options=null,_this333._headerData=null,_this333._header=null,_this333._visibleList=[],_this333._filtredList=[],_this333._headerCellPromise=$templateRequest("".concat(PATH,"/headerCell.html")),_this333.observe("headerInfo",_this333._onChangeHeader),_this333.observe("options",_this333._onChangeOptions),_this333.observeOnce("_headerData",function(){_this333.observe(["_headerData","data","filterList","options"],_this333.render),_this333.render()}),stService.register(_assertThisInitialized(_this333)),_this333}return _inherits(SmartTable,Base),_createClass(SmartTable,[{key:"$postLink",value:function(){this._header=$element.find(".smart-table__thead")}},{key:"$onDestroy",value:function(){stService.unregister(this),_get(_getPrototypeOf(SmartTable.prototype),"$onDestroy",this).call(this)}},{key:"getIdByIndex",value:function(index){return this.headerInfo[index].id}},{key:"_onChangeOptions",value:function(_ref145){var _this334=this,value=_ref145.value,prev=_ref145.prev;this._dropOldOptions(prev),utils.toArray(value&&value.filter||[]).forEach(function(item){_this334._filterList.push(item)})}},{key:"_dropOldOptions",value:function(oldOptions){var _this335=this;if(!oldOptions)return null;utils.toArray(oldOptions.filter).forEach(function(filter){_this335._filterList=_this335._filterList.filter(function(f){return f!==filter})})}},{key:"_applySort",value:function(){this._sort(),this._draw()}},{key:"render",value:function(){this._visibleList=[],this._filtredList=[],this.data&&this.data.length&&(this._filter(),this._sort()),this._draw()}},{key:"_onChangeHeader",value:function(){var _this336=this,headers=this.headerInfo,defaultNs=i18n.getNs($element);if(!headers||!headers.length)return null;var $tr=this._header.find(".smart-table__row");$tr.empty(),this._clearHeader(),Promise.all(this.headerInfo.map(this._remapHeaders,this)).then(function(headerDataList){headerDataList.forEach(function(data){var descriptorHash=Object.create(null);data.sort&&(data.$element.on("click",".sort-by",_this336._getClickHeaderHandler(data)),Object.assign(descriptorHash,{sorting:{get:function(){return data.sorting},enumerable:!1,configurable:!1},isAsc:{get:function(){return data.isAsc},enumerable:!1,configurable:!1}})),data.search&&(_this336._filterList.push(data.search),descriptorHash.searchQuery={get:function(){return data.searchQuery},set:function(value){value!==data.searchQuery&&(data.searchQuery=value,_this336.render())}}),data.$scope.title=data.title||Object.create(null),data.$scope.title.ns=data.$scope.title&&data.$scope.title.ns||defaultNs,data.$scope.sort=!!data.sort,data.$scope.search=!!data.search,data.$scope.placeholder=data.placeholder,Object.defineProperties(data.$scope,descriptorHash),$tr.append(data.$element)}),_this336._headerData=headerDataList,$scope.$digest()})}},{key:"_clearHeader",value:function(){var headerData=this._headerData;headerData&&headerData.length&&headerData.forEach(function(item){item.$scope.$destroy()}),this._headerData=[]}},{key:"_remapHeaders",value:function(header){var id=header.id,title=header.title,valuePath=header.valuePath||id,$headerScope=$scope.$new(!0),xhr=header.templatePath?$templateRequest(header.templatePath):this._headerCellPromise,sorting=header.sortActive||!1;return Object.assign($headerScope,_objectSpread({},header.scopeData||Object.create(null)),{id:id}),xhr.then(function(template){var $element=$compile(template)($headerScope);return{id:id,title:title,valuePath:valuePath,sort:SmartTable._getSortFunction(header.sort,valuePath),search:SmartTable._getSearchFunction($headerScope,header.search,valuePath),sorting:sorting,isAsc:!!tsUtils.isEmpty(header.isAsc)||header.isAsc,searchQuery:"",$scope:$headerScope,$element:$element,placeholder:header.placeholder||"filter"}})}},{key:"_getClickHeaderHandler",value:function(headerData){var _this337=this;return function(){headerData.sorting?headerData.isAsc=!headerData.isAsc:(_this337._headerData.forEach(function(item){item.sorting=!1}),headerData.sorting=!0,headerData.isAsc=!1),_this337.name&&stService.draw.once(function(){stService.sort.dispatch({name:_this337.name,isAsc:headerData.isAsc})}),_this337._applySort()}}},{key:"_sort",value:function(){var header=tsUtils.find(this._headerData||[],{sorting:!0});this._visibleList=header?header.sort(this._filtredList.slice(),header.isAsc):this._filtredList.slice()}},{key:"_filter",value:function(){var filters=this._getFilterList();if(!filters||!filters.length)return this._filtredList=this.data.slice(),null;this._filtredList=filters.reduce(function(result,filter){return filter(result)},this.data.slice())}},{key:"_getFilterList",value:function(){return utils.toArray(this._filterList||[])}},{key:"_draw",value:function(){var _this338=this;$scope.$parent.$data=this._visibleList,SmartTable._postDraw().then(function(){_this338.name&&stService.draw.dispatch(_this338.name)}),$scope.$parent.$digest()}}],[{key:"_postDraw",value:function(){return new Promise(function(resolve){$scope.$parent.$$postDigest(resolve)})}},{key:"_getSortFunction",value:function(sort,valuePath){return"function"==typeof sort?sort:sort&&function(list,isAsc){var method=isAsc?"asc":"desc";return list.sort(utils.comparators.process(function(item){return tsUtils.get({item:item},valuePath)}).smart[method])}||null}},{key:"_getSearchFunction",value:function($scope,search,valuePath){return"function"==typeof search?function(list){return search($scope,"searchQuery",list)}:search&&function(list){return function($scope,key,list){var query=$scope[key];return query?list.filter(function(item){var value=tsUtils.get({item:item},valuePath);return-1!==String(value).toLowerCase().indexOf(query.toLowerCase())}):list}($scope,"searchQuery",list)}||null}}]),SmartTable}()).prototype,"render",[_dec17],Object.getOwnPropertyDescriptor(_class12.prototype,"render"),_class12.prototype),_applyDecoratedDescriptor(_class12.prototype,"_onChangeHeader",[_dec18],Object.getOwnPropertyDescriptor(_class12.prototype,"_onChangeHeader"),_class12.prototype),_applyDecoratedDescriptor(_class12.prototype,"_draw",[_dec19],Object.getOwnPropertyDescriptor(_class12.prototype,"_draw"),_class12.prototype),_class12)};controller.$inject=["Base","$scope","$element","decorators","$templateRequest","$compile","utils","stService","i18n"],angular.module("app.ui").component("wSmartTable",{bindings:{name:"@",data:"<",options:"<",headerInfo:"<"},templateUrl:"".concat(PATH,"/table.html"),transclude:!0,controller:controller})}(),function(){var module=angular.module("app.ui"),controller=function(Base){return function(){function StepButton(){return _classCallCheck(this,StepButton),_possibleConstructorReturn(this,_getPrototypeOf(StepButton).apply(this,arguments))}return _inherits(StepButton,Base),StepButton}()};controller.$inject=["Base"],module.component("wStepButton",{bindings:{onStepClick:"&",position:"<",isDisabled:"<"},transclude:!0,templateUrl:"modules/ui/directives/stepButton/stepButton.html",controller:controller})}(),function(){var controller=function(Base,$element,ComponentList,$scope){return new(function(){function StepByStep(){var _this339;return _classCallCheck(this,StepByStep),(_this339=_possibleConstructorReturn(this,_getPrototypeOf(StepByStep).call(this)))._steps=new ComponentList,_this339.activeStep=null,_this339.observe("activeStep",_this339._onChangeStep),$element.on("click","[w-step-next]",function(){_this339._setStep(_this339._getStepIndex()+1),$scope.$apply()}),$element.on("click","[w-step-prev]",function(){_this339._setStep(_this339._getStepIndex()-1),$scope.$apply()}),_this339}return _inherits(StepByStep,Base),_createClass(StepByStep,[{key:"registerStep",value:function(step){var id=step.id||this._steps.length;step.id=id,this._steps.push(step),null==this.activeStep&&(this.activeStep=step.id),this._onChangeStep()}},{key:"_onChangeStep",value:function(){var _this340=this;this._steps.forEach(function(step){step.displayToggle(_this340.activeStep===step.id)})}},{key:"_getStepIndex",value:function(){return this._steps.index(this.activeStep,"id")}},{key:"_setStep",value:function(index){this._steps.components[index]&&(this.activeStep=this._steps.components[index].id)}}]),StepByStep}())};controller.$inject=["Base","$element","ComponentList","$scope"],angular.module("app.ui").component("wStepByStep",{bindings:{activeStep:"="},template:'<div class="step-list" ng-transclude></div>',transclude:!0,controller:controller})}(),function(){var controller=function(Base,$scope){return new(function(){function ScriptModalCtrl(){var _this341;return _classCallCheck(this,ScriptModalCtrl),(_this341=_possibleConstructorReturn(this,_getPrototypeOf(ScriptModalCtrl).call(this,$scope))).tx=null,_this341.state=Object.create(null),_this341.step=0,_this341.observe("activeTab",_this341._onChangeActiveTab),_this341._onChangeActiveTab(),_this341}return _inherits(ScriptModalCtrl,Base),_createClass(ScriptModalCtrl,[{key:"activeState",get:function(){return this.state[this.activeTab]}}]),_createClass(ScriptModalCtrl,[{key:"onClickBack",value:function(){this.step--}},{key:"nextStep",value:function(signable){this.signable=signable,this.step++}},{key:"_onChangeActiveTab",value:function(){var tab=this.activeTab;this.state[tab]||(this.state[tab]=Object.create(null))}}]),ScriptModalCtrl}())};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("ScriptModalCtrl",controller)}(),function(){var factory=function(){var LocalStorage=function(){function LocalStorage(){_classCallCheck(this,LocalStorage)}return _createClass(LocalStorage,[{key:"read",value:function(key){var result=LocalStorage.getStorage().getItem(key);try{return JSON.parse(result)}catch(e){return result}}},{key:"write",value:function(key,value){var api=LocalStorage.getStorage();try{return api.setItem(key,JSON.stringify(value)),Promise.resolve(null)}catch(e){return Promise.resolve(e)}}},{key:"clear",value:function(){var api=LocalStorage.getStorage();try{return api.clear(),Promise.resolve(null)}catch(e){return Promise.resolve(e)}}},{key:"onUpdate",value:function(){return null}},{key:"init",value:function(){LocalStorage.getStorage()}},{key:"canIUse",value:function(){try{return getStorageApi().setItem("___test",String(Date.now())),!0}catch(e){return!1}}}],[{key:"getStorage",value:function(){return LocalStorage.storage||(LocalStorage.storage=getStorageApi()),LocalStorage.storage}}]),LocalStorage}();return LocalStorage.storage=null,new LocalStorage};function getStorageApi(){return localStorage}factory.$inject=[],angular.module("app.utils").factory("localStorage",factory)}(),angular.module("app.wallet").controller("WalletHeaderCtrl",function(){}),function(){var controller=function(Base,$scope,user){return new(function(){function BuyBTCFaqCtrl(){var _this342;return _classCallCheck(this,BuyBTCFaqCtrl),(_this342=_possibleConstructorReturn(this,_getPrototypeOf(BuyBTCFaqCtrl).call(this,$scope))).isLogined=!!user.address,_this342}return _inherits(BuyBTCFaqCtrl,Base),BuyBTCFaqCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.buyBTCFaq").controller("BuyBTCFaqCtrl",controller)}(),function(){var ORDERS_TYPES_asks="asks",ORDERS_TYPES_bids="bids",ORDER_LIST_STUB=[{amount:0,price:0}],THRESHOLD_VALUES={asks:2,bids:2},COLORS={default:{lineColor:{asks:"#e5494d",bids:"#1f5af6"},fillColor:{asks:"rgba(229, 73, 77, 0.15)",bids:"rgba(90, 129, 234, 0.15"}},black:{lineColor:{asks:"#e5494d",bids:"#5a81ea"},fillColor:{asks:"rgba(229, 73, 77, 0.15)",bids:"rgba(90, 129, 234, 0.15)"}}},ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber,controller=function(Base,utils,waves,$scope,user){return new(function(){function TradeGraph(){var _this343;_classCallCheck(this,TradeGraph),(_this343=_possibleConstructorReturn(this,_getPrototypeOf(TradeGraph).call(this))).loadingError=!1,_this343._chartCropRate=null,_this343.canShowGraph=!1,_this343.pending=!0,_this343.options={axisX:"price",axisY:"amount",marginBottom:0,hasDates:!1,checkWidth:!0,view:{asks:{lineColor:COLORS.default.lineColor.asks,fillColor:COLORS.default.fillColor.asks,lineWidth:4},bids:{lineColor:COLORS.default.lineColor.bids,fillColor:COLORS.default.fillColor.bids,lineWidth:4}}},_this343.chartPlateOptions={},_this343.theme="default",_this343.data={asks:ORDER_LIST_STUB,bids:ORDER_LIST_STUB},_this343.syncSettings({_chartCropRate:"dex.chartCropRate",theme:"theme"});var orderBookState=ds.dataManager.orderbookSubject.getValue();return _this343._setOrderBook(_objectSpread({bids:ORDER_LIST_STUB,asks:ORDER_LIST_STUB},orderBookState)),_this343.orderbookSubscription=ds.dataManager.orderbookSubject.subscribe(function(state){_this343._setOrderBook(state)}),_this343.theme=user.getSetting("theme"),_this343._setChartPlateOptions(),_this343._setChartOptionsView(),_this343.observe("theme",_this343._onThemeChange),_this343}return _inherits(TradeGraph,Base),_createClass(TradeGraph,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(TradeGraph.prototype),"$onDestroy",this).call(this),this.orderbookSubscription.unsubscribe()}},{key:"onMouse",value:function(chartData){var id=chartData.id,_chartData$point=chartData.point,xValue=_chartData$point.xValue,yValue=_chartData$point.yValue;this.chartEvent=_objectSpread({},chartData,{id:"".concat(id[0].toUpperCase()).concat(id.substring(1)),amount:new BigNumber(yValue).toFormat(),price:new BigNumber(xValue).toFormat()})}},{key:"_setOrderBook",value:function(orderBook){if(orderBook.loaded)if(orderBook.error)this.loadingError=!0;else{this.pending=!1,this.loadingError=!1;var data=TradeGraph._buildCumulativeOrderBook(this._cutOffOutlyingOrdersIfNecessary(orderBook));this._updateGraphAccordingToOrderBook(data),this.data={asks:data.asks,bids:data.bids},utils.safeDigest($scope)}else this.pending=!0}},{key:"_cutOffOutlyingOrdersIfNecessary",value:function(orderBook){if(TradeGraph._isLackOfAsks(orderBook)||TradeGraph._isLackOfBids(orderBook))return orderBook;var filteredOrderBook=utils.filterOrderBookByCharCropRate({chartCropRate:this._chartCropRate,cropRange:orderBook.chartInfo.cropRange,asks:orderBook.asks,bids:orderBook.bids});return TradeGraph._areEitherAsksOrBids(filteredOrderBook)?filteredOrderBook:orderBook}},{key:"_updateGraphAccordingToOrderBook",value:function(orderBook){try{this.canShowGraph=!!TradeGraph._areEitherAsksOrBids(orderBook)}catch(e){this.canShowGraph=!1}return orderBook}},{key:"_setChartOptionsView",value:function(){this.options=_objectSpread({},this.options,{view:this._getViewOptions()})}},{key:"_getViewOptions",value:function(){switch(this.theme){case"black":return{asks:{lineColor:COLORS[this.theme].lineColor.asks,fillColor:COLORS[this.theme].fillColor.asks,lineWidth:2},bids:{lineColor:COLORS[this.theme].lineColor.bids,fillColor:COLORS[this.theme].fillColor.bids,lineWidth:2}};default:return{asks:{lineColor:COLORS.default.lineColor.asks,fillColor:COLORS.default.fillColor.asks,lineWidth:4},bids:{lineColor:COLORS.default.lineColor.bids,fillColor:COLORS.default.fillColor.bids,lineWidth:4}}}}},{key:"_setChartPlateOptions",value:function(){switch(this.theme){case"black":this.chartPlateOptions=_objectSpread({},this.chartPlateOptions,{markerColors:COLORS[this.theme].lineColor});break;default:this.chartPlateOptions=_objectSpread({},this.chartPlateOptions,{markerColors:COLORS.default.lineColor})}}},{key:"_onThemeChange",value:function(){var _this344=this;utils.wait(1e3).then(function(){_this344._setChartOptionsView(),_this344._setChartPlateOptions()})}}],[{key:"_areEitherAsksOrBids",value:function(orderBook){return TradeGraph._areEnoughAsks(orderBook)||TradeGraph._areEnoughBids(orderBook)}},{key:"_areEnoughAsks",value:function(orderBook){return!TradeGraph._isLackOfAsks(orderBook)}},{key:"_areEnoughBids",value:function(orderBook){return!TradeGraph._isLackOfBids(orderBook)}},{key:"_isLackOfAsks",value:function(orderBook){return TradeGraph._isLackOf(orderBook,ORDERS_TYPES_asks)}},{key:"_isLackOfBids",value:function(orderBook){return TradeGraph._isLackOf(orderBook,ORDERS_TYPES_bids)}},{key:"_isLackOf",value:function(orderBook,ordersType){var asksOrBids=orderBook[ordersType];return Array.isArray(asksOrBids)&&asksOrBids.length<THRESHOLD_VALUES[ordersType]}},{key:"_buildCumulativeOrderBook",value:function(_ref146){var asks=_ref146.asks,bids=_ref146.bids;return{asks:TradeGraph._buildCumulativeOrderList(asks),bids:TradeGraph._buildCumulativeOrderList(bids)}}},{key:"_buildCumulativeOrderList",value:function(list){var _this345=this,amount=new BigNumber(0);return list.reduce(function(result,item){return amount=amount.add(new BigNumber(item.amount)),result.push({amount:Number(amount.toFixed(_this345._chartCropRate)),price:Number(item.price)}),result},[])}}]),TradeGraph}())};controller.$inject=["Base","utils","waves","$scope","user"],angular.module("app.dex").component("wDexTradeGraph",{templateUrl:"modules/dex/directives/tradeGraph/tradeGraph.html",controller:controller})}(),function(){var rc=require("react-components"),wMarketMaking=function(reactDirective,$state){return reactDirective(rc.MarketMaking,void 0,void 0,{$state:$state})};wMarketMaking.$inject=["reactDirective","$state"],angular.module("app.marketMaking").directive("wMarketMaking",wMarketMaking)}(),function(){var i18next=require("i18next"),rc=require("react-components"),controller=function(reactDirective,modalManager,$state){return reactDirective(rc.DepositLiraWrapper,["liraModalProps"],void 0,{modalManager:modalManager,$state:$state,i18next:i18next})};controller.$inject=["reactDirective","modalManager","$state"],angular.module("app.ui").directive("wReactLiraModal",controller)}(),function(){var tsUtils=require("ts-utils"),factory=function(Base,utils){return new(function(){function VisibleService(){var _this346;return _classCallCheck(this,VisibleService),(_this346=_possibleConstructorReturn(this,_getPrototypeOf(VisibleService).call(this))).children=Object.create(null),_this346._handlerdebounce=utils.debounceRequestAnimationFrame(function(e){return _this346._onScroll(e)}),_this346._initHandlerDebounce=utils.debounce(function(){return _this346._onScroll()},50),_this346._updateSortDebounce=utils.debounce(function(){return _this346.updateSort()},50),_this346}return _inherits(VisibleService,Base),_createClass(VisibleService,[{key:"checkVisibleContent",value:function(){this._handlerdebounce()}},{key:"registerVisibleComponent",value:function(visible,$parent){var _this347=this;if(!$parent.length)throw new Error("Element visible has no parent!");var id=VisibleService._getParentId($parent);this.children[id]||(this.children[id]={scrollTop:$parent.scrollTop(),visible:Object.create(null),list:[]}),this.children[id].list.push(visible),this.receiveOnce(visible.signals.destroy,function(){_this347.children[id].list=_this347.children[id].list.filter(function(i){return i!==visible}),_this347.children[id].list.length||delete _this347.children[id],0===Object.keys(_this347.children).length&&_this347._removeHandlers(),_this347._updateSortDebounce()}),1===Object.keys(this.children).length&&1===this.children[id].list.length&&this._addHandlers(),this._updateSortDebounce()}},{key:"updateSort",value:function(){var _this348=this;Object.keys(this.children).forEach(function(id){var visibleElements=$("#".concat(id," .w-visible")).toArray(),childrenHash=utils.toHash(_this348.children[id].list,"cid"),sortList=_this348.children[id].list.map(function(item){return{cid:item.cid,index:visibleElements.indexOf(item.node)}});sortList.sort(utils.comparators.process(function(i){return i.index}).asc),_this348.children[id].list=sortList.map(function(item){return childrenHash[item.cid]}),_this348.children[id].visible=Object.create(null)}),this._onScroll()}},{key:"unregisterVisibleComponent",value:function(visible){Object.values(this.children).forEach(function(info){info.list=info.list.filter(function(i){return i!==visible}),delete info.visible[visible.cid]}),this.stopReceive(visible.signals.destroy)}},{key:"_onScroll",value:function(e){var _this349=this,target=e&&e.target,id=target&&target.getAttribute&&target.getAttribute("id");id&&this.children[id]?this._scrollById(target.scrollTop,id):Object.keys(this.children).forEach(function(id){var element=document.querySelector("#".concat(id));element?(_this349.children[id].visible=Object.create(null),_this349._scrollById(element.scrollTop,id)):delete _this349.children[id]})}},{key:"_scrollById",value:function(activeScrollTop,id){var _this350=this,direction=this.children[id].scrollTop<activeScrollTop,visibleHash=this.children[id].visible;if(this.children[id].visible=Object.create(null),!Object.keys(visibleHash).length)return this.children[id].list.forEach(function(item){item.currentVisibleState()&&(_this350.children[id].visible[item.cid]=item)}),null;var wasVisible=!1,wasChangeVisible=!1,loop=function(i){var item=_this350.children[id].list[i];if(!(wasVisible=wasVisible||visibleHash[item.cid]))return null;if(item.currentVisibleState())_this350.children[id].visible[item.cid]=item,wasChangeVisible=!0;else if(wasChangeVisible)return!1};if(direction)for(var i=0;i<this.children[id].list.length&&!1!==loop(i);i++);else for(var _i7=this.children[id].list.length-1;0<=_i7&&!1!==loop(_i7);_i7--);this.children[id].scrollTop=activeScrollTop}},{key:"_addHandlers",value:function(){document.addEventListener("scroll",this._handlerdebounce,!0),window.addEventListener("resize",this._initHandlerDebounce,!1)}},{key:"_removeHandlers",value:function(){document.removeEventListener("scroll",this._handlerdebounce,!0),window.removeEventListener("resize",this._initHandlerDebounce,!1)}}],[{key:"_getParentId",value:function($parent){var nodeId=$parent.attr("id");if(nodeId)return nodeId;var id=tsUtils.uniqueId("visible-parent-id");return $parent.attr("id",id),id}}]),VisibleService}())};factory.$inject=["Base","utils"],angular.module("app.ui").factory("visibleService",factory)}(),function(){var analytics=require("data-service").analytics,directive=function(Base){return{priority:1e5,scope:{eventTarget:"<",event:"<",eventParams:"<"},restrict:"AE",controller:function($scope,$element){return new(function(){function Analytics(){var _getPrototypeOf8,_this351;_classCallCheck(this,Analytics);for(var _len21=arguments.length,args=new Array(_len21),_key21=0;_key21<_len21;_key21++)args[_key21]=arguments[_key21];return(_this351=_possibleConstructorReturn(this,(_getPrototypeOf8=_getPrototypeOf(Analytics)).call.apply(_getPrototypeOf8,[this].concat(args)))).handler=void 0,_this351}return _inherits(Analytics,Base),_createClass(Analytics,[{key:"$postLink",value:function(){this.handler=function(){if(!$scope.event)return null;analytics.send({name:$scope.event,target:$scope.eventTarget,params:$scope.eventParams})},this.listenEventEmitter($element,"click",this.handler)}}]),Analytics}())}}};directive.$inject=["Base"],angular.module("app.utils").directive("wAnalytics",directive)}(),function(){var BigNumber=require("@waves/bignumber").BigNumber,AVAILABLE_VALIDATORS=["gt","gte","lt","lte","length","integer","precision","byteLt","byteLte","byteGt","byteGte","number","asset","compare","alias","address","wavesAddress","outerBlockchains","anyAddress","pattern","custom"],PATTERNS={get NUMBER(){var decimal=WavesApp.getLocaleData().separators.decimal;return"\\d*\\".concat(decimal,"?\\d*")},INTEGER:"\\d*"},directive=function(utils,validateService,decorators,$rootScope,$compile,Base){return{require:"ngModel",priority:1e4,compile:function($input,$attrs){return"INPUT"!==$input.get(0).tagName&&"TEXTAREA"!==$input.get(0).tagName?null:function($scope,$input,$compiledAttrs,$ngModel){var _dec20,_class13;return new(_dec20=decorators.async(),_applyDecoratedDescriptor((_class13=function(){function Validate(){var _this352;return _classCallCheck(this,Validate),(_this352=_possibleConstructorReturn(this,_getPrototypeOf(Validate).call(this,$scope)))._validators=Object.create(null),_this352._validatorsReady=new tsUtils.Signal,_this352._ready=!1,_this352._validatorsReady.once(function(){_this352._ready=!0}),_this352._createValidatorList(),$scope.$watch($attrs.ngModel,function(){return _this352._validate()}),_this352}return _inherits(Validate,Base),_createClass(Validate,[{key:"_addInputPattern",value:function(pattern){var _this353=this;return new Promise(function(resolve){var create=function(){var patternName=Validate._getAttrName("pattern");$attrs[patternName]||($attrs[patternName]=pattern,resolve(_this353._createValidator("pattern")))};_this353._ready?create():_this353.receiveOnce(_this353._validatorsReady,create)})}},{key:"_applyValidators",value:function(validators){validators.forEach(function(_ref147){var name=_ref147.name,result=(0,_ref147.handler)($ngModel.$modelValue,$ngModel.$viewValue);switch(_typeof(result)){case"boolean":$ngModel.$setValidity(name,result);break;case"object":if(!result||"function"!=typeof result.then)throw new Error("Wrong validation result!");$ngModel.$setValidity("pending-".concat(name),!1);var onEnd=function(){$ngModel.$setValidity("pending-".concat(name),!0),$scope.$apply()};utils.when(result).then(function(){$ngModel.$setValidity(name,!0),onEnd()},function(){$ngModel.$setValidity(name,!1),onEnd()});break;default:throw new Error("Wrong validation result!")}})}},{key:"_validate",value:function(){var _this354=this;this._applyValidators(Object.keys(this._validators).map(function(name){return _this354._validators[name]})),$scope.$apply()}},{key:"_validateByName",value:function(targetName){this._applyValidators([this._validators[targetName]].filter(Boolean))}},{key:"_createValidatorList",value:function(){var _this355=this;AVAILABLE_VALIDATORS.filter(Validate._hasValidator).forEach(function(name){_this355._createValidator(name)}),this._validatorsReady.dispatch()}},{key:"_createValidator",value:function(name){if(this._validators[name])throw new Error("Duplicate validator! ".concat(name));switch(name){case"asset":this._validators[name]=this._createAssetValidator(name);break;case"compare":this._validators[name]=this._createCompareValidator(name);break;case"custom":this._validators[name]=this._createCustomValidator(name);break;case"number":this._validators[name]=this._createBigNumberValidator(name);break;case"alias":case"address":case"wavesAddress":this._validators[name]=this._createAddressValidator(name);break;case"integer":this._validators[name]=this._createIntegerValidator(name);break;case"anyAddress":this._validators[name]=this._createAnyAddressValidator(name);break;case"outerBlockchains":this._validators[name]=this._createOuterBlockchainsValidator(name);break;case"pattern":this._validators[name]=this._createPatternValidator(name);break;case"byteLt":case"byteLte":this._validators[name]=this._createByteValidator(name);break;default:this._validators[name]=this._createSimpleValidator(name)}return this._validators[name].parser&&$ngModel.$parsers.unshift(this._validators[name].parser),this._validators[name].formatter&&$ngModel.$formatters.push(this._validators[name].formatter),this._validators[name]}},{key:"_createCustomValidator",value:function(name){var validator={name:name,value:null,handler:function(){return null==validator.value||("function"==typeof validator.value?validator.value():!!validator.value)}};return this._listenValidatorChanges(name,validator),validator}},{key:"_createIntegerValidator",value:function(name){return this._addInputPattern(PATTERNS.INTEGER),{name:name,value:null,handler:function(modelValue){try{var num=Validate._toBigNumber(modelValue);return!modelValue||num.roundTo(0).eq(Validate._toBigNumber(modelValue))}catch(e){return!1}}}}},{key:"_createOuterBlockchainsValidator",value:function(name){var value=null,validator={name:name,value:null,handler:function(address){return validateService.outerBlockchains(address,validator.value)}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(data){value=Validate._toAssetId(data)}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createAnyAddressValidator",value:function(name){var value=null,validator={name:name,value:null,handler:function(address){return validateService.anyAddress(address,validator.value)}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(data){value=Validate._toAssetId(data)}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createCompareValidator",value:function(name){var _this356=this,value=null,validator={name:name,value:null,$compare:null,$compareHandler:function(){_this356._validateByName(name),$scope.$apply()},handler:function(value){return value===validator.$compare.val()},destroy:function(){this.$compare.off("input",this.$compareHandler)}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(val){utils.isNotEqualValue(value,val)&&(validator.$compare&&validator.$compare.off("input",validator.$compareHandler),validator.$compare=$input.closest("form").find('input[name="'.concat(val,'"]')),validator.$compare.on("input",validator.$compareHandler),value=val)}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createPatternValidator",value:function(name){var value,parserWorkedBeforeInputEvent=!1;function getCorrespondingToPatternPartOf(value){var inputWithoutGroup=Validate._replaceGroupSeparator(value);return(validator.value.exec(inputWithoutGroup)||[])[0]||""}var validator={name:name,value:null,handler:function(){return!0},parser:function(value){var correspondingToPatternPartOfInput=getCorrespondingToPatternPartOf(value);return correspondingToPatternPartOfInput!==value&&Validate._replaceInputValue(correspondingToPatternPartOfInput),parserWorkedBeforeInputEvent=!0,correspondingToPatternPartOfInput}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(val){value=new RegExp(val)}}),$input.on("input",function(){parserWorkedBeforeInputEvent?parserWorkedBeforeInputEvent=!1:Validate._replaceInputValue(getCorrespondingToPatternPartOf($input.val()))}),this._listenValidatorChanges(name,validator),validator}},{key:"_createAssetValidator",value:function(name){var _this357=this,precisionValidator=this._createValidator("precision");function setPrecisionFromAttr(precisionRestriction){precisionValidator.value=void 0!==precisionRestriction?Number(precisionRestriction):validator.money&&validator.money.asset.precision||0}this._addInputPattern(PATTERNS.NUMBER).then(function(validator){_this357.listenEventEmitter(i18next,"languageChanged",function(){validator.value=PATTERNS.NUMBER})});var value=null,validator={name:name,money:null,value:null,apply:function(){_this357._validateByName(name),_this357._validateByName(precisionValidator.name)},handler:function(){return!0},parser:function(value){if(value){setPrecisionFromAttr($compiledAttrs.validatorAssetPrecision);var money=Validate._toMoney(value,validator.money);if(precisionValidator.handler($ngModel.$modelValue,value))return money||(_this357._validateByName("asset"),null);if(money){var viewValue=money.getTokens().toFixed(Math.min(precisionValidator.value,money.getTokens().getDecimalsCount()));return $ngModel.$setViewValue(viewValue),$ngModel.$render(),money.cloneWithTokens(viewValue)}return null}return null},formatter:function(value){setPrecisionFromAttr($compiledAttrs.validatorAssetPrecision);var viewValue=$input.val(),money=precisionValidator.handler($ngModel.$modelValue,viewValue)&&Validate._toMoney(viewValue,validator.money);return Validate._isFocused()&&(!value||money&&money.eq(value))?$input.val():value?value.getTokens().toFixed(Math.min(precisionValidator.value,value.getTokens().getDecimalsCount())):""}};return $input.on("input",function(){_this357._validateByName(precisionValidator.name),$scope.$apply()}),Object.defineProperty(validator,"value",{get:function(){return value},set:function(assetData){if(validator.money=null,!assetData)return null;(value=Validate._toAssetId(assetData))&&ds.moneyFromTokens("0",value).then(function(money){utils.isNotEqualValue(validator.money,money)&&(validator.money=money,validator.apply(),$ngModel.$modelValue=validator.parser($ngModel.$viewValue))})}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createAddressValidator",value:function(name){var validator={name:name,value:null,handler:function(value){return validateService[name](value,validator.value)}};return this._listenValidatorChanges(name,validator),validator}},{key:"_createByteValidator",value:function(name){var validator=this._createSimpleValidator(name),$byteScope=$rootScope.$new(!0),$element=$compile("<div ".concat(['w-i18n-ns="app.utils"','class="byte-validator__help"','w-i18n="validators.byte.help"','params="{bytes: bytes}"'].join(" "),"></div>"))($byteScope);$input.after($element),$scope.$on("$destroy",function(){$byteScope.$destroy()});var origin=validator.handler;return validator.handler=function(modelValue){var stringBytes=validateService.getByteFromString(modelValue||"");return $byteScope.bytes=Number(validator.value)-stringBytes,$byteScope.$apply(),origin(modelValue)},validator}},{key:"_createSimpleValidator",value:function(name){var handler;switch(name){case"precision":handler=function(modelValue,viewValue){var value;try{value=viewValue?utils.parseNiceNumber(viewValue):null}catch(e){value=null}return validateService[name](value,validator.value)};break;default:handler=function(modelValue){return validateService[name](modelValue,validator.value)}}var validator={name:name,value:null,handler:handler};return this._listenValidatorChanges(name,validator),validator}},{key:"_createBigNumberValidator",value:function(name){return this._addInputPattern(PATTERNS.NUMBER),{name:name,handler:function(){return!0},parser:function(value){if(""!==value)return Validate._toBigNumber(value)},formatter:Validate._toString}}},{key:"_listenValidatorChanges",value:function(name,validator){var _this358=this,attrValue=$attrs[Validate._getAttrName(name)];if(Validate._hasExp(attrValue)){var exp=attrValue.replace(/{{(.*)?}}/g,"$1");-1!==exp.indexOf("::")?validator.value=$scope.$eval(exp.replace("::","")):$scope.$watch(exp,function(value){validator.value=value,_this358._validateByName(validator.name)})}else validator.value=attrValue}}],[{key:"_isFocused",value:function(){return document.activeElement===$input.get(0)}},{key:"_toAssetId",value:function(data){return"string"==typeof data?data:data instanceof ds.wavesDataEntities.Money?data.asset.id:data instanceof ds.wavesDataEntities.Asset?data.id:null}},{key:"_toString",value:function(value){return value instanceof BigNumber?value.toFixed():value instanceof ds.wavesDataEntities.Money?value.getTokens().toFormat():value?String(value):""}},{key:"_toMoney",value:function(value,target){if(!target)return null;try{return target.cloneWithTokens(utils.parseNiceNumber(value))}catch(e){return null}}},{key:"_toBigNumber",value:function(value){try{return new BigNumber(utils.parseNiceNumber(value))}catch(e){return null}}},{key:"_hasExp",value:function(value){if(!value)return!1;var openIndex=value.indexOf("{{"),closeIndex=value.indexOf("}}");return-1!==openIndex&&-1!==closeIndex&&openIndex<closeIndex}},{key:"_getAttrName",value:function(validatorName){return"wValidator".concat(validatorName.charAt(0).toUpperCase()).concat(validatorName.slice(1))}},{key:"_hasValidator",value:function(name){return Validate._getAttrName(name)in $attrs}},{key:"_replaceInputValue",value:function(newValue){$ngModel.$viewValue=newValue,$ngModel.$render()}},{key:"_replaceGroupSeparator",value:function(value){var separator=WavesApp.localize[i18next.language].separators.group,reg=new RegExp("\\".concat(separator),"g");return value.replace(reg,"")}}]),Validate}()).prototype,"_validate",[_dec20],Object.getOwnPropertyDescriptor(_class13.prototype,"_validate"),_class13.prototype),_class13)}}}};directive.$inject=["utils","validateService","decorators","$rootScope","$compile","Base"],angular.module("app.utils").directive("wValidate",directive)}(),function(){var controller=function(Base,$scope,user){return new(function(){function AddressInfoCtrl(){var _this359;return _classCallCheck(this,AddressInfoCtrl),(_this359=_possibleConstructorReturn(this,_getPrototypeOf(AddressInfoCtrl).call(this,$scope))).userName=void 0,_this359.address=void 0,_this359.userType=void 0,_this359.userName=user.name,_this359.userType=user.userType,_this359.address=user.address,_this359}return _inherits(AddressInfoCtrl,Base),AddressInfoCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.utils").controller("AddressInfoCtrl",controller)}(),function(){var controller=function(Base,$scope,user,createPoll,utils,waves,baseAssetService){var ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber;return new(function(){function AssetInfoCtrl(asset){var _this360;_classCallCheck(this,AssetInfoCtrl),(_this360=_possibleConstructorReturn(this,_getPrototypeOf(AssetInfoCtrl).call(this,$scope))).asset=asset,_this360.wavesId=baseAssetService.WavesAssetId,_this360.isDemo=!user.address,_this360.quantity=_this360.asset.quantity.div(new BigNumber(10).pow(_this360.asset.precision)).toFormat(),_this360.minFee=ds.utils.getTransferFeeList().find(function(money){return money.asset.id===_this360.asset.id}),_this360.circleChartData=null,_this360.totalBalance=null,_this360.transactions=[],_this360.transactionsPending=!0;var _utils$getDataFromOra2=utils.getDataFromOracles(_this360.asset.id),link=_utils$getDataFromOra2.link,email=_utils$getDataFromOra2.email,provider=_utils$getDataFromOra2.provider,description=_utils$getDataFromOra2.description;if(_this360.link=link,_this360.email=email,_this360.provider=provider,_this360.description=description||asset.description,_this360.withScam=null,_this360.spam=[],_this360.tab="info",_this360.chartOptions={items:{available:{color:"#66bf00",radius:66},leased:{color:"#ffebc0",radius:50},inOrders:{color:"#bacaf5",radius:58}},center:27,direction:!0,startFrom:Math.PI/2},!_this360.isDemo){createPoll(_assertThisInitialized(_this360),_this360._getCircleGraphData,_this360._setCircleGraphData,15e3),createPoll(_assertThisInitialized(_this360),AssetInfoCtrl._getTxList,_this360._setTxList,4e3,{isBalance:!0,$scope:$scope})}return _this360._updateAsset().then(function(asset){_this360.quantity=asset.quantity.div(new BigNumber(10).pow(asset.precision)).toFormat(),$scope.$apply()}),_this360}return _inherits(AssetInfoCtrl,Base),_createClass(AssetInfoCtrl,[{key:"_setTxList",value:function(transactions){var _this361=this;this.transactionsPending=!1,this.transactions=transactions.filter(function(tx){var TYPES=waves.node.transactions.TYPES;switch(tx.typeName){case TYPES.SEND:case TYPES.RECEIVE:case TYPES.MASS_RECEIVE:case TYPES.MASS_SEND:case TYPES.CIRCULAR:return tx.amount.asset.id===_this361.asset.id;case TYPES.EXCHANGE_BUY:case TYPES.EXCHANGE_SELL:return tx.amount.asset.id===_this361.asset.id||tx.price.asset.id===_this361.asset.id;case TYPES.LEASE_IN:case TYPES.LEASE_OUT:case TYPES.CANCEL_LEASING:return _this361.asset.id===baseAssetService.WavesAssetId;case TYPES.ISSUE:case TYPES.REISSUE:case TYPES.BURN:return(tx.assetId||tx.amount&&tx.amount.asset.id)===_this361.asset.id;case TYPES.SPONSORSHIP_START:case TYPES.SPONSORSHIP_STOP:return tx.assetId===_this361.asset.id;case TYPES.SPONSORSHIP_FEE:return _this361.asset.id===tx.feeAssetId;default:return!1}})}},{key:"_getCircleGraphData",value:function(){return waves.node.assets.balance(this.asset.id)}},{key:"_updateAsset",value:function(){return waves.node.assets.info(this.asset.id)}},{key:"_setCircleGraphData",value:function(_ref148){var available=_ref148.available,leasedOut=_ref148.leasedOut,inOrders=_ref148.inOrders;this.circleChartData=[{id:"available",value:available},{id:"leased",value:leasedOut},{id:"inOrders",value:inOrders}],this.totalBalance=available.add(leasedOut).add(inOrders),$scope.$digest()}}],[{key:"_getTxList",value:function(){return waves.node.transactions.list(100)}}]),AssetInfoCtrl}())(this.locals)};controller.$inject=["Base","$scope","user","createPoll","utils","waves","baseAssetService"],angular.module("app.ui").controller("AssetInfoCtrl",controller)}(),function(){var controller=function(Base,$scope,$mdDialog){var analytics=require("data-service").analytics;return new(function(){function ConfirmTxCtrl(_ref149){var _this362,signable=_ref149.signable,analyticsText=_ref149.analyticsText,onBuyWithCardClick=_ref149.onBuyWithCardClick;return _classCallCheck(this,ConfirmTxCtrl),(_this362=_possibleConstructorReturn(this,_getPrototypeOf(ConfirmTxCtrl).call(this,$scope)))._resolveOnClose=!1,_this362.signable=signable,analyticsText&&analytics.send({name:analyticsText,target:"ui"}),_this362.onBuyWithCardClick=onBuyWithCardClick,_this362}return _inherits(ConfirmTxCtrl,Base),_createClass(ConfirmTxCtrl,[{key:"back",value:function(){$mdDialog.cancel()}},{key:"close",value:function(){this._resolveOnClose?$mdDialog.hide():$mdDialog.cancel()}},{key:"onSendTransaction",value:function(){this._resolveOnClose=!0}}]),ConfirmTxCtrl}())(this.locals)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.utils").controller("ConfirmTxCtrl",controller)}(),function(){var LOCALIZATION_title={normal:"modal.gatewaySign.title",error:"modal.gatewaySign.error.title"},controller=function(Base,$scope,user,utils,$mdDialog){var isEmpty=function(value){return!value},tsApiValidator=require("ts-api-validator"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),schema=new tsApiValidator.Schema({type:tsApiValidator.ObjectPart,required:!0,content:{referrer:{type:tsApiValidator.StringPart,isEmpty:isEmpty,path:"r",required:!0},name:{type:tsApiValidator.StringPart,isEmpty:isEmpty,path:"n",required:!0},data:{type:tsApiValidator.StringPart,isEmpty:isEmpty,path:"d",required:!0},iconPath:{type:tsApiValidator.StringPart,path:"i",required:!1},successPath:{type:tsApiValidator.StringPart,path:"s",required:!1},debug:{type:tsApiValidator.BooleanPart,required:!1,defaultValue:!1}}});return new(function(){function GatewaySignCtrl(search){var _this363;return _classCallCheck(this,GatewaySignCtrl),(_this363=_possibleConstructorReturn(this,_getPrototypeOf(GatewaySignCtrl).call(this,$scope))).isSeed=!1,_this363.signAdapterError=!1,_this363.signPending=!1,_this363.isDesktop=WavesApp.isDesktop(),_this363.hasError=!1,_this363.imageSrc="",_this363.referrer="",_this363.name="",_this363.successUrl="",_this363.debug=!1,_this363.search=null,_this363.userType=null,_this363.titleLiteral=LOCALIZATION_title.normal,_this363.search=search,_this363.userType=user.userType,_this363.debug=!!search.debug,_this363.isSeed="seed"===user.userType,_this363.observe("hasError",function(value){_this363.titleLiteral=value?LOCALIZATION_title.error:LOCALIZATION_title.normal}),schema.parse(search).then(function(params){var referrer=(_this363.urlParams=params).referrer,name=params.name,iconPath=params.iconPath;return _this363.referrer=referrer,_this363.name=name,_this363._setImageUrl(referrer,iconPath),_this363.createUrl()}).catch(function(e){_this363._sendError(e.message||e),_this363.signPending=!1}).finally(function(){return $scope.$apply()}),_this363}return _inherits(GatewaySignCtrl,Base),_createClass(GatewaySignCtrl,[{key:"sign",value:function(){var _this364=this;this.createUrl().catch(function(e){_this364._sendError(e.message||e),_this364.signPending=!1}).finally(function(){return $scope.$apply()})}},{key:"signAuth",value:function(adapter,data){var _this365=this;this.signPending=!0;var signable=adapter.makeSignable(data);return signable.getId().then(function(id){_this365.id=id,$scope.$apply()}),signable.getSignature()}},{key:"createUrl",value:function(){var _this366=this,_this$urlParams=this.urlParams,referrer=_this$urlParams.referrer,data=_this$urlParams.data,successPath=_this$urlParams.successPath,host=GatewaySignCtrl._getDomain(referrer),signData={type:SIGN_TYPE.AUTH,data:{prefix:"WavesWalletAuthentication",host:host,data:data}},adapter=ds.signature.getSignatureApi(),sign=this.signAuth(adapter,signData);return Promise.all([sign,adapter.getPublicKey()]).then(function(_ref150){var _ref151=_slicedToArray(_ref150,2),signature=_ref151[0],publicKey=_ref151[1],search="?s=".concat(signature,"&p=").concat(publicKey,"&a=").concat(user.address),path=successPath||"",url="".concat(referrer,"/").concat(path).concat(search);_this366.signPending=!1,_this366.signAdapterError=!1,_this366.successUrl=GatewaySignCtrl._normalizeUrl(url),_this366.isSeed||(_this366.send(),$mdDialog.cancel())}).catch(function(e){if(_this366.signPending=!1,_this366.isSeed)return Promise.reject(e);_this366.signAdapterError=!0})}},{key:"send",value:function(){utils.redirect(this.successUrl)}},{key:"_setImageUrl",value:function(referrer,iconPath){var _this367=this;if(!iconPath)return null;var url=function(){try{return new URL(iconPath).href}catch(e){return GatewaySignCtrl._normalizeUrl("".concat(referrer,"/").concat(iconPath))}}();utils.loadImage(url).then(function(){_this367.imageSrc=url,$scope.$digest()})}},{key:"_sendError",value:function(message){this.hasError=!0,this.errorMessage=message}}],[{key:"_getDomain",value:function(referer){var url=new URL(referer);if("https:"!==url.protocol)throw new Error('Protocol must be "https:"');return url.hostname}},{key:"_normalizeUrl",value:function(urlString){var url=new URL(urlString);return"".concat(url.protocol,"//")+"".concat(url.host,"/").concat(url.pathname,"/").concat(url.search).concat(url.hash).replace(/\/+/g,"/").replace(/\/$/,"")}}]),GatewaySignCtrl}())(this.search)};controller.$inject=["Base","$scope","user","utils","$mdDialog"],angular.module("app.utils").controller("GatewaySignCtrl",controller)}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),controller=function($scope,waves,Base,utils,user,$mdDialog,balanceWatcher,outerBlockchains,gatewayService,baseAssetService){return new(function(){function AssetSendCtrl(options){var _this368;_classCallCheck(this,AssetSendCtrl),(_this368=_possibleConstructorReturn(this,_getPrototypeOf(AssetSendCtrl).call(this,$scope))).sendMode=void 0,_this368.headerPath="modules/utils/modals/sendAsset/send-header.html",_this368.choosableMoneyList=[],_this368.step=0,_this368.canChooseAsset=!options.assetId||options.canChooseAsset,_this368.moneyHash=null,_this368.showBuyFiatModal=!1,_this368.buyParams={onClose:function(){return _this368._onCloseBuyModal()}};var baseAssetId=baseAssetService.getBaseAssetId(),baseAssetName=baseAssetService.getBaseAssetName(),baseAssetPrecision=baseAssetService.getBaseAssetPrecision();_this368.state={assetId:options.assetId||baseAssetService.WavesAssetId,mirrorId:baseAssetId,mirrorAssetName:baseAssetName,mirrorAssetPrecision:baseAssetPrecision,gatewayData:{details:null,error:null,pending:!1,blockchainName:""},paymentId:"",moneyHash:null,singleSend:utils.liteObject({type:SIGN_TYPE.TRANSFER}),massSend:utils.liteObject({type:SIGN_TYPE.MASS_TRANSFER})},_this368._setBuyParams(),_this368.receive(balanceWatcher.change,_this368._updateBalanceList,_assertThisInitialized(_this368)),_this368._updateBalanceList(),_this368.observe("sendMode",_this368._onChangeSendMode),_this368.receive(utils.observe(_this368.state,"assetId"),_this368.checkSendMode,_assertThisInitialized(_this368)),_this368.receive(utils.observe(_this368.state.singleSend,"recipient"),_this368.checkSendMode,_assertThisInitialized(_this368)),_this368.checkSendMode(),_this368.tab=options.mode,_this368.strict=options.amount&&options.recipient&&options.strict,_this368.errorOccured=!1,ds.analytics.sendV2("Send",{action:"Show",label:_this368.state.assetId});try{_this368.referrer=new URL(options.referrer).href}catch(e){_this368.referrer=null}if(options.mode||options.recipient||options.amount){_this368.tab="singleSend",_this368.state.singleSend.recipient=options.recipient,_this368.state.singleSend.attachment=options.attachment;var attachment="gateway"===_this368.sendMode&&_this368.gatewayDetails?_this368.gatewayDetails.attachment:options.attachment,attachmentString=attachment?attachment.toString():"",bytesAttachment=utils.stringToBytes(attachmentString);Promise.all([ds.moneyFromTokens(options.amount||"0",_this368.state.assetId),waves.node.getFee({type:SIGN_TYPE.TRANSFER})]).then(function(_ref152){var _ref153=_slicedToArray(_ref152,2),money=_ref153[0],fee=_ref153[1];_this368.state.singleSend.amount=money,_this368.state.singleSend.fee=fee;var tx=waves.node.transactions.createTransaction(_objectSpread({},_this368.state.singleSend,{attachment:bytesAttachment})),signable=ds.signature.getSignatureApi().makeSignable({type:SIGN_TYPE.TRANSFER,data:tx});_this368.strict&&_this368.nextStep(signable)}).catch(function(){_this368.errorOccured=!0,$scope.$digest()})}else _this368.syncSettings({tab:"send.defaultTab"}),"massSend"!==_this368.tab||_this368.advancedMode||(_this368.tab="singleSend");return _this368.receive(utils.observe(_this368.state,"moneyHash"),_this368._onChangeMoneyHash,_assertThisInitialized(_this368)),_this368}return _inherits(AssetSendCtrl,Base),_createClass(AssetSendCtrl,[{key:"balance",get:function(){return this.state.moneyHash&&this.state.moneyHash[this.state.assetId]}},{key:"gatewayDetails",get:function(){return this.state.gatewayData.details}}]),_createClass(AssetSendCtrl,[{key:"$postLink",value:function(){this.tab="singleSend"}},{key:"back",value:function(){this.step--}},{key:"nextStep",value:function(signable){this.signable=signable,this.step++}},{key:"onTxSent",value:function(id){this.referrer&&(utils.redirect("".concat(this.referrer,"?txId=").concat(id)),$mdDialog.hide());var singleSend=this.state.singleSend;"waves"===this.sendMode&&ds.analytics.sendAsset.sendSuccess(singleSend.amount.asset.ticker||singleSend.amount.asset.id,singleSend.mirror?singleSend.mirror.getTokens().toString():0)}},{key:"onGatewayTxSent",value:function(){var singleSend=this.state.singleSend;ds.analytics.sendAsset.withdrawSuccess(singleSend.amount.asset.ticker||singleSend.amount.asset.id,singleSend.mirror?singleSend.mirror.getTokens().toString():0)}},{key:"setMode",value:function(mode){this.sendMode=mode}},{key:"checkSendMode",value:function(){this._isOuterBlockchains()?this.setMode("gateway"):this.setMode("waves")}},{key:"updateGatewayData",value:function(){var _this369=this;if(gatewayService.hasSupportOf(this.balance.asset,"withdraw")){this.state.gatewayData=_objectSpread({},this.state.gatewayData,{pending:!0});var pendingPromise=gatewayService.getWithdrawDetails(this.balance.asset,this.state.singleSend.recipient,this.state.paymentId).then(function(details){pendingPromise===_this369.pendingPromise&&(_this369.state.gatewayData={error:null,details:details,pending:!1,blockchainName:gatewayService.getBlockChainName(_this369.balance.asset)},utils.safeApply($scope))},function(error){pendingPromise===_this369.pendingPromise&&(_this369.state.gatewayData={details:null,error:error,pending:!1,blockchainName:gatewayService.getBlockChainName(_this369.balance.asset)},utils.safeApply($scope))});return this.pendingPromise=pendingPromise}}},{key:"onShowBuyFiatModal",value:function(){this.showBuyFiatModal=!0}},{key:"_onChangeMoneyHash",value:function(){var hash=this.state.moneyHash,list=Object.values(hash).filter(function(money){return!money.getTokens().eq(0)&&AssetSendCtrl._isNotScam(money)});list.length?(!utils.toHash(list,"asset.id")[this.state.assetId]&&this.canChooseAsset&&(this.state.assetId=list[0].asset.id),this.choosableMoneyList=list):this.choosableMoneyList=[this.state.moneyHash[this.state.assetId]]}},{key:"_updateBalanceList",value:function(){var _this370=this,hash=balanceWatcher.getBalance();[this.state.assetId,this.state.mirrorId].reduce(function(acc,assetId){return acc.then(function(hash){return hash[assetId]?Promise.resolve(hash):balanceWatcher.getBalanceByAssetId(assetId).then(function(money){return hash[assetId]=money,hash})})},Promise.resolve(hash)).then(function(hash){_this370.state.moneyHash=hash,utils.safeApply($scope)})}},{key:"_isOuterBlockchains",value:function(){var outerChain=outerBlockchains[this.state.assetId];if(!outerChain)return!1;var recipient=this.state.singleSend.recipient;return!user.isValidAddress(recipient)&&outerChain.isValidAddress(recipient)}},{key:"_onChangeSendMode",value:function(){"gateway"===this.sendMode?this.updateGatewayData():this.gatewayData={details:null,error:null,pending:!1,blockchainName:""}}},{key:"_setBuyParams",value:function(){var _this371=this;Promise.all([ds.gateway.getAcashCryptoAssets(),ds.gateway.getAcashFiatAssets()]).then(function(_ref154){var _ref155=_slicedToArray(_ref154,2),cryptoAssets=_ref155[0],fiatAssets=_ref155[1],wavesAcash=cryptoAssets.find(function(_ref156){return"WAVES"===_ref156.id});fiatAssets.length&&(_this371.buyParams={onClose:function(){return _this371._onCloseBuyModal()},initValues:{fiatAsset:fiatAssets[0],fiatAmount:"",cryptoAsset:wavesAcash,cryptoAmount:"",rate:0,disableCryptoSelect:!0}})}).catch(function(){return null})}},{key:"_onCloseBuyModal",value:function(){this.showBuyFiatModal=!1,utils.safeApply($scope)}},{key:"advancedMode",get:function(){return user.getSetting("advancedMode")}}],[{key:"_isNotScam",value:function(item){return!user.scam[item.asset.id]}}]),AssetSendCtrl}())(this.locals)};controller.$inject=["$scope","waves","Base","utils","user","$mdDialog","balanceWatcher","outerBlockchains","gatewayService","baseAssetService"],angular.module("app.utils").controller("AssetSendCtrl",controller)}(),function(){var controller=function(Base,$scope){return new(function(){function smartPairCtrl(_ref157){var _this372,amountTicker=_ref157.amountTicker,priceTicker=_ref157.priceTicker;return _classCallCheck(this,smartPairCtrl),(_this372=_possibleConstructorReturn(this,_getPrototypeOf(smartPairCtrl).call(this,$scope))).amountTicker=amountTicker,_this372.priceTicker=priceTicker,_this372}return _inherits(smartPairCtrl,Base),smartPairCtrl}())(this)};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("smartPairCtrl",controller)}(),function(){var factory=function(){var ObjectStorage=function(){function ObjectStorage(){_classCallCheck(this,ObjectStorage)}return _createClass(ObjectStorage,[{key:"read",value:function(key){var result=ObjectStorage.getStorage()[key];try{return JSON.parse(result)}catch(e){return result}}},{key:"write",value:function(key,value){var api=ObjectStorage.getStorage();try{return api[key]=JSON.stringify(value),Promise.resolve(null)}catch(e){return Promise.resolve(null)}}},{key:"clear",value:function(){ObjectStorage.storage=Object.create(null)}},{key:"onUpdate",value:function(){return null}},{key:"init",value:function(){ObjectStorage.getStorage()}}],[{key:"getStorage",value:function(){return ObjectStorage.storage||(ObjectStorage.storage=Object.create(null)),ObjectStorage.storage}}]),ObjectStorage}();return ObjectStorage.storage=null,new ObjectStorage};factory.$inject=[],angular.module("app.utils").factory("objectStorage",factory)}(),function(){var factory=function(objectStorage,localStorage,webStorage,postmessageStorage){return function(){return WavesApp.isDesktop()?webStorage:WavesApp.isMock?objectStorage:WavesApp.usePostMessageStorage?postmessageStorage:localStorage.canIUse()?localStorage:objectStorage}};factory.$inject=["objectStorage","localStorage","webStorage","postmessageStorage"],angular.module("app.utils").factory("storageSelect",factory)}(),function(){var controller=function(Base,$scope,user){return new(function(){function BuyUSDNFaqCtrl(){var _this373;return _classCallCheck(this,BuyUSDNFaqCtrl),(_this373=_possibleConstructorReturn(this,_getPrototypeOf(BuyUSDNFaqCtrl).call(this,$scope))).isLogined=!!user.address,_this373}return _inherits(BuyUSDNFaqCtrl,Base),BuyUSDNFaqCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.buyUSDNFaq").controller("BuyUSDNFaqCtrl",controller)}(),function(){var controller=function(user){return new function ChooseUserCtrl(){_classCallCheck(this,ChooseUserCtrl),user.currentUser&&user.logout("switch",!0)}};controller.$inject=["user"],angular.module("app.chooseUser").controller("ChooseUserCtrl",controller)}(),function(){function controller(Base,$scope,utils,waves,stService,PromiseControl,createPoll,$element,modalManager,configService,matcher,baseAssetService){var assetsHash,DEFAULT_ASSETS=(assetsHash=baseAssetService.getDefaultAssetsHashId(),baseAssetService.getDefaultAssetsList().forEach(function(item){var name=item.label||item.ticker||item.name;item.watchlist_exclude&&delete assetsHash[name]}),assetsHash),_require71=require("ramda"),equals=_require71.equals,uniq=_require71.uniq,not=_require71.not,find=_require71.find,propEq=_require71.propEq,filter=_require71.filter,whereEq=_require71.whereEq,uniqBy=_require71.uniqBy,prop=_require71.prop,path=_require71.path,flatten=_require71.flatten,splitEvery=_require71.splitEvery,ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber;return new(function(){function WatchList(){var _this374;return _classCallCheck(this,WatchList),(_this374=_possibleConstructorReturn(this,_getPrototypeOf(WatchList).call(this,$scope))).pending=!1,_this374.loadingError=!1,_this374.dropDownId=null,_this374.dropDown=[],_this374.isActiveSelect=!1,_this374.searchRequest=null,_this374.tabs=[],_this374.search="",_this374.searchInProgress=!1,_this374.activeTab="all",_this374.showOnlyFavorite=!1,_this374.pairDataList=[],_this374._isSelfSetPair=!1,_this374._searchAssets=[],_this374._searchAssetsHash=Object.create(null),_this374._favourite=[],_this374._favoriteHash=Object.create(null),_this374._assetIdPair=void 0,_this374._poll=void 0,_this374._lockedPairs=[],_this374._marketPairs=[],_this374._timer=void 0,_this374.tabs=(configService.get("SETTINGS.DEX.WATCH_LIST_TABS")||[]).map(function(item){return _objectSpread({},item,{value:baseAssetService.getIdByTicker(item.value)})}),_this374.dropDown=function(){var DROP_DOWN_ORDER_LIST=configService.get("SETTINGS.DEX.DROP_DOWN_ORDER_LIST"),DROP_DOWN_LIST=[];return DROP_DOWN_ORDER_LIST.forEach(function(name){DROP_DOWN_LIST.push({name:name,id:DEFAULT_ASSETS[name]})}),DROP_DOWN_LIST}(),_this374._initCache(),_this374.headers=[{id:"favourite",templatePath:"modules/dex/directives/dexWatchlist/FavouritesColumnHeader.html",scopeData:{toggleOnlyFavourite:function(){_this374.showOnlyFavorite=!_this374.showOnlyFavorite,WatchList._renderSmartTable()},$ctrl:_assertThisInitialized(_this374)}},{id:"pair",title:{literal:"directives.watchlist.pair"},sort:_this374._getComparatorByPath("pairNames")},{id:"price",title:{literal:"directives.watchlist.price"},sort:_this374._getComparatorByPath("lastPrice")},{id:"change",title:{literal:"directives.watchlist.chg"},sort:_this374._getComparatorByPath("change24")},{id:"volume",title:{literal:"directives.watchlist.volume"},sortActive:!0,isAsc:!1,sort:_this374._getComparatorByPath("currentVolume")},{id:"info"}],_this374.tableOptions={filter:_this374._getTableFilter()},_this374}return _inherits(WatchList,Base),_createClass(WatchList,[{key:"$postLink",value:function(){this.observe("dropDownId",this._onChangeDropDown),this.observe("_favourite",this._updateFavoriteHash),this.observe("_searchAssets",this._updateSearchAssetHash),this.observe("search",this._onChangeSearch),this.syncSettings({activeTab:"dex.watchlist.activeTab",showOnlyFavorite:"dex.watchlist.showOnlyFavorite",_favourite:"dex.watchlist.favourite",_assetIdPair:"dex.assetIdPair"}),this._initializeActiveTab(),this.observe("_assetIdPair",this._onChangeChosenPair),this.observe("activeTab",this._onChangeActiveTab),stService.draw.once(WatchList._onRenderTable),this._getMarketPairsAndCreatePool()}},{key:"showAssetInfo",value:function(event,asset){return event.preventDefault(),event.stopPropagation(),modalManager.showAssetInfo(asset)}},{key:"isChosen",value:function(pairData){return this._assetIdPair.amount===pairData.amountAsset.id&&this._assetIdPair.price===pairData.priceAsset.id}},{key:"getShortId",value:function(id){return utils.getShortId(id)}},{key:"isLockedPair",value:function(amountAssetId,priceAssetId){return utils.isLockedInDex(amountAssetId,priceAssetId)}},{key:"isSmartPair",value:function(pairData){return utils.isLockedInDexSmartAssets(pairData.amountAsset,pairData.priceAsset)}},{key:"choosePair",value:function(pairData){var _this375=this,pair={amount:pairData.amountAsset.id,price:pairData.priceAsset.id},amountAssetName=pairData.amountAsset.ticker||pairData.amountAsset.displayName,priceAssetName=pairData.priceAsset.ticker||pairData.priceAsset.displayName;if(this.isLockedPair(pair.amount,pair.price))return modalManager.showLockPairWarning(amountAssetName,priceAssetName),null;if(this.isSmartPair(pairData))return modalManager.showSmartPairModal(amountAssetName,priceAssetName),null;var pairName="".concat(pairData.amountAsset.ticker||pairData.amountAsset.id,"/").concat(pairData.priceAsset.ticker||pairData.priceAsset.id);ds.analytics.dex.changePairFromWatchList(pairName),ds.api.matcher.getLastPrice(pairData).then(function(){_this375._isSelfSetPair=!0,_this375._assetIdPair=pair,_this375._isSelfSetPair=!1}).catch(function(e){if(!e.message.includes("blacklisted"))return _this375._isSelfSetPair=!0,_this375._assetIdPair=pair,_this375._isSelfSetPair=!1,null;modalManager.showLockPairWarning(amountAssetName,priceAssetName)})}},{key:"chooseTrading",value:function(){this.isActiveSelect=!1,this.activeTab="trading"}},{key:"chooseSelect",value:function(){this.isActiveSelect=!0,this.activeTab=this.dropDownId}},{key:"chooseTab",value:function(id){this.isActiveSelect=!1,this.activeTab=id}},{key:"toggleFavourite",value:function($event,pair){$event.stopPropagation();var key=WatchList._getKeyByPair(pair.pairIdList),favorite=this._favourite.slice();if(this._favoriteHash[key]){this._favourite=favorite.filter(function(p){return not(function(p){return equals(p,pair.pairIdList)||equals(p,pair.pairIdList.reverse())}(p))})}else favorite.push(pair.pairIdList),this._favourite=uniq(favorite);WatchList._renderSmartTable()}},{key:"isFavourite",value:function(pair){return!!this._favoriteHash[WatchList._getKeyByPair(pair.pairIdList)]}},{key:"_isActiveTrading",value:function(){return"trading"===this.activeTab}},{key:"_initializeActiveTab",value:function(){find(propEq("value",this.activeTab),this.tabs)||this._isActiveTrading()||(this.isActiveSelect=!0,this.dropDownId=this.activeTab)}},{key:"_onChangeChosenPair",value:function(){var _this376=this,pair=this._assetIdPair,id=[pair.amount,pair.price].sort().join();!this._favoriteHash[id]&&this.showOnlyFavorite&&(this.showOnlyFavorite=!1),find(propEq("id",id),this.pairDataList)?WatchList._renderSmartTable():this._cache([id.split(",")]).then(function(_ref158){var item=_slicedToArray(_ref158,1)[0];_this376.pairDataList.push(item),WatchList._renderSmartTable()}),this._isSelfSetPair||(this.activeTab="all",stService.draw.once(WatchList._onRenderTable))}},{key:"_onChangeDropDown",value:function(){this.isActiveSelect&&(this.activeTab=this.dropDownId)}},{key:"_getPairData",value:function(){var _this377=this,pairs=this._getPairList();return Promise.all([this._getTabRate(),this._getUsdnRate(),this._cache(pairs)]).then(function(_ref160){var _ref161=_slicedToArray(_ref160,3),rate=_ref161[0],usdnRate=_ref161[1],pairsList=_ref161[2];_this377.pending=!1,_this377.loadingError=!1;var activeTab=_this377.activeTab,filteredPairs=pairsList.filter(Boolean).map(WatchList._chooseVolume(activeTab,rate,usdnRate));return!filteredPairs.length&&pairs.length&&utils.wait(5e3).then(function(){_this377.pending=!0,_this377._initCache(),_this377._onChangeActiveTab()}),filteredPairs}).catch(function(){_this377.loadingError=!0})}},{key:"_getPairList",value:function(){var _this378=this,marketAssets=this._marketPairs.map(function(_ref162){return _ref162.id.split(",")}),favorite=(this._favourite||[]).filter(function(item){return item&&2===item.filter(Boolean).length}).map(function(p){return p.sort()}),chosen=[this._assetIdPair.amount,this._assetIdPair.price].sort(),searchIdList=Object.keys(this._searchAssetsHash),combinationWithMarket=searchIdList.reduce(function(acc,id){return[].concat(_toConsumableArray(acc),_toConsumableArray(WatchList._getCombinationsWith(_this378._marketAssetIds,id)))},[]),searchingPair=this.search.split("/")[1]&&2===searchIdList.length?[searchIdList.sort(utils.comparators.asc)]:[];return uniq(searchingPair.concat(favorite,combinationWithMarket,[chosen],marketAssets))}},{key:"_setPairData",value:function(data){this.pairDataList=data}},{key:"_getTabRate",value:function(){var _this379=this,activeTab=this.activeTab;return this._isActiveTrading()?Promise.resolve(new BigNumber(1)):waves.node.assets.getAsset("all"===activeTab?DEFAULT_ASSETS.USDN:activeTab).then(function(asset){return _this379.volumeAsset=asset,"all"===activeTab?Promise.resolve(new BigNumber(1)):ds.api.rate.getRate(DEFAULT_ASSETS.WAVES,activeTab).catch(function(){return new BigNumber(1)})}).catch(function(){return new BigNumber(1)})}},{key:"_getUsdnRate",value:function(){return ds.api.rate.getRate(DEFAULT_ASSETS.WAVES,DEFAULT_ASSETS.USDN).catch(function(){return new BigNumber(1)})}},{key:"_getTableFilter",value:function(){var _this380=this;return function(list){return""!==_this380.search?list.filter(function(item){return _this380._filterDataItemByTab(item)&&_this380._filterDataItemByQuery(item)}):list.filter(function(item){return _this380._filterDataItemByTab(item)})}}},{key:"_filterDataItemByTab",value:function(item){if(this._isActiveTrading())return!0;var canShow=!this.showOnlyFavorite||this.isFavourite(item);return"all"===this.activeTab?canShow:canShow&&(item.amountAsset.id===this.activeTab||item.priceAsset.id===this.activeTab)}},{key:"_filterDataItemByQuery",value:function(item){var query=this.search,searchPair=[{success:!1,names:[item.amountAsset.name.toLowerCase(),item.amountAsset.ticker&&item.amountAsset.ticker.toLowerCase()||null].filter(Boolean)},{success:!1,names:[item.priceAsset.name.toLowerCase(),item.priceAsset.ticker&&item.priceAsset.ticker.toLowerCase()||null].filter(Boolean)}];return function search(query){var queryList=query.split("/").map(function(q){return q.trim()});if(1===queryList.length){var q=query.toLowerCase();return WatchList._isId(query)?item.pairIdList.includes(query):filter(whereEq({success:!1}),searchPair).some(function(searchItem){return searchItem.success=searchItem.names.some(function(n){return 0===n.indexOf(q)}),searchItem.success})}if(queryList[0]&&""===queryList[1]){var _q=queryList[0].toLowerCase();return WatchList._isId(queryList[0])?item.pairIdList.includes(queryList[0]):searchPair.some(function(searchItem){return searchItem.success||(searchItem.success=searchItem.names.some(function(n){return n===_q})),searchItem.success})}return!queryList[0]&&queryList[1]?search(query.replace("/","")):search(queryList[0].trim())&&search(queryList[1].trim())}(query.trim())}},{key:"_onChangeSearch",value:function(){var _this381=this;this.searchRequest&&(this.searchRequest.drop(),this.searchInProgress=!1,this.pending=!1,this.searchRequest=null);var query=this.search;this._searchAssets=[];var queryParts=query.split("/").slice(0,2).map(function(q){return q.replace(/[:()^]/g,"").trim()}).filter(Boolean);if(!queryParts.length)return WatchList._renderSmartTable(),null;this.searchInProgress=!0,this.pending=!0,this.loadingError=!1,this.searchRequest=new PromiseControl(Promise.all(queryParts.map(waves.node.assets.search))).then(function(_ref163){var _ref164=_slicedToArray(_ref163,2),_ref164$=_ref164[0],d1=void 0===_ref164$?[]:_ref164$,_ref164$2=_ref164[1],d2=void 0===_ref164$2?[]:_ref164$2;return _this381._searchAssets=uniqBy(prop("id"),d1.concat(d2)),_this381._poll.restart().then(function(){_this381.searchInProgress=!1,_this381.pending=!1,_this381.searchRequest=null,_this381.showOnlyFavorite=!1,$scope.$apply()})}).catch(function(){_this381.searchInProgress=!1,_this381.pending=!1,_this381.searchRequest=null,$scope.$apply()})}},{key:"_updateFavoriteHash",value:function(){this._favoriteHash=this._favourite.reduce(function(acc,pair){return acc[WatchList._getKeyByPair(pair)]=pair,acc},Object.create(null))}},{key:"_updateSearchAssetHash",value:function(){this._searchAssetsHash=this._searchAssets.reduce(function(acc,asset){return acc[asset.id]=asset,acc},Object.create(null))}},{key:"_onChangeActiveTab",value:function(){var _this382=this;this.pending=!0,this.loadingError=!1,this._poll.restart().then(function(){_this382.pending=!1,$scope.$apply()})}},{key:"_initCache",value:function(){this._cache=utils.cache(controller.storage,WatchList._loadDataByPairs,WatchList._getKeyByPair,3e4,function(pair){return function(list){return list.find(function(p){return equals(p.pairIdList.slice().sort(),pair.slice().sort())})}})}},{key:"_getComparatorByPath",value:function(dataPath){var _this383=this;return function(list,isAsc){var method=isAsc?"asc":"desc",favorite=[],other=[],comparator=utils.comparators.process(path(dataPath.split("."))).smart[method];return list.forEach(function(item){_this383.isFavourite(item)?favorite.push(item):other.push(item)}),favorite.sort(comparator),other.sort(comparator),favorite.concat(other)}}},{key:"_getMarketPairsAndCreatePool",value:function(){var _this384=this;return this.pending=!0,this.loadingError=!1,this._timer&&clearTimeout(this._timer),this._poll&&this._poll.destroy(),Promise.all([this._getTabRate(),this._getUsdnRate(),ds.api.pairs.getPairsFromMarketData()]).then(function(_ref165){var _ref166=_slicedToArray(_ref165,3),rate=_ref166[0],usdnRate=_ref166[1];return _ref166[2].map(WatchList._chooseVolume(_this384.activeTab,rate,usdnRate))}).then(function(marketPairs){var pairs=marketPairs.filter(function(_ref167){var currentVolume=_ref167.currentVolume;return currentVolume&&!currentVolume.isZero()});_this384.pairDataList=pairs,_this384._marketPairs=pairs,_this384._marketAssetIds=uniq(flatten(pairs.map(function(_ref168){var amountAsset=_ref168.amountAsset,priceAsset=_ref168.priceAsset;return[amountAsset.id,priceAsset.id]})))}).then(function(){_this384._poll=createPoll(_this384,_this384._getPairData,_this384._setPairData,3e4,{$scope:$scope}),_this384._poll.ready.then(function(){_this384.pending=!1})}).catch(function(){_this384.pending=!1,_this384.loadingError=!0,_this384._timer=setTimeout(function(){_this384._getMarketPairsAndCreatePool()},2e3)})}}],[{key:"_addRateForPair",value:function(rate){return function(pair){if(!pair.volume)return pair;var currentVolume=pair.volume.getTokens().mul(rate).roundTo(3,BigNumber.ROUND_MODE.ROUND_HALF_UP);return _objectSpread({},pair,{currentVolume:currentVolume})}}},{key:"_chooseVolume",value:function(activeTab,rate,usdnRate){return function(pair){if("all"===activeTab||"WAVES"===activeTab){var _currentVolume3,_currentVolume,_pair$volumeAmount,_currentVolume2;if(pair.volumeWaves)_currentVolume=pair.volumeWaves.getTokens();else _currentVolume=null===(_pair$volumeAmount=pair.volumeAmount)||void 0===_pair$volumeAmount?void 0:_pair$volumeAmount.getTokens().mul(rate);if("all"===activeTab)_currentVolume=null===(_currentVolume2=_currentVolume)||void 0===_currentVolume2?void 0:_currentVolume2.mul(usdnRate);return _objectSpread({},pair,{currentVolume:null===(_currentVolume3=_currentVolume)||void 0===_currentVolume3?void 0:_currentVolume3.roundTo(3,BigNumber.ROUND_MODE.ROUND_HALF_UP),currentVolumeName:"all"===activeTab?"USDN":activeTab})}var currentVolume=activeTab===pair.amountAsset.id?pair.volumeAmount:pair.volumePrice;return _objectSpread({},pair,{currentVolume:null==currentVolume?void 0:currentVolume.getTokens().roundTo(3,BigNumber.ROUND_MODE.ROUND_HALF_UP),currentVolumeName:null==currentVolume?void 0:currentVolume.asset.displayName})}}},{key:"_renderSmartTable",value:function(){stService.render("watchlist")}},{key:"_onRenderTable",value:function(name){if("watchlist"!==name)return null;setTimeout(function(){var $chosen=$element.find(".chosen");if(!$chosen.length)return null;var $body=$element.find(".smart-table__tbody"),scroll=$body.scrollTop(),top=$chosen.offset().top-$body.offset().top+scroll-$body.height()/2+$chosen.height()/2;$element.find(".smart-table__tbody").animate({scrollTop:top},300)},300)}},{key:"_isId",value:function(query){return 16<WatchList._getBytes(query)||"WAVES"===query}},{key:"_getBytes",value:function(str){return new Blob([str],{type:"text/plain"}).size}},{key:"_getAssetsFromPairs",value:function(pairs){return pairs.reduce(function(acc,item){return["amountAsset","priceAsset"].forEach(function(propertyName){acc.hash[item.pair[propertyName].id]||(acc.assets.push(item.pair[propertyName]),acc.hash[item.pair[propertyName].id]=!0)}),acc},{assets:[],hash:{}}).assets}},{key:"_getKeyByPair",value:function(pair){return pair.sort().join()}},{key:"_loadDataByPairs",value:function(pairs){var ids=uniq(flatten(pairs));return ds.api.assets.get(ids).then(function(){var list=[],promiseList=pairs.filter(function(p){return 2===p.length}).reduce(function(acc,_ref169){var _ref170=_slicedToArray(_ref169,2),assetId1=_ref170[0],assetId2=_ref170[1],promise=ds.api.pairs.get(assetId1,assetId2).then(function(value){return list.push({status:"fulfilled",value:value}),list}).catch(function(){return list.push({status:"rejected"}),list});return acc.push(promise),acc},[]);return Promise.all(promiseList).then(function(){return list})}).then(function(pairs){pairs=pairs.filter(function(_ref171){return"fulfilled"===_ref171.status}).map(function(_ref172){return _ref172.value});var promiseList=splitEvery(20,pairs).map(function(pairs){return ds.api.pairs.info(matcher.currentMatcherAddress,pairs).then(function(infoList){return infoList.map(function(data,i){return _objectSpread({},data,{pairNames:"".concat(pairs[i].amountAsset.displayName," / ").concat(pairs[i].priceAsset.displayName),pairIdList:[pairs[i].amountAsset.id,pairs[i].priceAsset.id]})})}).catch(function(){return pairs.map(WatchList._getEmptyPairData)})});return Promise.all(promiseList)}).then(flatten)}},{key:"_getEmptyPairData",value:function(pair){return{amountAsset:pair.amountAsset,priceAsset:pair.priceAsset,pairNames:"".concat(pair.amountAsset.displayName," / ").concat(pair.priceAsset.displayName),pairIdList:[pair.amountAsset.id,pair.priceAsset.id],id:[pair.amountAsset.id,pair.priceAsset.id].sort().join(),lastPrice:null,firstPrice:null,volumePrice:null,volumeAmount:null,change24:null}}},{key:"_getAllCombinations",value:function(assetIdList){var pairs=[];return assetIdList.forEach(function(assetId,index){assetIdList.slice(index+1).forEach(function(anotherAssetId){pairs.push([assetId,anotherAssetId].sort(utils.comparators.asc))})}),pairs}},{key:"_getCombinationsWith",value:function(arrayIdList,id){return arrayIdList.map(function(assetId){return[id,assetId].sort(utils.comparators.asc)})}},{key:"_uniqPairs",value:function(pairs){return Object.values(pairs.reduce(function(acc,pair){return acc[pair.join(",")]=pair,acc},{}))}}]),WatchList}())}controller.storage=Object.create(null),controller.$inject=["Base","$scope","utils","waves","stService","PromiseControl","createPoll","$element","modalManager","configService","matcher","baseAssetService"],angular.module("app.dex").component("wDexWatchlist",{templateUrl:"modules/dex/directives/dexWatchlist/DexWatchlist.html",controller:controller})}(),function(){var controller=function(Base,$scope,$state,user,utils,notification){var libs=require("@waves/waves-transactions").libs,ds=require("data-service"),analytics=ds.analytics;return new(function(){function FromBackupCtrl(){var _this385;return _classCallCheck(this,FromBackupCtrl),(_this385=_possibleConstructorReturn(this,_getPrototypeOf(FromBackupCtrl).call(this,$scope))).step=0,_this385.password="",_this385.passwordError=!1,_this385.emptyError=!1,_this385.checkedHash={},_this385.decryptedData={},_this385.hasSelected=!1,_this385.selectIsVisible=!0,_this385.exportError=!1,_this385.originalUsers=[],_this385.selectIsVisible=!0,analytics.send({name:"Import From Backup Click",target:"ui"}),_this385}return _inherits(FromBackupCtrl,Base),_createClass(FromBackupCtrl,[{key:"toggleSelect",value:function(address){this.checkedHash[address]=!this.checkedHash[address],this.onSelect()}},{key:"onSelect",value:function(){var total=(this.decryptedData.saveUsers||[]).length,selected=Object.values(this.checkedHash).filter(Boolean).length;this.hasSelected=!!selected,this.selectIsVisible=total!==selected}},{key:"selectAll",value:function(){var _this386=this;(this.decryptedData.saveUsers||[]).forEach(function(user){_this386.checkedHash[user.address]=!0}),this.onSelect()}},{key:"unselectAll",value:function(){var _this387=this;(this.decryptedData.saveUsers||[]).forEach(function(user){_this387.checkedHash[user.address]=!1}),this.onSelect()}},{key:"next",value:function(){var _this388=this;if(0===this.step&&this.backup&&this.backup.encrypted)user.getMultiAccountUsers().then(function(users){_this388.originalUsers=users,_this388.password="",_this388.step=1,utils.safeApply($scope)});else if(0===this.step&&this.backup&&!this.backup.encrypted)this.password="",this.decryptedData=_objectSpread({},this.backup),this.decryptedData.saveUsers="string"==typeof this.decryptedData.saveUsers?JSON.parse(this.decryptedData.saveUsers):this.decryptedData.saveUsers,this.remapUsers(),this.filterUsers(),this.selectFirst(),this.emptyError?this.step=0:this.step=2;else if(1===this.step&&this.password){var saveUsers=this.decryptData();this.passwordError||(this.decryptedData=_objectSpread({},this.backup,{saveUsers:saveUsers}),this.remapUsers(),this.filterUsers(),this.selectFirst(),this.emptyError?this.step=0:this.step=2)}}},{key:"filterUsers",value:function(){this.decryptedData.saveUsers=this.decryptedData.saveUsers||[],WavesApp.isDesktop()&&(this.decryptedData.saveUsers=this.decryptedData.saveUsers.filter(function(user){return"wavesKeeper"!==user.userType})),!WavesApp.device.phone()&&!WavesApp.device.tablet()||(this.decryptedData.saveUsers=this.decryptedData.saveUsers.filter(function(user){return"wavesKeeper"!==user.userType&&"ledger"!==user.userType})),this.decryptedData.saveUsers=this.decryptedData.saveUsers.filter(function(user){return user.networkByte===(ds.config.get("code")||"W").charCodeAt(0)}),this.decryptedData.saveUsers&&0!==this.decryptedData.saveUsers.length||(this.emptyError=!0)}},{key:"selectFirst",value:function(){var user=(this.decryptedData.saveUsers||[])[0];user&&(this.checkedHash=_defineProperty({},user.address,!0),this.onSelect())}},{key:"login",value:function(newUser){user.login(newUser),notification.info({ns:"app.ui",title:{literal:"importSuccess"}}),analytics.user.importAddressSuccess("backup"),$state.go(user.goToActiveState())}},{key:"decryptData",value:function(){try{var data=_objectSpread({},this.backup),users=JSON.parse(libs.crypto.decryptSeed(data.saveUsers,this.password,data.encryptionRounds));return this.passwordError=!Array.isArray(users),users}catch(e){this.passwordError=!0}}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(FromBackupCtrl.prototype),"$onDestroy",this).call(this)}},{key:"onFileChange",value:function(event){var _this389=this,reader=new FileReader;if(this.emptyError=!1,event.target.files&&0<event.target.files.length){var file=event.target.files[0];this.filename=file.name||"",reader.readAsDataURL(file);var userListPromise=user.getMultiAccountUsers().then(function(users){_this389.originalUsers=users}),readerPromise=new Promise(function(resolve,reject){reader.onload=resolve,reader.onerror=reject});Promise.all([userListPromise,readerPromise]).then(function(){var fileData=libs.crypto.bytesToString(libs.crypto.base64Decode(reader.result.split(",")[1]));_this389.backup=FromBackupCtrl.parseUsers(fileData),_this389.readError=null}).catch(function(){_this389.readError="wrongFile"}).then(function(){utils.safeApply($scope)})}}},{key:"remapUsers",value:function(){var fromBackup=this.decryptedData.saveUsers||[],originalUsers=this.originalUsers.reduce(function(acc,user){return acc.names[user.name]=user,acc.addresses[user.address]=user,acc.publicKeys[user.publicKey]=user,acc},{names:{},addresses:{},publicKeys:{}});this.decryptedData.saveUsers=fromBackup.map(function(user){return originalUsers.addresses[user.address]?null:(originalUsers.names[user.name]&&(user.name=function(names,name){for(var index=0;name="".concat(name,"_").concat(index),index++,names.includes(name););return name}(Object.keys(originalUsers.names),user.name)),user)}).filter(Boolean)}},{key:"onSubmit",value:function(){var _this390=this,users=Object.entries(this.checkedHash).filter(function(item){return item[1]}).map(function(_ref173){var address=_slicedToArray(_ref173,1)[0];return _this390.decryptedData.saveUsers.find(function(user){return user.address===address})}),promises=[];users.reduce(function(acc,newUser){var userPromise=acc.then(function(){return user.addUser(newUser,!0,!0)});return promises.push(userPromise),userPromise},Promise.resolve()),Promise.all(promises).then(function(users){return _this390.login(users[0])}).catch(function(){_this390.exportError=!0})}}],[{key:"parseUsers",value:function(data){var backup=JSON.parse(data);if(!backup||"wavesBackup"!==backup.type||!backup.lastOpenVersion)throw new Error("wrongFile");var dataObject=JSON.parse(libs.crypto.bytesToString(libs.crypto.base64Decode(backup.data))),hashSum=dataObject.hashSum;if(delete dataObject.hashSum,libs.crypto.base58Encode(libs.crypto.sha256(libs.crypto.stringToBytes(JSON.stringify(dataObject))))!==hashSum)throw new Error("Fail is corrupted");return _objectSpread({},dataObject,{type:backup.type,lastOpenVersion:backup.lastOpenVersion})}}]),FromBackupCtrl}())};controller.$inject=["Base","$scope","$state","user","utils","notification"],angular.module("app.fromBackup").controller("FromBackupCtrl",controller),angular.module("app.fromBackup").directive("fileChange",["$parse",function($parse){return{require:"ngModel",restrict:"A",link:function($scope,element,attrs){var attrHandler=$parse(attrs.fileChange);element[0].addEventListener("change",function(e){$scope.$apply(function(){attrHandler($scope,{$event:e,files:e.target.files})})},!1)}}}])}(),function(){var controller=function(user){return new function LeasingFaqCtrl(){_classCallCheck(this,LeasingFaqCtrl),this.isLogined=!!user.address}};controller.$inject=["user"],angular.module("app.leasingFaq").controller("LeasingFaqCtrl",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,configService,user,modalManager,balanceWatcher){return reactDirective(rc.Leverage,void 0,void 0,{$state:$state,configService:configService,user:user,modalManager:modalManager,balanceWatcher:balanceWatcher})};controller.$inject=["reactDirective","$state","configService","user","modalManager","balanceWatcher"],angular.module("app.leverage").directive("wLeverage",controller)}(),function(){var range=require("ramda").range,FAQ_ITEMS=range(1,12).map(function(i){return{title:"faq.prediction.title".concat(i),text:"faq.prediction.text".concat(i),hash:"".concat(i)}}),controller=function(Base,$scope,user,modalManager,utils,waves,$element,ChartFactory,storage,matcher,configService,baseAssetService,$location,$state,balanceWatcher){var BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),moment=require("moment");return new(function(){function PredictionCtrl(){var _this391;_classCallCheck(this,PredictionCtrl),(_this391=_possibleConstructorReturn(this,_getPrototypeOf(PredictionCtrl).call(this,$scope))).chartOptions={axisX:"date",axisY:"value",marginBottom:46,hasDates:!1,checkWidth:2e3,heightFactor:.7,view:{values:{lineColor:"#5a81ea",fillColor:"#292f3c",gradientColor:["#334375","#292F3C"],lineWidth:2,isDashed:!1},peak:{lineColor:"#404a61",fillColor:"transparent",gradientColor:["transparent","transparent"],lineWidth:1,isDashed:!0}}},_this391.hasMultiAccount=!1,_this391.appUrls={google:"https://play.google.com/store/apps/details?id=com.wavesplatform.wallet",android:"https://waves.exchange/files/Waves.Exchange-app.apk",appStore:"https://apps.apple.com/us/app/waves-wallet/id1233158971"},_this391.lang="",_this391.isMobile=!1,_this391.faqItems=FAQ_ITEMS,_this391.hash="",_this391.buyAmount="",_this391.parsedBuyAmount="",_this391.assetId=void 0,_this391.chartTab="weekly",_this391.enableGetPrize=!1,_this391.winnerData=void 0,_this391.redeemHeight=void 0,_this391._getCovidData().then(function(){if(user.showPredictionModal){var modal=user.showPredictionModal;_this391._debounceTimer=setTimeout(function(){_this391.showPredictionModal(modal)},1e3),user.showPredictionModal=null}}),user.getMultiAccountData().then(function(data){_this391.hasMultiAccount=!!data,!_this391.hasMultiAccount&&_this391.isWeb&&storage.load("accountImportComplete").then(function(complete){complete||_this391._loadUserListFromOldOrigin()})});var APP_URLS=configService.get("APP_URLS");if(APP_URLS){var google=APP_URLS.google,android=APP_URLS.android,appStore=APP_URLS.appStore;_this391.appUrls={google:google||_this391.appUrls.google,android:android||_this391.appUrls.android,appStore:appStore||_this391.appUrls.appStore}}return _this391._setIsMobile(),_this391.listenEventEmitter($(window),"resize",function(){_this391._setIsMobile(),$scope.$digest()}),_this391._onChangeLanguge=_this391._onChangeLang.bind(_assertThisInitialized(_this391)),i18next.on("languageChanged",_this391._onChangeLanguge),_this391._onChangeLang(),_this391.hash=$location.hash(),_this391.assetId=baseAssetService.getBaseAsset(),_this391}return _inherits(PredictionCtrl,Base),_createClass(PredictionCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(PredictionCtrl.prototype),"$onDestroy",this).call(this),clearTimeout(this._debounceTimer)}},{key:"onChangeBuyAmount",value:function(){this.buyAmount=this.buyAmount.replace(/[^!\d]/g,""),this.parsedBuyAmount=parseInt(this.buyAmount,10)}},{key:"buyFiat",value:function(e){e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation(),user.buyOptions={buyInit:this.parsedBuyAmount||"",assetId:this.assetId},user.isAuthorised?$state.go("staking"):(user.forceInitRouteState("staking"),user.getMultiAccountData().then(function(data){$state.go(data?"signIn":"signUp")}))}},{key:"buyOnExchange",value:function(assetType){var pairAssetsId={assetId1:this.baseAssetId,assetId2:"up"===assetType?this.incAssetId:this.decAssetId};utils.openDex(pairAssetsId.assetId1,pairAssetsId.assetId2)}},{key:"onClickChartTab",value:function(tab){this.chartTab=tab}},{key:"_onChangeLang",value:function(lng){this.lng=lng}},{key:"_addScrollHandler",value:function(){var scrolledView=$element.find(".scrolled-view"),header=$element.find("w-main-header");scrolledView.on("scroll",function(){header.toggleClass("fixed",60<scrolledView.scrollTop()),header.toggleClass("unfixed",scrolledView.scrollTop()<=60)})}},{key:"goToDexDemo",value:function(pairAssets){utils.openDex(pairAssets.assetId1,pairAssets.assetId2)}},{key:"goToStaking",value:function(){this._forceInitRouteState()}},{key:"onChartMouseMove",value:function(data){this.hoveredValue=data.point.yValue.toFormat(),this.chartCursorLeft="".concat(data.point.x,"px"),this.chartCursorTop="".concat(data.point.y,"px"),$scope.$apply()}},{key:"onChartMouseOut",value:function(){this.hoveredValue=void 0}},{key:"showPredictionModal",value:function(type){var _this392=this;if(clearTimeout(this._debounceTimer),user.isAuthorised){var winner=this.winnerData[0]?this.winnerData[0].value:null;Promise.all([ds.api.assets.get("WAVES"),winner?ds.api.assets.get(winner):null]).then(function(_ref175){var _ref176=_slicedToArray(_ref175,2),wavesAsset=_ref176[0],winnerAsset=_ref176[1],winnerBalance=winnerAsset?balanceWatcher.getBalanceByAsset(winnerAsset):null,wavesBalance=balanceWatcher.getBalanceByAsset(wavesAsset);waves.node.height().then(function(height){var didFinished=_this392.redeemHeight&&_this392.redeemHeight<=height;modalManager.showPredictionResult(type,winnerBalance,wavesBalance,didFinished)})})}else user.showPredictionModal=type,user.forceInitRouteState("prediction"),user.getMultiAccountData().then(function(data){$state.go(data?"signIn":"signUp")})}},{key:"_forceInitRouteState",value:function(){user.forceInitRouteState("staking")}},{key:"_setIsMobile",value:function(){this.isMobile=window.innerWidth<=860}},{key:"_getCovidData",value:function(){var _this393=this;this.inPending=!0;var _configService$get=configService.get("PREDICTION"),PAIR_ASSET=_configService$get.PAIR_ASSET,ENABLE_GET_PRIZE=_configService$get.ENABLE_GET_PRIZE,_configService$get2=configService.get("PREDICTION_SEP"),INCREASE=_configService$get2.INCREASE,DECREASE=_configService$get2.DECREASE,DATA_STATE_SEP=_configService$get2.DATA_STATE,baseAssetId=baseAssetService.getIdByTicker(PAIR_ASSET);return this.baseAssetId=baseAssetId,this.incAssetId=INCREASE,this.decAssetId=DECREASE,this.dataStateSepAddress=DATA_STATE_SEP,this.enableGetPrize=!!ENABLE_GET_PRIZE,ds.api.assets.get([baseAssetId,INCREASE,DECREASE]).then(function(_ref177){var _ref178=_slicedToArray(_ref177,3),base=_ref178[0],inc=_ref178[1],dec=_ref178[2];return _this393.baseAsset=base,_this393.incAsset=inc,_this393.decAsset=dec,_this393._getDataState()})}},{key:"_getDataState",value:function(){var _this394=this,regexp=/\d\d-\d\d-\d\d\d\d/;this.inPending=!0;var dataSepPromise=ds.api.data.getDataFields(this.dataStateSepAddress),heightPromise=waves.node.height();return Promise.all([dataSepPromise,heightPromise]).catch(function(){return[]}).then(function(_ref179){var _ref180=_slicedToArray(_ref179,2),_ref180$=_ref180[0],dataSep=void 0===_ref180$?[]:_ref180$,wavesHeight=_ref180[1],total=dataSep.filter(function(_ref181){var key=_ref181.key;return regexp.test(key)}).map(function(_ref182){var key=_ref182.key,value=_ref182.value;return{key:key,date:moment(key,"MM-DD-YYYY").toDate(),value:value}}).sort(function(i1,i2){return i1.date-i2.date}),byDay=total.reduce(function(acc,_,index,array){var last=array[index-1],current=array[index];return acc.push(_objectSpread({},current,{value:last?current.value-last.value:current.value})),acc},[]),byWeek=PredictionCtrl._getWeekValues(byDay);_this394.winnerData=dataSep.filter(function(_ref183){return"winner"===_ref183.key});var height=dataSep.filter(function(_ref184){return"redeemHeight"===_ref184.key})[0]||{value:null};_this394.redeemHeight=height.value,_this394.enableGetPrize=_this394.redeemHeight&&_this394.redeemHeight<=wavesHeight,_this394.peak=dataSep.find(function(_ref185){return"peak"===_ref185.key}).value,_this394.hasUser=user.isAuthorised,_this394.total={values:total},_this394.byWeek={values:byWeek,peak:byWeek.map(function(item){return _objectSpread({},item,{value:_this394.peak})})},_this394.totalSum=new BigNumber(total[total.length-1].value).toFormat(),_this394.byWeekSum=new BigNumber(byWeek[byWeek.length-1].value).toFormat(),_this394.lastUpdate=total[total.length-1].date||new Date,_this394.lastUpdateDate=moment(_this394.lastUpdate).format("MMMM DD"),_this394.inPending=!1,utils.safeApply($scope)})}}],[{key:"_getWeekValues",value:function(byDay){return byDay.map(function(item,index){return 0===index?item:_objectSpread({},item,{value:range(1,7).reduce(function(acc,weekIndex){var prev=byDay[index-weekIndex];return prev?prev.value+acc:acc},item.value)})})}}]),PredictionCtrl}())};controller.$inject=["Base","$scope","user","modalManager","utils","waves","$element","ChartFactory","storage","matcher","configService","baseAssetService","$location","$state","balanceWatcher"],angular.module("app.prediction").controller("PredictionCtrl",controller)}(),function(){var controller=function(user){return new function StakingFaqCtrl(){_classCallCheck(this,StakingFaqCtrl),this.isLogined=!!user.address}};controller.$inject=["user"],angular.module("app.stakingFaq").controller("StakingFaqCtrl",controller)}(),function(){var controller=function(Base,$scope,user,waves,utils){return new(function(){function AssetInfoHead(){return _classCallCheck(this,AssetInfoHead),_possibleConstructorReturn(this,_getPrototypeOf(AssetInfoHead).apply(this,arguments))}return _inherits(AssetInfoHead,Base),_createClass(AssetInfoHead,[{key:"$postLink",value:function(){this._getAssetInfo(),this.observe("assetId",this._getAssetInfo)}},{key:"_getAssetInfo",value:function(){var _utils$getDataFromOra3=utils.getDataFromOracles(this.assetId),isVerified=_utils$getDataFromOra3.isVerified,isGateway=_utils$getDataFromOra3.isGateway,isTokenomica=_utils$getDataFromOra3.isTokenomica,isStable=_utils$getDataFromOra3.isStable,isSuspicious=_utils$getDataFromOra3.isSuspicious,isGatewaySoon=_utils$getDataFromOra3.isGatewaySoon,isPrediction=_utils$getDataFromOra3.isPrediction,isInvestment=_utils$getDataFromOra3.isInvestment,isDefi=_utils$getDataFromOra3.isDefi,hasLabel=_utils$getDataFromOra3.hasLabel;this.isGateway=isGateway,this.isStable=isStable,this.isPrediction=isPrediction,this.isTokenomica=!isGateway&&isTokenomica,this.isVerified=!isTokenomica&&isVerified,this.isSuspicious=!isVerified&&isSuspicious,this.isGatewaySoon=!isGateway&&isGatewaySoon,this.isInvestment=isInvestment,this.isDefi=isDefi,this.hasLabel=hasLabel}}]),AssetInfoHead}())};controller.$inject=["Base","$scope","user","waves","utils"],angular.module("app.ui").component("wAssetStatus",{controller:controller,templateUrl:"modules/ui/directives/assetStatus/asset-status.html",bindings:{assetId:"<"}})}(),function(){var DEFAULT_OPTIONS_center=0,ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber,controller=function(Base,$element){return new(function(){function CircleChart(){var _this395;return _classCallCheck(this,CircleChart),(_this395=_possibleConstructorReturn(this,_getPrototypeOf(CircleChart).call(this)))._canvas=null,_this395._ctx=null,_this395._options=null,_this395._data=null,_this395.observe(["_options","_data"],_this395._redrawGraph),_this395}return _inherits(CircleChart,Base),_createClass(CircleChart,[{key:"$postLink",value:function(){this._canvas=$element.find("canvas").get(0),this._ctx=this._canvas.getContext("2d"),this._redrawGraph()}},{key:"_resetCanvasSize",value:function(){var _this396=this,size=2*this._data.reduce(function(result,item){return Math.max(result,_this396._options.items[item.id].radius)},0)+2;this._canvas.width=size,this._canvas.height=size}},{key:"_getBalances",value:function(){var Money=ds.wavesDataEntities.Money;return this._data.map(function(item){var value=item.value instanceof Money?item.value.getTokens():item.value;return{id:item.id,value:value}})}},{key:"_redrawGraph",value:function(){return this._canvas&&this._data&&this._data.length&&this._options&&this._options.items?(this._resetCanvasSize(),void this._draw()):null}},{key:"_draw",value:function(){var _this397=this,balances=this._getBalances(),total=balances.reduce(function(result,item){return result.add(item.value)},new BigNumber(0)),center=this._canvas.height/2+.5,insightRadius=this._options.center||DEFAULT_OPTIONS_center,empty=total.eq(0);if($element.toggleClass("empty-chart",empty),empty)return!1;var startFrom=this._options.startFrom;balances.forEach(function(item){var options=_this397._options.items[item.id],progress=item.value.div(total),end=startFrom+2*Math.PI*progress,startInsight={x:center+insightRadius*Math.cos(startFrom),y:center+insightRadius*Math.cos(Math.PI/2-startFrom)},startOut={x:center+options.radius*Math.cos(startFrom),y:center+options.radius*Math.cos(Math.PI/2-startFrom)},endInsight={x:center+insightRadius*Math.cos(end),y:center+insightRadius*Math.cos(Math.PI/2-end)};_this397._ctx.beginPath(),_this397._ctx.fillStyle=options.color,_this397._ctx.strokeStyle=options.color,_this397._ctx.lineWidth=1,_this397._ctx.moveTo(startInsight.x,startInsight.y),_this397._ctx.lineTo(startOut.x,startOut.y),_this397._ctx.arc(center,center,options.radius,startFrom,end),_this397._ctx.lineTo(endInsight.x,endInsight.y),_this397._ctx.moveTo(startInsight.x,startInsight.y),_this397._ctx.arc(center,center,insightRadius,startFrom,end),_this397._ctx.fill(),_this397._ctx.closePath(),startFrom=end}),insightRadius&&(this._ctx.save(),this._ctx.globalCompositeOperation="destination-out",this._ctx.beginPath(),this._ctx.fillStyle="rgba(255,255,255,1)",this._ctx.arc(center,center,insightRadius,0,2*Math.PI),this._ctx.fill(),this._ctx.closePath(),this._ctx.restore())}}]),CircleChart}())};controller.$inject=["Base","$element","utils"],angular.module("app.ui").component("wCircleChart",{bindings:{_options:"<options",_data:"<data"},template:"<canvas></canvas>",transclude:!1,controller:controller})}(),angular.module("app.ui").component("wDesktopOnly",{scope:!1,transclude:!0,template:'<div ng-if="::'.concat(WavesApp.isDesktop(),'" ng-transclude></div>')}),function(){var controller=function(Base,$scope,$element){return new(function(){function InfoTooltipController(){var _this398;return _classCallCheck(this,InfoTooltipController),(_this398=_possibleConstructorReturn(this,_getPrototypeOf(InfoTooltipController).call(this))).hovered=!1,_this398}return _inherits(InfoTooltipController,Base),_createClass(InfoTooltipController,[{key:"hoverIn",value:function(){this.hovered=!0,clearTimeout(this.timer),$scope.$apply()}},{key:"hoverOut",value:function(){var _this399=this;clearTimeout(this.timer),this.timer=setTimeout(function(){_this399.hovered=!1,$scope.$apply()},Number(this.delay)||1e3)}},{key:"$postLink",value:function(){var _this400=this;$element.find("i").on("mouseover",function(){return _this400.hoverIn()}),$element.find("i").on("mouseout",function(){return _this400.hoverOut()})}}]),InfoTooltipController}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wInfoTooltip",{templateUrl:"modules/ui/directives/infoTooltip/infoTooltip.html",transclude:!0,bindings:{delay:"<",noIcon:"<"},controller:controller})}(),function(){var controller=function($element,$scope,Base,utils,$document){var _require77=require("ramda"),range=_require77.range,last=_require77.last,head=_require77.head;return new(function(){function RangeSlider(){var _getPrototypeOf9,_this401;_classCallCheck(this,RangeSlider);for(var _len22=arguments.length,args=new Array(_len22),_key22=0;_key22<_len22;_key22++)args[_key22]=arguments[_key22];return(_this401=_possibleConstructorReturn(this,(_getPrototypeOf9=_getPrototypeOf(RangeSlider)).call.apply(_getPrototypeOf9,[this].concat(args)))).min=void 0,_this401.max=void 0,_this401.scaleInterval=void 0,_this401.intervals=void 0,_this401.ngModel=void 0,_this401.disabled=void 0,_this401._numberValues=void 0,_this401._scale=void 0,_this401._track=void 0,_this401._handle=void 0,_this401._container=void 0,_this401._amountOfPoints=void 0,_this401._coords=void 0,_this401._applyValueMode=!1,_this401.__handlePosition=0,_this401}return _inherits(RangeSlider,Base),_createClass(RangeSlider,[{key:"$postLink",value:function(){this._track=$element.find(".range-slider__track"),this._trackColor=$element.find(".range-slider__track_colorize"),this._handle=$element.find(".range-slider__handle"),this._container=$element.find(".range-slider"),this.observe(["min","max","scaleInterval","intervals"],this._onChangeParams),this.observe("ngModel",this._onChangeModel),this._onChangeParams(),this._initEvents()}},{key:"_onChangeModel",value:function(){if(this._applyValueMode)return null;this._drawModelState()}},{key:"_drawModelState",value:function(){var _this402=this,newPos=this._coords[this._numberValues[this.ngModel]],start=this._handleTranslateX;this._handle.prop("progress",0),utils.animate(this._handle,{progress:1},{duration:100,step:function(progress){_this402._handleTranslateX=start+(newPos-start)*progress}}),utils.animate(this._trackColor,{width:newPos},{duration:100})}},{key:"_onChangeParams",value:function(){if(null==this.max)return $element.hide(),null;$element.show();var min=this.min||0,max=this.max,scaleInterval=this.scaleInterval||1;this._amount=(max-min)/scaleInterval,this.gridValues=range(min,max+1).map(function(num){return num*scaleInterval}),this._calcPosition(max,min,scaleInterval)}},{key:"_calcPosition",value:function(max,min,scaleInterval){var _this403=this,intervals=this.intervals||1,sliderLength=this._track.width()-this._handle.outerWidth();this._amountOfPoints=this._amount*intervals;var oneInterval=scaleInterval/intervals;this._numberValues=range(min,this._amountOfPoints+1).map(function(num){return Math.round(num*oneInterval*100)/100}),this._scale=sliderLength/this._amountOfPoints,this._coords=range(0,this._amountOfPoints+1).map(function(num){return _this403._track.position().left+num*_this403._scale})}},{key:"_resizePosition",value:function(){var _this404=this,sliderLength=this._track.width()-this._handle.outerWidth();this._scale=sliderLength/this._amountOfPoints,this._coords=range(0,this._amountOfPoints+1).map(function(num){return _this404._track.position().left+num*_this404._scale}),this._drawModelState()}},{key:"_initEvents",value:function(){var _this405=this,onResize=utils.debounceRequestAnimationFrame(function(){return _this405._resizePosition()});this.listenEventEmitter($element,"mousedown touchstart",function(){_this405._handle.stop(!0,!1),_this405._trackColor.stop(!0,!1);var startPos=_this405._track.offset().left;_this405._container.addClass("range-slider_drag");var onDrag=utils.debounceRequestAnimationFrame(function(event){if(!_this405.disabled){var utilEvent=utils.getEventInfo(event),position=Math.round(utilEvent.pageX-startPos-_this405._handle.width()/2),newPosition=Math.min(Math.max(head(_this405._coords),position),last(_this405._coords));_this405._updateModel(_this405._numberValues[_this405._findClosestIndex(newPosition)]),_this405._handleTranslateX=newPosition,$scope.$apply()}}),onDragEnd=utils.debounceRequestAnimationFrame(function(event){if($document.off("mousemove touchmove",onDrag),$document.off("mouseup touchend",onDragEnd),!_this405.disabled){var utilEvent=utils.getEventInfo(event);_this405._container.removeClass("range-slider_drag"),function(pos){_this405._updateModel(_this405._numberValues[_this405._findClosestIndex(pos)]),_this405._drawModelState()}(utilEvent.pageX-startPos-_this405._handle.width()/2),$scope.$apply()}});$document.on("mousemove touchmove",onDrag),$document.on("mouseup touchend",onDragEnd)}),this.listenEventEmitter($(window),"resize",onResize)}},{key:"_findClosestIndex",value:function(position){var _this406=this;return position=Math.min(Math.max(position,head(this._coords)),last(this._coords)),this._coords.findIndex(function(section){return Math.abs(position-section)<=_this406._scale/2})}},{key:"_updateModel",value:function(value){this._applyValueMode=!0,this.ngModel=this._numberValues[value],this._applyValueMode=!1}},{key:"_handleTranslateX",get:function(){return this.__handlePosition},set:function(translate){translate!==this.__handlePosition&&(this.__handlePosition=translate,this._handle.css("transform","translateX(".concat(translate,"px)")),this._trackColor.css("width",translate))}}]),RangeSlider}())};controller.$inject=["$element","$scope","Base","utils","$document"],angular.module("app.ui").component("wRangeSlider",{bindings:{min:"<",max:"<",scaleInterval:"<",intervals:"<",ngModel:"=",disabled:"<"},templateUrl:"modules/ui/directives/rangeSlider/rangeSlider.html",controller:controller})}(),function(){var controller=function(Base,user,$scope,RatingStarsFactory,$element,waves,modalManager,balanceWatcher,$mdDialog,utils,baseAssetService){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE;return new(function(){function RatingStars(){var _getPrototypeOf10,_this407;_classCallCheck(this,RatingStars);for(var _len23=arguments.length,args=new Array(_len23),_key23=0;_key23<_len23;_key23++)args[_key23]=arguments[_key23];return(_this407=_possibleConstructorReturn(this,(_getPrototypeOf10=_getPrototypeOf(RatingStars)).call.apply(_getPrototypeOf10,[this].concat(args)))).$container=void 0,_this407.hasBalance=!1,_this407.rating=void 0,_this407.size=void 0,_this407.assetID=void 0,_this407.canRate=!1,_this407}return _inherits(RatingStars,Base),_createClass(RatingStars,[{key:"$postLink",value:function(){var _this408=this,ratingStars=new RatingStarsFactory({$container:$element.find(".rating-stars-wrapper"),rating:this.rating,size:this.size,canRate:this.canRate,hasBalance:this.hasBalance});this.observe("rating",function(){ratingStars.update(_this408.rating)}),this.canRate&&(this.observe("hasBalance",function(){ratingStars.updateStatus(_this408.hasBalance),$scope.$apply()}),waves.node.getFee({type:SIGN_TYPE.DATA}).then(function(money){_this408.fee=money,_this408._checkBalance(),_this408.receive(ratingStars.vote,_this408._onVote,_this408)}))}},{key:"_checkBalance",value:function(){var balance=balanceWatcher.getBalance();this.wavesBalance=balance[baseAssetService.WavesAssetId],this.wctBalance=balance[baseAssetService.WCTAssetId],this.wavesBalance.gte(this.fee)&&this.wctBalance&&this.wctBalance.getTokens().gte(1)&&(this.hasBalance=!0,$scope.$apply())}},{key:"_onVote",value:function(rating){var _this409=this;waves.node.getFee({type:SIGN_TYPE.DATA}).then(function(money){_this409.fee=money;var tx=waves.node.transactions.createTransaction({type:SIGN_TYPE.DATA,data:{data:[{key:"tokenRating",type:"string",value:"tokenRating"},{key:"assetId",type:"string",value:_this409.assetId},{key:"score",type:"integer",value:rating}],fee:_this409.fee,type:SIGN_TYPE.DATA}});_this409.signable=ds.signature.getSignatureApi().makeSignable(tx),RatingStars._generateTx(_this409.signable)})}},{key:"openDex",value:function(){utils.openDex("WCT")}}],[{key:"_generateTx",value:function(signable){return $mdDialog.hide(),modalManager.showConfirmTx(signable)}}]),RatingStars}())};controller.$inject=["Base","user","$scope","RatingStarsFactory","$element","waves","modalManager","balanceWatcher","$mdDialog","utils","baseAssetService"],angular.module("app.ui").component("wRatingStars",{bindings:{rating:"<",size:"<",canRate:"<",assetId:"<"},templateUrl:"modules/ui/directives/ratingStars/ratingStars.html",controller:controller})}(),angular.module("app.ui").directive("wToggleClass",function(){return{scope:!1,require:"^^wToggleClassContainer",restrict:"A",link:function($scope,$element,$attrs,$container){$element.on("click",function(){$container.toggleClass($element.attr("w-toggle-class")||"active")})}}}),function(){var controller=function(Base,$filter,modalManager,notification,waves,utils,user,$scope){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,base58Encode=require("@waves/waves-transactions").libs.crypto.base58Encode;return new(function(){function Transaction(){return _classCallCheck(this,Transaction),_possibleConstructorReturn(this,_getPrototypeOf(Transaction).apply(this,arguments))}return _inherits(Transaction,Base),_createClass(Transaction,[{key:"$postLink",value:function(){var _this410=this;this.typeName=this.transaction.typeName,this.setScam(),this.receive(user.setScamSignal,function(){_this410.setScam(),$scope.$apply()})}},{key:"setScam",value:function(){if(this.isScam=!!user.scam[this.transaction.assetId],7===this.transaction.type){var isScamAmount=!!user.scam[this.transaction.amount.asset],isScamPrice=!!user.scam[this.transaction.price.asset];this.isScam=this.isScam||isScamAmount||isScamPrice}}},{key:"cancelLeasing",value:function(){var lease=this.transaction,leaseId=lease.id;return waves.node.getFee({type:SIGN_TYPE.CANCEL_LEASING}).then(function(fee){var tx=waves.node.transactions.createTransaction({fee:fee,type:SIGN_TYPE.CANCEL_LEASING,lease:lease,leaseId:leaseId}),signable=ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx});return modalManager.showConfirmTx(signable)})}},{key:"showTransaction",value:function(){modalManager.showTransactionInfo(this.transaction.id)}},{key:"getCopyAllData",value:function(){var tx=this.transaction,id="Transaction ID: ".concat(tx.id),type="Type: ".concat(tx.type," (").concat(this.typeName,")"),timestamp=$filter("date")(tx.timestamp,"MM/dd/yyyy HH:mm"),datetime="Date: ".concat(timestamp),sender="Sender: ".concat(tx.sender);tx.typeName===WavesApp.TRANSACTION_TYPES.NODE.EXCHANGE&&(sender+=" (matcher address)");var message="".concat(id,"\n").concat(type,"\n").concat(datetime,"\n").concat(sender);if(tx.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.UNKNOWN)return message+="\n\nRAW TX DATA BELOW\n\n",message+=JSON.stringify(tx,null,2);if(tx.recipient){var recipient="Recipient: ".concat(tx.recipient);message+="\n".concat(recipient)}if(tx.amount&&tx.amount instanceof ds.wavesDataEntities.Money){var asset=tx.amount.asset,amount="Amount: ".concat(tx.amount.toFormat()," ").concat(asset.name," (").concat(asset.id,")");message+="\n".concat(amount)}if(this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.EXCHANGE_BUY||this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.EXCHANGE_SELL){var _asset=tx.price.asset,total=tx.price.cloneWithTokens(this.transaction.price.getTokens().mul(this.transaction.amount.toTokens())),price="Price: ".concat(tx.price.toFormat()," ").concat(_asset.name," (").concat(_asset.id,")"),totalPrice="Total price: ".concat(total.toFormat()," ").concat(_asset.name);message+="\n".concat(price,"\n").concat(totalPrice)}this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.DATA&&(message+="\n\n\nDATA START",message+="\n\n".concat(tx.stringifiedData),message+="\n\nDATA END\n\n");var fee="Fee: ".concat(tx.fee.toFormat()," ").concat(tx.fee.asset.name," (").concat(tx.fee.asset.id,")");if(message+="\n".concat(fee),tx.attachment){var attachment;try{attachment=utils.bytesToSafeString(tx.attachment)}catch(e){attachment="base58:".concat(base58Encode(tx.attachment))}attachment&&(message+="\nAttachment: ".concat(attachment))}return message}}]),Transaction}())};controller.$inject=["Base","$filter","modalManager","notification","waves","utils","user","$scope"],angular.module("app.ui").component("wTransaction",{bindings:{datePattern:"@",transaction:"<"},require:{parent:"^wTransactionList"},templateUrl:"modules/ui/directives/transaction/transaction.html",transclude:!1,controller:controller})}(),function(){var factory=function(BaseNotificationManager){return new BaseNotificationManager({templateUrl:"modules/app/services/notification/templates/notification.html",queueLimit:5,defaultDelay:3e3})};factory.$inject=["BaseNotificationManager"],angular.module("app").factory("notification",factory)}(),function(){var Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),factory=function(BaseNodeComponent,utils,user,decorators,createPoll,$injector){var _dec21,_class14,Assets=(_dec21=decorators.cachable(5),_applyDecoratedDescriptor((_class14=function(){function Assets(){var _this411;return _classCallCheck(this,Assets),_this411=_possibleConstructorReturn(this,_getPrototypeOf(Assets).call(this)),user.loginSignal.on(_this411._handleLogin,_assertThisInitialized(_this411)),_this411}return _inherits(Assets,BaseNodeComponent),_createClass(Assets,[{key:"info",value:function(assetId){return assetId===$injector.get("baseAssetService").WavesAssetId||null===assetId?Promise.all([this.getAsset(assetId),ds.fetch("".concat(this.node,"/blockchain/rewards")).then(function(data){return{quantity:data.totalWavesAmount}}).catch(function(){return null})]).then(function(_ref186){var _ref187=_slicedToArray(_ref186,2),asset=_ref187[0],assetData=_ref187[1];return assetData&&Assets._updateAsset(asset,assetData),asset}):Promise.all([this.getAsset(assetId),ds.fetch("".concat(this.node,"/assets/details/").concat(assetId))]).then(function(_ref188){var _ref189=_slicedToArray(_ref188,2),asset=_ref189[0],assetData=_ref189[1];return Assets._updateAsset(asset,assetData),asset})}},{key:"getNft",value:function(limit){return ds.api.assets.getNftList(user.address,limit)}},{key:"getAsset",value:function(assetId){return ds.api.assets.get(assetId)}},{key:"balance",value:function(assetId){return this.balanceList([assetId]).then(function(_ref190){return _slicedToArray(_ref190,1)[0]})}},{key:"search",value:function(query){return $.get("".concat(ds.config.get("api"),"/assets/search/").concat(encodeURIComponent(query)),function(data){var hash=$injector.get("baseAssetService").getDefaultAssetsHash();return data.map(function(item){return item.name=hash[item.id]&&hash[item.id].name||item.name,item})})}},{key:"getAssetByTicker",value:function(ticker){return ds.fetch("".concat(ds.config.get("api"),"/").concat(ds.config.get("apiVersion"),"/assets?ticker=").concat(ticker)).then(function(data){return data.data[0].data})}},{key:"balanceList",value:function(assetIdList){var _this412=this;return utils.whenAll([this.userBalances(),this._getEmptyBalanceList(assetIdList)]).then(function(_ref192){var _ref193=_slicedToArray(_ref192,2),balanceList=_ref193[0],emptyBalanceList=_ref193[1],balances=utils.toHash(balanceList,"available.asset.id");return Promise.all(emptyBalanceList.map(function(money){return balances[money.asset.id]?Promise.resolve(balances[money.asset.id]):_this412.info(money.asset.id).then(function(){return{asset:money.asset,regular:money,available:money,inOrders:money,leasedOut:money,leasedIn:money}})}))})}},{key:"userBalances",value:function(){var hash=ds.dataManager.matcherService.balanceCache.get(),leaseOutData=ds.dataManager.matcherService.leaseOut;return ds.api.assets.get(Object.keys(hash)).then(function(list){return list.map(function(asset){var inOrders=new Money(BigNumber.toBigNumber(hash[asset.id].reserved).mul(Math.pow(10,asset.precision)),asset),leasedOut=leaseOutData[asset.id]||new Money(0,asset),available=new Money(BigNumber.toBigNumber(hash[asset.id].tradable).mul(Math.pow(10,asset.precision)),asset);return{asset:asset,regular:inOrders.add(available).add(leasedOut),inOrders:inOrders,available:available,leasedOut:leasedOut,leasedIn:new Money(0,asset)}})})}},{key:"giveMyScamBack",value:function(){user.scam=Object.create(null),this._pollScam&&(this._pollScam.destroy(),this._pollScam=null)}},{key:"giveMyTokensNameBack",value:function(){user.tokensName=Object.create(null),this._pollTokensNames&&(this._pollTokensNames.destroy(),this._pollTokensNames=null)}},{key:"stopScam",value:function(){this._pollScam=createPoll(this,this._getScamAssetList,this._setScamAssetList,15e3)}},{key:"tokensNameList",value:function(){this._pollTokensNames=createPoll(this,this._getTokensNameList,function(hash){return user.setTokensNameList(hash)},2e4)}},{key:"_getTokensNameList",value:function(){return ds.fetch("".concat(user.getSetting("tokensNameListUrl"),"?").concat(WavesApp.version,"-").concat(Date.now())).then(function(text){var papa=require("papaparse"),hash=Object.create(null);return papa.parse(text).data.forEach(function(_ref194){var id=_slicedToArray(_ref194,1)[0];id&&(hash[id]=!0)}),hash}).catch(function(){return Object.create(null)})}},{key:"_handleLogin",value:function(){user.getSetting("scamListUrl")?this.stopScam():this.giveMyScamBack(),user.getSetting("tokensNameListUrl")?this.tokensNameList():this.giveMyTokensNameBack()}},{key:"_getScamAssetList",value:function(){return ds.fetch("".concat(user.getSetting("scamListUrl"),"?").concat(WavesApp.version,"-").concat(Date.now())).then(function(text){var papa=require("papaparse"),hash=Object.create(null);return papa.parse(text).data.forEach(function(_ref196){var id=_slicedToArray(_ref196,1)[0];id&&(hash[id]=!0)}),hash}).catch(function(){return Object.create(null)})}},{key:"_setScamAssetList",value:function(hash){user.setScam(hash)}},{key:"_getEmptyBalanceList",value:function(idList){return ds.api.assets.get(idList).then(function(list){return list.map(function(asset){return new Money(0,asset)})})}}],[{key:"_updateAsset",value:function(asset,props){asset.reissuable=props.reissuable,asset.quantity=new BigNumber(props.quantity)}}]),Assets}()).prototype,"info",[_dec21],Object.getOwnPropertyDescriptor(_class14.prototype,"info"),_class14.prototype),_class14);return utils.bind(new Assets)};factory.$inject=["BaseNodeComponent","utils","user","decorators","createPoll","$injector"],angular.module("app").factory("assets",factory)}(),function(){var controller=function(Base,waves,user,utils,createPoll,$scope,$element,dexDataService,ease,$state,modalManager,balanceWatcher,transactions,matcher,baseAssetService,ordersWatcher,configService){var _require83=require("ramda"),prop=_require83.prop,keys=_require83.keys,Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),analytics=require("data-service").analytics,ORDER_TYPES_MAP={limit:"limit",market:"market"},USER_ALLOW_MARKET_ORDER=["seed","privateKey"],emptyOrder=Object.freeze({price:0});return new(function(){function CreateOrder(){var _this413;_classCallCheck(this,CreateOrder),(_this413=_possibleConstructorReturn(this,_getPrototypeOf(CreateOrder).call(this))).maxAmountBalance=null,_this413.canBuyOrder=!0,_this413.amountBalance=null,_this413.priceBalance=null,_this413.type="buy",_this413.maxPriceBalance=null,_this413.total=null,_this413.marketTotal=null,_this413.amount=null,_this413.price=null,_this413.marketPrice=null,_this413.marketAvgPrice=null,_this413.loadingError=!1,_this413.isDemo=!user.address,_this413.ERROR_DISPLAY_INTERVAL=1.5,_this413.ERROR_CLICKABLE_DISPLAY_INTERVAL=2,_this413._assetIdPair=null,_this413.analyticsPair=null,_this413.lastTradePrice=null,_this413._userList=[],_this413.expirationValues=[{name:"5min",value:function(){return utils.moment().add(5,"minutes").valueOf()}},{name:"30min",value:function(){return utils.moment().add(30,"minutes").valueOf()}},{name:"1hour",value:function(){return utils.moment().add(1,"hours").valueOf()}},{name:"1day",value:function(){return utils.moment().add(1,"days").valueOf()}},{name:"1week",value:function(){return utils.moment().add(1,"weeks").valueOf()}},{name:"30day",value:function(){return utils.moment().add(29,"days").valueOf()}}],_this413.maxAmount=null,_this413.feeList=[],_this413.matcherSettings={},_this413.feePoll=null,_this413.minAmountStep=null,_this413.minPriceStep=null,_this413.ignoreFieldsUpdate=!1,_this413.orderType=ORDER_TYPES_MAP.limit,_this413.orderTypes=[ORDER_TYPES_MAP.limit],_this413.orderTemplateUrls={limit:"modules/dex/directives/createOrder/limitOrderForm.html",market:"modules/dex/directives/createOrder/marketOrderForm.html"},_this413._asks=[],_this413._bids=[],_this413.isValidAmountPrecision=!1,_this413.isValidPricePrecision=!1,_this413.pairRestrictions={},_this413.hasFee=!0,_this413.observe(["type","amount","price","amountBalance","fee","pairRestrictions","priceBalance"],_this413._currentMaxAmount),_this413.receive(dexDataService.chooseOrderBook,function(_ref198){var type=_ref198.type,price=_ref198.price,amount=_ref198.amount;_this413.expand(type);var roundedPrice=_this413._getRoundPriceByPrecision(new BigNumber(price)).getTokens().toString(),roundedAmount=_this413._getClosestValidAmount(new BigNumber(amount)).getTokens().toString();switch(type){case"buy":_this413._onClickBuyOrder(roundedPrice,roundedAmount);break;case"sell":_this413._onClickSellOrder(roundedPrice,roundedAmount);break;default:throw new Error("Wrong order type!")}$scope.$digest()}),_this413.syncSettings({_assetIdPair:"dex.assetIdPair",expiration:"dex.createOrder.expirationName"}),_this413.observe("expiration",function(){ds.analytics.dex.changeOrderExpiration(_this413.expiration)}),_this413.analyticsPair="".concat(_this413._assetIdPair.amount," / ").concat(_this413._assetIdPair.price);return _this413.receive(balanceWatcher.change,function(){_this413._updateBalances(),"dynamic"===_this413.matcherSettings.mode&&_this413._updateFeeList()},_assertThisInitialized(_this413)),_this413.orderbookSubscription=ds.dataManager.orderbookSubject.subscribe(function(state){_this413._onChangeOrderbookData(state)}),_this413._updateBalances(),_this413._handleOrderTypes(),ds.api.pairs.get(_this413._assetIdPair.amount,_this413._assetIdPair.price).then(function(pair){_this413.amount=new Money(0,pair.amountAsset),_this413.lastTradePrice&&_this413.lastTradePrice.getTokens().gt(0)?_this413.price=_this413.lastTradePrice:_this413.price=_this413._getCurrentPrice(),_this413._setMinSteps(),_this413.isValidAmountPrecision=_this413._validateAmountPrecision(),_this413.isValidPricePrecision=_this413._validatePricePrecision(),_this413._onChangeMatcherPairRestrictions()}),_this413.observe(["amountBalance","type","fee","priceBalance"],_this413._updateMaxAmountOrPriceBalance),ds.dataManager.assetPairSubject.subscribe(function(pair){if(_this413.amount=null,_this413.price=null,_this413.total=null,_this413.bid=emptyOrder,_this413.ask=emptyOrder,pair){_this413._updateBalances();var form=_this413.order;form&&(form.$setUntouched(),form.$setPristine()),_this413.isLockedPair=utils.isLockedInDex(pair.amountAsset.id,pair.priceAsset.id),_this413.analyticsPair="".concat(pair.amountAsset.id," / ").concat(pair.priceAsset.id),_this413.observeOnce(["bid","ask"],utils.debounce(function(){_this413.type&&(_this413.amount=_this413.amountBalance.cloneWithTokens("0"),_this413.price=_this413._getCurrentPrice(),_this413._setMinSteps(),_this413.total=_this413.priceBalance.cloneWithTokens("0"),form&&(form.$setUntouched(),form.$setPristine()),$scope.$apply())})),_this413._setMatcherSettings(),_this413._handleOrderTypes()}}),_this413.observe(["priceBalance","total","maxPriceBalance"],_this413._setIfCanBuyOrder),_this413.observe("orderType",function(){_this413.amount=_this413.amountBalance.cloneWithTokens("0"),_this413.price=_this413._getCurrentPrice()}),_this413.observe(["_assetIdPair","type","orderType","amount","price"],function(){"market"===_this413.orderType&&_this413.price&&_this413._calculateMarketOrder()}),_this413.observe("amount",function(){_this413.isValidAmountPrecision=_this413._validateAmountPrecision(),_this413.ignoreFieldsUpdate||_this413._updateField({amount:_this413.amount})}),_this413.observe("price",function(){_this413.isValidPricePrecision=_this413._validatePricePrecision(),_this413.ignoreFieldsUpdate||_this413._updateField({price:_this413.price})}),_this413.observe("total",function(){_this413.ignoreFieldsUpdate||_this413._updateField({total:_this413.total})}),$element.on("mousedown touchstart",".body",function(e){e.stopPropagation($scope)}),user.getMultiAccountUsers().then(function(list){_this413._userList=list}),_this413._setMatcherSettings(),_this413.observe("matcherSettings",function(){"dynamic"===_this413.matcherSettings.feeMode?(_this413._updateFeeList(),_this413.feePoll||(_this413.feePoll=createPoll(_assertThisInitialized(_this413),_this413._getFeeRates,_this413._updateFeeList,1e4))):(_this413.fee=_this413.matcherSettings.fee,_this413.feeList=[],_this413.feePoll&&(_this413.feePoll.destroy(),_this413.feePoll=null)),$scope.$apply()}),_this413.receive(utils.observe(matcher,"pairRestrictions"),_this413._onChangeMatcherPairRestrictions,_assertThisInitialized(_this413)),_this413.observe(["maxAmountBalance"],_this413._onChangeMatcherPairRestrictions),_this413._setCreateOrderStatus=utils.debounce(function(status){_this413.processOrder!==status&&(_this413.processOrder=status,utils.safeApply($scope))},500),_this413}return _inherits(CreateOrder,Base),_createClass(CreateOrder,[{key:"priceDisplayName",get:function(){return this.priceBalance&&this.priceBalance.asset.displayName||""}},{key:"amountDisplayName",get:function(){return this.amountBalance&&this.amountBalance.asset.displayName||""}},{key:"loaded",get:function(){return!!(this.amountBalance&&this.priceBalance&&this.fee)}},{key:"loadedPairRestrictions",get:function(){return 0<Object.keys(this.pairRestrictions).length}}]),_createClass(CreateOrder,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(CreateOrder.prototype),"$onDestroy",this).call(this),this.orderbookSubscription.unsubscribe()}},{key:"isActiveBalanceButton",value:function(factor){var amount=this.amount;return!(!amount||amount.getTokens().eq(0))&&this.maxAmount.cloneWithTokens(this._getRoundAmountByPrecision(this.maxAmount.getTokens().mul(factor)).getTokens()).eq(amount)}},{key:"setAmountByBalance",value:function(factor){var amount=this._getClosestValidAmount(this.maxAmount.getTokens().mul(factor));return this._updateField({amount:amount}),Promise.resolve()}},{key:"hasBalance",value:function(){return!this.maxAmount.getTokens().isZero()}},{key:"expand",value:function(type){this.type=type,this.price&&!this.price.getTokens().eq("0")||(this.price=this._getCurrentPrice()),$element.parent().parent().parent().parent().parent().addClass("expanded")}},{key:"closeCreateOrder",value:function(){$element.parent().parent().parent().parent().parent().removeClass("expanded")}},{key:"isAmountInvalid",value:function(){return this.isDirtyAndInvalid(this.order.amount)}},{key:"isPriceInvalid",value:function(){return this.isDirtyAndInvalid(this.order.price)}},{key:"isTotalInvalid",value:function(){return this.isDirtyAndInvalid(this.order.total)}},{key:"isDirtyAndInvalid",value:function(field){return field.$touched&&field.$invalid}},{key:"setMaxAmount",value:function(){var amount=this._getClosestValidAmount(this.maxAmount.getTokens());this._updateField({amount:amount})}},{key:"setMaxPrice",value:function(){var amount=this._getRoundAmountByPrecision(this.maxAmount.getTokens()),price=this._getClosestValidPrice(this.price.getTokens()),total=this.priceBalance.cloneWithTokens(price.getTokens().mul(amount.getTokens()));this._updateField({amount:amount,total:total,price:price})}},{key:"setPrice",value:function(value){var price=this.priceBalance.cloneWithTokens(value);this._updateField({price:price})}},{key:"setAmount",value:function(value){var amount=this.amountBalance.cloneWithTokens(value);this._updateField({amount:amount})}},{key:"setBidPrice",value:function(){var price=this.priceBalance.cloneWithTokens(String(this.bid.price));this._updateField({price:price})}},{key:"setAskPrice",value:function(){var price=this.priceBalance.cloneWithTokens(String(this.ask.price));this._updateField({price:price})}},{key:"setLastPrice",value:function(){var price=this.lastTradePrice;this._updateField({price:price})}},{key:"createOrder",value:function($event){var _this414=this;if(!this.processOrder){if(this.isDemo)return this._showDemoModal();var form=this.order;$event.preventDefault();var notify=$element.find(".js-order-notification");return notify.removeClass("success").removeClass("error"),this.processOrder=!0,Promise.all([ds.fetch(ds.config.get("matcher")),this._getRateToBaseAsset(this.price.asset)]).then(function(_ref199){var _ref200=_slicedToArray(_ref199,2),matcherPublicKey=_ref200[0],rate=_ref200[1];form.$setUntouched(),$scope.$apply();var price="market"===_this414.orderType?_this414._getMarketOrderPrice():_this414.price,pairName="".concat(_this414.amount.asset.ticker||_this414.amount.asset.id," / ").concat(price.asset.ticker||price.asset.id),orderData={orderType:_this414.type,price:price,amount:_this414.amount,matcherFee:_this414.fee,matcherPublicKey:matcherPublicKey,priceInBaseAsset:price.getTokens().mul(rate).roundTo(price.asset.precision).toString(),pairName:pairName};_this414._checkScriptAssets().then(function(){return _this414._checkOrder(orderData)}).then(function(){return _this414._sendOrder(orderData)}).then(function(data){if(!data)return null;notify.addClass("success"),_this414.createOrderFailed=!1,"sell"===_this414.type&&"limit"===_this414.orderType&&analytics.dex.createSellOrderClick(orderData.pairName,orderData.priceInBaseAsset),"sell"===_this414.type&&"market"===_this414.orderType&&analytics.dex.createSellMarketOrderClick(orderData.pairName,orderData.priceInBaseAsset),"buy"===_this414.type&&"limit"===_this414.orderType&&analytics.dex.createBuyOrderClick(orderData.pairName,orderData.priceInBaseAsset),"buy"===_this414.type&&"market"===_this414.orderType&&analytics.dex.createBuyMarketOrderClick(orderData.pairName,orderData.priceInBaseAsset),dexDataService.createOrder.dispatch(),ordersWatcher.restart(),CreateOrder._animateNotification(notify)}).catch(function(){_this414.createOrderFailed=!0,notify.addClass("error"),analytics.send({name:"DEX ".concat(_this414.type," Order Transaction Error"),params:{pair:_this414.analyticsPair}}),$scope.$apply(),CreateOrder._animateNotification(notify)})}).then(function(){return _this414._setCreateOrderStatus(!1)},function(){return _this414._setCreateOrderStatus(!1)})}}},{key:"decreaseField",value:function(field,value){if(!this[field])return null;var newValue=this[field].minus(value);this._changeField(field,newValue)}},{key:"increaseField",value:function(field,value){if(!this[field])return null;var newValue;if(this[field].getTokens().eq(0)&&"amount"===field){var minTotal=this.minPriceStep.getTokens();this.price.getTokens().eq(0)&&(this.price=this.priceBalance.cloneWithTokens(this.pairRestrictions.minPrice)),this.amount=this._getClosestValidAmount(this.amountBalance.cloneWithTokens(minTotal.div(this.price.getTokens())).plus(value).getTokens())}else newValue=this[field].plus(value),this._changeField(field,newValue)}},{key:"_onChangeOrderbookData",value:function(_ref201){var _spread$percent,bids=_ref201.bids,asks=_ref201.asks,loaded=_ref201.loaded,spread=_ref201.spread;if(loaded){var firstBid=_slicedToArray(Array.isArray(bids)?bids:[emptyOrder],1)[0],lastAsk=_slicedToArray(Array.isArray(asks)?asks:[emptyOrder],1)[0];this.bid=firstBid||emptyOrder,this.ask=lastAsk||emptyOrder,this.spreadPercent=(null==spread?void 0:null===(_spread$percent=spread.percent)||void 0===_spread$percent?void 0:_spread$percent.toFixed(2))||"0.00",this._asks=asks,this._bids=bids,"market"===this.orderType&&this._calculateMarketOrder(),utils.safeDigest($scope)}}},{key:"_changeField",value:function(field,newValue){switch(field){case"price":this.price=newValue;break;case"amount":this.amount=newValue}}},{key:"_getRoundPriceByPrecision",value:function(price){if(!this.loadedPairRestrictions)return this.priceBalance.cloneWithTokens(price);var pricePrecision=this.pairRestrictions.pricePrecision,roundedPrice=price.roundTo(pricePrecision);return this.priceBalance.cloneWithTokens(roundedPrice)}},{key:"_getClosestValidPrice",value:function(price){if(!this.loadedPairRestrictions)return this.priceBalance.cloneWithTokens(price);var _this$pairRestriction=this.pairRestrictions,minPrice=_this$pairRestriction.minPrice,maxPrice=_this$pairRestriction.maxPrice,roundedPrice=this._getRoundPriceByPrecision(price).getTokens();return roundedPrice.lt(minPrice)?this.priceBalance.cloneWithTokens(minPrice):roundedPrice.gt(maxPrice)?this.priceBalance.cloneWithTokens(maxPrice):this.priceBalance.cloneWithTokens(roundedPrice)}},{key:"_getRoundAmountByPrecision",value:function(value){if(!this.loadedPairRestrictions)return this.amountBalance.cloneWithTokens(value);var amountPrecision=this.pairRestrictions.amountPrecision,roundedAmount=value.roundTo(amountPrecision,BigNumber.ROUND_CEIL);return this.amountBalance.cloneWithTokens(roundedAmount)}},{key:"_getClosestValidAmount",value:function(amount){if(!this.loadedPairRestrictions)return this.amountBalance.cloneWithTokens(amount);var _this$pairRestriction2=this.pairRestrictions,amountPrecision=_this$pairRestriction2.amountPrecision,minAmount=_this$pairRestriction2.minAmount,maxAmount=_this$pairRestriction2.maxAmount,roundedAmount=this._getRoundAmountByPrecision(amount).getTokens();return roundedAmount.lt(minAmount)?this.amountBalance.cloneWithTokens(minAmount.roundTo(amountPrecision)):roundedAmount.gt(maxAmount)?this.amountBalance.cloneWithTokens(maxAmount.roundTo(amountPrecision)):this.amountBalance.cloneWithTokens(roundedAmount)}},{key:"_sendOrder",value:function(data){var _this415=this,clone=_objectSpread({},data,{expiration:ds.utils.normalizeTime(this.expirationValues.find(function(el){return el.name===_this415.expiration}).value())});return utils.createOrder(clone,this.orderType)}},{key:"_checkScriptAssets",value:function(){if(user.getSetting("tradeWithScriptAssets"))return Promise.resolve();var scriptAssets=[this.amountBalance.asset,this.priceBalance.asset].filter(function(asset){return asset.hasScript});return 0<scriptAssets.length?modalManager.showDexScriptedPair(scriptAssets):Promise.resolve()}},{key:"_checkOrder",value:function(orderData){if("market"===this.orderType)return Promise.resolve();var isBuy="buy"===orderData.orderType,limit=1+(isBuy?1:-1)*(Number(user.getSetting("orderLimit"))||0),price=new BigNumber(isBuy?this.ask.price:this.bid.price).mul(limit),orderPrice=orderData.price.getTokens();return price.isNaN()||price.eq(0)?Promise.resolve():(isBuy?orderPrice.sub(price):price.sub(orderPrice)).isNegative()?Promise.resolve():(ds.analytics.dex.openConfirmOrderModal(orderData.pairName,orderData.priceInBaseAsset),modalManager.showConfirmOrder(_objectSpread({},orderData,{orderLimit:100*Number(user.getSetting("orderLimit"))})).then(function(){ds.analytics.dex.confirmOrderModalOkClick(orderData.pairName,orderData.priceInBaseAsset)}).catch(function(){throw ds.analytics.dex.confirmOrderModalCancelClick(orderData.pairName,orderData.priceInBaseAsset),new Error("You have cancelled the creation of this order")}))}},{key:"_getRateToBaseAsset",value:function(asset){return baseAssetService.getBaseAsset().then(function(baseAsset){return ds.api.rate.getRate(asset,baseAsset)})}},{key:"_showDemoModal",value:function(){var _this416=this;return modalManager.showDialogModal({iconClass:"open-main-dex-account-info",message:{literal:"modal.createOrder.message"},buttons:[{success:!1,classes:"big",text:{literal:"modal.createOrder.cancel"},click:function(){return $state.go("create")}},{success:!0,classes:"big submit",text:{literal:"modal.createOrder.ok"},click:function(){return $state.go(0<_this416._userList.length?"signIn":"signUp")}}]}).catch(function(){return null}).then(function(){var form=_this416.order;_this416.amount=null,form.$setUntouched(),form.$setPristine()})}},{key:"_onClickBuyOrder",value:function(priceStr,amountStr){var price=this.priceBalance.cloneWithTokens(priceStr),maxAmount=this.amountBalance.cloneWithTokens(this.priceBalance.getTokens().div(priceStr)),amount=Money.min(this.amountBalance.cloneWithTokens(amountStr),maxAmount);this._updateField({amount:amount,price:price})}},{key:"_onClickSellOrder",value:function(priceStr,amountStr){var price=this.priceBalance.cloneWithTokens(priceStr),amountMoney=this.amountBalance.cloneWithTokens(amountStr),amount=Money.min(amountMoney,this.maxAmount);this._updateField({amount:amount,price:price})}},{key:"_getMaxAmountForSell",value:function(){var fee=this.fee;return this.amountBalance.safeSub(fee).toNonNegative()}},{key:"_getMaxAmountForBuy",value:function(){var fee=this.fee;return fee&&this.price&&!this.price.getTokens().eq(0)?this.amountBalance.cloneWithTokens(this.priceBalance.safeSub(fee).toNonNegative().getTokens().div(this.price.getTokens()).roundTo(this.amountBalance.asset.precision)):this.amountBalance.cloneWithTokens("0")}},{key:"_currentMaxAmount",value:function(){"buy"===this.type?this.maxAmount=this._getMaxAmountForBuy():this.maxAmount=this._getMaxAmountForSell()}},{key:"_getLastPrice",value:function(){var _this417=this;return transactions.getExchangeTxList({amountAsset:this._assetIdPair.amount,priceAsset:this._assetIdPair.price,limit:1}).then(function(_ref206){var tx=_slicedToArray(_ref206,1)[0];return tx&&tx.price||null}).catch(function(){return _this417.loadingError=!1})}},{key:"_updateMaxAmountOrPriceBalance",value:function(){if(!this.amountBalance||!this.fee||!this.priceBalance)return null;"sell"===this.type?(this.maxAmountBalance=this._getMaxAmountForSell(),this.maxPriceBalance=null):(this.maxAmountBalance=null,this.maxPriceBalance=this.priceBalance.safeSub(this.fee).toNonNegative())}},{key:"_getCurrentPrice",value:function(){switch(this.type){case"sell":return this.priceBalance.cloneWithTokens(String(this.bid.price));case"buy":return this.priceBalance.cloneWithTokens(String(this.ask.price));default:throw new Error("Wrong type")}}},{key:"_getMarketOrderPrice",value:function(){return this.marketPrice.cloneWithTokens(this.marketPrice.getTokens().mul("buy"===this.type?1.1:.9).roundTo(Math.min(this.price.asset.precision,this.pairRestrictions.pricePrecision)))}},{key:"_updateBalances",value:function(){var _this418=this;return this.isDemo?ds.api.pairs.get(this._assetIdPair.amount,this._assetIdPair.price).then(function(pair){_this418.amountBalance=Money.fromTokens(10,pair.amountAsset),_this418.priceBalance=Money.fromTokens(10,pair.priceAsset),utils.safeApply($scope)}):ds.api.pairs.get(this._assetIdPair.amount,this._assetIdPair.price).then(function(pair){_this418.amountBalance=balanceWatcher.getBalanceByAsset(pair.amountAsset),_this418.priceBalance=balanceWatcher.getBalanceByAsset(pair.priceAsset),utils.safeApply($scope)})}},{key:"_updateField",value:function(newState){var changingInputs,matchingTableEntry,calcFieldDependencyTable=[{inputs:["amount","price"],doCalculate:"total"},{inputs:["amount"],doCalculate:"total"},{inputs:["price"],doCalculate:"total"},{inputs:["total"],doCalculate:"amount"},{inputs:["amount","price","total"],doCalculate:void 0}];this.loaded&&(this._applyState(newState),this._calculateField((changingInputs=keys(newState),matchingTableEntry=Object.values(calcFieldDependencyTable).find(function(_ref208){var inputs=_ref208.inputs;return inputs.length===changingInputs.length&&inputs.every(function(input){return-1!==changingInputs.indexOf(input)})}),prop("doCalculate",matchingTableEntry))),this._setIfCanBuyOrder())}},{key:"_applyState",value:function(newState){var _this419=this;keys(newState).forEach(function(key){_this419[key]=newState[key]}),this.order&&this.order.$setDirty()}},{key:"_calculateField",value:function(fieldName){switch(fieldName){case"total":this._calculateTotal();break;case"price":this._calculatePrice();break;case"amount":this._calculateAmount()}}},{key:"_calculateTotal",value:function(){if(!this.price||!this.amount||"limit"!==this.orderType)return null;var price=this._validPrice(),amount=this._validAmount();this._setDirtyField("total",this.priceBalance.cloneWithTokens(price.mul(amount)))}},{key:"_calculatePrice",value:function(){if(!this.total||!this.amount||"limit"!==this.orderType)return null;var total=this._validTotal(),amount=this._validAmount();this._setDirtyField("price",this._getClosestValidPrice(total.div(amount)))}},{key:"_calculateAmount",value:function(){if(!this.total||!this.price)return null;var total=this._validTotal(),price=this._validPrice();"buy"===this.type?this._setDirtyField("amount",this._getClosestValidAmount(total.div(price))):"sell"===this.type&&this._setDirtyField("amount",this._getRoundAmountByPrecision(total.div(price)))}},{key:"_calculateMarketOrder",value:function(){if(this.amount){var asksOrBids="buy"===this.type?this._asks:this._bids,filledAmount=this.amount.cloneWithTokens(0),computedTotal=new Money(0,this.price.asset),askOrBidPrice=new Money(0,this.price.asset),_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step4,_iterator3=(asksOrBids||[])[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step4=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var askOrBid=_step4.value;if(filledAmount.gte(this.amount))break;askOrBidPrice=computedTotal.cloneWithTokens(askOrBid.price);var askOrBidAmount=filledAmount.cloneWithTokens(askOrBid.amount),unfilledAmount=this.amount.minus(filledAmount),amount=unfilledAmount.lte(askOrBidAmount)?unfilledAmount:askOrBidAmount,total=askOrBidPrice.getTokens().mul(amount.getTokens());computedTotal=computedTotal.add(computedTotal.cloneWithTokens(total)),filledAmount=filledAmount.add(amount)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}this.marketTotal=computedTotal,this.marketPrice=askOrBidPrice,this.marketAvgPrice=computedTotal.getTokens().eq(0)?new Money(0,this.price.asset):computedTotal.cloneWithTokens(computedTotal.getTokens().div(filledAmount.getTokens()).roundTo(Math.min(this.price.asset.precision,this.pairRestrictions.pricePrecision)))}else this.price&&(this.marketTotal=new Money(0,this.price.asset),this.marketAvgPrice=new Money(0,this.price.asset))}},{key:"_validTotal",value:function(){return this.order&&this.order.total&&""!==this.order.total.$viewValue?this.total.getTokens():this.priceBalance.cloneWithTokens("0").getTokens()}},{key:"_validPrice",value:function(){return this.order&&this.order.price&&""!==this.order.price.$viewValue?this.price.getTokens():this.amountBalance.cloneWithTokens("0").getTokens()}},{key:"_validAmount",value:function(){return this.order&&this.order.amount&&""!==this.order.amount.$viewValue?this.amount.getTokens():this.amountBalance.cloneWithTokens("0").getTokens()}},{key:"_setIfCanBuyOrder",value:function(){"buy"===this.type&&this.total&&this.priceBalance&&this.total.asset.id===this.priceBalance.asset.id?this.maxPriceBalance&&(this.canBuyOrder=this.total.lte(this.maxPriceBalance)&&this.maxPriceBalance.getTokens().gt(0)):this.canBuyOrder=!0}},{key:"_setDirtyField",value:function(field,value){if(this.ignoreFieldsUpdate=!0,value.getTokens().isNaN()||!value.getTokens().isFinite())return this.ignoreFieldsUpdate=!1,null;this[field]=value,this.order&&(this.order.$setDirty(),this.order[field]&&this.order[field].$setTouched()),this.ignoreFieldsUpdate=!1}},{key:"_updateFeeList",value:function(){var _this420=this;return this._getFeeRates().then(function(list){var assetsId=_this420._getOrderedCustomFeeAssetsList(list);Promise.all(assetsId.map(function(id){return balanceWatcher.getBalanceByAssetId(id)})).then(function(balances){var basedCustomFee=_this420.matcherSettings.basedCustomFee,feeList=balances.map(function(balance){var id=balance.asset.id,rate=new BigNumber(list[id]);return balance.cloneWithCoins(rate.mul(basedCustomFee[id]).roundTo(0,BigNumber.ROUND_MODE.ROUND_CEIL))}),filteredFeeList=feeList.filter(function(fee,i){return fee.lte(balances[i])});_this420.hasFee=!!filteredFeeList.length||_this420.isDemo,filteredFeeList.length?1===filteredFeeList.length?(_this420.fee=filteredFeeList[0],_this420.feeList=[]):(_this420.fee=filteredFeeList[0],_this420.feeList=filteredFeeList):(_this420.fee=feeList[0],_this420.feeList=[])})}).catch(function(){_this420.feeList=[]})}},{key:"_getFeeRates",value:function(){return waves.matcher.getFeeRates()}},{key:"_setMatcherSettings",value:function(){var _this421=this;return Promise.all([ds.api.pairs.get(this._assetIdPair.amount,this._assetIdPair.price),Promise.resolve(matcher.currentMatcherPublicKey)]).then(function(_ref209){var _ref210=_slicedToArray(_ref209,2),pair=_ref210[0],matcherPublicKey=_ref210[1];waves.matcher.getCreateOrderSettings(pair,matcherPublicKey).then(function(data){_this421.matcherSettings=data}).catch(function(){return null})})}},{key:"_getOrderedCustomFeeAssetsList",value:function(list){var currentFeeAsset=this.fee&&this.fee.asset.id||baseAssetService.WavesAssetId,_Object$keys$reduce=Object.keys(list).reduce(function(acc,id){return id===currentFeeAsset?acc.currentFee.push(id):acc.otherFee.push(id),acc},{currentFee:[],otherFee:[]}),currentFee=_Object$keys$reduce.currentFee,otherFee=_Object$keys$reduce.otherFee;return[].concat(_toConsumableArray(currentFee),_toConsumableArray(otherFee))}},{key:"_onChangeMatcherPairRestrictions",value:function(){this.pairRestrictions={};var defaultPairRestriction=this._getDefaultPairRestriction(),matcherSettings=matcher.pairRestrictions;if(!matcherSettings)return this.pairRestrictions=defaultPairRestriction,void this._setMinStepsByRestrictions();var restrictions=matcherSettings.restrictions,matchingRules=matcherSettings.matchingRules;if(!restrictions&&!matchingRules)return this.pairRestrictions=defaultPairRestriction,void this._setMinStepsByRestrictions();if(!restrictions&&matchingRules&&matchingRules.tickSize)return this.pairRestrictions=_objectSpread({},defaultPairRestriction,{pricePrecision:CreateOrder._isValidMatcherRulesStep(matchingRules.tickSize)?new BigNumber(matchingRules.tickSize).getDecimalsCount():defaultPairRestriction.pricePrecision}),void this._setMinStepsByRestrictions();var maxAmount=restrictions.maxAmount,maxPrice=restrictions.maxPrice,stepPrice=restrictions.stepPrice,stepAmount=restrictions.stepAmount,minPrice=restrictions.minPrice,minAmount=restrictions.minAmount,restMaxAmount=maxAmount?new BigNumber(maxAmount):defaultPairRestriction.maxAmount,priceSizes=[defaultPairRestriction.pricePrecision];stepPrice&&CreateOrder._isValidMatcherRulesStep(stepPrice)&&priceSizes.push(new BigNumber(stepPrice).getDecimalsCount()),matchingRules&&matchingRules.tickSize&&CreateOrder._isValidMatcherRulesStep(matchingRules.tickSize)&&priceSizes.push(new BigNumber(matchingRules.tickSize).getDecimalsCount());var pricePrecision=Math.min.apply(Math,priceSizes),amountPrecision=stepAmount?Math.min(new BigNumber(stepAmount).getDecimalsCount(),defaultPairRestriction.amountPrecision):defaultPairRestriction.amountPrecision;this.pairRestrictions={maxPrice:maxPrice?new BigNumber(maxPrice):defaultPairRestriction.maxPrice,maxAmount:this.maxAmountBalance?BigNumber.min(this.maxAmountBalance.getTokens(),restMaxAmount):restMaxAmount,minPrice:minPrice?BigNumber.max(new BigNumber(minPrice),defaultPairRestriction.minPrice):defaultPairRestriction.minPrice,minAmount:minAmount?BigNumber.max(new BigNumber(minAmount),defaultPairRestriction.minAmount):defaultPairRestriction.minAmount,pricePrecision:pricePrecision,amountPrecision:amountPrecision},this._setMinStepsByRestrictions()}},{key:"_getDefaultPairRestriction",value:function(){var pricePrecision=this.priceBalance.asset.precision,amountPrecision=this.amountBalance.asset.precision;return{maxPrice:new BigNumber(1/0),maxAmount:this.maxAmountBalance?this.maxAmountBalance.getTokens():new BigNumber(1/0),pricePrecision:pricePrecision,amountPrecision:amountPrecision,minPrice:new BigNumber(10).pow(-pricePrecision),minAmount:new BigNumber(10).pow(-amountPrecision)}}},{key:"_validateAmountPrecision",value:function(){if(!this.loadedPairRestrictions||!this.amount)return!0;var amountPrecision=this.pairRestrictions.amountPrecision;return this.amount.getTokens().getDecimalsCount()<=amountPrecision}},{key:"_validatePricePrecision",value:function(){if(!this.loadedPairRestrictions||!this.price)return!0;var pricePrecision=this.pairRestrictions.pricePrecision;return this.price.getTokens().getDecimalsCount()<=pricePrecision}},{key:"_isBestBid",value:function(){if(!this.price||!this.bid)return!1;var bestBidPrice=this.priceBalance.cloneWithTokens(String(this.bid.price));return this.price.eq(bestBidPrice)}},{key:"_isBestAsk",value:function(){if(!this.price||!this.ask)return!1;var bestAskPrice=this.priceBalance.cloneWithTokens(String(this.ask.price));return this.price.eq(bestAskPrice)}},{key:"_setMinSteps",value:function(){this.loadedPairRestrictions?this._setMinStepsByRestrictions():(this.minAmountStep=new Money(1,this.amount.asset),this.minPriceStep=new Money(1,this.price.asset))}},{key:"_setMinStepsByRestrictions",value:function(){this.minAmountStep=this.amountBalance.cloneWithTokens(new BigNumber(10).pow(-this.pairRestrictions.amountPrecision)),this.minPriceStep=this.priceBalance.cloneWithTokens(new BigNumber(10).pow(-this.pairRestrictions.pricePrecision))}},{key:"_handleOrderTypes",value:function(){var _this422=this,isPairAvailable=(configService.get("SETTINGS.DEX.MARKET_PAIRS")||[]).map(function(pairStr){return pairStr.split("/")}).map(function(pair){return baseAssetService.getIdByTicker(pair)}).some(function(pair){return pair.includes(_this422._assetIdPair.amount)&&pair.includes(_this422._assetIdPair.price)});(!user.currentUser||user.currentUser&&USER_ALLOW_MARKET_ORDER.includes(user.userType))&&isPairAvailable?this.orderTypes=Object.values(ORDER_TYPES_MAP):(this.orderTypes=this.orderTypes.filter(function(type){return type!==ORDER_TYPES_MAP.market}),this.orderType===ORDER_TYPES_MAP.market&&(this.orderType=this.orderTypes[0]))}}],[{key:"_animateNotification",value:function($element){return utils.animate($element,{t:100},{duration:1200,step:function(tween){var progress=ease.bounceOut(tween/100);$element.css("transform","translate(0, ".concat(100*progress-100,"%)"))}}).then(function(){return utils.wait(700)}).then(function(){return utils.animate($element,{t:0},{duration:500,step:function(tween){var progress=ease.linear(tween/100);$element.css("transform","translate(0, ".concat(-100*(1-progress),"%)"))}})})}},{key:"_isValidMatcherRulesStep",value:function(step){return!new BigNumber(step).isZero()}}]),CreateOrder}())};controller.$inject=["Base","waves","user","utils","createPoll","$scope","$element","dexDataService","ease","$state","modalManager","balanceWatcher","transactions","matcher","baseAssetService","ordersWatcher","configService"],angular.module("app.dex").component("wCreateOrder",{bindings:{},templateUrl:"modules/dex/directives/createOrder/createOrder.html",transclude:!1,controller:controller})}(),function(){var whereEq=require("ramda").whereEq,ds=require("data-service"),analytics=ds.analytics,BigNumber=require("@waves/bignumber").BigNumber,OrderPrice=require("@waves/data-entities").OrderPrice,controller=function(Base,user,notification,utils,$scope,permissionManager,ease,$element,ordersWatcher,modalManager){return new(function(){function DexMyOrders(){var _this423;return _classCallCheck(this,DexMyOrders),(_this423=_possibleConstructorReturn(this,_getPrototypeOf(DexMyOrders).call(this)))._orderForDrop={},_this423._assetIdPair=void 0,_this423.orders=[],_this423.isDemo=!user.address,_this423.pending=!!user.address,_this423.loadingError=!1,_this423.showAnimations=!1,_this423.isActiveOrders=!1,_this423.userList=[],_this423.syncSettings({_assetIdPair:"dex.assetIdPair",_matcherUrl:"network.matcher"}),user.getMultiAccountUsers().then(function(list){_this423.userList=list}),_this423}return _inherits(DexMyOrders,Base),_createClass(DexMyOrders,[{key:"$postLink",value:function(){var _this424=this;this.headers=[{id:"pair",valuePath:"item.pair",search:!0,placeholder:"directives.filter"},{id:"type",title:{literal:"directives.myOrders.type"},valuePath:"item.type",sort:!0},{id:"time",title:{literal:"directives.myOrders.time"},valuePath:"item.timestamp",sort:!0,sortActive:!0,isAsc:!1},{id:"amount",title:{literal:"directives.myOrders.amount"},valuePath:"item.amount",sort:!0},{id:"price",title:{literal:"directives.myOrders.price"},valuePath:"item.price",sort:!0},{id:"total",title:{literal:"directives.myOrders.total"},valuePath:"item.total",sort:!0},{id:"status",title:{literal:"directives.myOrders.status"},valuePath:"item.progress",sort:!0},this.isActiveOrders&&{id:"controls",templatePath:"modules/dex/directives/dexMyOrders/header-control-cell.html",scopeData:{cancelAllOrdersClick:function(){_this424.cancelAllOrders()},$ctrl:this}}||null].filter(Boolean),this.isDemo||(this._handleOrdersChange(),ordersWatcher.subscribe(this._handleOrdersChange,this))}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(DexMyOrders.prototype),"$onDestroy",this).call(this),this.isDemo||ordersWatcher.unsubscribe(this._handleOrdersChange)}},{key:"setPair",value:function(order){if(this.isLockedPair(order.assetPair.amountAsset.id,order.assetPair.priceAsset.id))return null;var _order$assetPair=order.assetPair,amountAsset=_order$assetPair.amountAsset,priceAsset=_order$assetPair.priceAsset;if(this.isLockedInDexSmartAssets(amountAsset,priceAsset))modalManager.showSmartPairModal(amountAsset.ticker||amountAsset.displayName,priceAsset.ticker||priceAsset.displayName);else{var pairName="".concat(amountAsset.ticker||amountAsset.id," / ").concat(priceAsset.ticker||priceAsset.id);this.isActiveOrders?ds.analytics.dex.changePairFromOpenOrders(pairName):ds.analytics.dex.changePairFromOrderHistory(pairName),user.setSetting("dex.assetIdPair",{amount:order.assetPair.amountAsset.id,price:order.assetPair.priceAsset.id})}}},{key:"cancelAllOrders",value:function(){var _this425=this;if(!permissionManager.isPermitted("CAN_CANCEL_ORDER")){var $notify=$element.find(".js-order-notification");return DexMyOrders._animateNotification($notify),null}var ordersList=this.orders.map(function(_ref211){var id=_ref211.id;return _this425._orderForDrop[id]=!0,id});ds.cancelOrders(ordersList).then(function(response){analytics.send({name:"Cancel All Orders",target:"all"}),notification.info({ns:"app.dex",title:{literal:"directives.myOrders.notifications.canceledAll"}}),_this425.orders.forEach(function(order){response.includes(order.id)&&(order.state="Canceled"),delete _this425._orderForDrop[order.id]}),ordersWatcher.restart()}).catch(function(e){var error=utils.parseError(e);notification.error({ns:"app.dex",title:{literal:"directives.myOrders.notifications.somethingWentWrong"},body:{literal:error&&error.message||error}})})}},{key:"round",value:function(data){return Math.round(Number(data))}},{key:"isSelected",value:function(order){return this._assetIdPair.amount===order.amount.asset.id&&this._assetIdPair.price===order.price.asset.id}},{key:"isLockedPair",value:function(amountAssetId,priceAssetId){return utils.isLockedInDex(amountAssetId,priceAssetId)}},{key:"isLockedInDexSmartAssets",value:function(assetA,assetB){return utils.isLockedInDexSmartAssets(assetA,assetB)}},{key:"dropOrder",value:function(order){var _this426=this;if(!this._orderForDrop[order.id]){if(!permissionManager.isPermitted("CAN_CANCEL_ORDER")){var $notify=$element.find(".js-order-notification");return DexMyOrders._animateNotification($notify),null}this._orderForDrop[order.id]=!0;var classNameToOrder=function(className,argument_1){var isRemove=1<arguments.length&&void 0!==argument_1&&argument_1,$row=$element.find(".order_".concat(order.id)).closest(".order-row");isRemove?$row.removeClass(className):$row.addClass(className)};classNameToOrder("pre-leave"),ds.cancelOrders([order.id]).then(function(result){if(result[0]!==order.id)throw new Error("Can't drop order ".concat(order.id))}).then(function(){analytics.dex.cancelOrderClick(),classNameToOrder("force-leave");var canceledOrder=_this426.orders.find(whereEq({id:order.id}));canceledOrder&&(canceledOrder.state="Canceled"),notification.info({ns:"app.dex",title:{literal:"directives.myOrders.notifications.isCanceled"}}),delete _this426._orderForDrop[order.id],ordersWatcher.restart()}).catch(function(e){delete _this426._orderForDrop[order.id],classNameToOrder("pre-leave",!0);var error=utils.parseError(e);notification.error({ns:"app.dex",title:{literal:"directives.myOrders.notifications.somethingWentWrong"},body:{literal:error&&error.message||error}})})}}},{key:"_handleOrdersChange",value:function(){var _ordersWatcher$getSta=ordersWatcher.getState(),orders=_ordersWatcher$getSta.orders,ready=_ordersWatcher$getSta.ready,error=_ordersWatcher$getSta.error;ready&&(this.orders=orders.filter(whereEq({isActive:this.isActiveOrders})).map(function(order){return _objectSpread({},order,{isCancelled:"CANCELLED"===order.status.toUpperCase()})}).map(DexMyOrders._remapOrders()),this.showAnimations=!0,this.pending=!1,this.loadingError=error,$scope.$applyAsync())}}],[{key:"_animateNotification",value:function($element){return utils.animate($element,{t:100},{duration:1200,step:function(tween){var progress=ease.bounceOut(tween/100);$element.css("transform","translate(0, ".concat(100*progress-100,"%)"))}}).then(function(){return utils.wait(700)}).then(function(){return utils.animate($element,{t:0},{duration:500,step:function(tween){var progress=ease.linear(tween/100);$element.css("transform","translate(0, ".concat(-100*(1-progress),"%)"))}})})}},{key:"_remapOrders",value:function(){return function(order){var assetPair=order.assetPair,pair="".concat(assetPair.amountAsset.displayName," / ").concat(assetPair.priceAsset.displayName),isNew=DexMyOrders._isNewOrder(order.timestamp.getTime()),percent=new BigNumber(100*order.progress).toFixed(2),average=order.price.cloneWithTokens(OrderPrice.fromMatcherCoins(order.avgWeighedPrice,assetPair).getTokens());return _objectSpread({},order,{isNew:isNew,percent:percent,pair:pair,average:average})}}},{key:"_isNewOrder",value:function(timestamp){return ds.utils.normalizeTime(Date.now())<timestamp+8e3}}]),DexMyOrders}())};controller.$inject=["Base","user","notification","utils","$scope","permissionManager","ease","$element","ordersWatcher","modalManager"],angular.module("app.dex").component("wDexMyOrders",{bindings:{isActiveOrders:"<"},templateUrl:"modules/dex/directives/dexMyOrders/myOrders.html",controller:controller})}(),function(){var rc=require("react-components"),wSwapWavesUsdn=function(reactDirective,$state,user,balanceWatcher,modalManager,storage){return reactDirective(rc.SwapWavesUsdn,void 0,void 0,{$state:$state,user:user,balanceWatcher:balanceWatcher,modalManager:modalManager,storage:storage})};wSwapWavesUsdn.$inject=["reactDirective","$state","user","balanceWatcher","modalManager","storage"],angular.module("app.swapWavesUsdn").directive("wSwapWavesUsdn",wSwapWavesUsdn)}(),function(){var controller=function(Base,user){return new(function(){function Password(){var _getPrototypeOf11,_this427;_classCallCheck(this,Password);for(var _len24=arguments.length,args=new Array(_len24),_key24=0;_key24<_len24;_key24++)args[_key24]=arguments[_key24];return(_this427=_possibleConstructorReturn(this,(_getPrototypeOf11=_getPrototypeOf(Password)).call.apply(_getPrototypeOf11,[this].concat(args)))).form=null,_this427.accountName="",_this427.accountAddress="",_this427}return _inherits(Password,Base),_createClass(Password,[{key:"$postLink",value:function(){this.observe("accountName",this._onChangeName)}},{key:"_onChangeName",value:function(){var _this428=this;Promise.all([user.getFilteredUserList(),user.getMultiAccountUsers()]).then(function(_ref212){var _ref213=_slicedToArray(_ref212,2),_ref213$=_ref213[0],legacyUsers=void 0===_ref213$?[]:_ref213$,_ref213$2=_ref213[1],users=void 0===_ref213$2?[]:_ref213$2;return[].concat(_toConsumableArray(legacyUsers),_toConsumableArray(users))}).then(function(users){return users.some(function(userToCheck){return userToCheck.name===_this428.accountName&&userToCheck.address!==_this428.accountAddress})}).then(function(isUnique){_this428.form.accountName.$setValidity("isUnique",!isUnique)})}}]),Password}())};controller.$inject=["Base","user"],angular.module("app.ui").component("wAccountName",{bindings:{onSubmit:"&",accountName:"=",accountAddress:"<"},templateUrl:"modules/ui/directives/account-name/account-name.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base){return new(function(){function UnavailableCtrl(){return _classCallCheck(this,UnavailableCtrl),_possibleConstructorReturn(this,_getPrototypeOf(UnavailableCtrl).apply(this,arguments))}return _inherits(UnavailableCtrl,Base),UnavailableCtrl}())};controller.$inject=["Base"],angular.module("app.unavailable").controller("UnavailableCtrl",controller)}(),function(){var controller=function(Base,$scope){var analytics=require("data-service").analytics;return new(function(){function AnyTxModalCtrl(_ref214){var _this429,tx=_ref214.tx,analyticsText=_ref214.analyticsText;return _classCallCheck(this,AnyTxModalCtrl),(_this429=_possibleConstructorReturn(this,_getPrototypeOf(AnyTxModalCtrl).call(this,$scope))).state=null,_this429.signable=null,_this429.step=0,_this429.analyticsText=analyticsText,_this429.state={tx:tx},_this429}return _inherits(AnyTxModalCtrl,Base),_createClass(AnyTxModalCtrl,[{key:"onFillTxForm",value:function(signable){this.analyticsText&&analytics.send({name:this.analyticsText,target:"ui"}),this.signable=signable,this.step++}},{key:"onConfirmBack",value:function(){this.step--}}]),AnyTxModalCtrl}())(this.locals)};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("AnyTxModalCtrl",controller)}(),function(){var controller=function(Base,$scope,userNameService,user,notification,$mdDialog){return new(function(){function ChangeNameCtrl(){var _this430;return _classCallCheck(this,ChangeNameCtrl),(_this430=_possibleConstructorReturn(this,_getPrototypeOf(ChangeNameCtrl).call(this,$scope))).userName=void 0,_this430.isUniqueUserName=!0,$scope.user=user,$scope.MAX_USER_NAME_LENGTH=userNameService.MAX_USER_NAME_LENGTH,_this430.userName=userNameService.name,_this430.observe("userName",function(){userNameService.setName(_this430.userName),userNameService.isUniqueName().then(function(data){_this430.isUniqueUserName=data})}),_this430.observe("isUniqueUserName",function(){_this430.setUserName&&_this430.setUserName.userName.$setValidity("user-name-unique",_this430.isUniqueUserName)}),_this430}return _inherits(ChangeNameCtrl,Base),_createClass(ChangeNameCtrl,[{key:"saveUserName",value:function(){this.userName&&this.isUniqueUserName&&(userNameService.save(),notification.info({ns:"app.welcome",title:{literal:"welcome.nameSaved"}}),$mdDialog.cancel())}}]),ChangeNameCtrl}())};controller.$inject=["Base","$scope","userNameService","user","notification","$mdDialog"],angular.module("app.utils").controller("ChangeNameCtrl",controller)}(),function(){var ds=require("data-service"),_require89=require("@waves/waves-transactions"),libs=_require89.libs,seedUtils=_require89.seedUtils,keyPair=libs.crypto.keyPair,controller=function(Base,$log,$mdDialog,storageImporter){return new(function(){function MigrateModalCtrl(){var _this431;return _classCallCheck(this,MigrateModalCtrl),(_this431=_possibleConstructorReturn(this,_getPrototypeOf(MigrateModalCtrl).call(this))).mode=window.opener?"import":"export",WavesApp.isDesktop()?_this431.connectProvider=new ds.connect.HttpConnectProvider({port:8888,url:"http://localhost:8888/connect"}):_this431.connectProvider=new ds.connect.PostMessageConnectProvider({mode:_this431.mode}),_this431}return _inherits(MigrateModalCtrl,Base),_createClass(MigrateModalCtrl,[{key:"export",value:function(){var _this432=this,message=JSON.stringify({event:"connect"});this.connectProvider.send(message,{event:"data",attempts:3}).then(function(result){if(!result||"connect"!==result.event)throw new Error("Message event is not valid: ".concat(result.event));var publicKeyTo=result.payload,_keyPair2=keyPair(seedUtils.generateNewSeed(20)),publicKey=_keyPair2.publicKey,privateKey=_keyPair2.privateKey;return storageImporter.export(privateKey,publicKeyTo).then(function(data){return _this432.connectProvider.send(JSON.stringify({event:"data",payload:{publicKey:publicKey,data:data}}),{event:"data"})})}).then(function(result){"ok"===result.payload?($log.log("done"),_this432.connectProvider.destroy()):$log.log("fail",result)}).catch(function(e){$log.error(e)})}}]),MigrateModalCtrl}())};controller.$inject=["Base","$log","$mdDialog","storageImporter"],angular.module("app.utils").controller("MigrateModalCtrl",controller)}(),function(){var controller=function($element,$mdDialog){var modalCtrl=new(function(){function ReactModalCtrl(){_classCallCheck(this,ReactModalCtrl)}return _createClass(ReactModalCtrl,[{key:"done",value:function(){$mdDialog.cancel()}},{key:"close",value:function(){document.contains($element.get(0))&&$mdDialog.hide()}}]),ReactModalCtrl}());this.locals.onInit($element.get(0).querySelector("md-dialog"),modalCtrl)};controller.$inject=["$element","$mdDialog","$scope"],angular.module("app.utils").controller("ReactModalCtrl",controller)}(),function(){var locationHref=location.href,analytics=require("data-service").analytics,controller=function(Base,$scope,storage,$element){return new(function(){function TryDesktopCtrl(){var _this433;_classCallCheck(this,TryDesktopCtrl),(_this433=_possibleConstructorReturn(this,_getPrototypeOf(TryDesktopCtrl).call(this,$scope))).save=!1;var url=new URL(locationHref),href="waves-exchange://".concat(url.pathname).concat(url.search).concat(url.hash).replace("///","//");return $element.find("a").attr("href",href),_this433}return _inherits(TryDesktopCtrl,Base),_createClass(TryDesktopCtrl,[{key:"onOpenLink",value:function(){analytics.send({name:"Onboarding Popup Official Site Click",target:"ui"})}},{key:"tryWeb",value:function(){this._saveChoice("web")}},{key:"tryDesktop",value:function(){this._saveChoice("desktop")}},{key:"_saveChoice",value:function(mode){this.save&&storage.save("openClientMode",mode)}}]),TryDesktopCtrl}())};controller.$inject=["Base","$scope","storage","$element"],angular.module("app.utils").controller("TryDesktopCtrl",controller)}(),function(){var factory=function(Base){var BaseClassComponent=function(){function BaseClassComponent(parent){if(_classCallCheck(this,BaseClassComponent),!(parent instanceof Base))throw new Error("Can't add component to controller, controller not instanceof Base!");this.parent=parent,this.receiveOnce(parent.signals.destroy,this.remove,this)}return _createClass(BaseClassComponent,[{key:"remove",value:function(){}}]),BaseClassComponent}();return BaseClassComponent.prototype.receive=tsUtils.Receiver.prototype.receive,BaseClassComponent.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,BaseClassComponent.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,BaseClassComponent};factory.$inject=["Base"],angular.module("app.utils").factory("BaseClassComponent",factory)}(),function(){var factory=function(coinomatService,coinomatCardService,coinomatSepaService,wavesExchangeGatewayService,configService,baseAssetService){return new(function(){function GatewayService(){_classCallCheck(this,GatewayService),this.gateways=[coinomatService,coinomatCardService,coinomatSepaService,wavesExchangeGatewayService]}return _createClass(GatewayService,[{key:"getCryptocurrencies",value:function(){return _objectSpread({},coinomatService.getAll(),{},wavesExchangeGatewayService.getAll())}},{key:"getPurchasableWithCards",value:function(){return coinomatCardService.getAll()}},{key:"getFiats",value:function(){return coinomatSepaService.getAll()}},{key:"getDepositDetails",value:function(asset,wavesAddress){var gateway=this._findGatewayFor(asset,"deposit");return gateway?gateway.getDepositDetails(asset,wavesAddress):null}},{key:"getWithdrawDetails",value:function(asset,targetAddress,paymentId){var gateway=this._findGatewayFor(asset,"withdraw");return this.canUseGateway(asset)?gateway.getWithdrawDetails(asset,targetAddress,paymentId):Promise.reject({code:1001,message:"Gateway is blocked"})}},{key:"canUseGateway",value:function(asset){var permissions=configService.get("PERMISSIONS.CANT_TRANSFER_GATEWAY");return!permissions||!permissions.includes(asset.id)}},{key:"getCardFiatWithLimits",value:function(crypto,wavesAddress,fiatList){return this._findGatewayFor(crypto,"card").getFiatWithLimits(crypto,wavesAddress,fiatList)}},{key:"getCardApproximateCryptoAmount",value:function(crypto,fiat,recipientAddress,fiatAmount){var gateway=this._findGatewayFor(crypto,"card");return gateway?gateway.getApproximateCryptoAmount(crypto,fiat,recipientAddress,fiatAmount):Promise.resolve(0)}},{key:"getCardBuyLink",value:function(crypto,fiat,recipientAddress,fiatAmount){var gateway=this._findGatewayFor(crypto,"card");return gateway?gateway.getCardBuyLink(crypto,fiat,recipientAddress,fiatAmount):""}},{key:"getSepaDetails",value:function(asset,wavesAddress){var gateway=this._findGatewayFor(asset,"sepa");return gateway?gateway.getSepaDetails(asset,wavesAddress):null}},{key:"hasSupportOf",value:function(asset,type){return!!this._findGatewayFor(asset,type)}},{key:"getAssetKeyName",value:function(asset,type){return this._findGatewayFor(asset,type).getAssetKeyName(asset)}},{key:"isInvalidAddressError",value:function(error,asset,type){var gateway=this._findGatewayFor(asset,type);return!(!gateway||"function"!=typeof gateway.isInvalidAddressError)&&gateway.isInvalidAddressError(error)}},{key:"isAddressInUseError",value:function(error,asset,type){var gateway=this._findGatewayFor(asset,type);return!(!gateway||"function"!=typeof gateway.isAddressInUseError)&&gateway.isAddressInUseError(error.errors)}},{key:"isAddressNotExistError",value:function(error,asset,type){var gateway=this._findGatewayFor(asset,type);return!(!gateway||"function"!=typeof gateway.isAddressNotExistError)&&gateway.isAddressNotExistError(error.errors)}},{key:"isSmartAddressError",value:function(error,asset,type){var gateway=this._findGatewayFor(asset,type);return!(!gateway||"function"!=typeof gateway.isSmartAddressError)&&gateway.isSmartAddressError(error.errors)}},{key:"hasConfirmation",value:function(address){return coinomatService.hasConfirmation(address)}},{key:"getDefaultCardFiatList",value:function(){var defaultAssets=baseAssetService.getDefaultAssetsHashId();return(configService.get("gateways.coinomat.fiat")||[]).map(function(item){return _objectSpread({},item,{assetId:defaultAssets[item.name]})})}},{key:"checkIsIgnoredWithdrawMax",value:function(asset){var gateway=this._findGatewayFor(asset,"withdraw");return!(!gateway||"function"!=typeof gateway.checkIsIgnoredWithdrawMax)&&gateway.checkIsIgnoredWithdrawMax(asset)}},{key:"getBlockChainName",value:function(asset){switch(asset.ticker){case"BTC":return"Bitcoin";case"BCH":return"Bitcoin Cash";case"BSV":return"Bitcoin SV";case"DASH":return"Dash";case"ERG":return"Ergo";case"LTC":return"Litecoin";case"XMR":return"Monero";case"WEST":return"WEST";case"ZEC":return"Zcash";case"ETH":case"USDT":case"USDN":case"NSBT":case"BNT":case"WAVES":return"Ethereum";default:return""}}},{key:"_findGatewayFor",value:function(asset,type){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step5,_iterator4=this.gateways[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step5=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var gateway=_step5.value,supportMap=gateway.getSupportMap(asset);if(supportMap&&supportMap[type])return gateway}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}}]),GatewayService}())};factory.$inject=["coinomatService","coinomatCardService","coinomatSepaService","wavesExchangeGatewayService","configService","baseAssetService"],angular.module("app.utils").factory("gatewayService",factory)}(),function(){var factory=function(BaseNodeComponent){var ds=require("data-service");return new(function(){function Aliases(){return _classCallCheck(this,Aliases),_possibleConstructorReturn(this,_getPrototypeOf(Aliases).apply(this,arguments))}return _inherits(Aliases,BaseNodeComponent),_createClass(Aliases,[{key:"getAddress",value:function(alias){return ds.api.aliases.getAddressByAlias(alias).then(function(_ref215){return _ref215.address})}},{key:"getAliasList",value:function(){return ds.dataManager.getLastAliases()}},{key:"getByIdList",value:function(list){return ds.api.aliases.getAliasesByIdList(list)}},{key:"validate",value:function(alias){return 4<=alias.length&&alias.length<=WavesApp.maxAliasLength&&alias.split("").every(function(_char6){return"-.0123456789@_abcdefghijklmnopqrstuvwxyz".includes(_char6)})}}]),Aliases}())};factory.$inject=["BaseNodeComponent"],angular.module("app").factory("aliases",factory)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.BuyBTCFaq,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.buyBTCFaq").directive("wBuyBtcFaq",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function BuyWAVESFaqCtrl(){var _this434;return _classCallCheck(this,BuyWAVESFaqCtrl),(_this434=_possibleConstructorReturn(this,_getPrototypeOf(BuyWAVESFaqCtrl).call(this,$scope))).isLogined=!!user.address,_this434}return _inherits(BuyWAVESFaqCtrl,Base),BuyWAVESFaqCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.buyWAVESFaq").controller("BuyWAVESFaqCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function InvestmentsCtrl(){var _this435;return _classCallCheck(this,InvestmentsCtrl),(_this435=_possibleConstructorReturn(this,_getPrototypeOf(InvestmentsCtrl).call(this,$scope))).isLogined=!!user.address,_this435}return _inherits(InvestmentsCtrl,Base),InvestmentsCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.investments").controller("InvestmentsCtrl",controller)}(),function(){var analytics=require("data-service").analytics,SignInFormCtrl=function(){function SignInFormCtrl($state,user,multiAccount,modalManager,configService){_classCallCheck(this,SignInFormCtrl),this.password="",this.form=null,this.multiAccountData="",this.multiAccountHash="",this.legacyUserList=null;var config=configService.get();this.privacyPolicy=config.privacyPolicy,this.termsAgreement=config.termsAndConditions,this.$state=$state,this.user=user,this.multiAccount=multiAccount,this.modalManager=modalManager}return _createClass(SignInFormCtrl,[{key:"$onInit",value:function(){var _this436=this;Promise.all([this.user.getMultiAccountData(),this.user.getMultiAccountHash(),this.user.getFilteredUserList()]).then(function(_ref216){var _ref217=_slicedToArray(_ref216,3),multiAccountData=_ref217[0],multiAccountHash=_ref217[1],userList=_ref217[2];multiAccountData?(_this436.multiAccountData=multiAccountData,_this436.multiAccountHash=multiAccountHash,_this436.legacyUserList=userList):_this436.$state.go("signUp")})}},{key:"onSubmit",value:function(){var _this437=this;this.form.$invalid||(this.showPasswordError=!1,this.multiAccount.signIn(this.multiAccountData,this.password,void 0,this.multiAccountHash).then(function(){_this437.onSuccess()}).catch(function(){_this437._showPasswordError()}))}},{key:"showForgotPasswordModal",value:function(overwrite){var _this438=this;analytics.user.forgotPasswordClick(),this.modalManager.showForgotPasswordModal({overwrite:overwrite}).then(function(){_this438.onResetPassword()})}},{key:"onPasswordChange",value:function(){this.password&&(this.showPasswordError=!1)}},{key:"_showPasswordError",value:function(){this.password="",this.showPasswordError=!0}}]),SignInFormCtrl}();SignInFormCtrl.$inject=["$state","user","multiAccount","modalManager","configService"],angular.module("app.signIn").component("wSignInForm",{templateUrl:"modules/signIn/components/signInForm/signInForm.html",controller:SignInFormCtrl,bindings:{overwrite:"<",onSuccess:"&",pending:"<",onResetPassword:"&"}})}(),(SignUpFormCtrl=function(){function SignUpFormCtrl(storage,configService){_classCallCheck(this,SignUpFormCtrl),this.termsAccepted=!1,this.form=null,this.password="",this.confirmPassword="",this.termsAgreement=!1,this.privacyPolicyAgreement=!1;var config=configService.get();this.privacyPolicy=config.privacyPolicy,this.termsAgreementUrl=config.termsAndConditions,this.storage=storage}return _createClass(SignUpFormCtrl,[{key:"invalid",get:function(){return this.form.$invalid||!this.termsAccepted&&(!this.privacyPolicyAgreement||!this.termsAgreement)}}]),_createClass(SignUpFormCtrl,[{key:"$onInit",value:function(){var _this439=this;this.storage.load("termsAccepted").then(function(termsAccepted){_this439.termsAccepted=termsAccepted})}},{key:"handleSubmit",value:function(){this.onSubmit({password:this.password})}}]),SignUpFormCtrl}()).$inject=["storage","configService"],angular.module("app.signIn").component("wSignUpForm",{templateUrl:"modules/signUp/components/signUpForm/signUpForm.html",controller:SignUpFormCtrl,bindings:{onSubmit:"&"}}),function(){var controller=function(Base,waves,$attrs,utils,$element){return new(function(){function BalanceInput(){var _this440;return _classCallCheck(this,BalanceInput),(_this440=_possibleConstructorReturn(this,_getPrototypeOf(BalanceInput).call(this))).name=null,_this440.focus=!1,_this440.amount=null,_this440.assetId=null,_this440.maxBalance=null,_this440.fee=null,_this440.realMaxBalance=null,_this440.fillMax=null,_this440.showBuyWithCard=!1,_this440.observe("assetId",_this440._onChangeAssetId),_this440.observe(["fee","maxBalance"],_this440._setMaxBalance),_this440.observe("focus",function(){_this440.focus?_this440.onFocus():_this440.onBlur()}),_this440}return _inherits(BalanceInput,Base),_createClass(BalanceInput,[{key:"$postLink",value:function(){if(!this.name)throw new Error("Has no name for input!")}},{key:"fillMaxClick",value:function(){if(this.onFillMaxClick&&this.onFillMaxClick(),$attrs.fillMax)return this.fillMax(),null;if(this.maxBalance){var feeHash=utils.groupMoney(utils.toArray(this.fee)),amount=null;if((amount=feeHash[this.assetId]?this.maxBalance.sub(feeHash[this.assetId]):this.maxBalance).getTokens().lt(0)?this.amount=this.maxBalance.cloneWithTokens("0"):this.amount=amount,this.amount.getTokens().isZero()){var input=null==$element?void 0:$element.find("input[name=".concat(this.name,"]"))[0];if(!input||input.value)return;input.value="0"}}}},{key:"_setMaxBalance",value:function(){if(this.fee&&this.maxBalance){var feeList=utils.toArray(this.fee),feeHash=utils.groupMoney(feeList);if(feeHash[this.maxBalance.asset.id]){var max=this.maxBalance.sub(feeHash[this.maxBalance.asset.id]);max.getTokens().lt(0)?this.realMaxBalance=this.maxBalance.cloneWithTokens("0"):this.realMaxBalance=max}else this.realMaxBalance=this.maxBalance}else this.realMaxBalance=this.maxBalance}},{key:"_onChangeAssetId",value:function(){var _this441=this;if(!this.assetId)return null;ds.moneyFromTokens("0",this.assetId).then(function(money){_this441.asset=money.asset})}}]),BalanceInput}())};controller.$inject=["Base","waves","$attrs","utils","$element"],angular.module("app.ui").component("wBalanceInput",{bindings:{name:"@",inputClasses:"@",fillMax:"&",onFocus:"&",onBlur:"&",amount:"=",assetId:"<",maxBalance:"<",fee:"<",min:"<",minGte:"<",disabled:"<",assetName:"<",assetPrecision:"<",placeholder:"@",onFillMaxClick:"&",showBuyWithCard:"<",onBuyWithCardClick:"&"},scope:!1,templateUrl:"modules/ui/directives/balanceInput/balanceInput.html",controller:controller})}(),function(){function controller(carouselManager){return new(function(){function CarouselDots(){var _this442=this;_classCallCheck(this,CarouselDots),this.sliderId=null,this.dots=[],this.slider=null,this.$postLink=function(){_this442.slider=carouselManager.getSlider(_this442.sliderId).then(function(slider){_this442.slider=slider,_this442.initialize()})}}return _createClass(CarouselDots,[{key:"initialize",value:function(){for(var _this443=this,loop=function(i){var dot=Object.create(null);dot.index=i,Object.defineProperty(dot,"active",{get:function(){return _this443.slider.getActive()===i}}),_this443.dots.push(dot)},i=0;i<this.slider.length;i++)loop(i)}},{key:"getClass",value:function(dot){return dot.active?"active":""}},{key:"onClick",value:function(dot){dot.active||this.slider.goTo(dot.index)}}]),CarouselDots}())}controller.$inject=["carouselManager"],angular.module("app.ui").component("wCarouselDots",{transclude:!0,bindings:{sliderId:"@"},controller:controller,templateUrl:"modules/ui/directives/carouselDots/dots.html"})}(),function(){var controller=function(Base,$element,$document,$scope,utils){return new(function(){function ClickOutSide(){return _classCallCheck(this,ClickOutSide),_possibleConstructorReturn(this,_getPrototypeOf(ClickOutSide).apply(this,arguments))}return _inherits(ClickOutSide,Base),_createClass(ClickOutSide,[{key:"$postLink",value:function(){var _this444=this;requestAnimationFrame(function(){_this444.listenEventEmitter($document,"click",function(e){0===$(e.target).closest($element).length&&(_this444.onClickOutside({event:e}),utils.safeApply($scope))})})}}]),ClickOutSide}())};controller.$inject=["Base","$element","$document","$scope","utils"],angular.module("app.ui").component("wClickOutside",{bindings:{onClickOutside:"&"},template:"<ng-transclude></ng-transclude>",transclude:!0,controller:controller})}(),function(){var controller=function(Base,$scope,$element){return new(function(){function InputError(){var _this445;return _classCallCheck(this,InputError),(_this445=_possibleConstructorReturn(this,_getPrototypeOf(InputError).call(this))).model=null,_this445.inputContainer=null,_this445.message=null,_this445.name=null,_this445.canShow=!1,_this445.hiddenByTimeout=!1,_this445.timer=null,_this445.hideWithin=0,_this445}return _inherits(InputError,Base),_createClass(InputError,[{key:"$postLink",value:function(){this.receive(this.inputContainer.tik,this._onTick,this),this.observe("canShow",this._onChangeCanShow),this.observe("hiddenByTimeout",this._onChangeCanShowByTimeout),this._onChangeCanShow()}},{key:"_onChangeCanShow",value:function(){var _this446=this;this.hiddenByTimeout=!1,this.timer&&clearTimeout(this.timer),$element.toggleClass("hidden",!this.canShow),this.hideWithin&&this.canShow&&(this.timer=setTimeout(function(){_this446.timer=null,_this446.hiddenByTimeout=!0},1e3*this.hideWithin))}},{key:"_onChangeCanShowByTimeout",value:function(){$element.toggleClass("hidden",this.canShow&&this.hiddenByTimeout)}},{key:"_onTick",value:function(elements){var _this447=this;elements.forEach(function(element){var name=element.getAttribute("name");if(!name)return null;if(_this447.name&&_this447.name!==name)return null;var model=_this447.inputContainer.form[name];if(!model)return null;_this447.model||(_this447.model=model);var isFocused=element===document.activeElement,pending=_this447.inputContainer.form.$pending||model.$pending,isTouchedOrSubmited=_this447.inputContainer.form.$submitted||model.$touched;_this447.canShow=!(pending||isFocused||!isTouchedOrSubmited||!model.$error[_this447.message])})}}]),InputError}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wInputError",{transclude:!0,require:{inputContainer:"^wInputContainer"},bindings:{message:"@",name:"@",hideWithin:"<?"},template:'<span class="error active" ng-transclude></span>',controller:controller})}(),function(){var FAQ_ITEMS=(0,require("ramda").range)(1,26).map(function(i){return{title:"faq.title".concat(i),text:"faq.text".concat(i),hash:"".concat(i)}}),controller=function($location){return new function MigrationFaq(){_classCallCheck(this,MigrationFaq),this.items=FAQ_ITEMS,this.hash=$location.hash()}};controller.$inject=["$location"],angular.module("app.ui").component("wMigrationFaq",{templateUrl:"modules/ui/directives/migrationFaq/migrationFaq.html",controller:controller})}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,uniqueId=require("ts-utils").uniqueId,ds=require("data-service"),fetch=ds.fetch,controller=function(Base,waves,$scope,user,balanceWatcher){return new(function(){function ScriptTxForm(){var _this448;_classCallCheck(this,ScriptTxForm),(_this448=_possibleConstructorReturn(this,_getPrototypeOf(ScriptTxForm).call(this))).state=Object.create(null),_this448.script="",_this448.isValid=!0,_this448.onSuccess=null,_this448.hasScript=user.hasScript(),_this448.requiredError=!1,_this448.validationError=!1,_this448.placeHolderLiteral=user.hasScript()?"change":"create",_this448.validationPending=!1,_this448.hasFee=!1,_this448.signPending=!1,_this448._validateXHR=null,_this448._activeXHR_Id=null,_this448._listeners=[],_this448.observe("state",_this448._onChangeState),_this448.observe("script",_this448._onChangeScript),_this448.receive(balanceWatcher.change,function(){_this448._currentHasFee(),$scope.$apply()}),user.hasScript()||(_this448.observe("script",_this448._updateRequiredErrorState),_this448._updateRequiredErrorState()),_this448.observe(["requiredError","validationError"],_this448._updateValidationState),_this448._updateValidationState(),_this448._currentHasFee();var signPendingListener=$scope.$on("signPendingChange",function(event,data){_this448.signPending=data});return _this448._listeners.push(signPendingListener),_this448}return _inherits(ScriptTxForm,Base),_createClass(ScriptTxForm,[{key:"$postLink",value:function(){this._initScript()}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(ScriptTxForm.prototype),"$onDestroy",this).call(this),this._listeners.forEach(function(listener){return listener()})}},{key:"getSignable",value:function(){var tx=waves.node.transactions.createTransaction(_objectSpread({},this.state.tx,{type:SIGN_TYPE.SET_SCRIPT}));return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"next",value:function(signable){this.onSuccess({signable:signable})}},{key:"_currentHasFee",value:function(){if(!this.state||!this.state.tx||!this.state.tx.fee)return null;var balanceHash=balanceWatcher.getBalance(),fee=this.state.tx.fee;this.hasFee=balanceHash[fee.asset.id]&&balanceHash[fee.asset.id].gte(fee)}},{key:"_updateRequiredErrorState",value:function(){this.requiredError=!this.script.replace("base64:","")}},{key:"_updateValidationState",value:function(){this.isValid=!this.validationError&&!this.requiredError}},{key:"_initScript",value:function(){var script=(this.state&&this.state.tx&&this.state.tx.script||"base64:").replace("base64:","");this.script!==script?this.script=script:this._onChangeScript(),this.state.tx.script=script}},{key:"_onChangeState",value:function(){var _this449=this,state=this.state;state.tx||(state.tx=Object.create(null)),state.tx.fee||waves.node.getFee({type:SIGN_TYPE.SET_SCRIPT}).then(function(fee){state.tx.fee=fee,_this449._currentHasFee(),$scope.$apply()})}},{key:"_onChangeScript",value:function(){var script=this.script.replace("base64:","");this._clearActiveValidationXHR(),this._createActiveValidationXHR(script)}},{key:"_clearActiveValidationXHR",value:function(){this._activeXHR_Id=null,this._validateXHR=null,this.validationPending=!1}},{key:"_createActiveValidationXHR",value:function(code){var _this450=this;if(""===code)return this.validationError=!1,this.state.tx.script="",null;this.validationPending=!0;var id=uniqueId("script-form-validate");this._activeXHR_Id=id,this._validateXHR=fetch("".concat(ds.config.get("node"),"/utils/script/estimate"),{method:"POST",body:code}).then(function(){if(_this450._activeXHR_Id!==id)return null;_this450._clearActiveValidationXHR(),_this450.validationError=!1,_this450.state.tx.script="".concat("base64:").concat(code)}).catch(function(){if(_this450._activeXHR_Id!==id)return null;_this450._clearActiveValidationXHR(),_this450.validationError=!0,_this450.state.tx.script="base64:"}).then(function(){$scope.$apply()})}}]),ScriptTxForm}())};controller.$inject=["Base","waves","$scope","user","balanceWatcher"],angular.module("app.ui").component("wScriptTxForm",{controller:controller,scope:!1,bindings:{state:"<",onSuccess:"&"},templateUrl:"modules/ui/directives/scriptTxForm/script-form.html"})}(),angular.module("app.ui").component("wSelectFilter",{templateUrl:"modules/ui/directives/selectFilter/selectFilter.html",bindings:{search:"="},transclude:!0}),function(){var controller=function(Base,$scope,$mdDialog,user,multiAccount,notification){return new(function(){function PasswordModalCtrl(){var _this451;return _classCallCheck(this,PasswordModalCtrl),(_this451=_possibleConstructorReturn(this,_getPrototypeOf(PasswordModalCtrl).call(this,$scope))).form=null,_this451.oldPassword="",_this451.password="",_this451.confirmPassword="",_this451.showPasswordError=!1,_this451.observe("oldPassword",_this451._hidePasswordError),_this451}return _inherits(PasswordModalCtrl,Base),_createClass(PasswordModalCtrl,[{key:"onSubmit",value:function(){var _this452=this;this._hidePasswordError(),Promise.all([user.getMultiAccountData(),user.getMultiAccountHash()]).then(function(_ref218){var _ref219=_slicedToArray(_ref218,2),data=_ref219[0],hash=_ref219[1];return multiAccount.changePassword(data,_this452.oldPassword,_this452.password,user.getSetting("encryptionRounds"),hash)}).then(function(data){return user.saveMultiAccount(data)}).then(function(){$mdDialog.hide(),notification.info({ns:"app.utils",title:{literal:"modal.settings.passChanged"}})}).catch(function(){_this452._showPasswordError()})}},{key:"_showPasswordError",value:function(){this.showPasswordError=!0}},{key:"_hidePasswordError",value:function(){this.showPasswordError=!1}}]),PasswordModalCtrl}())};controller.$inject=["Base","$scope","$mdDialog","user","multiAccount","notification"],angular.module("app.utils").controller("PasswordModalCtrl",controller)}(),function(){var ds=require("data-service"),prop=require("ramda").prop,BigNumber=require("@waves/bignumber").BigNumber,factory=function(configService,baseAssetService){var getGatewayConfig=function(){return configService.get("gateways.".concat("coinomat"))},getPath=function(version){var config=getGatewayConfig();return"".concat(config.url,"/api/v").concat(version)},getGatewaysAssetIdHash=function(){var config=getGatewayConfig(),_config$deposit=config.deposit,deposit=void 0===_config$deposit?[]:_config$deposit,_config$withdraw=config.withdraw,withdraw=void 0===_config$withdraw?[]:_config$withdraw;return[].concat(_toConsumableArray(deposit),_toConsumableArray(withdraw)).reduce(function(acc,item){var _ref220=config.config.find(function(_ref221){return _ref221.gateway===item})||{},waves=_ref220.waves,gateway=_ref220.gateway;return acc[baseAssetService.getIdByTicker(item)]={deposit:deposit.includes(item),withdraw:withdraw.includes(item),gateway:gateway,waves:waves,errorAddressMessage:!0},acc},{})};return new(function(){function CoinomatService(){_classCallCheck(this,CoinomatService)}return _createClass(CoinomatService,[{key:"getAll",value:function(){return getGatewaysAssetIdHash()}},{key:"getDepositDetails",value:function(asset,wavesAddress){var gateways=getGatewaysAssetIdHash();CoinomatService._assertAsset(asset.id);var from=gateways[asset.id].gateway,to=gateways[asset.id].waves;return this._loadPaymentDetails(from,to,wavesAddress).then(function(details){return{address:details.tunnel.wallet_from,attachment:details.tunnel.attachment,minimumAmount:new BigNumber(details.tunnel.in_min),maximumAmount:new BigNumber(details.tunnel.in_max),exchangeRate:new BigNumber(details.tunnel.xrate),gatewayFee:new BigNumber(details.tunnel.fee_out)}})}},{key:"getWithdrawDetails",value:function(asset,targetAddress,paymentId){var gateways=getGatewaysAssetIdHash();CoinomatService._assertAsset(asset.id);var from=gateways[asset.id].waves,to=gateways[asset.id].gateway;return Promise.all([this._loadPaymentDetails(from,to,targetAddress,paymentId),this._loadWithdrawRate(from,to)]).then(function(_ref222){var _ref223=_slicedToArray(_ref222,2),details=_ref223[0],rate=_ref223[1];if(paymentId&&details.tunnel.monero_payment_id!==paymentId)throw new Error("Monero Payment ID is invalid or missing");return{address:details.tunnel.wallet_from,attachment:details.tunnel.attachment,minimumAmount:new BigNumber(rate.in_min),maximumAmount:new BigNumber(rate.in_max),exchangeRate:new BigNumber(rate.xrate),gatewayFee:new BigNumber(rate.fee_out)}})}},{key:"getSupportMap",value:function(asset){return getGatewaysAssetIdHash()[asset.id]}},{key:"getAssetKeyName",value:function(asset){return"".concat("coinomat").concat(getGatewaysAssetIdHash()[asset.id].gateway)}},{key:"hasConfirmation",value:function(address){return ds.fetch("".concat(getPath(2),"/get_confirmation.php?address=").concat(address)).then(function(_ref224){var status=_ref224.status,is_confirmed=_ref224.is_confirmed;return!("not found"===status||!is_confirmed)})}},{key:"isVerified",value:function(address){return ds.fetch("".concat(getPath(2),"/get_verification_status.php?address=").concat(address)).then(prop("verified"))}},{key:"getCoinomatTimestamp",value:function(){return ds.fetch("".concat(getPath(2),"/get_ts.php")).then(prop("ts"))}},{key:"getAddressErrorMessage",value:function(){return"Invalid wallet_to"}},{key:"isInvalidAddressError",value:function(error){return error&&error.message===this.getAddressErrorMessage()}},{key:"setCoinomatTermsAccepted",value:function(signature,timestamp,status){var confirmed=status?1:0;return ds.signature.getSignatureApi().getPublicKey().then(function(publicKey){var params={signature:signature,public_key:publicKey,ts:timestamp,is_confirmed:confirmed};return ds.fetch("".concat(getPath(2),"/set_confirmation.php?").concat(function(params){return Object.keys(params).reduce(function(acc,item){var start=acc?"&":"";return"".concat(acc).concat(start).concat(item,"=").concat(params[item])},"")}(params)),{method:"POST"}).then(function(response){if("error"===response.status)return Promise.reject("Error!")})})}},{key:"_loadPaymentDetails",value:function(from,to,recipientAddress,paymentId){return $.get("".concat(getPath(1),"/create_tunnel.php"),_objectSpread({currency_from:from,currency_to:to,wallet_to:recipientAddress},paymentId?{monero_payment_id:paymentId}:{})).then(function(res){return CoinomatService._assertResponse(res,"ok"),$.get("".concat(getPath(1),"/get_tunnel.php"),{xt_id:res.tunnel_id,k1:res.k1,k2:res.k2,history:0,lang:"ru_RU"})}).then(function(res){return CoinomatService._assertResponse(res,"tunnel"),res})}},{key:"_loadWithdrawRate",value:function(from,to){return $.get("".concat(getPath(1),"/get_xrate.php"),{f:from,t:to,lang:"ru_RU"})}}],[{key:"_assertResponse",value:function(response,fieldName){if(!response[fieldName])throw new Error(response.error)}},{key:"_assertAsset",value:function(assetId){if(!getGatewaysAssetIdHash()[assetId])throw new Error("Asset is not supported by Coinomat")}}]),CoinomatService}())};factory.$inject=["configService","baseAssetService"],angular.module("app.utils").factory("coinomatService",factory)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user,modalManager){return reactDirective(rc.DefoInvestment,void 0,void 0,{$state:$state,user:user,modalManager:modalManager})};controller.$inject=["reactDirective","$state","user","modalManager"],angular.module("app.defoInvestment").directive("wDefoInvestment",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.DefoStakingFaq,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.defoStakingFaq").directive("wDefoStakingFaq",controller)}(),function(){var ds=require("data-service"),ANALYTICS_TABS_NAMES={myOpenOrders:"My Open Orders",myOrderHistory:"My Orders History",myTradeHistory:"My Trade History",tradeHistory:"Trade History",myBalance:"Balance"},controller=function(Base){return new(function(){function MobileLayout(){var _this453;return _classCallCheck(this,MobileLayout),(_this453=_possibleConstructorReturn(this,_getPrototypeOf(MobileLayout).call(this))).mobileTab="Charts",_this453.mobileOrdersTab="myOpenOrders",_this453.mobileHistoryTab="orderBook",_this453.observe("mobileOrdersTab",_this453._onChangeTab),_this453}return _inherits(MobileLayout,Base),_createClass(MobileLayout,[{key:"setHovered",value:function(){this.isHovered=!0}},{key:"setNotHovered",value:function(){this.isHovered=!1}},{key:"_onChangeTab",value:function(){ANALYTICS_TABS_NAMES[this.mobileOrdersTab]&&ds.analytics.dex.changeActiveTab(ANALYTICS_TABS_NAMES[this.mobileOrdersTab])}}]),MobileLayout}())};controller.$inject=["Base"],angular.module("app.dex").component("wMobileLayout",{templateUrl:"modules/dex/directives/mobileLayout/mobileLayout.html",controller:controller})}(),function(){var _require95=require("ramda"),propEq=_require95.propEq,uniqBy=_require95.uniqBy,map=_require95.map,pipe=_require95.pipe,prop=_require95.prop,find=_require95.find,controller=function(Base,$scope,createPoll,user,utils,transactions,modalManager){var PAIR_COLUMN_DATA={id:"pair",valuePath:"item.pair",search:!0,placeholder:"directives.filter"},FEE_COLUMN_DATA={id:"fee",title:{literal:"directives.tradeHistory.tableTitle.fee"},valuePath:"item.userFee",sort:!0},HEADER_COLUMNS=[{id:"type",title:{literal:"directives.tradeHistory.tableTitle.type"},valuePath:"item.exchangeType",sort:!0},{id:"time",title:{literal:"directives.tradeHistory.tableTitle.date"},valuePath:"item.timestamp",sort:!0,sortActive:!0,isAsc:!1},{id:"price",title:{literal:"directives.tradeHistory.tableTitle.price"},valuePath:"item.price",sort:!0},{id:"amount",title:{literal:"directives.tradeHistory.tableTitle.size"},valuePath:"item.amount",sort:!0},{id:"total",title:{literal:"directives.tradeHistory.tableTitle.total"},valuePath:"item.total",sort:!0}];return new(function(){function TradeHistory(){var _this454;return _classCallCheck(this,TradeHistory),(_this454=_possibleConstructorReturn(this,_getPrototypeOf(TradeHistory).call(this))).userList=[],_this454._assetIdPair=null,_this454.isMy=!1,_this454.history=[],_this454.remapTransactions=TradeHistory._remapTxList(),_this454.pending=!0,_this454.isDemo=!1,_this454.headers=[],_this454.syncSettings({_assetIdPair:"dex.assetIdPair"}),user.getMultiAccountUsers().then(function(list){_this454.userList=list}),_this454}return _inherits(TradeHistory,Base),_createClass(TradeHistory,[{key:"$postLink",value:function(){this.headers=this.isMy?[PAIR_COLUMN_DATA].concat(HEADER_COLUMNS,FEE_COLUMN_DATA):HEADER_COLUMNS,this.isDemo=this.isMy&&!user.address,this._initializePoll(),this.observe("_assetIdPair",this._onChangeAssets)}},{key:"isSelected",value:function(tx){return this._assetIdPair.amount===tx.amount.asset.id&&this._assetIdPair.price===tx.price.asset.id}},{key:"setPair",value:function(tx){if(this.isLockedPair(tx))return null;var price=tx.price,amount=tx.amount;if(this.isLockedInDexSmartAssets(amount.asset,price.asset))modalManager.showSmartPairModal(amount.asset.ticker||amount.asset.displayName,price.asset.ticker||price.asset.displayName);else{var pairName="".concat(amount.asset.ticker||amount.asset.id," / ").concat(price.asset.ticker||price.asset.id);ds.analytics.dex.changePairFromMyTradeHistory(pairName),user.setSetting("dex.assetIdPair",{amount:tx.amount.asset.id,price:tx.price.asset.id})}}},{key:"isLockedPair",value:function(tx){return utils.isLockedInDex(tx.amount.asset.id,tx.price.asset.id)}},{key:"isLockedInDexSmartAssets",value:function(assetA,assetB){return utils.isLockedInDexSmartAssets(assetA,assetB)}},{key:"_initializePoll",value:function(){var _this455=this;if(this.isMy&&this.isDemo)return null;this.poll=createPoll(this,this._getTradeHistory,this._setTradeHistory,1e3),this.poll.ready.then(function(){_this455.pending=!1})}},{key:"_onChangeAssets",value:function(){var _this456=this;this.isMy||(this.pending=!0,this.history=[],this.poll.restart().then(function(){_this456.pending=!1}))}},{key:"_getTradeHistory",value:function(){return transactions.getExchangeTxList(this._getTransactionsFilter()).then(this.remapTransactions)}},{key:"_setTradeHistory",value:function(history){var _this457=this;if(this.history.length===history.length&&this.history.every(function(item,i){return propEq("id",item,_this457.history[i])}))return null;this.history=history,$scope.$apply()}},{key:"_getTransactionsFilter",value:function(){return this.isMy?{sender:user.address}:{amountAsset:this._assetIdPair.amount,priceAsset:this._assetIdPair.price}}}],[{key:"_remapTxList",value:function(){var filter=uniqBy(prop("id")),mapFunc=map(TradeHistory._remapTx);return pipe(filter,mapFunc)}},{key:"_remapTx",value:function(tx){var pair="".concat(function(tx){return tx.amount.asset.displayName}(tx)," / ").concat(function(tx){return tx.price.asset.displayName}(tx)),userFee=pipe(find(function(order){return order.orderType===tx.exchangeType}),function(order){return"sell"===order.orderType?tx.sellMatcherFee:tx.buyMatcherFee})([tx.order1,tx.order2]);return _objectSpread({},tx,{pair:pair,userFee:userFee})}}]),TradeHistory}())};controller.$inject=["Base","$scope","createPoll","user","utils","transactions","modalManager"],angular.module("app.dex").component("wDexTradeHistory",{bindings:{isMy:"<"},templateUrl:"modules/dex/directives/tradeHistory/tradeHistory.html",controller:controller})}(),function(){var ALIAS_PATTERN=/^[a-z0-9-@_.]*$/,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function(Base,$scope,user,waves,notification,utils,balanceWatcher,baseAssetService){var analytics=require("data-service").analytics;return new(function(){function AccountInfoCtrl(){var _this458;_classCallCheck(this,AccountInfoCtrl),(_this458=_possibleConstructorReturn(this,_getPrototypeOf(AccountInfoCtrl).call(this,$scope))).buyParams=void 0,_this458.address=user.address,_this458.createAliasStep=0,_this458.aliases=null,_this458.newAlias="",_this458.fee=null,_this458.noMoneyForFee=!0,_this458.invalid=!1,_this458.invalidMinLength=!1,_this458.invalidMaxLength=!1,_this458.invalidPattern=!1,_this458.transactionId="",_this458.signLoader=!1,_this458.signDeviceFail=!1,_this458.invalidExist=!1,_this458._balance=null,_this458.userType=user.userType,_this458.isLedger="ledger"===user.userType,_this458.isKeeper="wavesKeeper"===user.userType,_this458.errorCreateAliasMsg="",_this458.showBuyFiatModal=!1,_this458.createClicked=!1,_this458._setBuyParams(),_this458.receive(balanceWatcher.change,_this458._updateBalance,_assertThisInitialized(_this458)),_this458._updateBalance();var feePromise=waves.node.getFee({type:SIGN_TYPE.CREATE_ALIAS});return Promise.all([feePromise,balanceWatcher.ready]).then(function(_ref225){var fee=_slicedToArray(_ref225,1)[0];_this458.fee=fee,_this458.observe(["_balance","fee"],_this458._onChangeBalance),_this458._onChangeBalance(),$scope.$digest()}),_this458.aliases=waves.node.aliases.getAliasList(),_this458.observe(["newAlias"],_this458._validateNewAlias),analytics.send({name:"Account Show",target:"ui"}),_this458}var _validateNewAlias2;return _inherits(AccountInfoCtrl,Base),_createClass(AccountInfoCtrl,[{key:"getSignableTx",value:function(){var timestamp=ds.utils.normalizeTime(Date.now()),data={alias:this.newAlias,fee:this.fee,timestamp:timestamp};return ds.signature.getSignatureApi().makeSignable({type:10,data:data})}},{key:"createAlias",value:function(){var _this459=this;if(this.createClicked=!0,!this.noMoneyForFee){var signable=this.getSignableTx();return signable.getId().then(function(id){_this459.signDeviceFail=!1,_this459.transactionId=id,_this459.signLoader=user.userType&&"seed"!==user.userType,$scope.$digest()}).then(function(){return signable.getDataForApi()}).then(function(preparedTx){return _this459.wasDestroed?Promise.reject():(_this459.signLoader=!1,ds.broadcast(preparedTx).then(function(){analytics.send({name:"Account Alias Create Transaction Success",target:"ui"}),_this459.aliases.push(_this459.newAlias),_this459.newAlias="",_this459.createAliasStep=0,notification.info({ns:"app.utils",title:{literal:"modal.account.notifications.aliasCreated"}}),$scope.$digest()}))},function(){_this459.signDeviceFail=!0,_this459.signLoader=!1,$scope.$digest()}).catch(function(error){analytics.send({name:"Account Alias Create Transaction Error",target:"ui"}),_this459.errorCreateAliasMsg=utils.parseError(error)})}}},{key:"onCopyAddress",value:function(){}},{key:"onCopyAlias",value:function(){}},{key:"reset",value:function(){this.newAlias=""}},{key:"onShowBuyFiatModal",value:function(){this.showBuyFiatModal=!0}},{key:"_onChangeBalance",value:function(){this.noMoneyForFee=!this.fee||!this._balance||this._balance.getTokens().lt(this.fee.getTokens()),$scope.$digest()}},{key:"_updateBalance",value:function(){var _this460=this;balanceWatcher.getBalanceByAssetId(baseAssetService.WavesAssetId).then(function(money){_this460._balance=money,utils.safeApply($scope)})}},{key:"_onCloseBuyModal",value:function(){this.showBuyFiatModal=!1,utils.safeApply($scope)}},{key:"_setBuyParams",value:function(){var _this461=this;Promise.all([ds.gateway.getAcashCryptoAssets(),ds.gateway.getAcashFiatAssets()]).then(function(_ref227){var _ref228=_slicedToArray(_ref227,2),cryptoAssets=_ref228[0],fiatAssets=_ref228[1],wavesAcash=cryptoAssets.find(function(_ref229){return"WAVES"===_ref229.id});fiatAssets.length&&(_this461.buyParams={onClose:function(){return _this461._onCloseBuyModal()},initValues:{fiatAsset:fiatAssets[0],fiatAmount:"",cryptoAsset:wavesAcash,cryptoAmount:"",rate:0,disableCryptoSelect:!0}})}).catch(function(){_this461.buyParams={onClose:function(){return _this461._onCloseBuyModal()}}})}},{key:"_validateNewAlias",value:(_validateNewAlias2=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(){var invalid;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(this.invalidMinLength=this.newAlias&&this.newAlias.length<4,this.invalidMaxLength=this.newAlias&&30<this.newAlias.length,this.invalidPattern=this.newAlias&&!ALIAS_PATTERN.test(this.newAlias),invalid=this.invalidMinLength||this.invalidMaxLength||this.invalidPattern,this.newAlias&&!invalid)return this.pendingAlias=!0,this.invalid=!0,_context17.prev=7,_context17.next=10,ds.api.aliases.getAddressByAlias(this.newAlias);_context17.next=21;break;case 10:this.invalidExist=!0,_context17.next=16;break;case 13:_context17.prev=13,_context17.t0=_context17.catch(7),this.invalidExist=!1;case 16:this.pendingAlias=!1,this.invalid=invalid||this.invalidExist,$scope.$digest(),_context17.next=23;break;case 21:this.invalidExist=!1,this.invalid=invalid;case 23:case"end":return _context17.stop()}},_callee17,this,[[7,13]])})),function(){return _validateNewAlias2.apply(this,arguments)})}]),AccountInfoCtrl}())};controller.$inject=["Base","$scope","user","waves","notification","utils","balanceWatcher","baseAssetService"],angular.module("app.utils").controller("AccountInfoCtrl",controller)}(),angular.module("app.wallet.transactions",[]),function(){var controller=function(Base,$scope,user,waves,utils,createPoll,baseAssetService){return new(function(){function AssetInfoHead(){var _getPrototypeOf12,_this462;_classCallCheck(this,AssetInfoHead);for(var _len25=arguments.length,args=new Array(_len25),_key25=0;_key25<_len25;_key25++)args[_key25]=arguments[_key25];return(_this462=_possibleConstructorReturn(this,(_getPrototypeOf12=_getPrototypeOf(AssetInfoHead)).call.apply(_getPrototypeOf12,[this].concat(args)))).assetName=void 0,_this462.ratingError=!1,_this462.tokenratingLink=void 0,_this462.rating=null,_this462}return _inherits(AssetInfoHead,Base),_createClass(AssetInfoHead,[{key:"$postLink",value:function(){this._getAssetInfo(),this._setLink(),this.observe("assetId",this._getAssetInfo),createPoll(this,this._getTokenRating,this._setTokenRating,6e4)}},{key:"_getAssetInfo",value:function(){var _this463=this;waves.node.assets.getAsset(this.assetId).then(function(asset){_this463.assetName=asset.name,_this463.ticker=asset.ticker;var _utils$getDataFromOra4=utils.getDataFromOracles(asset.id),hasLabel=_utils$getDataFromOra4.hasLabel,isGateway=_utils$getDataFromOra4.isGateway,isStable=_utils$getDataFromOra4.isStable,canRate=_utils$getDataFromOra4.canRate;_this463.hasLabel=hasLabel,_this463.isGatewayOrWaves=!canRate||_this463.assetId===baseAssetService.WavesAssetId||isGateway||isStable,$scope.$apply()}),this.state={assetId:this.assetId}}},{key:"_getTokenRating",value:function(){return ds.api.rating.getAssetsRating(this.assetId).then(function(assetList){return assetList}).catch(function(){return null})}},{key:"_setTokenRating",value:function(assetList){return assetList?0===assetList.length?null:(this.rating=assetList[0].rating,void $scope.$apply()):(this.ratingError=!0,null)}},{key:"_setLink",value:function(){this.tokenratingLink="".concat(WavesApp.network.tokenrating,"/tokens/").concat(this.assetId)}}]),AssetInfoHead}())};controller.$inject=["Base","$scope","user","waves","utils","createPoll","baseAssetService"],angular.module("app.ui").component("wAssetInfoHead",{controller:controller,templateUrl:"modules/ui/directives/assetInfoHead/asset-info-head.html",bindings:{assetId:"<"}})}(),function(){var ds=require("data-service"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function(Base,$scope,user,coinomatService){return new(function(){function CoinomatTerms(){var _this464;return _classCallCheck(this,CoinomatTerms),(_this464=_possibleConstructorReturn(this,_getPrototypeOf(CoinomatTerms).call(this))).termsAccepted=!1,_this464.termsAcceptedFreeze=!1,_this464.canShowTerms=!1,_this464.canShowCheckBox=!1,_this464.isVerified=!1,_this464.userModelTerms=!1,_this464.signPending=!1,_this464.signable=null,_this464.forceShowTerms=!1,_this464.showAcceptedCheckbox=!1,_this464.onSignStart=null,_this464.onSignEnd=null,_this464.termsPending=!1,_this464.loadError=null,_this464._ts=0,_this464.observe(["forceShowTerms","termsAcceptedFreeze"],_this464._currentCanShowTerms),_this464.observe(["showAcceptedCheckbox","termsAcceptedFreeze"],_this464._currentCanShowCheckbox),_this464}return _inherits(CoinomatTerms,Base),_createClass(CoinomatTerms,[{key:"$postLink",value:function(){var _this465=this;this.termsPending=!0,Promise.all([coinomatService.hasConfirmation(user.address),coinomatService.isVerified(user.address)]).then(function(_ref230){var _ref231=_slicedToArray(_ref230,2),terms=_ref231[0],verified=_ref231[1];_this465.termsAccepted=terms,_this465.userModelTerms=terms,_this465.termsAcceptedFreeze=terms,_this465.isVerified=verified,_this465.termsPending=!1,_this465.observe("userModelTerms",_this465._onChangeTerms),_this465._currentCanShowTerms(),_this465._currentCanShowCheckbox(),$scope.$apply()}).catch(function(e){_this465.loadError=e,_this465.termsPending=!1,_this465._currentCanShowTerms(),_this465._currentCanShowCheckbox(),$scope.$apply()})}},{key:"onSignCancel",value:function(){this.signPending=!1,this.userModelTerms=this.termsAccepted,this.signable=null,this.onSignEnd()}},{key:"onSignSuccess",value:function(signature){var _this466=this;return coinomatService.setCoinomatTermsAccepted(signature,this._ts,this.userModelTerms).catch(function(){_this466.userModelTerms=_this466.termsAccepted}).then(function(){_this466.signPending=!1,_this466.signable=null,_this466._ts=0,_this466.termsAccepted=_this466.userModelTerms,_this466.onSignEnd(),$scope.$apply()})}},{key:"_currentCanShowTerms",value:function(){this.canShowTerms=this.forceShowTerms||!this.termsAcceptedFreeze}},{key:"_currentCanShowCheckbox",value:function(){this.canShowCheckBox=this.showAcceptedCheckbox||this.isVerified&&!this.termsAcceptedFreeze}},{key:"_onChangeTerms",value:function(){var _this467=this;return this.termsAccepted===this.userModelTerms?null:(this.signPending=!0,this.onSignStart(),coinomatService.getCoinomatTimestamp().then(function(ts){return _this467._ts=ts}).then(CoinomatTerms._createSignable).then(function(signable){_this467.signable=signable,$scope.$apply()}))}}],[{key:"_createSignable",value:function(timestamp){return ds.signature.getSignatureApi().makeSignable({type:SIGN_TYPE.COINOMAT_CONFIRMATION,data:{timestamp:timestamp}})}}]),CoinomatTerms}())};controller.$inject=["Base","$scope","user","coinomatService"],angular.module("app.ui").component("wCoinomatTerms",{controller:controller,scope:!1,templateUrl:"modules/ui/directives/coinomatTerms/coinomat-terms.html",bindings:{onSignStart:"&",onSignEnd:"&",isVerified:"=",termsAccepted:"=",termsPending:"=",loadError:"=",forceShowTerms:"<",showAcceptedCheckbox:"<"}})}(),function(){var controller=function(Base){return new(function(){function ConfirmAction(){return _classCallCheck(this,ConfirmAction),_possibleConstructorReturn(this,_getPrototypeOf(ConfirmAction).apply(this,arguments))}return _inherits(ConfirmAction,Base),_createClass(ConfirmAction,[{key:"$postLink",value:function(){this.clicked=!1}},{key:"onClickAction",value:function(){this.clicked=!0}},{key:"runAction",value:function(){this.action(),this.clicked=!1}},{key:"removeClicked",value:function(){this.clicked=!1}}]),ConfirmAction}())};controller.$inject=["Base"],angular.module("app.ui").component("wConfirmAction",{bindings:{literalText:"<",literalConfirm:"<",literalBack:"<",literalHeader:"<",literalDescription:"<",action:"&"},templateUrl:"modules/ui/directives/confirmAction/confirmAction.html",transclude:!1,controller:controller})}(),angular.module("app.ui").component("wInputHelper",{templateUrl:"modules/ui/directives/inputHelper/inputHelper.html",transclude:!0}),function(){var module=angular.module("app.ui"),controller=function(Base,notification){return new(function(){function SubscribeForm(){var _this468;return _classCallCheck(this,SubscribeForm),(_this468=_possibleConstructorReturn(this,_getPrototypeOf(SubscribeForm).call(this))).email="",_this468.emailError="",_this468.observe("email",function(){_this468.emailError=""}),_this468}return _inherits(SubscribeForm,Base),_createClass(SubscribeForm,[{key:"subscribe",value:function(){var _this469=this;switch(!0){case ds.api.email.emailValidators.isEmpty(this.email):this.emailError="fieldIsRequired";break;case!ds.api.email.emailValidators.isEmail(this.email):this.emailError="incorrectEmail";break;default:this.emailError=""}if(this.emailError)return null;ds.api.email.sendEmail({email:this.email,type:"subscribe"}).then(function(){notification.info({ns:"app.ui",title:{literal:"successSubscribe"}}),_this469.onSubscribe&&_this469.onSubscribe()}).catch(function(){notification.error({ns:"app.ui",title:{literal:"somethingWrongNotification"}})}),this.email=""}}]),SubscribeForm}())};controller.$inject=["Base","notification"],module.component("wSubscribeForm",{bindings:{onSubscribe:"<",isSmall:"<"},transclude:!0,templateUrl:"modules/ui/directives/subscribeForm/subscribeForm.html",controller:controller})}(),angular.module("app.ui").component("wTransactionIcon",{bindings:{typeName:"<"},templateUrl:"modules/ui/directives/transaction/transaction-icon.html"}),function(){var tsUtils=require("ts-utils"),Money=require("@waves/data-entities").Money,controller=function(user){return new(function(){function Burn(){_classCallCheck(this,Burn),this.props=null}return _createClass(Burn,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"amount.asset")||tsUtils.get(this.props,"quantity.asset")||this.props),this.name=tsUtils.get(this.props,"amount.asset.name")||tsUtils.get(this.props,"quantity.asset.name");var amount=tsUtils.get(this.props,"amount")||tsUtils.get(this.props,"quantity");this.amount=amount instanceof Money?amount.toFormat():amount.div(Math.pow(10,this.props.precision))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Burn}())};controller.$inject=["user"],angular.module("app.ui").component("wBurn",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/burn/burn.html",controller:controller})}(),function(){var controller=function(waves){var propEq=require("ramda").propEq;return new(function(){function Data(){_classCallCheck(this,Data),this.props=null}return _createClass(Data,[{key:"$postLink",value:function(){var _this470=this;if("data-vote"===this.props.typeName){var assetId=this.props.data.find(propEq("key","assetId")).value;waves.node.assets.getAsset(assetId).then(function(asset){_this470.assetName=asset.displayName})}}}]),Data}())};controller.$inject=["waves"],angular.module("app.ui").component("wData",{bindings:{props:"<"},controller:controller,templateUrl:"modules/ui/directives/transaction/types/data/data.html"})}(),function(){var controller=function(Base,$scope,waves,balanceWatcher,utils,baseAssetService){var isEmpty=require("ts-utils").isEmpty,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,Money=require("@waves/data-entities").Money,ds=require("data-service"),analytics=require("data-service").analytics;return new(function(){function SponsoredModalCtrl(_ref232){var _this471,asset=_ref232.asset,isCreateSponsored=_ref232.isCreateSponsored,onBuyWithCardClick=_ref232.onBuyWithCardClick;_classCallCheck(this,SponsoredModalCtrl),(_this471=_possibleConstructorReturn(this,_getPrototypeOf(SponsoredModalCtrl).call(this,$scope))).step=0,_this471.isCreateSponsored=null,_this471.assetId=null,_this471.fee=null,_this471.minSponsoredAssetFee=null,_this471.assetBalance=null,_this471.wavesBalance=null,_this471.signPending=!1,_this471.asset=null,_this471.continueClicked=!1,_this471._tx=null,_this471._listeners=[],_this471.assetId=asset.id,_this471.asset=asset,_this471.isCreateSponsored=isCreateSponsored,_this471.onBuyWithCardClick=onBuyWithCardClick;var _utils$getDataFromOra5=utils.getDataFromOracles(asset.id),isVerified=_utils$getDataFromOra5.isVerified,isGateway=_utils$getDataFromOra5.isGateway,isTokenomica=_utils$getDataFromOra5.isTokenomica,ticker=_utils$getDataFromOra5.ticker,description=_utils$getDataFromOra5.description;if(_this471.isVerified=isVerified,_this471.isGateway=isGateway,_this471.isTokenomica=isTokenomica,_this471.ticker=ticker||asset.ticker,_this471.description=description||asset.description,isEmpty(_this471.assetId))throw new Error("Wrong modal params!");_this471.receive(balanceWatcher.change,_this471._updateBalances,_assertThisInitialized(_this471)),_this471._updateBalances(),_this471.observe(["fee","minSponsoredAssetFee"],_this471._createTx),_this471._updateFee();var signPendingListener=$scope.$on("signPendingChange",function(event,data){_this471.signPending=data});return _this471._listeners.push(signPendingListener),_this471}return _inherits(SponsoredModalCtrl,Base),_createClass(SponsoredModalCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(SponsoredModalCtrl.prototype),"$onDestroy",this).call(this),this._listeners.forEach(function(listener){return listener()})}},{key:"getSignable",value:function(){return this.continueClicked=!0,this.hasFee?this.signable:Promise.reject()}},{key:"onConfirm",value:function(){analytics.send({name:"Enable Sponsorship Continue Click",target:"ui"}),this.step++}},{key:"onBack",value:function(){this.step--}},{key:"getSponsoredTx",value:function(){return this._tx}},{key:"_createTx",value:function(){if(!this.fee||!this.minSponsoredAssetFee)return this.signable=null;var fee=this.fee,minSponsoredAssetFee=this.minSponsoredAssetFee,type=SIGN_TYPE.SPONSORSHIP,tx=waves.node.transactions.createTransaction({fee:fee,type:type,minSponsoredAssetFee:minSponsoredAssetFee});this.signable=ds.signature.getSignatureApi().makeSignable({type:type,data:tx})}},{key:"_updateBalances",value:function(){var _this472=this;Promise.all([balanceWatcher.getBalanceByAssetId(baseAssetService.WavesAssetId),balanceWatcher.getBalanceByAssetId(this.assetId)]).then(function(_ref233){var _ref234=_slicedToArray(_ref233,2),waves=_ref234[0],asset=_ref234[1];_this472.wavesBalance=waves,_this472.assetBalance=asset,_this472._updateAvailableFee(),utils.safeApply($scope)})}},{key:"_updateFee",value:function(){var _this473=this;return this._getTxForFee().then(function(tx){return waves.node.getFee(tx)}).then(function(fee){_this473.fee=fee,_this473._updateAvailableFee()})}},{key:"_updateAvailableFee",value:function(){this.fee&&this.wavesBalance&&(this.hasFee=this.wavesBalance.gte(this.fee))}},{key:"_getTxForFee",value:function(){return Promise.resolve({type:SIGN_TYPE.SPONSORSHIP,minSponsoredAssetFee:new Money(0,this.asset)})}}]),SponsoredModalCtrl}())(this.locals)};controller.$inject=["Base","$scope","waves","balanceWatcher","utils","baseAssetService"],angular.module("app.utils").controller("SponsoredModalCtrl",controller)}(),angular.module("app.utils").factory("postmessageStorage",function(){var PostMessageStorage=function(){function PostMessageStorage(){_classCallCheck(this,PostMessageStorage),this.readyPromise=void 0}return _createClass(PostMessageStorage,[{key:"read",value:function(key){var _this474=this;return this.readyPromise.then(function(){return JSON.parse(_this474._data[key])}).catch(function(){return _this474._data[key]})}},{key:"write",value:function(key,value){var api=PostMessageStorage._getStorage();return this.readyPromise.then(function(){return api.request("updateData",{key:value})})}},{key:"clear",value:function(){var api=PostMessageStorage._getStorage();return this.readyPromise.then(function(){return api.dispatchEvent("clearData")})}},{key:"onUpdate",value:function(cb){PostMessageStorage._getStorage().on("setData",cb)}},{key:"init",value:function(){var _this475=this,api=PostMessageStorage._getStorage();api.once("init",function(){return api.request("getData")}),this.readyPromise=new Promise(function(resolve){api.once("setData",function(data){_this475._data=data,resolve(data)})})}}],[{key:"_getStorage",value:function(){return PostMessageStorage.storage||(PostMessageStorage.storage=function(){var _require103=require("@waves/waves-browser-bus"),WindowAdapter=_require103.WindowAdapter,Bus=_require103.Bus,adapter=new WindowAdapter({win:window,origin:location.origin},{win:window.opener,origin:"*"});return new Bus(adapter)}()),PostMessageStorage.storage}}]),PostMessageStorage}();return PostMessageStorage.storage=null,new PostMessageStorage}),function(){var factory=function(BaseNotificationManager){return new BaseNotificationManager({templateUrl:"modules/app/services/notification/templates/user-notification.html",queueLimit:1,defaultDelay:-1})};factory.$inject=["BaseNotificationManager"],angular.module("app").factory("userNotification",factory)}(),function(){var analytics=require("data-service").analytics,ds=require("data-service"),libs=require("@waves/waves-transactions").libs,base58Decode=libs.crypto.base58Decode,MigrateFormCtrl=function(){function MigrateFormCtrl($scope,$state,multiAccount,user){_classCallCheck(this,MigrateFormCtrl),this.migrateForm=null,this.migratePassword="",this.activeStep=0,this.userToMigrate=null,this.userListLocked=[],this.userListUnlocked=[],this.showPasswordError=!1,this.$scope=$scope,this.$state=$state,this.multiAccount=multiAccount,this.user=user}var _migrateUsersWithoutPassword;return _createClass(MigrateFormCtrl,[{key:"$onInit",value:function(){var _this476=this;Promise.all([this.user.getFilteredUserList(),this.user.getMultiAccountUsers()]).then(function(_ref235){var _ref236=_slicedToArray(_ref235,2),userList=_ref236[0],multiAccountUsers=_ref236[1],id=_this476.$state.params.id;_this476.activeStep=userList&&userList.length?0:1,_this476.userListLocked=userList,_this476.userListUnlocked=multiAccountUsers;var migrateWithoutPass=userList.filter(function(lockedUser){return lockedUser.userType&&"seed"!==lockedUser.userType&&"privateKey"!==lockedUser.userType});_this476.migrateUsersWithoutPassword(migrateWithoutPass).then(function(){if(id){if(migrateWithoutPass.length&&migrateWithoutPass.some(function(user){return _this476.multiAccount.hash(user.address)===id}))return _this476.prevStep(),null;var lockedUserByHash=_this476.userListLocked.find(function(lockedUser){return _this476.multiAccount.hash(lockedUser.address)===id});lockedUserByHash&&_this476.startMigrate(lockedUserByHash)}}),_this476.$scope.$apply()})}},{key:"migrateUsersWithoutPassword",value:(_migrateUsersWithoutPassword=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(usersWithoutPassword){var _iteratorNormalCompletion5,_didIteratorError5,_iteratorError5,_iterator5,_step6,legacyUser,userType,id,publicKey,address,networkByte;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:_didIteratorError5=!(_iteratorNormalCompletion5=!0),_iteratorError5=void 0,_context18.prev=3,_iterator5=usersWithoutPassword[Symbol.iterator]();case 5:if(_iteratorNormalCompletion5=(_step6=_iterator5.next()).done){_context18.next=15;break}return legacyUser=_step6.value,userType=legacyUser.userType,id=legacyUser.id,publicKey=legacyUser.publicKey,address=legacyUser.address,networkByte=base58Decode(address)[1],this.userToMigrate=legacyUser,_context18.next=12,this.migrateUser({userType:userType,networkByte:networkByte,id:id,publicKey:publicKey});case 12:_iteratorNormalCompletion5=!0,_context18.next=5;break;case 15:_context18.next=21;break;case 17:_context18.prev=17,_context18.t0=_context18.catch(3),_didIteratorError5=!0,_iteratorError5=_context18.t0;case 21:_context18.prev=21,_context18.prev=22,_iteratorNormalCompletion5||null==_iterator5.return||_iterator5.return();case 24:if(_context18.prev=24,_didIteratorError5)throw _iteratorError5;_context18.next=27;break;case 27:return _context18.finish(24);case 28:return _context18.finish(21);case 29:case"end":return _context18.stop()}},_callee18,this,[[3,17,21,29],[22,,24,28]])})),function(_x14){return _migrateUsersWithoutPassword.apply(this,arguments)})},{key:"migrateUser",value:function(userData){var _this477=this;return this.multiAccount.addUser(userData).then(function(data){return Promise.all([_this477.user.saveMultiAccount(data),_this477.user.migrateUser(_this477.userToMigrate,data.userHash)])}).then(function(){return _this477.user.getMultiAccountUsers()}).then(function(multiAccountUsers){_this477.userListLocked=_this477.userListLocked.filter(function(lockedUser){return lockedUser.address!==_this477.userToMigrate.address}),_this477.userListUnlocked=multiAccountUsers,_this477.userToMigrate=null})}},{key:"nextStep",value:function(){this.activeStep+=1}},{key:"prevStep",value:function(){var _this478=this,id=this.$state.params.id;id?this.user.getMultiAccountUsers().then(function(){var userToLogin=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).find(function(mUser){return _this478.multiAccount.hash(mUser.address)===id});userToLogin&&_this478.user.login(userToLogin),_this478.$state.go(_this478.user.goToActiveState())}):this.activeStep-=1}},{key:"startMigrate",value:function(userToMigrate){this.userToMigrate=userToMigrate,this.nextStep()}},{key:"checkSeed",value:function(seed,publicKey){return publicKey===libs.crypto.publicKey(seed)}},{key:"checkPK",value:function(privateKey,publicKey){return libs.crypto.publicKey({privateKey:privateKey})===publicKey}},{key:"onSubmit",value:function(){var _this479=this;try{this._hidePasswordError();var _this$userToMigrate=this.userToMigrate,id=_this$userToMigrate.id,publicKey=_this$userToMigrate.publicKey,address=_this$userToMigrate.address,_this$userToMigrate$s=_this$userToMigrate.settings,encryptionRounds=(void 0===_this$userToMigrate$s?{}:_this$userToMigrate$s).encryptionRounds||5e3,userType=userType||"seed",networkByte=base58Decode(address)[1],seed="seed"===userType?ds.Seed.decryptSeedPhrase(this.userToMigrate.encryptedSeed,this.migratePassword,encryptionRounds):void 0,privateKey="privateKey"===userType?ds.Seed.decryptSeedPhrase(this.userToMigrate.encryptedPrivateKey,this.migratePassword):void 0;if(seed&&!this.checkSeed(seed,publicKey))throw new Error("Incorrect seed");if(privateKey&&!this.checkPK(privateKey,publicKey))throw new Error("Incorrect private key");this.migrateUser({userType:userType,networkByte:networkByte,seed:seed,id:id,privateKey:privateKey,publicKey:publicKey}).then(function(){_this479.migratePassword="",_this479.prevStep(),analytics.send({name:"Successfully Unlocked"})})}catch(e){this._showPasswordError(),analytics.send({name:"Failed Unlock"})}}},{key:"finish",value:function(){var firstUser=_slicedToArray(this.userListUnlocked,1)[0];this.onFinish({firstUser:firstUser})}},{key:"_showPasswordError",value:function(){this.migratePassword="",this.showPasswordError=!0}},{key:"_hidePasswordError",value:function(){this.showPasswordError=!1}}]),MigrateFormCtrl}();MigrateFormCtrl.$inject=["$scope","$state","multiAccount","user"],angular.module("app.migrate").component("wMigrateForm",{templateUrl:"modules/migrate/components/migrateForm/migrateForm.html",controller:MigrateFormCtrl,bindings:{onFinish:"&"}})}(),angular.module("app.ui").component("wPermitMessage",{require:{parent:"^wPermit"},bindings:{literal:"@"},template:'<div class="w-permit-message" w-i18n="{{::$ctrl.literal}}"></div>'}),function(){var factory=function(mediaStream,Poll){var Signal=require("ts-utils").Signal,wrapper=require("worker-wrapper");return function(){function QrCodeReadService(options){var _this480=this;_classCallCheck(this,QrCodeReadService),this.onRead=new Signal,this.onError=new Signal,this.onHasSize=new Signal,this.size=null,this._canvas=document.createElement("CANVAS"),this._ctx=null,this._stream=null,this._video=document.createElement("VIDEO"),this._worker=null,this._poll=null,this._readQrHash=Object.create(null),this._readCount=4,this._maxSize=null,this._factor=1,options.readCount&&(this._readCount=options.readCount),this._maxSize=options.maxSize,this._initializeDom(options),requestAnimationFrame(function(){_this480._createWorker()._createStream().then(function(){return _this480._loadVideoSize()}).then(function(){return _this480._createPoll()}).catch(function(e){return _this480._dispatchError(e)})})}return _createClass(QrCodeReadService,[{key:"destroy",value:function(){this._removeWorker()._clearSignalHandlers()._stopStream()._removePoll()._removeVideoElement()}},{key:"_initializeDom",value:function(options){return this._createContext()._addVideoAttrs(),options.$element.append(this._video),this}},{key:"_removeVideoElement",value:function(){return this._video.parentNode&&this._video.parentNode.removeChild(this._video),this}},{key:"_createContext",value:function(){return this._ctx=this._canvas.getContext("2d"),this}},{key:"_addVideoAttrs",value:function(){return this._video.setAttribute("autoplay","true"),this._video.setAttribute("preload","auto"),this._video.setAttribute("muted","true"),this._video.setAttribute("playsinline","true"),this}},{key:"_clearSignalHandlers",value:function(){return this.onRead.off(),this.onError.off(),this}},{key:"_removeWorker",value:function(){return this._worker&&(this._worker.terminate(),this._worker=null),this}},{key:"_stopStream",value:function(){return this._stream&&(this._stream.stop(),this._stream=null),this}},{key:"_createWorker",value:function(){return this._worker||(this._worker=wrapper.create(function(){return new QrCode},{libs:["/node_modules/qrcode-reader/dist/index.min.js?".concat(WavesApp.version)]})),this}},{key:"_createPoll",value:function(){var _this481=this;return this._poll||(this._poll=new Poll(function(){return _this481._decodeImage()},function(result){return _this481._checkStop(result)},1e3/24)),this}},{key:"_removePoll",value:function(){return this._poll&&(this._poll.destroy(),this._poll=null),this}},{key:"_createStream",value:function(){var _this482=this;return mediaStream.create().then(function(stream){_this482._stream=stream,_this482._video.srcObject=stream.stream})}},{key:"_loadVideoSize",value:function(){var _this483=this;return new Promise(function(resolve){_this483._video.addEventListener("loadedmetadata",function handler(){_this483.size={width:_this483._video.videoWidth,height:_this483._video.videoHeight};var factor=_this483._maxSize&&Math.min(_this483._maxSize.width/_this483.size.width,_this483._maxSize.height/_this483.size.height)||1;_this483._factor=factor,_this483._video.style.transform="scale(".concat(factor,") translate(-50%, -50%)"),WavesApp.device.phone()||WavesApp.device.tablet()||(_this483._video.style.transform="scale(".concat(factor,") translate(-50%, -50%) scaleX(-1)"),_this483._video.style.left="150%"),_this483._video.style.transformOrigin="0 0",_this483._canvas.width=170/factor,_this483._canvas.height=170/factor,_this483.onHasSize.dispatch(_objectSpread({},_this483.size)),_this483._video.removeEventListener("loadedmetadata",handler,!1),resolve()},!1)})}},{key:"_decodeImage",value:function(){var _this484=this;if(!this.size||!this.size.width||!this.size.height)return null;var frame=this._getFrame();return this._worker.process(function(qr,_ref237){var frame=_ref237.frame;return new Promise(function(resolve){qr.callback=function(error,response){resolve(error?null:response.result)},qr.decode(frame)})},{frame:frame}).catch(function(e){return _this484._dispatchError(e)})}},{key:"_checkStop",value:function(parsedQr){if(!parsedQr)return null;this._readQrHash[parsedQr]?this._readQrHash[parsedQr]++:this._readQrHash[parsedQr]=1,this._readQrHash[parsedQr]>=this._readCount&&(this.onRead.dispatch(parsedQr),this.destroy())}},{key:"_getFrame",value:function(){var _this$_ctx,size=170*(1/this._factor),args=[(this.size.width-size)/2,(this.size.height-size)/2,size,size,0,0,size,size];return(_this$_ctx=this._ctx).drawImage.apply(_this$_ctx,[this._video].concat(args)),this._ctx.getImageData(0,0,size,size)}},{key:"_dispatchError",value:function(error){this.onError.dispatch(error),this.destroy()}}]),QrCodeReadService}()};factory.$inject=["mediaStream","Poll"],angular.module("app.ui").factory("QrCodeReadService",factory)}(),function(){var controller=function(Base,$scope,$mdDialog){return new(function(){function ConfirmOrderCtrl(_ref238){var _this485,locals=_ref238.locals;return _classCallCheck(this,ConfirmOrderCtrl),(_this485=_possibleConstructorReturn(this,_getPrototypeOf(ConfirmOrderCtrl).call(this,$scope))).type=locals.orderType,_this485.orderLimit=locals.orderLimit,_this485.isSell="sell"===_this485.type,_this485}return _inherits(ConfirmOrderCtrl,Base),_createClass(ConfirmOrderCtrl,[{key:"agree",value:function(){$mdDialog.hide()}},{key:"close",value:function(){$mdDialog.cancel()}}]),ConfirmOrderCtrl}())(this)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.ui").controller("ConfirmOrderCtrl",controller)}(),function(){var controller=function(Base,$scope,user,utils){var encryptSeed=require("@waves/waves-transactions").seedUtils.encryptSeed,crypto=require("@waves/waves-transactions").libs.crypto,getPublicKey=crypto.publicKey,getAddress=crypto.address,base58Decode=crypto.base58Decode,checkAccount=function(account){if(!account)return!1;var address=account.address,userType=account.userType,networkByte=account.networkByte,publicKey="";switch(userType){case"seed":try{publicKey=/^base58:/.test(account.seed)?getPublicKey(base58Decode(account.seed.replace("base58:",""))):getPublicKey(account.seed)}catch(e){return!1}break;case"privateKey":try{publicKey=getPublicKey({privateKey:account.privateKey})}catch(e){return!1}break;default:publicKey=account.publicKey}return getAddress({publicKey:publicKey},networkByte)===address};return new(function(){function ExportAccountsCtrl(){var _this486;return _classCallCheck(this,ExportAccountsCtrl),(_this486=_possibleConstructorReturn(this,_getPrototypeOf(ExportAccountsCtrl).call(this,$scope))).checkedHash={},_this486.needPassword=!0,_this486.selectIsVisible=!0,_this486.userlist=[],_this486.password="",_this486.settings={lastOpenVersion:null},_this486.settings=user.getMultiAccountSettings(),_this486.userList=[],_this486.checkedHash[user.address]=!0,_this486.selectIsVisible=!0,user.getMultiAccountSettings().then(function(settings){_this486.settings=settings}),user.getMultiAccountUsers().then(function(users){_this486.userList=(Array.isArray(users)?users:[]).filter(checkAccount),_this486.onSelect(),utils.safeApply($scope)}),_this486}return _inherits(ExportAccountsCtrl,Base),_createClass(ExportAccountsCtrl,[{key:"toggleSelect",value:function(address){this.checkedHash[address]=!this.checkedHash[address],this.onSelect()}},{key:"onSelect",value:function(){var selected=Object.values(this.checkedHash).filter(Boolean).length,total=(this.userList||[]).length;this.hasSelected=!!selected,this.selectIsVisible=selected!==total}},{key:"selectAll",value:function(){var _this487=this;this.userList.forEach(function(user){_this487.checkedHash[user.address]=!0}),this.onSelect()}},{key:"unselectAll",value:function(){var _this488=this;this.userList.forEach(function(user){_this488.checkedHash[user.address]=!1}),this.onSelect()}},{key:"onSubmit",value:function(){var _this489=this,users=Object.entries(this.checkedHash).filter(function(item){return item[1]}).map(function(_ref239){var address=_slicedToArray(_ref239,1)[0];return _this489.userList.find(function(user){return user.address===address})}),stringifyUsers=JSON.stringify(users),saveUsers=this.needPassword?encryptSeed(stringifyUsers,this.password,1e4):stringifyUsers,saveData={encrypted:this.needPassword,encryptionRounds:this.needPassword?1e4:void 0,saveUsers:saveUsers},dataToSaveInBytes=crypto.stringToBytes(JSON.stringify(saveData));saveData.hashSum=crypto.base58Encode(crypto.sha256(dataToSaveInBytes));var toSave={type:"wavesBackup",lastOpenVersion:this.settings.lastOpenVersion,data:crypto.base64Encode(crypto.stringToBytes(JSON.stringify(saveData))),checkSum:saveData.hashSum,time:Date.now()};utils.downloadFile("accountsBackup-".concat(toSave.time,".json"),JSON.stringify(toSave,null,4))}}]),ExportAccountsCtrl}())};controller.$inject=["Base","$scope","user","utils"],angular.module("app.utils").controller("ExportAccountsCtrl",controller)}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,$=require("jquery"),ds=require("data-service"),controller=function(Base,$scope,$mdDialog,user){return new(function(){function SignByDeviceCtrl(signable,anyData){var _this490;_classCallCheck(this,SignByDeviceCtrl),(_this490=_possibleConstructorReturn(this,_getPrototypeOf(SignByDeviceCtrl).call(this,$scope))).anyData=null,_this490.deferred=$.Deferred(),_this490.mode="",_this490.loading=!0,_this490.isLedger=!1,_this490.isKeeper=!1,_this490.txData=null,_this490.total=void 0,_this490.order={type:"",pair:"",amount:null},_this490.anyData=anyData;var cb="function"==typeof signable?signable:null,type=(signable="function"==typeof signable?anyData.signable:signable)&&signable.type||anyData&&anyData.type;_this490.mode=SignByDeviceCtrl.getSignMode(type),signable?signable.getId().then(function(id){_this490.txId=id,$scope.$apply()}):_this490.txId=anyData.hash,_this490.txData=signable?signable.getTxData():anyData,_this490.parseOrderData(),_this490.txData.price&&(_this490.total=_this490.txData.price.cloneWithTokens(_this490.txData.price.getTokens().mul(_this490.txData.amount.getTokens()))),_this490.isLedger="ledger"===user.userType,_this490.isKeeper="wavesKeeper"===user.userType,_this490.deferred.promise().then(function(result){_this490.onLoad(result)}).catch(function(error){_this490.onError(error)});return(signable?signable.getSignature():cb()).then(function(data){var result=signable||data;_this490.deferred.resolve(result)}).catch(function(error){ds.analytics.send({name:"Auth_Token_Reject"}),_this490.deferred.reject(error)}),_this490}return _inherits(SignByDeviceCtrl,Base),_createClass(SignByDeviceCtrl,[{key:"onClose",value:function(){this.deferred.reject()}},{key:"onLoad",value:function(result){$mdDialog.hide(result),$scope.$destroy()}},{key:"onError",value:function(error){$mdDialog.cancel(error),$scope.$destroy()}},{key:"parseOrderData",value:function(){if("cancel-order"!==this.mode)return null;this.order.type=this.anyData&&this.anyData.type||"",this.order.pair=this.anyData&&this.anyData.pair||"",this.order.amount=this.anyData&&this.anyData.amount||""}}],[{key:"getSignMode",value:function(type){switch(type){case SIGN_TYPE.CREATE_ORDER:return"create-order";case SIGN_TYPE.CANCEL_ORDER:return"cancel-order";case SIGN_TYPE.MATCHER_ORDERS:case"apiToken":return"sign-matcher";case SIGN_TYPE.SCRIPT_INVOCATION:return"invocation";default:throw new Error("Wrong sign type!")}}}]),SignByDeviceCtrl}())(this.signable,this.anyData)};controller.$inject=["Base","$scope","$mdDialog","user"],angular.module("app.ui").controller("SignByDeviceCtrl",controller)}(),function(){var controller=function(Base,$scope,user,utils,waves,i18n,baseAssetService){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),configs=ds.utils.ConfigService,analytics=require("data-service").analytics;return new(function(){function StartLeasingCtrl(){var _this491;_classCallCheck(this,StartLeasingCtrl),(_this491=_possibleConstructorReturn(this,_getPrototypeOf(StartLeasingCtrl).call(this,$scope))).signPending=!1,_this491._listeners=[],_this491.step=0,_this491.title=i18n.translate("modal.startLease.title","app.utils"),_this491.assetId=baseAssetService.WavesAssetId,_this491.recipient="",_this491.amount=null,_this491.nodeListLink=configs.getConfig("NETWORK.nodeList"),waves.node.getFee({type:SIGN_TYPE.LEASE}).then(function(money){_this491.fee=money}),waves.node.assets.balance(_this491.assetId).then(function(balance){_this491.balance=balance.available});var signPendingListener=$scope.$on("signPendingChange",function(event,data){_this491.signPending=data});return _this491._listeners.push(signPendingListener),_this491}return _inherits(StartLeasingCtrl,Base),_createClass(StartLeasingCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(StartLeasingCtrl.prototype),"$onDestroy",this).call(this),this._listeners.forEach(function(listener){return listener()})}},{key:"back",value:function(){this.step--}},{key:"sign",value:function(){analytics.send({name:"Leasing Popup Start Click",target:"ui"});var tx=waves.node.transactions.createTransaction({recipient:this.recipient,fee:this.fee,amount:this.amount,type:SIGN_TYPE.LEASE});return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"next",value:function(signable){this.signable=signable,this.step++}}]),StartLeasingCtrl}())};controller.$inject=["Base","$scope","user","utils","waves","i18n","baseAssetService"],angular.module("app.ui").controller("StartLeasingCtrl",controller)}(),function(){var controller=function(Base,$scope,$mdDialog){return new(function(){function UpdateClientCtrl(options){var _this492;_classCallCheck(this,UpdateClientCtrl),(_this492=_possibleConstructorReturn(this,_getPrototypeOf(UpdateClientCtrl).call(this,$scope))).canClose=!options.isForce,_this492.version=options.version,_this492.text=options.text,_this492.title=options.title,_this492.type=options.type,_this492.textType=options.textType,_this492.titleType=options.titleType;var id=options.id||Date.now();return _this492.titleId="title_".concat(id),_this492.textId="text_".concat(id),_this492.hasText=0<Object.keys(options.text||{}).length,_this492}return _inherits(UpdateClientCtrl,Base),_createClass(UpdateClientCtrl,[{key:"onUpdate",value:function(){WavesApp.reload()}},{key:"onClose",value:function(){$mdDialog.hide()}}]),UpdateClientCtrl}())(this)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.utils").controller("UpdateClientCtrl",controller)}(),function(){var map=require("ramda").map,controller=function(Base,createPoll,waves,utils,user,baseAssetService){return new(function(){function AssetRateChart(){var _this493;return _classCallCheck(this,AssetRateChart),(_this493=_possibleConstructorReturn(this,_getPrototypeOf(AssetRateChart).call(this))).options={axisX:"timestamp",axisY:"rate",checkWidth:!0,view:{rate:{lineColor:"#3a4050",fillColor:"#2F3542",lineWidth:2}}},_this493.startFrom=null,_this493.assetId=null,_this493.chartToId=null,_this493.noUpdate=null,_this493._poll=null,_this493._setThemeSettings(),_this493}return _inherits(AssetRateChart,Base),_createClass(AssetRateChart,[{key:"$postLink",value:function(){this.observe("noUpdate",this._onChangeNoUpdate),this.observe(["assetId","chartToId","startFrom"],this._onChangeMainParams),this.observe("theme",this._setThemeSettings),this.syncSettings({theme:"theme"}),this.noUpdate?this._onChangeMainParams():this._poll=this._createPoll()}},{key:"_setThemeSettings",value:function(){var wAssetRateChart=user.getThemeSettings().wAssetRateChart;this.options.view.rate.fillColor=wAssetRateChart.seriesColor,this.options.view.rate.lineColor=wAssetRateChart.lineColor}},{key:"_onChangeNoUpdate",value:function(){var noUpdate=this.noUpdate;noUpdate&&!this._poll&&(this._poll=this._createPoll()),!noUpdate&&this._poll&&(this._poll.destroy(),this._poll=null)}},{key:"_onChangeMainParams",value:function(){var _this494=this;this._poll?this._poll.restart():this._getGraphData().then(function(values){_this494.chartData=values},function(){return null})}},{key:"_getGraphData",value:function(){var startDate=this.startFrom||utils.moment().add(-100,"days"),assetId=this.assetId,baseAssetId=this.chartToId||baseAssetService.getBaseAssetId();return assetId&&baseAssetId!==assetId?waves.utils.getRateHistory(assetId,baseAssetId,startDate).then(map(function(item){return _objectSpread({},item,{rate:Number(item.rate.toFixed())})})).then(function(rate){return{rate:rate}}):Promise.resolve(null)}},{key:"_createPoll",value:function(){return createPoll(this,this._getGraphData,"chartData",15e3)}}]),AssetRateChart}())};controller.$inject=["Base","createPoll","waves","utils","user","baseAssetService"],angular.module("app.ui").component("wAssetRateChart",{bindings:{startFrom:"<",assetId:"<",noUpdate:"<",chartToId:"<"},template:'<w-chart ng-if="$ctrl.chartData" data="$ctrl.chartData" options="$ctrl.options""></w-chart>',transclude:!1,controller:controller})}(),function(){var controller=function(Base,configService){var analytics=require("data-service").analytics;return new(function(){function ChangeLanguage(){var _this495;_classCallCheck(this,ChangeLanguage),(_this495=_possibleConstructorReturn(this,_getPrototypeOf(ChangeLanguage).call(this))).onChange=null;var LANGS=configService.get("SETTINGS.LANGS")||["en","ru"];if(_this495.list=Object.keys(WavesApp.localize).filter(function(lng){return LANGS.includes(lng)}).map(function(key){return{code:key,name:WavesApp.localize[key].name}}),i18next.language)_this495.active=i18next.language,_this495.prev=_this495.active,_this495.observe("active",_this495._onChangeLanguage);else{i18next.on("initialized",function handler(){_this495.active=i18next.language,_this495.prev=_this495.active,_this495.observe("active",_this495._onChangeLanguage),i18next.off("initialized",handler)})}return _this495}return _inherits(ChangeLanguage,Base),_createClass(ChangeLanguage,[{key:"_sendAnalytics",value:function(lng){analytics.user.changeLanguage(lng)}},{key:"_onChangeLanguage",value:function(){this._sendAnalytics(this.active),this.prev=this.active;var active=this.active;active&&(i18next.changeLanguage(active),this.onChange({language:active}))}}]),ChangeLanguage}())};controller.$inject=["Base","configService"],angular.module("app.ui").component("wChangeLanguage",{bindings:{onChange:"&"},templateUrl:"modules/ui/directives/changeLanguage/changeLanguage.html",transclude:!1,controller:controller})}(),function(){var analytics=require("data-service").analytics,controller=function(Base,user,$scope,angularUtils){return new(function(){function GetStartedLinkCtrl(){var _this496;return _classCallCheck(this,GetStartedLinkCtrl),(_this496=_possibleConstructorReturn(this,_getPrototypeOf(GetStartedLinkCtrl).call(this,$scope))).hasMultiAccount=void 0,_this496.hasCreate=void 0,_this496.hasImport=void 0,_this496.hovered=!1,_this496._init(),_this496}return _inherits(GetStartedLinkCtrl,Base),_createClass(GetStartedLinkCtrl,[{key:"addGtmEvent",value:function(event,params){analytics.addGtmEvent(event,params)}},{key:"importClick",value:function(){analytics.user.importAccountClick()}},{key:"_init",value:function(){var _this497=this;user.getMultiAccountData().then(function(data){_this497.hasMultiAccount=!!data,angularUtils.postDigest($scope).then(function(){$scope.$apply()})})}}]),GetStartedLinkCtrl}())};controller.$inject=["Base","user","$scope","utils"],angular.module("app.ui").component("wGetStartedLink",{templateUrl:"modules/ui/directives/getStartedLink/getStartedLink.html",bindings:{hasCreate:"<",hasImport:"<"},controller:controller})}(),function(){var controller=function(Base,$element,$scope,createPoll,utils,decorators){var _dec22,_class15,tsUtisl=require("ts-utils");return new(_dec22=decorators.async(),_applyDecoratedDescriptor((_class15=function(){function InputContainer(){var _this498;return _classCallCheck(this,InputContainer),(_this498=_possibleConstructorReturn(this,_getPrototypeOf(InputContainer).call(this))).form=null,_this498.tik=new tsUtisl.Signal,_this498}return _inherits(InputContainer,Base),_createClass(InputContainer,[{key:"$postLink",value:function(){var _this499=this,name=$element.closest("form").attr("name");if(this.form=name&&$scope.$parent.$eval(name),!this.form)throw new Error("Can't get form!");this.receive(utils.observe(this.form,"$valid"),this._runApply,this),createPoll(this,function(){return null},function(){_this499.tik.dispatch(_this499._getElements())},250)}},{key:"_getElements",value:function(){return $element.find("input,textarea").toArray()}},{key:"_runApply",value:function(){$scope.$apply()}}]),InputContainer}()).prototype,"_runApply",[_dec22],Object.getOwnPropertyDescriptor(_class15.prototype,"_runApply"),_class15.prototype),_class15)};controller.$inject=["Base","$element","$scope","createPoll","utils","decorators"],angular.module("app.ui").component("wInputContainer",{transclude:!0,template:"<ng-transclude></ng-transclude>",controller:controller})}(),function(){var controller=function(Base,$element){return new(function(){function ResponsiveMenu(){var _this500;return _classCallCheck(this,ResponsiveMenu),(_this500=_possibleConstructorReturn(this,_getPrototypeOf(ResponsiveMenu).call(this))).menuList=[],_this500}return _inherits(ResponsiveMenu,Base),_createClass(ResponsiveMenu,[{key:"registerItem",value:function(item){this.menuList.push(item)}},{key:"menuToggle",value:function(){$element.find(".navigation-menu").toggleClass("active"),$element.find(".navigation-menu-overlay").toggleClass("active")}},{key:"clickItem",value:function(){$element.find(".navigation-menu").removeClass("active")}},{key:"setActive",value:function(item){this.activeMenu=item.value,this.clickItem()}}]),ResponsiveMenu}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wResponsiveMenu",{templateUrl:"modules/ui/directives/responsiveMenu/responsiveMenu.html",bindings:{activeMenu:"="},transclude:!0,controller:controller})}(),function(){var factory=function(){var tsUtils=require("ts-utils");return new(function(){function STService(){_classCallCheck(this,STService),this._hash=Object.create(null),this.draw=new tsUtils.Signal,this.sort=new tsUtils.Signal}return _createClass(STService,[{key:"render",value:function(name){var _this501=this;Object.keys(this._hash).forEach(function(cid){name&&_this501._hash[cid].name!==name||_this501._hash[cid].render()})}},{key:"register",value:function(table){this._hash[table.cid]=table}},{key:"getTableByCid",value:function(cid){return this._hash[cid]}},{key:"unregister",value:function(table){delete this._hash[table.cid]}}]),STService}())};factory.$inject=[],angular.module("app.ui").factory("stService",factory)}(),function(){var tsUtils=require("ts-utils"),Money=require("@waves/data-entities").Money,controller=function(user){return new(function(){function Issue(){_classCallCheck(this,Issue),this.props=null}return _createClass(Issue,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"amount.asset")||tsUtils.get(this.props,"quantity.asset")||this.props),this.name=tsUtils.get(this.props,"amount.asset.name")||tsUtils.get(this.props,"quantity.asset.name");var amount=tsUtils.get(this.props,"amount")||tsUtils.get(this.props,"quantity");this.amount=amount instanceof Money?amount.toFormat():amount.div(Math.pow(10,this.props.precision))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Issue}())};controller.$inject=["user"],angular.module("app.ui").component("wIssue",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/issue/issue.html",controller:controller})}(),angular.module("app.ui").component("wLease",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/lease/lease.html"}),function(){var BigNumber=require("@waves/bignumber").BigNumber,factory=function(waves,$q,_outerBlockchains,utils,user){var _class16,fetchAliases=utils.cache({},waves.node.aliases.getByIdList,function(item){return item},3e4,function(item){return function(result){return result.find(function(res){return res&&res.alias===item})}}),ValidateService=(_applyDecoratedDescriptor((_class16=function(){function ValidateService(){_classCallCheck(this,ValidateService)}return _createClass(ValidateService,[{key:"gt",value:function(inputValue,validateValue){return inputValue.gt(validateValue)}},{key:"gte",value:function(inputValue,validateValue){return inputValue.gte(validateValue)}},{key:"lt",value:function(inputValue,validateValue){return inputValue.lt(validateValue)}},{key:"lte",value:function(inputValue,validateValue){return inputValue.lte(validateValue)}},{key:"length",value:function(inputValue,_length){return String(inputValue).length<=_length}},{key:"precision",value:function(inputValue,_precision){var _inputValue$toFixed$s2=_slicedToArray(inputValue.toFixed().split("."),2),dec=(_inputValue$toFixed$s2[0],_inputValue$toFixed$s2[1]);return!dec||_precision.gte(dec.length)}},{key:"byteLt",value:function(inputValue,bytes){return this.getByteFromString(inputValue)<Number(bytes)}},{key:"byteLte",value:function(inputValue,bytes){return this.getByteFromString(inputValue)<=Number(bytes)}},{key:"byteGt",value:function(inputValue,bytes){return this.getByteFromString(inputValue)>Number(bytes)}},{key:"byteGte",value:function(inputValue,bytes){return this.getByteFromString(inputValue)>=Number(bytes)}},{key:"integer",value:function(inputValue){return inputValue.round().eq(inputValue)}},{key:"anyAddress",value:function(address,assetId){return!!this.outerBlockchains(address,assetId)||this.wavesAddress(address)}},{key:"wavesAddress",value:function(address,value){return utils.whenAll([this.alias(address,value),this.address(address,value)]).then(function(_ref241){var _ref242=_slicedToArray(_ref241,2),_ref242$=_ref242[0],alias=void 0===_ref242$||_ref242$,_ref242$2=_ref242[1];return alias||(void 0===_ref242$2||_ref242$2)?$q.resolve():$q.reject()})}},{key:"wavesAddresses",value:function(addressList,value){var _this502=this,data=addressList.map(function(item,i){return{alias:item,address:item,index:i,isAddress:_this502.address(item,value),isValidAlis:_this502.isValidAlias(item)}}),aliases=data.filter(function(item){return!item.isAddress||item.isValidAlis});return fetchAliases(aliases.map(function(item){return item.alias})).then(function(result){return aliases.forEach(function(item,index){result[index]&&result[index].address?(item.address=result[index].address,item.isValidAlis=!0):item.isValidAlis=!1}),data.map(function(item){return _objectSpread({state:item.isValidAlis||item.isAddress},item)})})}},{key:"outerBlockchains",value:function(address,assetId){if(!address||!assetId)return!0;var outerChain=_outerBlockchains[assetId];return!!outerChain&&outerChain.isValidAddress(address)}},{key:"isValidAlias",value:function(alias){return waves.node.aliases.validate(alias||"")}},{key:"alias",value:function(address,argument_1){var value=1<arguments.length&&void 0!==argument_1?argument_1:void 0;return!address||!(address.length<WavesApp.minAliasLength)&&(!(address.length>WavesApp.maxAliasLength)&&(!!waves.node.aliases.validate(address)&&(value&&"no-self"===value?!waves.node.aliases.getAliasList().includes(address)&&waves.node.aliases.getAddress(address):waves.node.aliases.getAddress(address))))}},{key:"address",value:function(_address,argument_1){var value=1<arguments.length&&void 0!==argument_1?argument_1:"";return!_address||!(_address.length<=WavesApp.maxAliasLength)&&(!(_address.length>WavesApp.maxAddressLength)&&(!!waves.node.isValidAddress(_address)&&(!value||"no-self"!==value||_address!==user.address)))}},{key:"getByteFromString",value:function(str){return new Blob([str],{type:"text/plain"}).size}}],[{key:"toBigNumber",value:function(item){switch(_typeof(item)){case"string":case"number":try{return new BigNumber(item)}catch(e){return null}case"object":return item instanceof BigNumber?item:item instanceof ds.wavesDataEntities.Money?item.getTokens():null}}}]),ValidateService}()).prototype,"gt",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"gt"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"gte",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"gte"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"lt",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"lt"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"lte",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"lte"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"length",[notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"length"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"precision",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"precision"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"byteLt",[notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"byteLt"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"byteLte",[notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"byteLte"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"byteGt",[notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"byteGt"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"byteGte",[notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"byteGte"),_class16.prototype),_applyDecoratedDescriptor(_class16.prototype,"integer",[notNullArgs],Object.getOwnPropertyDescriptor(_class16.prototype,"integer"),_class16.prototype),_class16);function notNullArgs(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _len26=arguments.length,args=new Array(_len26),_key26=0;_key26<_len26;_key26++)args[_key26]=arguments[_key26];return!!args.some(function(value){return null==value||""===value})||origin.call.apply(origin,[this].concat(args))}}function toBigNumberArgs(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _len27=arguments.length,args=new Array(_len27),_key27=0;_key27<_len27;_key27++)args[_key27]=arguments[_key27];return origin.call.apply(origin,[this].concat(_toConsumableArray(args.map(ValidateService.toBigNumber))))}}return utils.bind(new ValidateService)};factory.$inject=["waves","$q","outerBlockchains","utils","user"],angular.module("app.utils").factory("validateService",factory)}(),function(){var factory=function(configService,baseAssetService){var getGatewayConfig=function(){return configService.get("gateways.".concat("coinomat"))},getGateways=function(){var _getGatewayConfig$car=getGatewayConfig().card;return(void 0===_getGatewayConfig$car?[]:_getGatewayConfig$car).reduce(function(acc,item){return acc[baseAssetService.getIdByTicker(item)]=item,acc},{})},getPath=function(){return"".concat(getGatewayConfig().url,"/api/v2/indacoin")};return new(function(){function CoinomatCardService(){_classCallCheck(this,CoinomatCardService)}return _createClass(CoinomatCardService,[{key:"getAll",value:function(){return getGateways()}},{key:"getFiatWithLimits",value:function(crypto,wavesAddress,fiatList){var _this503=this;CoinomatCardService._assertAsset(crypto||crypto.id);var to=getGateways()[crypto.id];return Promise.all(fiatList.map(function(fiat){return _this503._loadBuyLimits(to,fiat.fiatCode,wavesAddress).then(function(limits){return _objectSpread({},fiat,{},limits)})}))}},{key:"getApproximateCryptoAmount",value:function(crypto,fiat,wavesAddress,fiatAmount){return CoinomatCardService._assertAsset(crypto.id||crypto),$.get("".concat(getPath(),"/rate.php"),{crypto:getGateways()[crypto.id],fiat:fiat,address:wavesAddress,amount:fiatAmount})}},{key:"getCardBuyLink",value:function(crypto,fiat,wavesAddress,fiatAmount){CoinomatCardService._assertAsset(crypto.id||crypto);var to=getGateways()[crypto.id];return"".concat(getPath(),"/buy.php?crypto=").concat(to,"&fiat=").concat(fiat,"&address=").concat(wavesAddress,"&amount=").concat(fiatAmount)}},{key:"getSupportMap",value:function(asset){if(getGateways()[asset.id])return{card:!0}}},{key:"getAssetKeyName",value:function(asset){return"".concat("coinomat").concat(getGateways()[asset.id].gateway)}},{key:"_loadBuyLimits",value:function(to,from,recipientAddress){return $.get("".concat(getPath(),"/limits.php"),{crypto:to,fiat:from,address:recipientAddress}).then(function(res){try{return JSON.parse(res)}catch(e){return{}}})}}],[{key:"_assertAsset",value:function(assetId){if(!getGateways()[assetId])throw new Error("Asset is not supported by Coinomat")}}]),CoinomatCardService}())};factory.$inject=["configService","baseAssetService"],angular.module("app.utils").factory("coinomatCardService",factory)}(),function(){var KNOWLEDGE_BASE="".concat(WavesApp.network.support,"/forums/2-knowledge-base/topics"),SEPA_COUNTRIES_URL="".concat(KNOWLEDGE_BASE,"/1304-list-of-accepted-countries-and-documents-for-verification"),factory=function(configService,baseAssetService){var getGateways=function(){var _getGatewayConfig2$se=configService.get("gateways.coinomat").sepa;return(void 0===_getGatewayConfig2$se?[]:_getGatewayConfig2$se).reduce(function(acc,item){return acc[baseAssetService.getIdByTicker(item)]=item,acc},{})};return new(function(){function CoinomatSepaService(){_classCallCheck(this,CoinomatSepaService)}return _createClass(CoinomatSepaService,[{key:"getAll",value:function(){return getGateways()}},{key:"getSepaDetails",value:function(asset,wavesAddress){return CoinomatSepaService._assertAsset(asset.id),Promise.resolve({listOfEligibleCountries:SEPA_COUNTRIES_URL,idNowSiteUrl:"https://idnow.eu",idNowUserLink:"".concat("https://go.idnow.de/coinomat/userdata","/").concat(wavesAddress)})}},{key:"getSupportMap",value:function(asset){if(getGateways()[asset.id])return{sepa:!0}}},{key:"getAssetKeyName",value:function(asset){return"".concat("coinomatSepa").concat(getGateways()[asset.id])}}],[{key:"_assertAsset",value:function(assetId){if(!getGateways()[assetId])throw new Error("Asset is not supported by Coinomat SEPA")}}]),CoinomatSepaService}())};factory.$inject=["configService","baseAssetService"],angular.module("app.utils").factory("coinomatSepaService",factory)}(),angular.module("app.utils").factory("storageDataConverter",function(){var tsUtils=require("ts-utils");return{stringify:function(data){switch(_typeof(data)){case"string":return data;case"object":try{return function(data){try{var paths=tsUtils.getPaths(data);return JSON.stringify(paths.reduce(function(result,item){return result[String(item)]=tsUtils.get(data,item),result},Object.create(null)))}catch(e){return JSON.stringify(data)}}(data)}catch(e){return String(data)}default:return String(data)}},parse:function(data){if("object"!==_typeof(data))return data;var result=null;return tsUtils.each(data,function(value,path){result=result||tsUtils.Path.parse(path).getItemData(0).container,tsUtils.set(result,path,value)}),result}}}),angular.module("app").component("wComponentError",{templateUrl:"modules/app/directives/componentError/componentError.html"}),function(){var factory=function(user,utils,aliases,decorators,BaseNodeComponent,matcher){var _dec23,_dec24,_class17,R=require("ramda"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),Money=require("@waves/data-entities").Money,TYPES=WavesApp.TRANSACTION_TYPES.EXTENDED,Transactions=(_dec23=decorators.cachable(120),_dec24=decorators.cachable(1),_applyDecoratedDescriptor((_class17=function(){function Transactions(){var _this504;return _classCallCheck(this,Transactions),(_this504=_possibleConstructorReturn(this,_getPrototypeOf(Transactions).call(this))).TYPES=TYPES,_this504}return _inherits(Transactions,BaseNodeComponent),_createClass(Transactions,[{key:"get",value:function(id){return ds.api.transactions.get(id).then(this._pipeTransaction())}},{key:"getUtx",value:function(id){return ds.api.transactions.getUTX(id).then(this._pipeTransaction())}},{key:"getAlways",value:function(id){var _this505=this;return this.get(id).catch(function(){return _this505.getUtx(id)}).catch(function(){return _this505.get(id)})}},{key:"list",value:function(argument_0,argument_1){var limit=0<arguments.length&&void 0!==argument_0?argument_0:1e3,after=1<arguments.length?argument_1:void 0;return this._list(limit,after,user.address)}},{key:"getActiveLeasingTx",value:function(){return this._getActiveLeasingTx(user.address)}},{key:"listUtx",value:function(){var _this506=this;return ds.api.transactions.listUTX(user.address).then(function(list){return list.map(_this506._pipeTransaction())})}},{key:"listAlways",value:function(){return utils.whenAll([this.listUtx(),this.list()]).then(function(_ref243){var _ref244=_slicedToArray(_ref243,2),utxTxList=_ref244[0],txList=_ref244[1];return utxTxList.concat(txList)})}},{key:"getExchangeTxList",value:function(prams,options){return ds.api.transactions.getExchangeTxList(_objectSpread({matcher:matcher.currentMatcherAddress},prams),options)}},{key:"createTransaction",value:function(txData){var tx=ds.utils.normalizeTxTimestamp(_objectSpread({sender:user.address,timestamp:Date.now()},txData));return tx.type===SIGN_TYPE.MASS_TRANSFER&&(tx.totalAmount=tx.totalAmount||tx.transfers.map(function(_ref245){return _ref245.amount}).reduce(function(result,item){return result.add(item)}),tx.assetId=tx.totalAmount&&tx.totalAmount.asset.id),tx.fee||(tx.fee=Money.fromCoins(0,ds.api.assets.wavesAsset)),this._pipeTransaction(!1)(tx)}},{key:"_getActiveLeasingTx",value:function(address){var _this507=this;return ds.fetch("".concat(this.node,"/leasing/active/").concat(address)).then(R.uniqBy(R.prop("id"))).then(R.map(function(item){return _objectSpread({},item,{status:"active"})})).then(function(list){return ds.api.transactions.parseTx(list,!1)}).then(function(list){return list.map(_this507._pipeTransaction())})}},{key:"_list",value:function(limit,after,address){var _this508=this;return ds.api.transactions.list(address,limit,after).then(function(list){return list.map(_this508._pipeTransaction())})}},{key:"_pipeTransaction",value:function(){return function(tx){return ds.utils.transactions.remapTransaction(user)(tx)}}}],[{key:"_getTypeByName",value:function(txTypeName){switch(txTypeName){case WavesApp.TRANSACTION_TYPES.NODE.TRANSFER:return 4;case WavesApp.TRANSACTION_TYPES.NODE.MASS_TRANSFER:return 11;case WavesApp.TRANSACTION_TYPES.NODE.LEASE:return 8;case WavesApp.TRANSACTION_TYPES.NODE.CANCEL_LEASING:return 9;case WavesApp.TRANSACTION_TYPES.NODE.ISSUE:return 3;case WavesApp.TRANSACTION_TYPES.NODE.REISSUE:return 5;case WavesApp.TRANSACTION_TYPES.NODE.BURN:return 6;case WavesApp.TRANSACTION_TYPES.NODE.CREATE_ALIAS:return 10;case WavesApp.TRANSACTION_TYPES.NODE.DATA:return 12;case WavesApp.TRANSACTION_TYPES.NODE.SET_SCRIPT:return 13;case WavesApp.TRANSACTION_TYPES.NODE.SPONSORSHIP:return 14;case WavesApp.TRANSACTION_TYPES.NODE.SCRIPT_INVOCATION:return 16;default:throw new Error("Wrong tx name!")}}},{key:"_getTemplateType",value:function(_ref246){var typeName=_ref246.typeName;return ds.utils.transactions.getTemplateType({typeName:typeName})}},{key:"_getTransactionAddress",value:function(_ref247){var typeName=_ref247.typeName,sender=_ref247.sender,recipient=_ref247.recipient;return ds.utils.transactions.getTransactionAddress({typeName:typeName,sender:sender,recipient:recipient})}}]),Transactions}()).prototype,"_getActiveLeasingTx",[_dec23],Object.getOwnPropertyDescriptor(_class17.prototype,"_getActiveLeasingTx"),_class17.prototype),_applyDecoratedDescriptor(_class17.prototype,"_list",[_dec24],Object.getOwnPropertyDescriptor(_class17.prototype,"_list"),_class17.prototype),_class17);return utils.bind(new Transactions)};factory.$inject=["user","utils","aliases","decorators","BaseNodeComponent","matcher"],angular.module("app").factory("transactions",factory)}(),function(){var DISABLED_FEATURES=["header_screenshot","header_symbol_search","symbol_search_hot_key","display_market_status","control_bar","timeframes_toolbar","volume_force_overlay","header_compare"],MOBILE_DISABLED_FEATURES=[].concat(DISABLED_FEATURES,["left_toolbar"]);function getOverrides(candleUpColor,candleDownColor){return{"mainSeriesProperties.candleStyle.upColor":candleUpColor,"mainSeriesProperties.candleStyle.downColor":candleDownColor,"mainSeriesProperties.candleStyle.drawBorder":!1,"mainSeriesProperties.hollowCandleStyle.upColor":candleUpColor,"mainSeriesProperties.hollowCandleStyle.downColor":candleDownColor,"mainSeriesProperties.hollowCandleStyle.drawBorder":!1,"mainSeriesProperties.barStyle.upColor":candleUpColor,"mainSeriesProperties.barStyle.downColor":candleDownColor,"mainSeriesProperties.haStyle.upColor":candleUpColor,"mainSeriesProperties.haStyle.downColor":candleDownColor,"mainSeriesProperties.haStyle.drawBorder":!1,"mainSeriesProperties.lineStyle.color":candleUpColor,"mainSeriesProperties.areaStyle.color1":candleUpColor,"mainSeriesProperties.areaStyle.color2":candleUpColor,"mainSeriesProperties.areaStyle.linecolor":candleUpColor,volumePaneSize:"medium"}}function getStudiesOverrides(_ref248){return{"volume.volume.color.0":_ref248.volume0,"volume.volume.color.1":_ref248.volume1}}var counter=0,controller=function(Base,candlesService,$scope,themes,user,utils){return new(function(){function DexCandleChart(){var _this509;return _classCallCheck(this,DexCandleChart),(_this509=_possibleConstructorReturn(this,_getPrototypeOf(DexCandleChart).call(this))).layout="",_this509.elementId="tradingview".concat(counter++),_this509.notLoaded=!1,_this509._chart=null,_this509._chartReady=!1,_this509._assetIdPairWasChanged=!1,_this509._changeTheme=!0,_this509._assetIdPair=null,_this509.loadingTradingView=!0,_this509.theme=user.getSetting("theme"),_this509.candle=user.getSetting("candle"),_this509.observe("_assetIdPair",_this509._onChangeAssetPair),_this509.observe("theme",function(){_this509._changeTheme=!0,_this509._resetTradingView()}),_this509.observe("candle",_this509._refreshTradingView),_this509.syncSettings({_assetIdPair:"dex.assetIdPair"}),_this509.syncSettings({theme:"theme"}),_this509.syncSettings({candle:"candle"}),_this509}return _inherits(DexCandleChart,Base),_createClass(DexCandleChart,[{key:"$postLink",value:function(){var _this510=this;Promise.resolve().then(function(){_this510._createTradingView(),_this510.listenEventEmitter(i18next,"languageChanged",_this510._changeLangHandler.bind(_this510)),$scope.$apply()})}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(DexCandleChart.prototype),"$onDestroy",this).call(this),this._removeTradingView()}},{key:"_onChangeAssetPair",value:function(){this._chartReady?this._setChartPair():this._assetIdPairWasChanged=!0}},{key:"_resetTradingView",value:function(){try{return this._removeTradingView()._createTradingView()}catch(e){}}},{key:"_removeTradingView",value:function(){candlesService.unsubscribeBars();try{this._chart&&this._chart.remove()}catch(e){}return this._chart=null,this}},{key:"_refreshTradingView",value:function(){if(!this._chart)return null;var _themes$getCurrentCan=themes.getCurrentCandleSColor(this.candle),up=_themes$getCurrentCan.up,down=_themes$getCurrentCan.down,volume0=_themes$getCurrentCan.volume0,volume1=_themes$getCurrentCan.volume1,overrides=getOverrides(up,down),studiesOverrides=getStudiesOverrides({volume0:volume0,volume1:volume1});this._chart.applyOverrides(overrides),this._chart.applyStudiesOverrides(studiesOverrides)}},{key:"_createTradingView",value:function(){var _this511=this;this.loadingTradingView=!0;var _themes$getCurrentCan2=themes.getCurrentCandleSColor(this.candle),up=_themes$getCurrentCan2.up,down=_themes$getCurrentCan2.down,volume0=_themes$getCurrentCan2.volume0,volume1=_themes$getCurrentCan2.volume1,themeConf=themes.getTradingViewConfig(this.theme),overrides=_objectSpread({},getOverrides(up,down),{},themeConf.OVERRIDES),studies_overrides=_objectSpread({},getStudiesOverrides({volume0:volume0,volume1:volume1}),{},themeConf.STUDIES_OVERRIDES),toolbar_bg=themeConf.toolbarBg,custom_css_url=themeConf.customCssUrl,disabled_features="mobile"===this.layout?MOBILE_DISABLED_FEATURES:DISABLED_FEATURES;return this._chart=new TradingView.widget({locale:DexCandleChart._remapLanguageCode(i18next.language),symbol:"".concat(this._assetIdPair.amount,"/").concat(this._assetIdPair.price),interval:user.getSetting("lastInterval"),container_id:this.elementId,datafeed:candlesService,library_path:"".concat(location.origin,"/tradingview/"),autosize:!0,toolbar_bg:toolbar_bg,disabled_features:disabled_features,overrides:overrides,studies_overrides:studies_overrides,custom_css_url:custom_css_url,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),this._chart.onChartReady(function(){_this511._changeTheme&&(_this511._chart.applyOverrides(overrides),_this511._chart.applyStudiesOverrides(studies_overrides)),_this511._changeTheme=!1,_this511.loadingTradingView=!1,_this511._assetIdPairWasChanged&&(_this511._setChartPair(),_this511._assetIdPairWasChanged=!1,_this511._chartReady=!0),_this511._chart.subscribe("onIntervalChange",function(e){user.setSetting("lastInterval",e)}),utils.safeDigest($scope)}),this._chart._options.datafeed.onLoadError=function(){_this511.notLoaded=!0,utils.wait(5e3).then(function(){_this511._resetTradingView()})},this}},{key:"_setChartPair",value:function(){var interval=this._chart.symbolInterval().interval,_this$_assetIdPair=this._assetIdPair,amount=_this$_assetIdPair.amount,price=_this$_assetIdPair.price;this._chart.setSymbol("".concat(amount,"/").concat(price),interval)}},{key:"_changeLangHandler",value:function(){return this._resetTradingView()}}],[{key:"_remapLanguageCode",value:function(code){switch(code){case"hi_IN":case"id":return"en";case"zh_CN":return"zh";case"pt_BR":return"pt";default:return code}}}]),DexCandleChart}())};controller.$inject=["Base","candlesService","$scope","themes","user","utils"],angular.module("app.dex").component("wDexCandleChart",{bindings:{layout:"@layoutType"},templateUrl:"modules/dex/directives/dexCandleChart/dex-candle-chart.html",transclude:!1,controller:controller})}(),angular.module("app.dex").component("wDexLayoutSideBarToggle",{bindings:{handleClick:"&",side:"@"},templateUrl:"modules/dex/directives/layout/DexLayoutSideBarToggle.html",controller:function(){return new(function(){function Controller(){_classCallCheck(this,Controller),this.handleClick=angular.noop,this.isHovered=!1}return _createClass(Controller,[{key:"setHovered",value:function(){this.isHovered=!0}},{key:"setNotHovered",value:function(){this.isHovered=!1}}]),Controller}())}}),angular.module("app.ui").factory("RatingStarsFactory",function(){var range=require("ramda").range,tsUtils=require("ts-utils");return function(){function RatingStarsFactory(_ref249){var $container=_ref249.$container,rating=_ref249.rating,_ref249$size=_ref249.size,size=void 0===_ref249$size?"m":_ref249$size,_ref249$canRate=_ref249.canRate,canRate=void 0!==_ref249$canRate&&_ref249$canRate,hasBalance=_ref249.hasBalance;_classCallCheck(this,RatingStarsFactory),this.starsStringList=[],this.rating=rating,this.canRate=canRate,this.$container=$container,this.hasBalance=hasBalance,this.size=size,this.update(this.rating),this.canRate&&this._initHandlers(this.hasBalance),this.voteSignal=new tsUtils.Signal}return _createClass(RatingStarsFactory,[{key:"update",value:function(rating){var _this512=this,filledAmount=Math.round(rating);this.starsStringList=range(0,5).map(function(index){return{$star:_this512.getStar(index,filledAmount)}}),this._render(this.$container)}},{key:"updateStatus",value:function(status){this.hasBalance=status,this._initHandlers(this.hasBalance)}},{key:"_initHandlers",value:function(hasBalance){var _this513=this;this.starsList.forEach(function(starObj){hasBalance?starObj.$star.on("click",function(){_this513.voteSignal.dispatch(starObj.weight)}):starObj.$star.off()})}},{key:"_render",value:function($container){this.template='\n                <div class="rating-stars '.concat(this.size," ").concat(this.canRate?"can-rate":"",'">\n                    ').concat(this.starsStringList.map(function(obj){return obj.$star}).join(""),"\n                </div>"),$container.html(this.template),this.starsList=this.$container.find(".rating-stars__star").toArray().map(function(star,i){return{$star:$(star),weight:i+1}}),this._initHandlers(this.hasBalance)}},{key:"getStar",value:function(index,filledAmount){return'<div class="rating-stars__star '.concat(index+1<=filledAmount?"filled":"",'"></div>')}},{key:"vote",get:function(){return this.voteSignal}}]),RatingStarsFactory}()}),function(){var controller=function(Base,utils,$scope,$filter){return new(function(){function TransactionInfoRow(){return _classCallCheck(this,TransactionInfoRow),_possibleConstructorReturn(this,_getPrototypeOf(TransactionInfoRow).apply(this,arguments))}return _inherits(TransactionInfoRow,Base),_createClass(TransactionInfoRow,[{key:"$postLink",value:function(){var _this514=this;this.type=this.transaction.type,this.props=_objectSpread({},this.transaction,{time:$filter("date")(this.transaction.timestamp,this.datePattern||"HH:mm"),isScam:this.isScam}),this.observe("isScam",function(){_this514.props.isScam=_this514.isScam,utils.safeApply($scope)})}}]),TransactionInfoRow}())};controller.$inject=["Base","utils","$scope","$filter"],angular.module("app.ui").component("wTransactionInfoRow",{bindings:{transaction:"<",datePattern:"<",isScam:"<"},templateUrl:"modules/ui/directives/transaction/transaction-info-row.html",controller:controller})}(),function(){var controller=function(Base,$scope,$mdDialog){return new(function(){function ConfirmInvokeCtrl(_ref250){var _this515,locals=_ref250.locals;return _classCallCheck(this,ConfirmInvokeCtrl),(_this515=_possibleConstructorReturn(this,_getPrototypeOf(ConfirmInvokeCtrl).call(this,$scope))).type=locals.orderType,_this515}return _inherits(ConfirmInvokeCtrl,Base),_createClass(ConfirmInvokeCtrl,[{key:"agree",value:function(){$mdDialog.hide()}},{key:"close",value:function(){$mdDialog.cancel()}}]),ConfirmInvokeCtrl}())(this)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.ui").controller("ConfirmInvokeCtrl",controller)}(),function(){var $=require("jquery"),controller=function(Base,$scope,$mdDialog){return new(function(){function LoginByDeviceCtrl(callback){var _this516;_classCallCheck(this,LoginByDeviceCtrl),(_this516=_possibleConstructorReturn(this,_getPrototypeOf(LoginByDeviceCtrl).call(this,$scope))).deferred=$.Deferred(),_this516.loading=!0,_this516.isLedger=!1,_this516.isKeeper=!1;var _callback=callback(),promise=_callback.promise,type=_callback.type;return _this516.isLedger="ledger"===type,_this516.isKeeper="wavesKeeper"===type,_this516.deferred.promise().then(function(){return _this516.onLoad()}).catch(function(error){return _this516.onError(error)}),promise.then(_this516.deferred.resolve,_this516.deferred.reject),_this516}return _inherits(LoginByDeviceCtrl,Base),_createClass(LoginByDeviceCtrl,[{key:"onClose",value:function(){this.deferred.reject()}},{key:"onLoad",value:function(){$mdDialog.hide(),$scope.$destroy()}},{key:"onError",value:function(e){$mdDialog.cancel(e),$scope.$destroy()}}]),LoginByDeviceCtrl}())(this.locals)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.utils").controller("LoginByDeviceCtrl",controller)}(),function(){var controller=function(Base,storage){return new(function(){function MigrationFailed(){var _getPrototypeOf13,_this517;_classCallCheck(this,MigrationFailed);for(var _len28=arguments.length,args=new Array(_len28),_key28=0;_key28<_len28;_key28++)args[_key28]=arguments[_key28];return(_this517=_possibleConstructorReturn(this,(_getPrototypeOf13=_getPrototypeOf(MigrationFailed)).call.apply(_getPrototypeOf13,[this].concat(args)))).doNotShowAgain=!1,_this517}return _inherits(MigrationFailed,Base),_createClass(MigrationFailed,[{key:"submit",value:function(){this.doNotShowAgain&&storage.save("migrationStatus","")}}]),MigrationFailed}())};controller.$inject=["Base","storage"],angular.module("app.utils").controller("MigrationFailed",controller)}(),function(){var analytics=require("data-service").analytics,controller=function(Base,$scope,seedService,user){return new(function(){function SeedBackupModalsCtrl(seed){var _this518;return _classCallCheck(this,SeedBackupModalsCtrl),(_this518=_possibleConstructorReturn(this,_getPrototypeOf(SeedBackupModalsCtrl).call(this,$scope))).titleLiteral="",_this518.step=0,_this518.seed=seed,_this518.seedConfirmWasFilled=!1,_this518.seedIsValid=!1,_this518.observe("step",_this518._onChangeStep),_this518}return _inherits(SeedBackupModalsCtrl,Base),_createClass(SeedBackupModalsCtrl,[{key:"onSeedConfirmFulfilled",value:function(isValid){this.seedIsValid=isValid,this.seedConfirmWasFilled=!0}},{key:"seedOnTouch",value:function(){this.seedConfirmWasFilled=!1}},{key:"clear",value:function(){this.seedIsValid=!1,this.seedConfirmWasFilled=!1,seedService.clear.dispatch()}},{key:"_onChangeStep",value:function(){this.seedIsValid=!1,this.seedConfirmWasFilled=!1,this.titleLiteral="title_".concat(this.step),1===this.step&&(user.setSetting("hasBackup",!0),analytics.send({name:"Create Save Phrase Success Show",target:"ui"}))}}]),SeedBackupModalsCtrl}())(this.seed)};controller.$inject=["Base","$scope","seedService","user"],angular.module("app.utils").controller("SeedBackupModalsCtrl",controller)}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function(Base,$scope,$state,user){return new(function(){function SignDeviceErrorCtrl(_ref251){var _this519,locals=_ref251.locals;return _classCallCheck(this,SignDeviceErrorCtrl),(_this519=_possibleConstructorReturn(this,_getPrototypeOf(SignDeviceErrorCtrl).call(this,$scope))).mode=locals.error,_this519.userType=locals.userType,_this519.userAddress=locals.address,_this519.isLedger="ledger"===_this519.userType,_this519.isKeeper="wavesKeeper"===_this519.userType,_this519.isPrivateKey="privateKey"===_this519.userType,_this519.loading=!0,_this519.signableType=locals.signableType,_this519}return _inherits(SignDeviceErrorCtrl,Base),_createClass(SignDeviceErrorCtrl,[{key:"onClose",value:function(){var isDevice=this.isLedger||this.isKeeper,isSignError="sign-error"===this.mode||"sign-user-error"===this.mode,isMatcherOrders=this.signableType===SIGN_TYPE.MATCHER_ORDERS;isSignError&&isDevice&&isMatcherOrders&&"chooseUser"!==$state.$current.name&&user.logout("chooseUser",!0)}}]),SignDeviceErrorCtrl}())(this)};controller.$inject=["Base","$scope","$state","user"],angular.module("app.ui").controller("SignDeviceError",controller)}(),function(){var ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber,factory=function(configService,baseAssetService,user){var getGatewayConfig=function(){return configService.get("gateways.".concat("wavesExchangeGateway"))},getGatewaysAssetIdHash=function(){var _getGatewayConfig3=getGatewayConfig(),_getGatewayConfig3$de=_getGatewayConfig3.deposit,deposit=void 0===_getGatewayConfig3$de?[]:_getGatewayConfig3$de,_getGatewayConfig3$wi=_getGatewayConfig3.withdraw,withdraw=void 0===_getGatewayConfig3$wi?[]:_getGatewayConfig3$wi;return[].concat(_toConsumableArray(deposit),_toConsumableArray(withdraw)).reduce(function(acc,item){return acc[baseAssetService.getIdByTicker(item)]={deposit:deposit.includes(item),withdraw:withdraw.includes(item),gateway:item,errorAddressMessage:!0,wrongAddressMessage:!0},acc},{})};return new(function(){function WavesExchangeService(){_classCallCheck(this,WavesExchangeService),this.authToken={access_token:null,requested_expiration:-1},this.config=getGatewayConfig()}return _createClass(WavesExchangeService,[{key:"getAll",value:function(){return getGatewaysAssetIdHash()}},{key:"getSupportMap",value:function(asset){return getGatewaysAssetIdHash()[asset.id]}},{key:"getAddressErrorMessage",value:function(address){return"can't withdraw to address ".concat(address)}},{key:"getWrongAddressMessage",value:function(address){return"wrong address ".concat(address)}},{key:"getDepositDetails",value:function(asset,address){var _this$_getRewriteData=this._getRewriteData(asset,"deposit"),assetId=_this$_getRewriteData.assetId,customFee=_this$_getRewriteData.customFee;return ds.protoApi.getWavesAssetBindings({direction:"DEPOSIT",includesWavesAsset:assetId}).then(function(_ref252){var assetBindings=_ref252.assetBindings,binding=_slicedToArray(assetBindings,1)[0];return 1<assetBindings.length&&(binding=assetBindings.find(function(item){return item.senderAsset.ticker.includes(assetId)&&!item.senderAsset.asset.includes("AC_")})),ds.protoApi.getOrCreateDepositTransferBinding({asset:binding.senderAsset.asset,recipientAddress:address})}).then(function(_ref253){var transferBinding=_ref253.transferBinding,_transferBinding$asse=transferBinding.assetBinding,senderAmountMin=_transferBinding$asse.senderAmountMin,senderAmountMax=_transferBinding$asse.senderAmountMax;return _objectSpread({address:transferBinding.addresses,minimumAmount:senderAmountMin,maximumAmount:senderAmountMax},transferBinding.assetBinding,{gatewayFee:customFee||transferBinding.assetBinding.taxFlat})})}},{key:"getWithdrawDetails",value:function(asset,address){var _this$_getRewriteData2=this._getRewriteData(asset,"withdraw"),assetId=_this$_getRewriteData2.assetId,customFee=_this$_getRewriteData2.customFee;return ds.protoApi.getWavesAssetBindings({direction:"WITHDRAWAL",includesWavesAsset:assetId}).then(function(_ref254){var assetBindings=_ref254.assetBindings,binding=_slicedToArray(assetBindings,1)[0];return 1<assetBindings.length&&(binding=assetBindings.find(function(item){return item.recipientAsset.ticker.includes(assetId)})),ds.protoApi.getOrCreateWithdrawTransferBinding({asset:binding.recipientAsset.asset,recipientAddress:address})}).then(function(_ref255){var transferBinding=_ref255.transferBinding;return _objectSpread({address:transferBinding.addresses[0]},transferBinding.assetBinding)}).then(function(data){return{address:data.address,attachment:"",exchangeRate:1,minimumAmount:data.senderAmountMin,maximumAmount:data.senderAmountMax,gatewayFee:customFee||data.taxFlat}})}},{key:"getAssetKeyName",value:function(asset){return"wavesGateway".concat(getGatewaysAssetIdHash()[asset.id].gateway)}},{key:"checkIsIgnoredWithdrawMax",value:function(asset){return!!(getGatewayConfig().ignoreWithdrawMax||[]).find(function(id){return asset.id===id||asset.ticker===id})}},{key:"isAddressInUseError",value:function(errors){return Array.isArray(errors)&&errors.find(function(error){return 420011===error.code})}},{key:"isAddressNotExistError",value:function(errors){return!!Array.isArray(errors)&&errors.find(function(error){return!(420012!==error.code||error.details&&error.details.subcode&&error.details.subcode.long)})}},{key:"isSmartAddressError",value:function(errors){return!!Array.isArray(errors)&&errors.find(function(error){return 420012===error.code&&error.details&&error.details.subcode&&error.details.subcode.long&&error.details.subcode.long.eq(1)})}},{key:"_fetchAuthToken",value:function(){return fetch("".concat(this.config.url).concat(this.config.oauthHandle),{method:"POST",headers:{Authorization:"Basic ".concat(btoa("test-client:secret")),"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:"grant_type=password&username=".concat(user.publicKey,"&password=").concat(user.matcherSign.timestamp,":").concat(user.matcherSign.signature,"&scope=client")}).then(function(response){return response.json()}).then(function(token){if(token&&token.access_token&&token.requested_expiration)return token;throw new Error("Invalid gateway auth token")})}},{key:"_useAuthToken",value:function(){var _this520=this,_this$authToken=this.authToken,access_token=_this$authToken.access_token,requested_expiration=_this$authToken.requested_expiration;return access_token&&requested_expiration>Date.now()?Promise.resolve(access_token):this._fetchAuthToken().then(function(authToken){return(_this520.authToken=authToken).access_token}).catch(function(){throw new Error("Gateway auth error")})}},{key:"_getOrCreateBinding",value:function(senderAsset,recipientAsset,recipientAddress){var _this521=this;return this._useAuthToken().then(function(token){return fetch("".concat(_this521.config.url).concat(_this521.config.bindingHandle),{method:"POST",headers:{Authorization:"Bearer ".concat(token),Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({sender_asset:senderAsset,recipient_asset:recipientAsset,recipient_address:recipientAddress})})}).then(function(resp){return resp.text()}).then(function(dataString){try{return JSON.parse(dataString)}catch(e){throw new Error(dataString)}}).catch(function(error){if(_this521._isAddressError(error.message))throw new Error(_this521.getAddressErrorMessage(recipientAddress));if(_this521._isWrongAddress(error.message))throw new Error(_this521.getWrongAddressMessage(recipientAddress));throw error})}},{key:"_isAddressError",value:function(argument_0){var msg=0<arguments.length&&void 0!==argument_0?argument_0:"";return msg.includes("address are not supported")||msg.includes("address already exists")}},{key:"_isWrongAddress",value:function(argument_0){var msg=0<arguments.length&&void 0!==argument_0?argument_0:"";return msg.includes("checksum failed")||msg.includes("address is not valid")}},{key:"_getRewriteData",value:function(asset,type){var _this$config=this.config,_this$config$cryptoFe=_this$config.cryptoFees,cryptoFees=void 0===_this$config$cryptoFe?{}:_this$config$cryptoFe,_this$config$cryptoNa=_this$config.cryptoNames,cryptoNames=void 0===_this$config$cryptoNa?{}:_this$config$cryptoNa,cryptoFee=cryptoFees[type]||{},customFee=cryptoFee[asset.ticker]||cryptoFee[asset.name]||cryptoFee[asset.id],assetId=cryptoNames[asset.ticker]?cryptoNames[asset.ticker]:asset.id;return{customFee:customFee?new BigNumber(customFee):null,assetId:assetId}}}]),WavesExchangeService}())};factory.$inject=["configService","baseAssetService","user"],angular.module("app.utils").factory("wavesExchangeGatewayService",factory)}(),angular.module("app.wallet.assets").controller("AssetsCtrl",function(){}),function(){var controller=function(Base,utils,createPoll,$scope,baseAssetService){return new(function(){function Asset(){var _this522;return _classCallCheck(this,Asset),(_this522=_possibleConstructorReturn(this,_getPrototypeOf(Asset).call(this,$scope))).balance=null,_this522.rating=null,_this522.isLira=!1,_this522}return _inherits(Asset,Base),_createClass(Asset,[{key:"$postLink",value:function(){var _utils$getDataFromOra6=utils.getDataFromOracles(this.balance.asset.id),isVerified=_utils$getDataFromOra6.isVerified,isGateway=_utils$getDataFromOra6.isGateway,isTokenomica=_utils$getDataFromOra6.isTokenomica,isStable=_utils$getDataFromOra6.isStable;this.isVerified=isVerified,this.isStable=isStable,this.isGateway=isGateway,this.isTokenomica=isTokenomica,this.isLira=this.balance.asset.id===baseAssetService.getDefaultAssetsHashId().TRY,this.isGateway||createPoll(this,this._getTokenRating,this._setTokenRating,6e4)}},{key:"isUnpinned",value:function(){return!["WAVES"].includes(this.balance.asset.id)}},{key:"_getTokenRating",value:function(){return ds.api.rating.getAssetsRating(this.balance.asset.id).then(function(assetList){return assetList}).catch(function(){return null})}},{key:"_setTokenRating",value:function(assetList){if(!assetList||0===assetList.length)return null;this.rating=assetList[0].rating,$scope.$apply()}}]),Asset}())};controller.$inject=["Base","utils","createPoll","$scope","baseAssetService"],angular.module("app.wallet.assets").component("wAsset",{bindings:{balance:"<",onClick:"&",onUnpinClick:"&",canBuyByFiat:"<"},templateUrl:"modules/wallet/modules/assets/directives/asset/asset.html",controller:controller})}(),function(){var controller=function(Base,$scope,user){return new(function(){function DefoInvestmentCtrl(){var _this523;return _classCallCheck(this,DefoInvestmentCtrl),(_this523=_possibleConstructorReturn(this,_getPrototypeOf(DefoInvestmentCtrl).call(this,$scope))).isLogined=!!user.address,_this523}return _inherits(DefoInvestmentCtrl,Base),DefoInvestmentCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.defoInvestment").controller("DefoInvestmentCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function DefoStakingFaqCtrl(){var _this524;return _classCallCheck(this,DefoStakingFaqCtrl),(_this524=_possibleConstructorReturn(this,_getPrototypeOf(DefoStakingFaqCtrl).call(this,$scope))).isLogined=!!user.address,_this524}return _inherits(DefoStakingFaqCtrl,Base),DefoStakingFaqCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.defoStakingFaq").controller("DefoStakingFaqCtrl",controller)}(),function(){var controller=function(Base,$element,$scope,utils,i18n){return new(function(){function ComplexityMeter(){var _this525;return _classCallCheck(this,ComplexityMeter),(_this525=_possibleConstructorReturn(this,_getPrototypeOf(ComplexityMeter).call(this))).$input=null,_this525.field=null,_this525.steps=[],_this525.touched=!1,_this525._form=null,_this525._messages=[],_this525._messageWarn=null,_this525._messageSuccess=null,_this525._addSteps(),_this525}return _inherits(ComplexityMeter,Base),_createClass(ComplexityMeter,[{key:"value",get:function(){return this.$input.val()}},{key:"valid",get:function(){return this._form&&this._form[this.field]&&this._form[this.field].$valid||!1}}]),_createClass(ComplexityMeter,[{key:"$postLink",value:function(){var _this526=this,form=$element.closest("form");this._form=$scope.$parent.$eval(form.attr("name")),this.$input=form.find('input[name="'.concat(this.field,'"]')),this.$input.on("input",function(){_this526._onChangeValue(),$scope.$apply()}),this.receive(utils.observe(this._form[this.field],"$viewValue"),this._onChangeValue,this),this.receive(utils.observe(this._form[this.field],"$valid"),this._onChangeValue,this),this._onChangeValue()}},{key:"addMessage",value:function(message){this._messages.push(message)}},{key:"addWarn",value:function(warn){this._messageWarn=warn}},{key:"addSuccess",value:function(success){this._messageSuccess=success}},{key:"_applyMessage",value:function(message){var _this527=this;message.show=message.validators.some(function(name){return _this527._form[_this527.field].$error[name]})}},{key:"_onChangeValue",value:function(){var value=this.value,complexity=this._getComplexy([this._getLengthComplexy(value),this._getComplexyByReg(value,/[A-Z]/g,30),this._getComplexyByReg(value,/[a-z]/g,30),this._getComplexyByReg(value,/[0-9]/g,30),this._getComplexyByReg(value,/\W/g,20)]);this._activateSteps(Math.round(complexity/10)),this._initializeMessage()}},{key:"_initializeMessage",value:function(){switch(this._hideAllMessages(),this.state){case"not-secure":this._messages.forEach(this._applyMessage,this);break;case"warn":this._messageWarn.show=!0;break;case"success":this._messageSuccess.show=!0;break;default:throw new Error("Wrong status")}}},{key:"_hideAllMessages",value:function(){this._messages.forEach(function(message){message.show=!1}),this._messageWarn.show=!1,this._messageSuccess.show=!1}},{key:"_activateSteps",value:function(activeStep){activeStep=this.valid?Math.max(activeStep,3):Math.min(activeStep,2);for(var i=0;i<this.steps.length;i++)this.steps[i].active=i<activeStep;if(activeStep<=2){var minLength=Number(this.$input.attr("min-length"))||8;this.state="not-secure",this.helpText=i18n.translate("createAccount.inputHelpError","app.create",{minLength:minLength})}else activeStep<7?(this.state="warn",this.helpText=i18n.translate("createAccount.inputHelpWarn","app.create")):this.state="success"}},{key:"_getComplexy",value:function(complexityList){return complexityList.reduce(function(result,item){return result+item})/complexityList.length*100}},{key:"_getLengthComplexy",value:function(value){var minLength=Number(this.$input.attr("min-length"))||8,targetLength=Math.round(1.8*minLength),complexity=Math.min(value.length/targetLength,1);return value.length<minLength?complexity/2:complexity}},{key:"_getComplexyByReg",value:function(value,reg,targetScore){var parts=value.match(reg);if(!parts)return 0;var score=0,charHash=Object.create(null);return parts.forEach(function(_char7){charHash[_char7]?score+=2:(score+=10,charHash[_char7]=_char7)}),Math.min(score/targetScore,1)}},{key:"_addSteps",value:function(){for(var i=0;i<10;i++)this.steps.push({active:!1})}}]),ComplexityMeter}())};controller.$inject=["Base","$element","$scope","utils","i18n"],angular.module("app.ui").component("wComplexityMeter",{bindings:{field:"@"},templateUrl:"modules/ui/directives/complexityMeter/complexityMeter.html",transclude:!0,controller:controller})}(),angular.module("app.ui").component("wCopyWrapDefault",{bindings:{info:"<",onCopy:"&"},template:"".concat('<div ng-click="$ctrl.onCopy()" w-copy="$ctrl.info" class="container" ng-transclude></div>').concat('<div ng-click="$ctrl.onCopy()" w-copy="$ctrl.info" class="copy-icon"></div>'),transclude:!0}),angular.module("app.ui").component("wExpandableBlock",{bindings:{title:"<"},templateUrl:"modules/ui/directives/expandableBlock/expandableBlock.html",transclude:!0}),function(){var rc=require("react-components"),controller=function(reactDirective){return reactDirective(rc.PaginationWrapper,["totalPages","onSetPage"],void 0,{})};controller.$inject=["reactDirective"],angular.module("app.ui").directive("wReactPagination",controller)}(),function(){var controller=function(Base,$scope){var _ANALYTICS_TX_NAMES2,analytics=require("data-service").analytics,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ANALYTICS_TX_NAMES=(_defineProperty(_ANALYTICS_TX_NAMES2={},SIGN_TYPE.CREATE_ORDER,"Create order"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.ISSUE,"Token Generation"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.TRANSFER,"Transfer"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.REISSUE,"Reissue"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.BURN,"Burn Token"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.EXCHANGE,"Exchange"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.LEASE,"Leasing"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.CANCEL_LEASING,"Cancel Leasing"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.CREATE_ALIAS,"Create Alias"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.MASS_TRANSFER,"Mass Transfer"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.DATA,"Data"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SET_SCRIPT,"Set Script"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SPONSORSHIP,"Sponsorship"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SET_ASSET_SCRIPT,"Set Asset Script"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SCRIPT_INVOCATION,"Script Invocation"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.UPDATE_ASSET_INFO,"Update Asset Info"),_ANALYTICS_TX_NAMES2);return new(function(){function TransactionInfoCtrl(){var _this528;return _classCallCheck(this,TransactionInfoCtrl),(_this528=_possibleConstructorReturn(this,_getPrototypeOf(TransactionInfoCtrl).call(this,$scope))).signable=null,_this528}return _inherits(TransactionInfoCtrl,Base),_createClass(TransactionInfoCtrl,[{key:"$postLink",value:function(){if(!this.signable)throw new Error("Has no signable!");var name="".concat(this.getEventName(this.signable)," Info Show");analytics.send({name:name,target:"ui"})}},{key:"getEventName",value:function(data){return data.type?data.type in ANALYTICS_TX_NAMES?ANALYTICS_TX_NAMES[data.type]:"Unknown":ANALYTICS_TX_NAMES[SIGN_TYPE.CREATE_ORDER]}}]),TransactionInfoCtrl}())};controller.$inject=["Base","$scope"],angular.module("app.ui").component("wTransactionInfo",{bindings:{signable:"<",isConfirm:"<",confirmed:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info.html",scope:!1,controller:controller})}(),function(){var controller=function(Base,user,i18n,waves,utils){return new(function(){function TransactionList(){var _this529;return _classCallCheck(this,TransactionList),(_this529=_possibleConstructorReturn(this,_getPrototypeOf(TransactionList).call(this)))._transactions=null,_this529.transactions=null,_this529.pending=!1,_this529.dontShowSpam=user.getSetting("dontShowSpam"),_this529.syncSettings({dontShowSpam:"dontShowSpam"}),_this529.observe(["_transactions","dontShowSpam"],_this529._onChangeTransactions),_this529}return _inherits(TransactionList,Base),_createClass(TransactionList,[{key:"$postLink",value:function(){this.parentSelector=this.parentSelector||"ul"}},{key:"_onChangeTransactions",value:function(){var transactions=this._transactions||[];this.dontShowSpam&&(transactions=transactions.filter(this._filterSpam));var hash=Object.create(null),toDate=tsUtils.date("DD.MM.YYYY");transactions.forEach(function(transaction){var date=toDate(transaction.timestamp);hash[date]||(hash[date]={timestamp:transaction.timestamp,transactions:[]}),hash[date].transactions.push(transaction)});var dates=Object.keys(hash).sort(utils.comparators.process(function(name){return hash[name].timestamp}).desc);this.transactions=dates.map(function(date){return{transactions:hash[date].transactions,timestamp:hash[date].timestamp,date:date}})}},{key:"_filterSpam",value:function(transaction){var isScamAmount,isScamPrice,isScam=!!user.scam[transaction.assetId];return 7===transaction.type&&(isScamAmount=!!user.scam[transaction.amount.asset],isScamPrice=!!user.scam[transaction.price.asset]),!(isScam||isScamAmount||isScamPrice)}}]),TransactionList}())};controller.$inject=["Base","user","i18n","waves","utils"],angular.module("app.ui").component("wTransactionList",{bindings:{transactionDatePattern:"@",parentSelector:"@",pending:"<",_transactions:"<transactions"},templateUrl:"modules/ui/directives/transactionList/transactionList.html",transclude:!1,controller:controller})}(),function(){var controller=function(Base,$scope,createPoll,utils,waves,user,balanceWatcher,baseAssetService){var entities=require("@waves/data-entities"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("data-service").analytics,ds=require("data-service");return new(function(){function TokenChangeModalCtrl(_ref256){var _this530,money=_ref256.money,txType=_ref256.txType,onBuyWithCardClick=_ref256.onBuyWithCardClick;_classCallCheck(this,TokenChangeModalCtrl),(_this530=_possibleConstructorReturn(this,_getPrototypeOf(TokenChangeModalCtrl).call(this,$scope))).signPending=!1,_this530.continueClicked=!1,_this530._listeners=[],_this530.step=0,_this530.noFee=!1,_this530.txType=txType,_this530.asset=money.asset,_this530.issue=money.asset.reissuable,_this530.maxCoinsCount=WavesApp.maxCoinsCount.sub(money.asset.quantity),_this530.balance=money,_this530.precision=money.asset.precision,_this530.input=null,_this530.quantity=new entities.Money(_this530.asset.quantity,_this530.asset),_this530._waves=null,_this530.onBuyWithCardClick=onBuyWithCardClick;var description=utils.getDataFromOracles(money.asset).description;_this530.description=description||money.asset.description;var _user$getThemeSetting3=user.getThemeSettings().TokenChangeModalCtrl,_TokenChangeModalCtrl=void 0===_user$getThemeSetting3?{}:_user$getThemeSetting3;_this530.options={grid:{x:!1,y:!1},margin:{top:0,right:0,left:0,bottom:0},series:[{dataset:"values",key:"rate",label:"Rate",color:_TokenChangeModalCtrl.seriesColor||"#5a81ea",type:["line","area"]}],axes:{x:{key:"timestamp",type:"date",ticks:4}}};var type="burn"===_this530.txType?SIGN_TYPE.BURN:SIGN_TYPE.REISSUE;waves.node.getFee({type:type,assetId:money.asset.id}).then(function(fee){_this530.fee=fee,$scope.$digest()}),createPoll(_assertThisInitialized(_this530),_this530._getGraphData,"chartData",15e3),ds.api.assets.get(baseAssetService.WavesAssetId).then(function(asset){_this530.receive(balanceWatcher.change,function(){return _this530._updateWavesBalance(asset)}),_this530._updateWavesBalance(asset)}),_this530.observe(["input","issue"],_this530._createTx),_this530.observe(["_waves","fee"],_this530._changeHasFee);var signPendingListener=$scope.$on("signPendingChange",function(event,data){_this530.signPending=data});return _this530._listeners.push(signPendingListener),_this530}return _inherits(TokenChangeModalCtrl,Base),_createClass(TokenChangeModalCtrl,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(TokenChangeModalCtrl.prototype),"$onDestroy",this).call(this),this._listeners.forEach(function(listener){return listener()})}},{key:"getSignable",value:function(){if(this.continueClicked=!0,this.noFee)return Promise.reject();var name=this.txType.slice(0,1).toUpperCase()+this.txType.slice(1);return analytics.send({name:"".concat(name," Token Continue Click"),target:"ui"}),this.signable}},{key:"next",value:function(){this.step++}},{key:"_updateWavesBalance",value:function(asset){this._waves=balanceWatcher.getBalanceByAsset(asset),utils.safeApply($scope)}},{key:"_changeHasFee",value:function(){if(!this._waves||!this.fee)return null;this.noFee=this._waves.lt(this.fee)}},{key:"_createTx",value:function(){var input=this.input,type="burn"===this.txType?SIGN_TYPE.BURN:SIGN_TYPE.REISSUE,quantityField="burn"===this.txType?"amount":"quantity";if(input){var _waves$node$transacti,tx=waves.node.transactions.createTransaction((_defineProperty(_waves$node$transacti={type:type,assetId:input.asset.id,description:input.asset.description,fee:this.fee},quantityField,input),_defineProperty(_waves$node$transacti,"precision",input.asset.precision),_defineProperty(_waves$node$transacti,"reissuable",this.issue),_waves$node$transacti));this.signable=ds.signature.getSignatureApi().makeSignable({type:type,data:tx})}else this.tx=null,this.signable=null}},{key:"_getGraphData",value:function(){var startDate=utils.moment().add(-100,"days");return waves.utils.getRateHistory(this.asset.id,baseAssetService.getBaseAssetId(),startDate).then(function(values){return{values:values}})}}]),TokenChangeModalCtrl}())({money:this.money,txType:this.txType,onBuyWithCardClick:this.onBuyWithCardClick})};controller.$inject=["Base","$scope","createPoll","utils","waves","user","balanceWatcher","baseAssetService"],angular.module("app.utils").controller("TokenChangeModalCtrl",controller)}(),function(){var ds=require("data-service"),getAddress=require("@waves/waves-transactions").libs.crypto.address,controller=function(Base,user){return new(function(){function WalletDebugModalCtrl(){var _this531;return _classCallCheck(this,WalletDebugModalCtrl),(_this531=_possibleConstructorReturn(this,_getPrototypeOf(WalletDebugModalCtrl).call(this))).address=void 0,_this531.publicKey=void 0,setTimeout(function(){_this531.walletDebugForm.publicKey.$$element.focus()},500),_this531}return _inherits(WalletDebugModalCtrl,Base),_createClass(WalletDebugModalCtrl,[{key:"onClick",value:function(){if(this.publicKey){var address=getAddress({publicKey:this.publicKey},ds.config.get("code").charCodeAt(0));user.loginDebug(address,this.publicKey)}else user.loginDebug(this.address)}}]),WalletDebugModalCtrl}())};controller.$inject=["Base","user"],angular.module("app.utils").controller("WalletDebugModalCtrl",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.BuyWAVESFaq,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.buyWAVESFaq").directive("wBuyWavesFaq",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.DefoInvestmentFaq,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.defoInvestmentFaq").directive("wDefoInvestmentFaq",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user){return reactDirective(rc.Investments,void 0,void 0,{$state:$state,user:user})};controller.$inject=["reactDirective","$state","user"],angular.module("app.investments").directive("wInvestments",controller)}(),function(){var controller=function($element){return new(function(){function ToggleClassContainer(){_classCallCheck(this,ToggleClassContainer)}return _createClass(ToggleClassContainer,[{key:"toggleClass",value:function(className){$element.toggleClass(className)}},{key:"addClass",value:function(className){$element.addClass(className)}}]),ToggleClassContainer}())};controller.$inject=["$element"];angular.module("app.ui").directive("wToggleClassContainer",function(){return{scope:!1,restrict:"A",controller:controller}})}(),function(){var controller=function(Base,$scope,user,$mdDialog){return new(function(){function AcceptNewTermsCtrl(){var _this532;return _classCallCheck(this,AcceptNewTermsCtrl),(_this532=_possibleConstructorReturn(this,_getPrototypeOf(AcceptNewTermsCtrl).call(this,$scope))).readTermsAndConditions=!1,_this532.privacyPolicy=!1,_this532}return _inherits(AcceptNewTermsCtrl,Base),_createClass(AcceptNewTermsCtrl,[{key:"confirm",value:function(){$mdDialog.hide()}}]),AcceptNewTermsCtrl}())};controller.$inject=["Base","$scope","user","$mdDialog"],angular.module("app.utils").controller("AcceptNewTermsCtrl",controller)}(),function(){var controller=function(Base,user,$mdDialog,storage){return new(function(){function EmailSubscribeCtrl(){return _classCallCheck(this,EmailSubscribeCtrl),_possibleConstructorReturn(this,_getPrototypeOf(EmailSubscribeCtrl).apply(this,arguments))}return _inherits(EmailSubscribeCtrl,Base),_createClass(EmailSubscribeCtrl,[{key:"onClose",value:function(){storage.save("subscribeModalViewed",!0),$mdDialog.hide()}}]),EmailSubscribeCtrl}())};controller.$inject=["Base","user","$mdDialog","storage"],angular.module("app.utils").controller("EmailSubscribeCtrl",controller)}(),function(){var controller=function(Base,$scope,utils,user,storage,$state,$mdDialog){var _require118=require("ramda"),find=_require118.find,propEq=_require118.propEq,uniqBy=_require118.uniqBy,filter=_require118.filter,pipe=_require118.pipe,prop=_require118.prop,isValidAddress=require("@waves/signature-adapter").isValidAddress,ds=require("data-service");return new(function(){function ImportAccountsCtrl(){var _this533;return _classCallCheck(this,ImportAccountsCtrl),(_this533=_possibleConstructorReturn(this,_getPrototypeOf(ImportAccountsCtrl).call(this,$scope))).pending=!0,_this533.userList=[],_this533.wasImportOld=!1,_this533.checkedHash=Object.create(null),_this533._myUserList=[],user.getFilteredUserList().catch(function(){return[]}).then(function(userList){return _this533._myUserList=userList,_this533.importFromOld()}),_this533}return _inherits(ImportAccountsCtrl,Base),_createClass(ImportAccountsCtrl,[{key:"hasSelected",get:function(){return 0<Object.values(this.checkedHash).filter(Boolean).length}}]),_createClass(ImportAccountsCtrl,[{key:"importAccounts",value:function(){var _this534=this,users=Object.keys(this.checkedHash).filter(function(address){return _this534.checkedHash[address]}).map(function(address){return find(propEq("address",address),_this534.userList)});return user.getFilteredUserList().then(function(list){return storage.save("userList",list.concat(users))}).then(function(){return storage.save("accountImportComplete",!0)}).then(function(){$mdDialog.hide(),$state.go("welcome")})}},{key:"importFromOld",value:function(){return this.wasImportOld=!0,this._import("https://client.wavesplatform.com")}},{key:"_import",value:function(origin){var _this535=this;return utils.importAccountByTab(origin,5e3).catch(function(){return[]}).then(function(list){_this535.pending=!1;var networkByte=ds.config.get("code").charCodeAt(0),filteredList=list.filter(function(user){return isValidAddress(user.address,networkByte)});_this535._addAccountList(filteredList)})}},{key:"_addAccountList",value:function(list){var _this536=this,myUsersHash=utils.toHash(this._myUserList||[],"address");this.userList=pipe(uniqBy(prop("address")),filter(function(user){return!myUsersHash[user.address]}))(list).reverse(),this.userList.forEach(function(user){_this536.checkedHash[user.address]=!0}),$scope.$apply()}}]),ImportAccountsCtrl}())};controller.$inject=["Base","$scope","utils","user","storage","$state","$mdDialog"],angular.module("app.utils").controller("ImportAccountsCtrl",controller)}(),function(){var controller=function(Base,$scope,modalManager){var analytics=require("data-service").analytics;return new(function(){function TutorialModalsCtrl(){var _this537;return _classCallCheck(this,TutorialModalsCtrl),(_this537=_possibleConstructorReturn(this,_getPrototypeOf(TutorialModalsCtrl).call(this,$scope))).isDesktop=WavesApp.isDesktop(),_this537.isWeb=WavesApp.isWeb(),analytics.send({name:"Onboarding SEED Popup Show",target:"ui"}),_this537}return _inherits(TutorialModalsCtrl,Base),_createClass(TutorialModalsCtrl,[{key:"showSeedBackupModal",value:function(){modalManager.showSeedBackupModal()}}]),TutorialModalsCtrl}())};controller.$inject=["Base","$scope","modalManager"],angular.module("app.utils").controller("TutorialModalsCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function LeasingCtrl(){var _this538;return _classCallCheck(this,LeasingCtrl),(_this538=_possibleConstructorReturn(this,_getPrototypeOf(LeasingCtrl).call(this,$scope))).isLogined=!!user.address,_this538}return _inherits(LeasingCtrl,Base),LeasingCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.wallet.leasing").controller("LeasingCtrl",controller)}(),function(){var controller=function(Base,$element){return new(function(){function ComplexityMessage(){var _this539;return _classCallCheck(this,ComplexityMessage),(_this539=_possibleConstructorReturn(this,_getPrototypeOf(ComplexityMessage).call(this))).message=null,_this539.type=null,_this539.validators=null,_this539.parent=null,_this539.show=!1,_this539.observe("show",_this539._onChangeShow),_this539._onChangeShow(),_this539}return _inherits(ComplexityMessage,Base),_createClass(ComplexityMessage,[{key:"$postLink",value:function(){if(this.type){switch(this.type){case"warn":this.parent.addWarn(this);break;case"success":this.parent.addSuccess(this);break;default:throw new Error("Wrong message type!")}return null}if(this.validators=(this.message||"").split(",").map(function(item){return item.trim()}).filter(Boolean),!this.validators.length)throw new Error("Has no message");this.parent.addMessage(this)}},{key:"_onChangeShow",value:function(){$element.toggleClass("hidden",!this.show)}}]),ComplexityMessage}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("complexityMessage",{controller:controller,require:{parent:"^wComplexityMeter"},bindings:{message:"@",type:"@"}})}(),function(){var controller=function(Base,newsService,utils,$scope,$state,storage){return new(function(){function NewsNotification(){var _this540;return _classCallCheck(this,NewsNotification),(_this540=_possibleConstructorReturn(this,_getPrototypeOf(NewsNotification).call(this))).notViewedAmount=null,_this540.messageVisible=!1,_this540.receive(newsService.change,function(_ref257){var notViewedAmount=_ref257.notViewedAmount;_this540.notViewedAmount=notViewedAmount,utils.safeApply($scope)},_assertThisInitialized(_this540)),storage.load("newsViewed").then(function(){newsService.fetchNews()}),storage.load("notificationMessageViewed").then(function(viewed){viewed||(_this540.messageVisible=!0)}),_this540}return _inherits(NewsNotification,Base),_createClass(NewsNotification,[{key:"isNewsState",value:function(){return"news"===$state.$current.name}},{key:"onIconClick",value:function(){this.isNewsState()||this.onClick({notViewedAmount:this.notViewedAmount})}},{key:"gotIt",value:function(){var _this541=this;storage.save("notificationMessageViewed",!0).then(function(){_this541.messageVisible=!1})}}]),NewsNotification}())};controller.$inject=["Base","newsService","utils","$scope","$state","storage"],angular.module("app.ui").component("wNewsNotification",{templateUrl:"modules/ui/directives/newsNotification/newsNotification.html",controller:controller,bindings:{onClick:"&"}})}(),function(){var controller=function(Base,$element,$attrs,$scope,utils,$state,state){return new(function(){function ResponsiveMenuItem(){var _this542;return _classCallCheck(this,ResponsiveMenuItem),(_this542=_possibleConstructorReturn(this,_getPrototypeOf(ResponsiveMenuItem).call(this))).parent=null,_this542.value=null,$element.on("click",function(e){e.stopPropagation(),null!=_this542.value&&(_this542.parent.setActive(_assertThisInitialized(_this542)),$scope.$apply())}),_this542}return _inherits(ResponsiveMenuItem,Base),_createClass(ResponsiveMenuItem,[{key:"$postLink",value:function(){var _this543=this;this.parent.registerItem(this),null!=this.value&&$attrs.activeByState?(this.receive(state.signals.changeRouterStateSuccess,this._onChangeState,this),this._onChangeState()):null!=this.value&&(this.receive(utils.observe(this.parent,"activeMenu"),function(){$element.toggleClass("active",_this543.parent.activeMenu===_this543.value)}),$element.toggleClass("active",this.parent.activeMenu===this.value))}},{key:"_onChangeState",value:function(){var id=$state.$current.name.slice($state.$current.name.lastIndexOf(".")+1).replace("-demo",""),path=WavesApp.stateTree.getPath(id);if(path){var active=this.value===path[path.length-1];$element.toggleClass("active",active),$element.toggleClass("has-active",-1!==path.indexOf(this.value)&&!active)}}}]),ResponsiveMenuItem}())};controller.$inject=["Base","$element","$attrs","$scope","utils","$state","state"],angular.module("app.ui").component("wResponsiveMenuItem",{template:'<div class="responsive-menu-item-content" ng-transclude></div>',require:{parent:"^wResponsiveMenu"},bindings:{value:"@"},transclude:!0,controller:controller})}(),(ShowHidePassword=function(){function ShowHidePassword($element){_classCallCheck(this,ShowHidePassword),this.$element=void 0,this.inputEl=void 0,this.isActive=!1,this.$element=$element}return _createClass(ShowHidePassword,[{key:"$postLink",value:function(){this.$element.addClass("show-hide-password"),this.inputEl=this.$element.find("input")}},{key:"toggle",value:function(){this.isActive=!this.isActive,this.inputEl.attr("type",this.isActive?"text":"password"),ds.analytics.welcome.toggleVisiblePasswordClick(this.isActive?"Visible":"Hidden")}}]),ShowHidePassword}()).$inject=["$element"],angular.module("app.ui").component("wShowHidePassword",{templateUrl:"modules/ui/directives/showHidePassword/showHidePassword.html",controller:ShowHidePassword,transclude:!0}),function(){var tsUtils=require("ts-utils"),Money=require("@waves/data-entities").Money,controller=function(user){return new(function(){function Reissue(){_classCallCheck(this,Reissue),this.props=null}return _createClass(Reissue,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"amount.asset")||tsUtils.get(this.props,"quantity.asset")||this.props),this.name=tsUtils.get(this.props,"amount.asset.name")||tsUtils.get(this.props,"quantity.asset.name");var amount=tsUtils.get(this.props,"amount")||tsUtils.get(this.props,"quantity");this.amount=amount instanceof Money?amount.toFormat():amount.div(Math.pow(10,this.props.precision))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Reissue}())};controller.$inject=["user"],angular.module("app.ui").component("wReissue",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/reissue/reissue.html",controller:controller})}(),angular.module("app.ui").component("wUnknown",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/unknown/unknown.html"}),function(){var controller=function(Base,user,$mdDialog){return new(function(){function DexScriptedPair(_ref258){var _this544,assets=_ref258.assets;return _classCallCheck(this,DexScriptedPair),(_this544=_possibleConstructorReturn(this,_getPrototypeOf(DexScriptedPair).call(this))).assets=assets,_this544.tradeWithScriptAssets=!1,_this544}return _inherits(DexScriptedPair,Base),_createClass(DexScriptedPair,[{key:"confirm",value:function(){user.setSetting("tradeWithScriptAssets",this.tradeWithScriptAssets),$mdDialog.hide()}}]),DexScriptedPair}())(this.locals)};controller.$inject=["Base","user","$mdDialog"],angular.module("app.utils").controller("DexScriptedPairCtrl",controller)}(),function(){var controller=function(Base,$scope){return new(function(){function LockPairWarningCtrl(_ref259){var _this545,amountTicker=_ref259.amountTicker,priceTicker=_ref259.priceTicker;return _classCallCheck(this,LockPairWarningCtrl),(_this545=_possibleConstructorReturn(this,_getPrototypeOf(LockPairWarningCtrl).call(this,$scope))).amountTicker=amountTicker,_this545.priceTicker=priceTicker,_this545}return _inherits(LockPairWarningCtrl,Base),LockPairWarningCtrl}())(this)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.ui").controller("LockPairWarningCtrl",controller)}(),function(){var controller=function(Base,$scope,explorerLinks,waves,createPoll){return new(function(){function TransactionInfoCtrl(_ref260){var _this546,transactionId=_ref260.transactionId;return _classCallCheck(this,TransactionInfoCtrl),(_this546=_possibleConstructorReturn(this,_getPrototypeOf(TransactionInfoCtrl).call(this,$scope))).timer=null,_this546.id=transactionId,_this546._getData(),_this546}return _inherits(TransactionInfoCtrl,Base),_createClass(TransactionInfoCtrl,[{key:"$onDestroy",value:function(){clearTimeout(this.timer),_get(_getPrototypeOf(TransactionInfoCtrl.prototype),"$onDestroy",this).call(this)}},{key:"_getData",value:function(){var _this547=this;waves.node.transactions.getAlways(this.id).then(function(transaction){return _this547._parseTransaction(transaction)}).catch(function(){return _this547._onError()}).then(function(tx){return _this547._setData(tx)})}},{key:"_parseTransaction",value:function(transaction){return transaction.isUTX?{confirmations:-1,transaction:transaction}:waves.node.height().then(function(height){return{confirmations:height-transaction.height,transaction:transaction}})}},{key:"_onError",value:function(){var _this548=this;clearTimeout(this.timer),this.wasDestroed||(this.timer=setTimeout(function(){return _this548._getData()},2e3))}},{key:"_setData",value:function(tx){if(!this.wasDestroed&&tx){var transaction=tx.transaction,confirmations=tx.confirmations;this.transaction=transaction,this.confirmations=confirmations,this.txStatus=function(transaction){switch(!0){case transaction.isFailed:return"failed";case transaction.isUTX:return"unconfirmed";default:return"confirmed"}}(transaction),this.explorerLink=explorerLinks.getTxLink(transaction.id);try{this.signable=ds.signature.getSignatureApi().makeSignable({type:transaction.type,data:transaction}),createPoll(this,this._getHeight,this._setHeight,1e3)}catch(e){this.signable=null}}$scope.$apply()}},{key:"_getHeight",value:function(){var promiseList=[waves.node.height()];return this.confirmed||promiseList.push(waves.node.transactions.getAlways(this.id)),Promise.all(promiseList)}},{key:"_setHeight",value:function(_ref261){var _ref262=_slicedToArray(_ref261,2),height=_ref262[0],tx=_ref262[1];tx?(Object.assign(this.transaction,tx),this.confirmed=!tx.isUTX,this.confirmed?this.confirmations=height-tx.height:this.confirmations=0):this.confirmations=height-this.transaction.height,$scope.$apply()}}]),TransactionInfoCtrl}())(this.locals)};controller.$inject=["Base","$scope","explorerLinks","waves","createPoll"],angular.module("app.utils").controller("TransactionInfoCtrl",controller)}(),function(){var rc=require("react-components"),controller=function(reactDirective,waves,utils,$state,user,modalManager,balanceWatcher,baseAssetService,configService,storage){return reactDirective(rc.Assets,void 0,void 0,{waves:waves,utils:utils,$state:$state,user:user,modalManager:modalManager,balanceWatcher:balanceWatcher,baseAssetService:baseAssetService,configService:configService,storage:storage})};controller.$inject=["reactDirective","waves","utils","$state","user","modalManager","balanceWatcher","baseAssetService","configService","storage"],angular.module("app.wallet.assets").directive("assetsDirective",controller)}(),function(){var factory=function($compile,$q,$rootScope,timeLine,Queue,$templateRequest,utils){var tsUtils=require("ts-utils");return function(){function BaseNotificationManager(options){_classCallCheck(this,BaseNotificationManager),this._queue=new Queue({queueLimit:options.queueLimit}),this._options=options,this.changeSignal=new tsUtils.Signal,this._setHandlers()}return _createClass(BaseNotificationManager,[{key:"remove",value:function(id){var item=this._queue.remove(id);item&&item.destroy&&item.destroy()}},{key:"removeAll",value:function(){this._queue.removeAll()}},{key:"destroyAll",value:function(){this._queue.destroyAll()}},{key:"has",value:function(id){return this._queue.has(id)}},{key:"info",value:function(notificationObj,delay){return this._push("info",notificationObj,delay)}},{key:"success",value:function(notificationObj,delay){return this._push("success",notificationObj,delay)}},{key:"warn",value:function(notificationObj,delay){return this._push("warn",notificationObj,delay)}},{key:"error",value:function(notificationObj,delay){return this._push("error",notificationObj,delay)}},{key:"getActiveNotificationsList",value:function(){return this._queue.getActiveList()}},{key:"_setHandlers",value:function(){this._queue.signals.change.on(this._run,this)}},{key:"_push",value:function(type,notificationObj,argument_2){var delay=2<arguments.length&&void 0!==argument_2?argument_2:this._options.defaultDelay,defer=$q.defer(),promise=defer.promise;notificationObj.id=notificationObj.id||tsUtils.uniqueId("n");var notification=utils.liteObject({id:notificationObj.id,defer:defer,promise:promise,notificationObj:notificationObj,delay:delay,type:type,$element:null,destroy:null});return this._queue.push(notification),promise}},{key:"_createElement",value:function($scope){return BaseNotificationManager._loadTemplate(this._options.templateUrl).then(function(html){return $compile(html)($scope)})}},{key:"_run",value:function(list){var _this549=this,promises=list.filter(function(item){return!item.$element}).map(function(item){var $scope=$rootScope.$new(!0);return $scope.$on("$destroy",item.defer.resolve),Object.assign($scope,item.notificationObj),$scope.type=item.type,item.destroy=function(){$scope.$destroy(),item.notificationObj.onClose&&item.notificationObj.onClose()},item.closeByUser=function(){item.notificationObj.onCloseByUser&&item.notificationObj.onCloseByUser(),item.destroy()},_this549._createElement($scope).then(function($element){(item.$element=$element).on("click","[w-notification-close]",function(){item.closeByUser()}),$element.on("click","[w-notification-action]",function(){item.notificationObj.action.callback(item)}),item.notificationObj.action&&$element.on("click",".js-notification-action",function(){item.notificationObj.action(item)}),0<item.delay&&timeLine.timeout(item.destroy,item.delay)})});Promise.all(promises).then(function(){return _this549._dispatch()})}},{key:"_dispatch",value:function(){this.changeSignal.dispatch(this.getActiveNotificationsList())}}],[{key:"_loadTemplate",value:function(url){return $templateRequest(url)}}]),BaseNotificationManager}()};factory.$inject=["$compile","$q","$rootScope","timeLine","Queue","$templateRequest","utils"],angular.module("app").factory("BaseNotificationManager",factory)}(),function(){var factory=function(Base,utils,eventManager,user,configService,$injector){var ds=require("data-service"),Money=require("@waves/data-entities").Money,_require122=require("@waves/signature-adapter"),currentFeeFactory=_require122.currentFeeFactory,SIGN_TYPE=_require122.SIGN_TYPE,address=require("@waves/waves-transactions").libs.crypto.address,path=require("ramda").path,BigNumber=require("@waves/bignumber").BigNumber,MULTI_FEE_TRANSACTIONS=_defineProperty({},SIGN_TYPE.TRANSFER,!0);return function(){function BaseNodeComponent(){return _classCallCheck(this,BaseNodeComponent),_possibleConstructorReturn(this,_getPrototypeOf(BaseNodeComponent).apply(this,arguments))}return _inherits(BaseNodeComponent,Base),_createClass(BaseNodeComponent,[{key:"_feeList",value:function(_ref263){var _this550=this,tx=_ref263.tx,feeConfig=configService.getFeeConfig(),currentFee=currentFeeFactory(feeConfig);return this._fillTransaction(tx).then(function(tx){return Promise.all([_this550._getAssets(tx).then(function(assetList){return assetList.filter(function(asset){return asset.hasScript})}).then(function(assetList){return assetList.map(function(asset){return asset.id})}),ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx}).getBytes(),ds.api.assets.get("WAVES"),_this550._isSmartAccount(tx)]).then(function(_ref264){var _ref265=_slicedToArray(_ref264,4),smartAssetsIdList=_ref265[0],bytes=_ref265[1],wavesAsset=_ref265[2],hasScript=_ref265[3],bigNumberFee=currentFee(tx,bytes,hasScript,smartAssetsIdList),count=bigNumberFee.div(feeConfig.calculate_fee_rules.default.fee).roundTo(0,BigNumber.ROUND_MODE.ROUND_UP),fee=new Money(bigNumberFee,wavesAsset),feeList=ds.utils.getTransferFeeList().map(function(money){return money.cloneWithTokens(money.getTokens().mul(count))});return MULTI_FEE_TRANSACTIONS[tx.type]?[fee].concat(_toConsumableArray(feeList)):[fee]})})}},{key:"getFee",value:function(tx,fee){return this._feeList({tx:tx}).then(function(list){if(fee){var hash=utils.toHash(list,"asset.id");if(hash[fee.asset.id]&&hash[fee.asset.id].getTokens().lte(fee.getTokens()))return fee;throw new Error("Wrong fee!")}return list[0]})}},{key:"getFeeList",value:function(tx){return this._feeList({tx:tx})}},{key:"_isSmartAccount",value:function(tx){var publicKey=tx.senderPublicKey;if(!publicKey||user.publicKey===publicKey)return Promise.resolve(user.hasScript());var wavesAddress=address({publicKey:publicKey},this.code);return ds.api.address.getScriptInfo(wavesAddress).then(function(data){return data.extraFee.getTokens().gt(0)})}},{key:"_pipeTransaction",value:function(moneyList){return function(transaction){return eventManager.addTx(transaction,moneyList),transaction}}},{key:"_fillTransaction",value:function(tx){switch(tx.type){case SIGN_TYPE.ISSUE:return this._fillIssue(tx);case SIGN_TYPE.TRANSFER:return this._fillTransfer(tx);case SIGN_TYPE.REISSUE:return this._fillReissue(tx);case SIGN_TYPE.BURN:return this._fillBurn(tx);case SIGN_TYPE.LEASE:return this._fillLease(tx);case SIGN_TYPE.CANCEL_LEASING:return this._fillCancelLease(tx);case SIGN_TYPE.CREATE_ALIAS:return this._fillCreateAlias(tx);case SIGN_TYPE.MASS_TRANSFER:return this._fillMassTransfer(tx);case SIGN_TYPE.DATA:return this._fillData(tx);case SIGN_TYPE.SET_SCRIPT:return this._fillSetScript(tx);case SIGN_TYPE.SPONSORSHIP:return this._fillSponsorship(tx);case SIGN_TYPE.SET_ASSET_SCRIPT:return this._fillSetAssetScript(tx);default:throw new Error("Unsupported type ".concat(tx.type,"!"))}}},{key:"_getAssets",value:function(tx){return Promise.all([["amount"],["fee"],["assetId"],["transfers",0,"amount"]].map(function(localPath){var value=path(localPath,tx);return value instanceof BigNumber?null:"string"==typeof value?ds.api.assets.get(value).catch(function(){return{id:value,hasScript:!1}}):value instanceof Money?{id:value.asset.id,hasScript:value.asset.hasScript}:null}).filter(Boolean))}},{key:"_fillIssue",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,name:tx.name||"name",description:tx.description||"description",reissuable:null==tx.reissue||tx.reissue,quantity:tx.quantity||new BigNumber(1),precision:tx.precision||0,decimals:tx.precision||0,script:tx.script||"",fee:tx.fee||new Money(1,asset)}})}},{key:"_fillTransfer",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,recipient:tx.recipient||user.address,amount:tx.amount||new Money(1,asset),fee:tx.fee||new Money(1,asset),attachment:tx.attachment instanceof Uint8Array?Array.from(tx.attachment):String(tx.attachment),senderPublicKey:tx.senderPublicKey||user.publicKey,assetId:tx.assetId||asset.id}})}},{key:"_fillReissue",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,assetId:tx.assetId||$injector.get("baseAssetService").getIdByTicker("BTC"),reissuable:tx.reissue||!0,quantity:tx.quantity||new BigNumber(1),fee:tx.fee||new Money(1,asset)}})}},{key:"_fillBurn",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,assetId:tx.assetId||$injector.get("baseAssetService").getIdByTicker("BTC"),amount:tx.amount||new BigNumber(1),fee:tx.fee||new Money(1,asset)}})}},{key:"_fillLease",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,recipient:tx.recipient||user.address,fee:tx.fee||new Money(1,asset),amount:tx.amount||new Money(1,asset)}})}},{key:"_fillCancelLease",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,leaseId:tx.leaseId||$injector.get("baseAssetService").getIdByTicker("BTC"),fee:tx.fee||new Money(1,asset)}})}},{key:"_fillCreateAlias",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,alias:tx.alias||"qwerty",fee:tx.fee||new Money(1,asset)}})}},{key:"_fillMassTransfer",value:function(tx){var transfers=tx.transfers&&tx.transfers.length?tx.transfers:null,totalAmount=transfers&&transfers.reduce(function(acc,item){return acc.add(item.amount)},tx.transfers[0].amount.cloneWithTokens(0))||null;return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,transfers:transfers||[{amount:new Money(1,asset),recipient:user.address}],totalAmount:totalAmount||new Money(1,asset),fee:tx.fee||new Money(1,asset),assetId:tx.assetId||asset.id}})}},{key:"_fillData",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,data:tx.data||[],fee:tx.fee||new Money(1,asset)}})}},{key:"_fillSetScript",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,script:tx.script||"",fee:tx.fee||new Money(1,asset)}})}},{key:"_fillSponsorship",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,assetId:tx.assetId||$injector.get("baseAssetService").getIdByTicker("BTC"),minSponsoredAssetFee:tx.minSponsoredAssetFee||new Money(1,asset),fee:tx.fee||new Money(1,asset)}})}},{key:"_fillSetAssetScript",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,script:tx.script||"base64:AQa3b8tH",assetId:tx.assetId||$injector.get("baseAssetService").getIdByTicker("BTC"),fee:tx.fee||new Money(1,asset)}})}},{key:"matcher",get:function(){return ds.config.get("matcher")}},{key:"node",get:function(){return ds.config.get("node")}},{key:"code",get:function(){return ds.config.get("code")}}]),BaseNodeComponent}()};factory.$inject=["Base","utils","eventManager","user","configService","$injector"],angular.module("app").factory("BaseNodeComponent",factory)}(),function(){var i18next=require("i18next"),rc=require("react-components"),controller=function(reactDirective,user,balanceWatcher,modalManager,utils,$state,storage){return reactDirective(rc.BuyModalWrapper,["fiatProps"],void 0,{user:user,balanceWatcher:balanceWatcher,modalManager:modalManager,utils:utils,$state:$state,i18next:i18next,storage:storage})};controller.$inject=["reactDirective","user","balanceWatcher","modalManager","utils","$state","storage"],angular.module("app.ui").directive("wReactFiatModal",controller)}(),function(){var controller=function(user,utils){return new(function(){function Exchange(){_classCallCheck(this,Exchange),this.props=null}return _createClass(Exchange,[{key:"$postLink",value:function(){this.typeName=this.props.typeName,this.amountAssetName=this.getAssetName(this.props.amount.asset),this.priceAssetName=this.getAssetName(this.props.price.asset),this.isScamAmount=!!user.scam[this.props.amount.asset],this.isScamPrice=!!user.scam[this.props.price.asset],this.amountParams={sign:"exchange-buy"===this.typeName?"+":"–",amount:this.props.amount.toFormat(),name:this.props.amount.asset.name},this.priceParams={sign:"exchange-buy"===this.typeName?"-":"+",amount:utils.getExchangeTotalPrice(this.props.amount,this.props.price),name:this.props.price.asset.name}}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Exchange}())};controller.$inject=["user","utils"],angular.module("app.ui").component("wExchangeData",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/exchange/exchange.html",controller:controller})}(),function(){var controller=function(Base,user,baseAssetService,waves,$scope,utils){return new(function(){function Transfer(){var _getPrototypeOf14,_this551;_classCallCheck(this,Transfer);for(var _len29=arguments.length,args=new Array(_len29),_key29=0;_key29<_len29;_key29++)args[_key29]=arguments[_key29];return(_this551=_possibleConstructorReturn(this,(_getPrototypeOf14=_getPrototypeOf(Transfer)).call.apply(_getPrototypeOf14,[this].concat(args)))).props=Object.create(null),_this551}return _inherits(Transfer,Base),_createClass(Transfer,[{key:"$postLink",value:function(){var _this552=this;this.typeName=this.props.typeName,this.time=this.props.time,this.address=this.props.shownAddress,this.isScam=this.props.isScam,this.receive(utils.observe(this.props,"isScam"),function(){_this552.isScam=_this552.props.isScam,utils.safeApply($scope)});var TYPES=waves.node.transactions.TYPES;switch(this.typeName){case TYPES.SPONSORSHIP_FEE:this.sponsoredFee();break;default:this.transfered()}}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}},{key:"sponsoredFee",value:function(){this.assetName=this.getAssetName(this.props.fee.asset),this.amountParams={sign:"+",amount:this.props.fee.toFormat(),name:this.props.fee.asset.name}}},{key:"transfered",value:function(){var _this553=this;this.assetName=this.getAssetName(this.props.amount.asset),this.amountParams={amount:this.props.amount.toFormat(),name:this.props.amount.asset.name},this.props.amount&&this.props.amount instanceof ds.wavesDataEntities.Money&&baseAssetService.convertToBaseAsset(this.props.amount).then(function(baseMoney){var baseAssetName=baseAssetService.getBaseAssetName();_this553.mirrorBalanceParams={amount:baseMoney.toFormat(),name:baseAssetName},$scope.$digest()})}}]),Transfer}())};controller.$inject=["Base","user","baseAssetService","waves","$scope","utils"],angular.module("app.ui").component("wTransferRow",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/transfer/transfer.html",controller:controller})}(),function(){var controller=function(Base){return new(function(){function TransactionExport(){return _classCallCheck(this,TransactionExport),_possibleConstructorReturn(this,_getPrototypeOf(TransactionExport).apply(this,arguments))}return _inherits(TransactionExport,Base),_createClass(TransactionExport,[{key:"copyLink",value:function(){}}]),TransactionExport}())};controller.$inject=["Base"],angular.module("app.ui").component("wTransactionExport",{controller:controller,scope:!1,bindings:{link:"<"},templateUrl:"modules/ui/directives/transactionExport/transaction-export.html"})}(),function(){var controller=function($scope){return new(function(){function TransactionInfoJson(){_classCallCheck(this,TransactionInfoJson),this.json="",this.signable=null}return _createClass(TransactionInfoJson,[{key:"$postLink",value:function(){var _this554=this;if(!this.signable)throw new Error("Has no signable!");this.signable.getDataForApi().then(function(json){_this554.json=WavesApp.stringifyJSON(json,null,4),$scope.$apply()})}},{key:"addAnalytic",value:function(){}}]),TransactionInfoJson}())};controller.$inject=["$scope"],angular.module("app.ui").component("wTransactionInfoJson",{bindings:{signable:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-json.html",scope:!1,controller:controller})}(),function(){var Money=require("@waves/data-entities").Money,ds=require("data-service"),controller=function(Base,$scope,waves,balanceWatcher){return new(function(){function BurnInfo(){var _getPrototypeOf15,_this555;_classCallCheck(this,BurnInfo);for(var _len30=arguments.length,args=new Array(_len30),_key30=0;_key30<_len30;_key30++)args[_key30]=arguments[_key30];return(_this555=_possibleConstructorReturn(this,(_getPrototypeOf15=_getPrototypeOf(BurnInfo)).call.apply(_getPrototypeOf15,[this].concat(args)))).signable=void 0,_this555.isConfirm=!1,_this555.id="",_this555.toRemainOnBalance=void 0,_this555.totalAfterIssueTokens=void 0,_this555}return _inherits(BurnInfo,Base),_createClass(BurnInfo,[{key:"$postLink",value:function(){var _this556=this;this.transaction=this.signable.getTxData();(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){return _this556.id=id}).then(function(id){return waves.node.transactions.get(id)}).then(function(){return!1},function(){return!0}).then(function(isConfirm){return _this556.isConfirm=isConfirm}).then(function(){return $scope.$apply()}),this.receive(balanceWatcher.change,this._onChangeBalances,this),this._onChangeBalances()}},{key:"_onChangeBalances",value:function(){var _this557=this,hash=balanceWatcher.getBalance();if(!Object.keys(hash).length)return null;var assetId=this.transaction.assetId;ds.api.assets.get(assetId).then(function(asset){var quantity=new Money(asset.quantity,asset),toReissue=_this557.transaction.amount;_this557.toRemainOnBalance=(hash[assetId]||new Money(0,asset)).sub(toReissue),_this557.totalAfterIssueTokens=quantity.sub(toReissue),$scope.$apply()})}}]),BurnInfo}())};controller.$inject=["Base","$scope","waves","balanceWatcher"],angular.module("app.ui").component("wBurnInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/burn/burn-info.html"})}(),function(){var controller=function($scope,$element){return new(function(){function DataInfo(){_classCallCheck(this,DataInfo),this.signable=void 0,this.json=void 0,this.dataVisible=!1,this.allVisible=!1}return _createClass(DataInfo,[{key:"$postLink",value:function(){var _this558=this;this.transaction=this.signable.getTxData(),this.json=JSON.stringify(this.transaction.data,null,"\t"),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this558.id=id,$scope.$apply()})}},{key:"toggleAll",value:function(){this.allVisible=!this.allVisible,$element.find(".transaction-details__list").stop().animate({scrollTop:0},300)}},{key:"toggleVisible",value:function(){this.allVisible=!1,this.dataVisible=!this.dataVisible}}]),DataInfo}())};controller.$inject=["$scope","$element"],angular.module("app.ui").component("wDataInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/data/data-info.html"})}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,BigNumber=require("@waves/bignumber").BigNumber,controller=function(Base,$scope,waves,configService,$mdDialog,modalManager,user){return new(function(){function PredictionResultCtrl(_ref266){var _this559,type=_ref266.type,winnerBalance=_ref266.winnerBalance,wavesBalance=_ref266.wavesBalance,didFinished=_ref266.didFinished;return _classCallCheck(this,PredictionResultCtrl),(_this559=_possibleConstructorReturn(this,_getPrototypeOf(PredictionResultCtrl).call(this,$scope))).type=void 0,_this559.winnerBalance=void 0,_this559.wavesBalance=void 0,_this559.canPayFee=!0,(_this559.didFinished=didFinished)?(_this559.type=type,_this559.winnerBalance=winnerBalance,_this559.wavesBalance=wavesBalance,_this559.didWin=winnerBalance&&winnerBalance.getTokens().gt(0),_this559.didWin?("donate"===type?_this559._createTransferTx():_this559._createInvokeTx(),_this559):_possibleConstructorReturn(_this559,null)):_possibleConstructorReturn(_this559,null)}return _inherits(PredictionResultCtrl,Base),_createClass(PredictionResultCtrl,[{key:"_createTransferTx",value:function(){var _this560=this;waves.node.getFee({type:SIGN_TYPE.TRANSFER}).then(function(fee){_this560.canPayFee=_this560.wavesBalance.getTokens().gt(fee.getTokens());var donateAddress=configService.get("PREDICTION").DONATE_ADDRESS||"3PAVvkQjYKPEeVKorLCpzFPAZhkCv4Z2GkM";_this560.tx=waves.node.transactions.createTransaction({type:SIGN_TYPE.TRANSFER,amount:_this560.winnerBalance,fee:fee,recipient:donateAddress,assetId:_this560.winnerBalance.asset.id})})}},{key:"_createInvokeTx",value:function(){var fee=this._getInvokeFee();this.canPayFee=this.wavesBalance.getCoins().gt(fee);var DAPP=configService.get("PREDICTION_SEP").DAPP;this.tx={fee:this.wavesBalance.cloneWithCoins(fee),type:16,version:1,call:{function:"redeem",args:[]},dApp:DAPP,feeAssetId:null,payment:[this.winnerBalance],chainId:user.networkByte}}},{key:"_signTx",value:function(){var signable=ds.signature.getSignatureApi().makeSignable({type:this.tx.type,data:this.tx});return $mdDialog.hide(),modalManager.showConfirmTx(signable)}},{key:"_getInvokeFee",value:function(){var hasScript=user.hasScript();return new BigNumber(hasScript?9e5:5e5)}},{key:"onClick",value:function(){this._signTx()}}]),PredictionResultCtrl}())(this.locals)};controller.$inject=["Base","$scope","waves","configService","$mdDialog","modalManager","user"],angular.module("app.utils").controller("PredictionResultCtrl",controller)}(),function(){var ds=require("data-service"),controller=function($scope,$state,$mdDialog,user,configService,storage){return new(function(){function StakingInfoModalCtrl(){var _this561=this;_classCallCheck(this,StakingInfoModalCtrl),this.annualInterest=void 0;var staking=configService.get("staking")||[],usdnConfig=staking.find(function(_ref267){return"neutrino"===_ref267.type});if(usdnConfig){var massPaymentSender=usdnConfig.massPaymentSender,referenceUser=usdnConfig.referenceUser,neutrinoId=usdnConfig.neutrinoId,referencePayoutsForAnnualRate=usdnConfig.referencePayoutsForAnnualRate,massPaymentSenders=staking[0].massPaymentSenders||[massPaymentSender];ds.StakingService.getAnnualRate(massPaymentSenders,referenceUser,neutrinoId,referencePayoutsForAnnualRate).then(function(data){_this561.annualInterest=data.toFormat(2),$scope.$apply()})}}return _createClass(StakingInfoModalCtrl,[{key:"onStakeUSDNClick",value:function(){this.onClose(!0),$state.go("staking")}},{key:"onClose",value:function(argument_0){0<arguments.length&&void 0!==argument_0&&argument_0&&storage.save("stakingAdvIsClosed",!0),$mdDialog.cancel()}}]),StakingInfoModalCtrl}())(this)};controller.$inject=["$scope","$state","$mdDialog","user","configService","storage"],angular.module("app.ui").controller("StakingInfoModalCtrl",controller)}(),function(){var get=require("ts-utils").get,_require130=require("ramda"),splitEvery=_require130.splitEvery,flatten=_require130.flatten,searchByNameAndId=function($scope,key,list){var query=$scope[key];return query?list.filter(function(item){var name=get({item:item},"item.asset.name"),id=get({item:item},"item.asset.id"),ticker=get({item:item},"item.asset.ticker");return-1!=="".concat(name," ").concat(ticker).toLowerCase().indexOf(query.toLowerCase())||String(id)===query}):list},ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber,controller=function(Base,$scope,waves,utils,modalManager,user,gatewayService,$state,stService,visibleService,balanceWatcher,notification,baseAssetService){return new(function(){function PortfolioCtrl(){var _this562;return _classCallCheck(this,PortfolioCtrl),(_this562=_possibleConstructorReturn(this,_getPrototypeOf(PortfolioCtrl).call(this,$scope))).buyParams=void 0,_this562.mirrorId=baseAssetService.getBaseAssetId(),_this562.mirror=null,_this562.pinned=[],_this562.address=user.address,_this562.spam=[],_this562.details=null,_this562.balanceList=[],_this562.filter=null,_this562.chartStartDate=utils.moment().add(-7,"days"),_this562.pending=!0,_this562.dontShowSpam=user.getSetting("dontShowSpam"),_this562.showBuyFiatModal=!1,_this562._setBuyParams(),waves.node.assets.getAsset(_this562.mirrorId).then(function(mirror){var rateAssetName=baseAssetService.getBaseAssetName();_this562.mirror=mirror,_this562.tableHeaders=[{id:"name",title:{literal:"list.name"},valuePath:"item.asset.name",sort:!0,search:searchByNameAndId,placeholder:"portfolio.filter"},{id:"balance",title:{literal:"list.balance"},valuePath:"item.available",sort:!0},{id:"inOrders",title:{literal:"list.inOrders"},valuePath:"item.inOrders",sort:!0},{id:"mirror",title:{literal:"list.mirror",params:{currency:rateAssetName}},valuePath:"item.amount",sort:!0},{id:"rate",title:{literal:"list.rate",params:{currency:rateAssetName}},valuePath:"item.rate",sort:!0},{id:"change24",title:{literal:"list.change"},valuePath:"item.change24",sort:!0},{id:"controls"}],$scope.$digest()}),_this562.syncSettings({pinned:"pinnedAssetIdList",spam:"wallet.portfolio.spam",filter:"wallet.portfolio.filter",dontShowSpam:"dontShowSpam"}),balanceWatcher.ready.then(function(){var onChange=function(){_this562._updateBalances(),visibleService.updateSort()};_this562.receive(balanceWatcher.change,onChange),_this562.receive(utils.observe(user,"scam"),onChange),_this562.observe(["pinned","spam","dontShowSpam"],onChange),_this562._updateBalances()}),balanceWatcher.ready.then(function(){_this562.pending=!1,_this562.observe("details",_this562._onChangeDetails),_this562.observe("filter",_this562._onChangeDetails),utils.safeApply($scope)}),_this562.receive(stService.sort,function(){visibleService.updateSort()}),waves.node.assets.getNft(1).then(function(list){if(list.length){var id="n-".concat(Date.now()),networkType="";switch(ds.config.get("code")){case"W":networkType="mainnet";break;case"T":networkType="testnet";break;case"S":networkType="stagenet";break;default:return}notification.info({id:id,ns:"app.wallet.portfolio",title:{literal:"hasNftToken",params:{address:user.address,networkType:networkType}}},-1),_this562.signals.destroy.once(function(){notification.remove(id)})}}),_this562}return _inherits(PortfolioCtrl,Base),_createClass(PortfolioCtrl,[{key:"showAsset",value:function(asset){modalManager.showAssetInfo(asset)}},{key:"showSend",value:function(asset){return modalManager.showSendAsset({assetId:asset&&asset.id})}},{key:"showReceivePopup",value:function(asset){return modalManager.showReceiveModal(asset)}},{key:"showDeposit",value:function(asset){return modalManager.showDepositAsset(user,asset)}},{key:"showSepa",value:function(asset){return modalManager.showSepaAsset(user,asset)}},{key:"showBurn",value:function(assetId){return modalManager.showBurnModal(assetId)}},{key:"showReissue",value:function(assetId){return modalManager.showReissueModal(assetId)}},{key:"canShowDex",value:function(balance){var _utils$getDataFromOra8=utils.getDataFromOracles(balance.asset.id),isVerified=_utils$getDataFromOra8.isVerified,isGateway=_utils$getDataFromOra8.isGateway,isStable=_utils$getDataFromOra8.isStable,isGatewaySoon=_utils$getDataFromOra8.isGatewaySoon;return balance.isPinned||balance.asset.isMyAsset||balance.asset.id===baseAssetService.WavesAssetId||gatewayService.getPurchasableWithCards()[balance.asset.id]||gatewayService.getCryptocurrencies()[balance.asset.id]||gatewayService.getFiats()[balance.asset.id]||isGateway||isStable||isVerified||isGatewaySoon}},{key:"openDex",value:function(asset){utils.openDex(asset.ticker||asset.id)}},{key:"toggleSpam",value:function(asset,state){user.toggleSpamAsset(asset.id,state),this.poll.restart()}},{key:"isDepositSupported",value:function(asset){var isWaves=asset.id===baseAssetService.WavesAssetId;return gatewayService.hasSupportOf(asset,"deposit")||isWaves}},{key:"isSepaSupported",value:function(asset){return gatewayService.hasSupportOf(asset,"sepa")}},{key:"onShowBuyFiatModal",value:function(){this.showBuyFiatModal=!0}},{key:"_onChangeDetails",value:function(){var balanceList,details=this.details;switch(this.filter){case"active":balanceList=details.active.slice();break;case"pinned":balanceList=details.pinned.slice();break;case"spam":balanceList=details.spam.slice();break;case"my":balanceList=details.my.slice();break;case"verified":balanceList=details.verified.slice();break;default:throw new Error("Wrong filter name!")}this.balanceList=balanceList}},{key:"_addRating",value:function(balanceList){return Promise.all(splitEvery(25,balanceList).map(function(block){return ds.api.rating.getAssetsRating(block.map(function(balanceItem){return balanceItem.asset.id}))})).then(function(list){var listHash=utils.toHash(flatten(list),"assetId");return balanceList.map(function(balanceItem){return balanceItem.rating=listHash[balanceItem.asset.id]?listHash[balanceItem.asset.id].rating:null,balanceItem})}).catch(function(){return balanceList})}},{key:"_updateBalances",value:function(){var _this563=this,balanceList=balanceWatcher.getFullBalanceList(),baseAssetId=baseAssetService.getBaseAssetId(),assetList=balanceList.map(function(balance){return balance.asset}),currentDayDate=utils.moment().format("YYYY-MM-DD hh:mm"),lastDayDate=utils.moment().add(-1,"days").format("YYYY-MM-DD hh:mm");Promise.all([this._addRating(balanceList),waves.utils.getRateList(assetList,baseAssetId,currentDayDate),waves.utils.getRateList(assetList,baseAssetId,lastDayDate)]).then(function(_ref268){var _ref269=_slicedToArray(_ref268,3),balanceListWithRating=_ref269[0],currentRateData=_ref269[1],lastRateData=_ref269[2],currentRates=PortfolioCtrl._mapRatesToBigNumber(currentRateData),lastRates=PortfolioCtrl._mapRatesToBigNumber(lastRateData);_this563.details=balanceListWithRating.map(function(item){var isPinned=_this563._isPinned(item.asset.id),isSpam=_this563._isSpam(item.asset.id),isOnScamList=user.scam[item.asset.id],_getMatchingRates2=_slicedToArray(function(balanceItem){if(!(currentRateData&&currentRateData.data&&lastRateData&&lastRateData.data))return[new BigNumber(0),new BigNumber(0)];var predicate=function(rate){var assetId="string"==typeof balanceItem.asset?balanceItem.asset:balanceItem.asset.id;return rate.amountAsset===assetId&&rate.priceAsset===baseAssetId},indexCurrent=currentRateData.data.findIndex(predicate);if(currentRateData.data[indexCurrent].amountAsset===lastRateData.data[indexCurrent].amountAsset)return[currentRates[indexCurrent],lastRates[indexCurrent]];var indexLast=lastRateData.data.findIndex(predicate);return[currentRates[indexCurrent],lastRates[indexLast]]}(item),2),currentRate=_getMatchingRates2[0],lastRate=_getMatchingRates2[1];return _objectSpread({},item,{asset:item.asset,inOrders:item.inOrders,isPinned:isPinned,isSpam:isSpam,isOnScamList:isOnScamList,rating:item.rating||null,minSponsoredAssetFee:item.asset.minSponsoredAssetFee,sponsorBalance:item.asset.sponsorBalance,leasedOut:item.leasedOut,change24:_this563._getChange24(currentRate,lastRate),rate:currentRate,amount:new BigNumber(currentRate.roundTo(2)).mul(item.available.getTokens())})}).reduce(function(acc,item){var _utils$getDataFromOra9=utils.getDataFromOracles(item.asset.id),isVerified=_utils$getDataFromOra9.isVerified,isGateway=_utils$getDataFromOra9.isGateway,isStable=_utils$getDataFromOra9.isStable,isGatewaySoon=_utils$getDataFromOra9.isGatewaySoon,spam=item.isOnScamList||item.isSpam;return(isVerified||isGateway||isStable||isGatewaySoon)&&acc.verified.push(item),spam?_this563.dontShowSpam||(item.asset.sender===user.address&&acc.my.push(item),acc.spam.push(item),acc.active.push(item)):(item.asset.sender===user.address&&acc.my.push(item),acc.active.push(item)),acc},{spam:[],my:[],active:[],verified:[]}),utils.safeApply($scope)})}},{key:"_isPinned",value:function(assetId){return this.pinned.includes(assetId)}},{key:"_isSpam",value:function(assetId){return this.spam.includes(assetId)}},{key:"_getChange24",value:function(currentRate,lastRate){return lastRate.isZero()?new BigNumber(0):currentRate.sub(lastRate).div(lastRate).mul(100).roundTo(2)}},{key:"_onCloseBuyModal",value:function(){this.showBuyFiatModal=!1,utils.safeApply($scope)}},{key:"_setBuyParams",value:function(){var _this564=this;Promise.all([ds.gateway.getAcashCryptoAssets(),ds.gateway.getAcashFiatAssets()]).then(function(_ref270){var _ref271=_slicedToArray(_ref270,2),cryptoAssets=_ref271[0],fiatAssets=_ref271[1],wavesAcash=cryptoAssets.find(function(_ref272){return"WAVES"===_ref272.id});fiatAssets.length&&(_this564.buyParams={onClose:function(){return _this564._onCloseBuyModal()},initValues:{fiatAsset:fiatAssets[0],fiatAmount:"",cryptoAsset:wavesAcash,cryptoAmount:"",rate:0,disableCryptoSelect:!0}})}).catch(function(){_this564.buyParams={onClose:function(){return _this564._onCloseBuyModal()}}})}}],[{key:"_mapRatesToBigNumber",value:function(rateList){return rateList&&rateList.data?rateList.data.map(function(item){return new BigNumber(item.data.rate)}):[]}}]),PortfolioCtrl}())};controller.$inject=["Base","$scope","waves","utils","modalManager","user","gatewayService","$state","stService","visibleService","balanceWatcher","notification","baseAssetService"],angular.module("app.wallet.portfolio").controller("PortfolioCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function DefoInvestmentFaqCtrl(){var _this565;return _classCallCheck(this,DefoInvestmentFaqCtrl),(_this565=_possibleConstructorReturn(this,_getPrototypeOf(DefoInvestmentFaqCtrl).call(this,$scope))).isLogined=!!user.address,_this565}return _inherits(DefoInvestmentFaqCtrl,Base),DefoInvestmentFaqCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.defoInvestmentFaq").controller("DefoInvestmentFaqCtrl",controller)}(),function(){var controller=function(Base,$scope,waves){var _require132=require("ramda"),indexBy=_require132.indexBy,prop=_require132.prop,head=_require132.head,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,Money=require("@waves/data-entities").Money,ds=require("data-service"),analytics=require("data-service").analytics,AnyTransactionForm=function(){function AnyTransactionForm(){var _this566;return _classCallCheck(this,AnyTransactionForm),(_this566=_possibleConstructorReturn(this,_getPrototypeOf(AnyTransactionForm).call(this))).state=Object.create(null),_this566.json="",_this566.onSuccess=null,_this566.isValidJSON=!0,_this566.signable=null,_this566.observe("json",_this566._onChangeJSON),_this566.observe("state",_this566._onChangeState),_this566}return _inherits(AnyTransactionForm,Base),_createClass(AnyTransactionForm,[{key:"next",value:function(){analytics.send({name:"Wallet Assets JSON Continue Click",target:"ui"}),this.onSuccess({signable:this.signable})}},{key:"_onChangeState",value:function(){var state=this.state;if(state.tx){if(state.tx)try{this.json=WavesApp.stringifyJSON(this.state.tx,null,4)}catch(e){this.json=""}}else state.tx=Object.create(null)}},{key:"_onChangeJSON",value:function(){var _this567=this;this.isValidJSON=!1;var json=this.json;if(this.fee=null,!this.json)return this.isValidJSON=!0,null;Promise.resolve(WavesApp.parseJSON(json)).then(function(data){return _this567._updateSignable(data).then(function(){_this567.state.tx=data,_this567.isValidJSON=!0})}).catch(function(){_this567.state.tx=null,_this567.isValidJSON=!1}).then(function(){$scope.$apply()})}},{key:"_updateSignable",value:function(data){var _this568=this;if(!data)return Promise.resolve(null);var clone=Object.keys(data).reduce(function(acc,name){var value=AnyTransactionForm._normalizeValue(data[name]);return acc[name]=value,acc},Object.create(null)),type=AnyTransactionForm._normalizeSignType(clone);return AnyTransactionForm._parse(type,clone).then(function(data){_this568.fee=data.fee,data.type!==SIGN_TYPE.SET_SCRIPT||data.script||(data.script=""),data.type!==SIGN_TYPE.TRANSFER&&data.type!==SIGN_TYPE.MASS_TRANSFER||(data.attachment=Array.from(data.attachment));try{_this568.signable=ds.signature.getSignatureApi().makeSignable({type:type,data:data})}catch(e){return Promise.reject(e)}})}}],[{key:"_parse",value:function(type,data){switch(type){case SIGN_TYPE.CREATE_ORDER:return AnyTransactionForm._parseOrder(data);case SIGN_TYPE.CANCEL_ORDER:return Promise.resolve(data);default:return AnyTransactionForm._parseTransaction(data)}}},{key:"_parseOrder",value:function(data){var moneyFactory=ds.api.matcher.factory;return Promise.all([waves.node.assets.getAsset("WAVES"),waves.node.assets.getAsset(ds.utils.normalizeAssetId(data.assetPair.amountAsset)),waves.node.assets.getAsset(ds.utils.normalizeAssetId(data.assetPair.priceAsset))]).then(indexBy(prop("id"))).then(function(hash){return ds.api.transactions.parseExchangeOrder(moneyFactory,data,hash)})}},{key:"_parseTransaction",value:function(data){switch(data.type){case SIGN_TYPE.CANCEL_LEASING:return Promise.all([AnyTransactionForm._parseDefaultTransaction(data),waves.node.transactions.get(data.leaseId)]).then(function(_ref273){var _ref274=_slicedToArray(_ref273,2);return _objectSpread({},_ref274[0],{lease:_ref274[1]})});case SIGN_TYPE.BURN:return Promise.all([AnyTransactionForm._parseDefaultTransaction(data),waves.node.assets.getAsset(data.assetId)]).then(function(_ref275){var _ref276=_slicedToArray(_ref275,2),tx=_ref276[0],asset=_ref276[1];return _objectSpread({},tx,{amount:new Money(tx.quantity,asset)})});default:return AnyTransactionForm._parseDefaultTransaction(data)}}},{key:"_parseDefaultTransaction",value:function(data){return ds.api.transactions.parseTx([data]).then(head)}},{key:"_normalizeSignType",value:function(data){return data.type&&SIGN_TYPE[data.type]?data.type:data.orderType&&["sell","buy"].includes(data.orderType)?SIGN_TYPE.CREATE_ORDER:data.id&&"string"==typeof data.id?SIGN_TYPE.CANCEL_ORDER:void 0}}]),AnyTransactionForm}();return AnyTransactionForm._normalizeValue=function(value){if("true"===value)return!0;if("false"===value)return!1;var num=Number(value);return String(num)===value?num:value},new AnyTransactionForm};controller.$inject=["Base","$scope","waves"],angular.module("app.ui").component("wAnyTransactionForm",{controller:controller,scope:!1,bindings:{state:"=",onSuccess:"&"},templateUrl:"modules/ui/directives/anyTransactionForm/any-tx-form.html"})}(),function(){var controller=function(ConfirmTxService,$scope,validateService,utils,waves,$attrs,balanceWatcher,user){var _require135=require("ramda"),flatten=_require135.flatten,propEq=_require135.propEq,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("data-service").analytics,ANALYTICS_TABS_NAMES={details:"View Details",JSON:"JSON",export:"Export"};return new(function(){function ConfirmTransaction(){var _this569;return _classCallCheck(this,ConfirmTransaction),(_this569=_possibleConstructorReturn(this,_getPrototypeOf(ConfirmTransaction).call(this,$scope))).locale=$attrs.ns||"app.ui",_this569.step=0,_this569.type=0,_this569.isSetScript=!1,_this569.errors=[],_this569.onTransactionSend=void 0,_this569.hasFee=!0,_this569.isSignClicked=!1,_this569.noFeeLiteral="confirmTransaction.send.errors.fee",_this569.observe(["signable"],_this569._showErrors),_this569.receive(balanceWatcher.change,_this569._showErrors,_assertThisInitialized(_this569)),_this569}return _inherits(ConfirmTransaction,ConfirmTxService),_createClass(ConfirmTransaction,[{key:"showBuyWithCard",get:function(){return this.onBuyWithCardClick&&!this.hasFee&&this.isSignClicked}},{key:"disableSignButton",get:function(){return this.onBuyWithCardClick&&!this.hasFee?this.isSignClicked:0<this.errors.length||!this.txId}}]),_createClass(ConfirmTransaction,[{key:"$postLink",value:function(){var _this570=this,tx=this.signable.getTxData();this.type=this.signable.type,this.isSetScript=this.type===SIGN_TYPE.SET_SCRIPT&&tx.script,this.isTockenIssue=this.type===SIGN_TYPE.ISSUE,this.isAnyTx&&this.observe("activeTab",function(){var name="Wallet Assets JSON ".concat(ANALYTICS_TABS_NAMES[_this570.activeTab]," Show");analytics.send({name:name,target:"ui"})});var key,NAME=this.getEventName(tx);if(analytics.send({name:"".concat(NAME," Info Show"),target:"ui"}),this.signable.hasMySignature().then(function(state){_this570.step=state?1:0,$scope.$apply()}),"data-vote"===this.tx.typeName){var assetId=(key="assetId",tx.data.find(propEq("key",key))).value;waves.node.assets.getAsset(assetId).then(function(asset){_this570.votedAssetID=asset.displayName})}}},{key:"sendTransaction",value:function(){var _this571=this;if(this.isAnyTx){var name="Wallet Assets JSON ".concat(ANALYTICS_TABS_NAMES[this.activeTab]," Send Click");analytics.send({name:name,target:"ui"})}return analytics.send(this._getConfirmAnalytics(this.signable.getTxData(),!0)),_get(_getPrototypeOf(ConfirmTransaction.prototype),"sendTransaction",this).call(this).then(function(data){return _this571.onTransactionSend(),_this571.pending=!1,data})}},{key:"onChangeSignable",value:function(){_get(_getPrototypeOf(ConfirmTransaction.prototype),"onChangeSignable",this).call(this),this.tx&&(this.permissionName=ConfirmTransaction._getPermissionNameByTx(this.signable.type))}},{key:"getSignable",value:function(){return this.signable}},{key:"getSignableAndSendEvent",value:function(){if(this.isSignClicked=!0,!this.hasFee&&this.onBuyWithCardClick)return Promise.reject();switch(this.signable.type){case 14:analytics.send({name:"Disable Sponsorship Continue Click",target:"ui"});break;case 9:analytics.send({name:"Leasing Cancel Sign Click",target:"ui"})}return this.signable}},{key:"nextStep",value:function(){this.step++,this.initExportLink()}},{key:"isShowError",value:function(literal){return!(this.onBuyWithCardClick&&literal===this.noFeeLiteral)}},{key:"_getConfirmAnalytics",value:function(data,isOnSendClick){var NAME=this.getEventName(data);return{name:"".concat(NAME,isOnSendClick?" Info Send Click":" Info Go Back Click"),params:{type:data.type},target:"ui"}}},{key:"_showErrors",value:function(){var promise,_this572=this;if(!this.signable)return null;var _this$signable$getTxD=this.signable.getTxData(),amount=_this$signable$getTxD.amount,fee=_this$signable$getTxD.fee,senderPublicKey=_this$signable$getTxD.senderPublicKey,type=this.signable.type;if(senderPublicKey&&senderPublicKey!==user.publicKey)return null;switch(type){case SIGN_TYPE.TRANSFER:promise=Promise.all([this._validateAmount(amount,!1),this._validateAmount(fee,!0),this._validateAddress()]);break;case SIGN_TYPE.CREATE_ORDER:case SIGN_TYPE.CANCEL_LEASING:promise=Promise.all([]);break;default:promise=Promise.all([this._validateAmount(fee,!0)])}return promise.then(flatten).then(function(errors){_this572.errors=errors,$scope.$apply()})}},{key:"_validateAddress",value:function(){var recipient=this.signable.getTxData().recipient,errors=[];return utils.resolve(utils.when(validateService.wavesAddress(recipient))).then(function(_ref277){return _ref277.state||errors.push({literal:"confirmTransaction.send.errors.recipient.invalid"}),errors})}},{key:"_validateAmount",value:function(amount,isFee){var errors=[],hash=balanceWatcher.getBalance();if(!hash[amount.asset.id]||hash[amount.asset.id].lt(amount)||amount.getTokens().lte(0)){var feeLiteral=this.noFeeLiteral,literal=isFee?feeLiteral:"confirmTransaction.send.errors.balance.invalid";errors.push({literal:literal,data:{fee:amount}}),isFee&&(this.hasFee=!1)}else isFee&&(this.hasFee=!0);return errors}},{key:"back",value:function(){analytics.send(this._getConfirmAnalytics(this.signable.getTxData(),!1)),this.onClickBack()}}],[{key:"_getPermissionNameByTx",value:function(type){switch(type){case SIGN_TYPE.ISSUE:return"CAN_ISSUE_TRANSACTION";case SIGN_TYPE.TRANSFER:return"CAN_TRANSFER_TRANSACTION";case SIGN_TYPE.REISSUE:return"CAN_REISSUE_TRANSACTION";case SIGN_TYPE.BURN:return"CAN_BURN_TRANSACTION";case 7:throw new Error("Can' confirm exchange transaction!");case SIGN_TYPE.LEASE:return"CAN_LEASE_TRANSACTION";case SIGN_TYPE.CANCEL_LEASING:return"CAN_CANCEL_LEASE_TRANSACTION";case SIGN_TYPE.CREATE_ALIAS:return"CAN_CREATE_ALIAS_TRANSACTION";case SIGN_TYPE.MASS_TRANSFER:return"CAN_MASS_TRANSFER_TRANSACTION";case SIGN_TYPE.DATA:return"CAN_DATA_TRANSACTION";case SIGN_TYPE.SET_SCRIPT:return"CAN_SET_SCRIPT_TRANSACTION";case SIGN_TYPE.SPONSORSHIP:return"CAN_SPONSORSHIP_TRANSACTION";case SIGN_TYPE.CREATE_ORDER:return"CAN_CREATE_ORDER";case SIGN_TYPE.CANCEL_ORDER:return"CAN_CANCEL_ORDER";default:return""}}}]),ConfirmTransaction}())};controller.$inject=["ConfirmTxService","$scope","validateService","utils","waves","$attrs","balanceWatcher","user"],angular.module("app.ui").component("wConfirmTransaction",{bindings:{signable:"<",onClickBack:"&",onTxSent:"&",noBackButton:"<",warning:"<",onTransactionSend:"&",referrer:"<",activeTab:"<",isAnyTx:"<",onBuyWithCardClick:"&?"},templateUrl:"modules/ui/directives/confirmTransaction/confirmTransaction.html",transclude:!1,controller:controller})}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),signature=ds.signature,$=require("jquery"),controller=function(Base,waves,$scope,user,balanceWatcher){var analytics=require("data-service").analytics;return new(function(){function SetAssetScriptFrom(){var _this573;return _classCallCheck(this,SetAssetScriptFrom),(_this573=_possibleConstructorReturn(this,_getPrototypeOf(SetAssetScriptFrom).call(this))).state=void 0,_this573.asset=void 0,_this573.script="",_this573.isValidScript=!0,_this573.isPendingScrip=!1,_this573.fee=void 0,_this573.onSuccess=void 0,_this573.hasFee=!0,_this573._activeXHR=null,_this573.observe("state",_this573._onChangeState),_this573.observe("script",_this573._onChangeScript),_this573.observe("fee",_this573._currentHasFee),_this573.receive(balanceWatcher.change,_this573._currentHasFee,_assertThisInitialized(_this573)),_this573._currentHasFee(),_this573}return _inherits(SetAssetScriptFrom,Base),_createClass(SetAssetScriptFrom,[{key:"isAllOk",get:function(){return this.isValidScript&&!this.isPendingScrip}}]),_createClass(SetAssetScriptFrom,[{key:"onClickSign",value:function(){analytics.send({name:"Update Script Continue Click",target:"ui"});var tx=this._getTx();return signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"_onChangeScript",value:function(){var _this574=this,script=this.script.replace("base64:","");if(this._activeXHR&&(this._activeXHR.abort(),this._activeXHR=null),!script)return this.isValidScript=!0,this.isPendingScrip=!1,null;this._activeXHR=$.ajax({url:"".concat(ds.config.get("node"),"/utils/script/estimate"),method:"POST",data:script}),this._activeXHR.then(function(){_this574.isValidScript=!0}).catch(function(){_this574.isValidScript=!1}).always(function(){_this574.isPendingScrip=!1,$scope.$apply()})}},{key:"_onChangeState",value:function(){var _this575=this;if(!this.state||!this.state.assetId)throw new Error("Has no assetId!");this.script=this.state.script||"",waves.node.assets.getAsset(this.state.assetId).then(function(asset){if(!asset.hasScript)throw new Error("This asset has no script!");_this575.asset=asset,$scope.$apply()}),waves.node.getFee(this._getTx()).then(function(fee){_this575.fee=fee,$scope.$apply()})}},{key:"_getTx",value:function(){var script=this.script.replace("base64:","");return{type:SIGN_TYPE.SET_ASSET_SCRIPT,assetId:this.state.assetId,script:this.isAllOk&&this.script?"base64:".concat(script):"base64:AQa3b8tH",fee:this.fee||null}}},{key:"_currentHasFee",value:function(){var waves=balanceWatcher.getBalance().WAVES;if(!this.fee)return null;this.hasFee=!!waves&&waves.gte(this.fee)}}]),SetAssetScriptFrom}())};controller.$inject=["Base","waves","$scope","user","balanceWatcher"],angular.module("app.ui").component("wSetAssetScriptFrom",{bindings:{state:"<",onSuccess:"&"},templateUrl:"modules/ui/directives/setAssetScriptForm/setAssetScriptFrom.html",transclude:!1,controller:controller})}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function(utils,user,waves){var propEq=require("ramda").propEq;return new(function(){function TransactionInfoHeader(){_classCallCheck(this,TransactionInfoHeader),this.signable=void 0,this.isScam=void 0,this.isScamAmount=void 0,this.isScamPrice=void 0}return _createClass(TransactionInfoHeader,[{key:"$postLink",value:function(){var isOrder=this.signable.type===SIGN_TYPE.CREATE_ORDER;this.typeName=isOrder?"create-order":utils.getTransactionTypeName(this.signable.getTxData()),this.transaction=this.signable.getTxData(),this.transaction.assetId||this._addAssetId(this.transaction.type),this.isScam=!!user.scam[this.transaction.assetId],7===this.transaction.type&&(this.isScamAmount=!!user.scam[this.transaction.amount.asset],this.isScamPrice=!!user.scam[this.transaction.price.asset]),12===this.signable.type&&this._checkDataTx()}},{key:"_checkDataTx",value:function(){var _this576=this,transaction=this.signable.getTxData(),findKey=function(key){return transaction.data.find(propEq("key",key))},keyRating=findKey("score");this.voteObject=Object.create(null),keyRating&&(this.voteObject.rating=findKey("score").value,this.voteObject.assetId=findKey("assetId").value,waves.node.assets.getAsset(this.voteObject.assetId).then(function(asset){_this576.voteObject.assetName=asset.displayName}))}},{key:"_addAssetId",value:function(typeName){switch(typeName){case 4:case 11:this.transaction=_objectSpread({},this.transaction,{assetId:this.transaction.amount.asset.id});break;case 14:this.transaction=_objectSpread({},this.transaction,{assetId:this.transaction.minSponsoredAssetFee.asset.id})}}}]),TransactionInfoHeader}())};controller.$inject=["utils","user","waves"],angular.module("app.ui").component("wTransactionInfoHeader",{bindings:{signable:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-header.html",scope:!1,controller:controller})}(),function(){var controller=function(utils){return new(function(){function BurnHeader(){_classCallCheck(this,BurnHeader),this.signable=void 0,this.isScam=void 0}return _createClass(BurnHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.quantity=this.transaction.amount.toFormat(),this.name=this.transaction.amount.asset.name,this.typeName=utils.getTransactionTypeName(this.transaction)}}]),BurnHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wBurnHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/burn/burn-header.html"})}(),angular.module("app.ui").component("wDataHeader",{bindings:{signable:"<",voteObject:"<"},templateUrl:"modules/ui/directives/transactionInfo/types/data/data-header.html"}),function(){var controller=function($scope,$element){return new(function(){function IssueInfo(){_classCallCheck(this,IssueInfo),this.signable=void 0,this.asset=void 0,this.shownScript=!1,this.$container=void 0}return _createClass(IssueInfo,[{key:"$postLink",value:function(){var _this577=this;this.$container=$element.find(".js-script-container"),this.$container.hide(),this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this577.id=id,$scope.$apply()})}},{key:"toggleScript",value:function(){this.shownScript=!this.shownScript,this.$container.stop(!0,!0).slideToggle(100)}}]),IssueInfo}())};controller.$inject=["$scope","$element"],angular.module("app.ui").component("wIssueInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/issue/issue-info.html"})}(),function(){var controller=function($scope,utils,waves,Base){return new(function(){function LeaseInfo(){var _getPrototypeOf16,_this578;_classCallCheck(this,LeaseInfo);for(var _len31=arguments.length,args=new Array(_len31),_key31=0;_key31<_len31;_key31++)args[_key31]=arguments[_key31];return(_this578=_possibleConstructorReturn(this,(_getPrototypeOf16=_getPrototypeOf(LeaseInfo)).call.apply(_getPrototypeOf16,[this].concat(args)))).signable=void 0,_this578.isLeaseIn=!1,_this578.isLeaseOut=!1,_this578.address="",_this578.isActive=void 0,_this578.confirmed=void 0,_this578}return _inherits(LeaseInfo,Base),_createClass(LeaseInfo,[{key:"$postLink",value:function(){var _this579=this;switch(this.transaction=this.signable.getTxData(),this.isActive="active"===this.transaction.status,utils.getTransactionTypeName(this.transaction)){case WavesApp.TRANSACTION_TYPES.EXTENDED.LEASE_OUT:this.isLeaseOut=!0,this.address=this.transaction.recipient;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.LEASE_IN:this.isLeaseIn=!0,this.address=this.transaction.sender}this._getId().then(function(id){_this579.id=id,_this579.confirmed?_this579._applyConfirmed():_this579.observeOnce("confirmed",_this579._applyConfirmed),$scope.$apply()})}},{key:"_applyConfirmed",value:function(){var _this580=this;waves.node.transactions.getAlways(this.id).then(function(res){_this580.transaction=res,_this580.isActive="active"===_this580.transaction.status,$scope.$apply()})}},{key:"_getId",value:function(){return this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()}}]),LeaseInfo}())};controller.$inject=["$scope","utils","waves","Base"],angular.module("app.ui").component("wLeaseInfo",{bindings:{signable:"<",confirmed:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/lease/lease-info.html"})}(),function(){var controller=function(Base,readFile,$scope,utils,validateService,waves){var Papa=require("papaparse"),BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),analytics=ds.analytics;return new(function(){function MassSend(){var _this581;_classCallCheck(this,MassSend),(_this581=_possibleConstructorReturn(this,_getPrototypeOf(MassSend).call(this))).signPending=!1,_this581.submitClicked=!1,_this581.hasFee=!0,_this581._listeners=[],_this581.noMirror=!1,_this581.mirror=null,_this581.validTxCount=0,_this581.hasErrors=!1,_this581.hasWarnings=!1,_this581.errors={},_this581.warnings={},_this581.state=null,_this581.maxTransfersCount=100,_this581.onContinue=null,_this581.recipientCsv="",_this581.totalAmount=null,_this581.recipientErrors=[],_this581.amountErrors=[],_this581.transfers=[],_this581.view=utils.liteObject({errors:utils.liteObject({showAll:!1})}),_this581.isValidAmounts=!0,_this581.massSend=null,_this581.importError=!1,_this581.hasFee=!1;var signPendingListener=$scope.$on("signPendingChange",function(event,data){_this581.signPending=data});return _this581._currentHasFee(),_this581._listeners.push(signPendingListener),_this581}var _runUpdateFlow2;return _inherits(MassSend,Base),_createClass(MassSend,[{key:"getValidTransfers",value:function(){var list=this.transfers.slice(),recipientErrors=utils.toHash(this.recipientErrors,"recipient");return list.filter(function(item){return!recipientErrors[item.recipient]})}},{key:"$postLink",value:function(){var _this582=this,assetId=this.state.assetId;this.tx.transfers=this.tx.transfers||[],this.tx.attachment=this.tx.attachment||"",this.sendDescription=!!this.tx.attachment,this.tx.assetId=assetId;var transfers=this.tx.transfers.map(function(item){return _objectSpread({},item,{amount:_this582.state.moneyHash[assetId].cloneWithTokens(item.amount.toTokens())})});this.recipientCsv=transfers.map(function(_ref278){var amount=_ref278.amount,recipient=_ref278.recipient;return"".concat(recipient,",").concat(amount.getTokens().toFixed())}).join("\n"),analytics.send({name:"Mass Transfer Click",target:"ui"});var onHasMoneyHash=function(){var changeAssetId=utils.observe(_this582.state,"assetId"),changeTransfers=utils.observe(_this582.state.massSend,"transfers");_this582.observe("recipientCsv",_this582._onChangeCSVText),_this582.observe("transfers",_this582._runUpdateFlow),_this582.receive(changeAssetId,_this582._onChangeAssetId,_this582),_this582.receive(changeAssetId,_this582._calculateFee,_this582),_this582.receive(utils.observe(_this582.state.massSend,"fee"),_this582._currentHasFee,_this582),_this582.transfers=_this582.tx.transfers.slice(),changeTransfers.dispatch()};this.state.moneyHash?onHasMoneyHash():utils.observe(this.state,"moneyHash").once(function(){onHasMoneyHash(),$scope.$digest()}),this._currentHasFee(),this.observe("totalAmount",this._currentHasFee)}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(MassSend.prototype),"$onDestroy",this).call(this),this._listeners.forEach(function(listener){return listener()})}},{key:"importFile",value:function(data){var _this583=this;if("ok"===data.status)return this.importError=!1,readFile.read(data.file).then(function(content){_this583.useImportedText=!0,_this583.importedText=content,_this583.massSend.recipientCsv.$touched=!0,_this583._processTextAreaContent(content),$scope.$digest()});this._updateErrors("import",!0),$scope.$digest(),setTimeout(function(){_this583._updateErrors("import",!1),$scope.$digest()},3e3)}},{key:"clear",value:function(){this.recipientCsv=""}},{key:"nextStep",value:function(){if(this.submitClicked=!0,!this.hasFee)return Promise.reject();var tx=waves.node.transactions.createTransaction(this.tx);return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:_objectSpread({},tx,{attachment:utils.stringToBytes(tx.attachment)})})}},{key:"onTxSign",value:function(signable){analytics.send({name:"Mass Transfer Continue Click",target:"ui"}),this.onContinue({signable:signable})}},{key:"onChangeDescCheckbox",value:function(){this.tx.attachment=""}},{key:"_updateErrors",value:function(error,value){var errors=_objectSpread({},this.errors,_defineProperty({},error,value));Object.values(errors).some(Boolean)?this.hasErrors=!0:this.hasErrors=!1,this.errors=errors}},{key:"_updateWarnings",value:function(warning,value){var warnings=_objectSpread({},this.warnings,_defineProperty({},warning,value));Object.values(warnings).some(Boolean)?this.hasWarnings=!0:this.hasWarnings=!1}},{key:"_onChangeAssetId",value:function(){var _this584=this,transfers=this.transfers;if(transfers&&transfers.length){this.clear();var assetId=this.state.assetId;this.tx.assetId=assetId,this.transfers=transfers.map(function(item){return{recipient:item.recipient,amount:_this584.state.moneyHash[assetId].cloneWithTokens(item.amount.toTokens())}})}}},{key:"_currentHasFee",value:function(){if(!(this.state&&this.state.massSend&&this.state.massSend.fee&&this.totalAmount))return null;var fee=this.state.massSend.fee,moneyHash=this.state.moneyHash;fee.asset.id===this.totalAmount.asset.id?this.hasFee=moneyHash[fee.asset.id]&&moneyHash[fee.asset.id].gte(fee.add(this.totalAmount)):this.hasFee=moneyHash[fee.asset.id]&&moneyHash[fee.asset.id].gte(fee)}},{key:"_updateTxList",value:function(){var list=this.transfers.slice(),recipientErrors=utils.toHash(this.recipientErrors,"recipient"),validTransfers=list.filter(function(item){return!recipientErrors[item.recipient]});MassSend._isNotEqual(this.tx.transfers,validTransfers)&&(this.tx.transfers=validTransfers),this.tx.assetId!==this.state.assetId&&(this.tx.assetId=this.state.assetId),this._currentHasFee()}},{key:"_calculateTotalAmount",value:function(){var transfers=this.getValidTransfers();if(transfers.length)return this.totalAmount=transfers.map(function(_ref279){var amount=_ref279.amount;return amount.getTokens().gte(0)?amount:amount.cloneWithTokens("0")}).reduce(function(result,item){return result.add(item)},this.state.moneyHash[this.state.assetId].cloneWithTokens("0")),this._fillMirror(),null;this.totalAmount=this.state.moneyHash[this.state.assetId].cloneWithTokens("0"),this._fillMirror()}},{key:"_fillMirror",value:function(){var _this585=this;this.totalAmount?ds.api.rate.getRate(this.state.assetId,this.state.mirrorId).then(function(rate){_this585.mirror=_this585.totalAmount.convertTo(_this585.state.moneyHash[_this585.mirrorId].asset,rate),$scope.$digest()}):this.mirror=null}},{key:"_calculateFee",value:function(){var _this586=this,invalidRecipients=this.recipientErrors.map(function(_ref280){return _ref280.recipient}),validTransfers=this.transfers.filter(function(_ref281){var recipient=_ref281.recipient;return!invalidRecipients.find(function(invalid){return invalid===recipient})});return waves.node.getFee(_objectSpread({},this.tx,{transfers:validTransfers})).then(function(fee){_this586.tx.fee=fee,$scope.$digest()}).catch(function(){return null})}},{key:"_processTextAreaContent",value:function(content){var _this587=this,data=Papa.parse(content||"").data;this.recipientHash=MassSend._getRecipientHashByCSVParseResult(data);var transfers=[];Object.keys(this.recipientHash).forEach(function(recipient){var amountNum=_this587.recipientHash[recipient].map(function(amount){try{return MassSend._parseAmount(amount)}catch(e){return new BigNumber(0)}}).reduce(function(result,item){return result.add(item)}),amount=_this587.state.moneyHash[_this587.state.assetId].cloneWithTokens(amountNum);transfers.push({recipient:recipient,amount:amount})}),MassSend._isNotEqual(this.transfers,transfers)&&(this.transfers=transfers)}},{key:"_validateRecipients",value:function(){var _this588=this;return MassSend._isValidRecipients(this.transfers.map(function(item){return item.recipient})).then(function(){var list=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],errors=[];list.forEach(function(response,index){var transfer=_this588.transfers[index];response.state&&!transfer.amount.getTokens().lte(0)||errors.push({recipient:transfer.recipient,amount:_this588.recipientHash[transfer.recipient][0]})}),_this588.recipientErrors=errors,_this588.validTxCount=list.length-errors.length,0<Object.keys(_this588.recipientErrors).length?_this588._updateWarnings("recipients",_this588.recipientErrors):_this588._updateWarnings("recipients",null),0===_this588.validTxCount&&0<list.length?_this588._updateErrors("allTransfersInvalid",!0):_this588._updateErrors("allTransfersInvalid",!1),_this588.validTxCount>_this588.maxTransfersCount?_this588._updateErrors("exceedsMaxCount",!0):_this588._updateErrors("exceedsMaxCount",!1)})}},{key:"_validateFundsSufficiency",value:function(){if(!this.totalAmount)return this._updateErrors("insufficientFunds",!1),null;var balance=utils.groupMoney([this.totalAmount])[this.state.assetId];this.state.moneyHash[this.state.assetId].lt(balance)?this._updateErrors("insufficientFunds",!0):this._updateErrors("insufficientFunds",!1)}},{key:"_onChangeCSVText",value:function(){var text=this.useImportedText?this.importedText:this.recipientCsv;this._processTextAreaContent(text)}},{key:"_updateTextAreaContent",value:function(){this.useImportedText&&(this.recipientCsv=this.importedText,this.useImportedText=!1)}},{key:"_runUpdateFlow",value:(_runUpdateFlow2=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(){return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return this._updateTextAreaContent(),_context19.next=3,this._validateRecipients();case 3:return this._calculateTotalAmount(),_context19.next=6,this._calculateFee();case 6:this._validateFundsSufficiency(),this._updateTxList();case 8:case"end":return _context19.stop()}},_callee19,this)})),function(){return _runUpdateFlow2.apply(this,arguments)})},{key:"tx",get:function(){return this.state.massSend}},{key:"mirrorId",get:function(){return this.state.mirrorId}},{key:"isContinueButtonDisabled",get:function(){return this.hasErrors||!this.hasFee&&this.submitClicked}},{key:"showBuyWithCard",get:function(){return"WAVES"===this.state.assetId&&this.errors.insufficientFunds}}],[{key:"_getRecipientHashByCSVParseResult",value:function(data){var recipientHash=Object.create(null);return data.forEach(function(item){if(!item.length)return null;var _item$map2=_slicedToArray(item.map(function(text){return text.replace(/\s/g,"").replace(/"/g,"")}),2),recipient=_item$map2[0],amountString=_item$map2[1];if(!recipient||!amountString)return null;recipientHash[recipient]||(recipientHash[recipient]=[]),recipientHash[recipient].push(amountString)}),recipientHash}},{key:"_isNotEqual",value:function(a,b){return!MassSend._isEqual(a,b)}},{key:"_isEqual",value:function(a,b){return a.length===b.length&&a.every(function(item,i){return item.recipient===b[i].recipient&&item.amount.eq(b[i].amount)})}},{key:"_isValidRecipients",value:function(recipientList){return validateService.wavesAddresses(recipientList)}},{key:"_parseAmount",value:function(amountString){var data=WavesApp.getLocaleData(),amount=amountString.replace(new RegExp("\\".concat(data.separators.group),"g"),"").replace(new RegExp("\\".concat(data.separators.decimal)),".").replace(",",".");return/^([0-9]+\.)?[0-9]+$/.test(amount)?new BigNumber(amount):new BigNumber(0)}}]),MassSend}())};controller.$inject=["Base","readFile","$scope","utils","validateService","waves"],angular.module("app.ui").component("wMassSend",{bindings:{state:"<",onContinue:"&",onShowBuyFiatModal:"&"},templateUrl:"modules/utils/modals/sendAsset/components/massSend/mass-send.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base,$scope){return new(function(){function SetAssetScriptModalCtrl(assetId){var _this589;return _classCallCheck(this,SetAssetScriptModalCtrl),(_this589=_possibleConstructorReturn(this,_getPrototypeOf(SetAssetScriptModalCtrl).call(this,$scope))).state=void 0,_this589.signable=void 0,_this589.step=0,_this589.state={assetId:assetId},_this589}return _inherits(SetAssetScriptModalCtrl,Base),_createClass(SetAssetScriptModalCtrl,[{key:"onFillTxForm",value:function(signable){this.signable=signable;var _this$signable$getTxD3=this.signable.getTxData(),assetId=_this$signable$getTxD3.assetId,script=_this$signable$getTxD3.script;this.state={assetId:assetId,script:script},this.step++}},{key:"onConfirmBack",value:function(){this.step--}}]),SetAssetScriptModalCtrl}())(this.locals)};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("SetAssetScriptModalCtrl",controller)}(),function(){var rc=require("react-components"),transactionsExternal=function(reactDirective,$state,user,balanceWatcher,modalManager,baseAssetService,notification){return reactDirective(rc.TransactionsExternal,void 0,void 0,{$state:$state,user:user,balanceWatcher:balanceWatcher,modalManager:modalManager,baseAssetService:baseAssetService,notification:notification})};transactionsExternal.$inject=["reactDirective","$state","user","balanceWatcher","modalManager","baseAssetService","notification"],angular.module("app.wallet.transactions").directive("wTransactionsExternal",transactionsExternal)}(),function(){var rc=require("react-components"),controller=function(reactDirective,user,waves,$state){return reactDirective(rc.ChooseUser,void 0,void 0,{user:user,waves:waves,$state:$state})};controller.$inject=["reactDirective","user","waves","$state"],angular.module("app.chooseUser").directive("chooseUserDirective",controller)}(),function(){function controller(Base,matcher,baseAssetService){var Money=require("@waves/data-entities").Money;return new(function(){function DexWatchlistSelect(){var _this590;return _classCallCheck(this,DexWatchlistSelect),(_this590=_possibleConstructorReturn(this,_getPrototypeOf(DexWatchlistSelect).call(this))).watchListVisible=!1,_this590._assetPair=null,_this590.pairInfo=null,_this590.syncSettings({_assetIdPair:"dex.assetIdPair"}),_this590._onChangeAssets(),_this590.observe("_assetIdPair",_this590._onChangeAssets),_this590}return _inherits(DexWatchlistSelect,Base),_createClass(DexWatchlistSelect,[{key:"_onChangeAssets",value:function(){var _this591=this;this._getPair().then(function(pair){ds.api.pairs.info(matcher.currentMatcherAddress,[pair]).then(function(_ref282){var pairInfo=_slicedToArray(_ref282,1)[0],volume=pairInfo.volume||new Money(0,pairInfo.priceAsset);_this591.pairInfo=_objectSpread({},pairInfo,{volumeBigNum:volume.getTokens()})})}),this.watchListVisible=!1}},{key:"_getPair",value:function(argument_0){var pair=0<arguments.length&&void 0!==argument_0?argument_0:this._assetIdPair;return pair?ds.api.pairs.get(pair.amount,pair.price):ds.api.pairs.get(baseAssetService.WavesAssetId,baseAssetService.getIdByTicker("BTC"))}}]),DexWatchlistSelect}())}controller.$inject=["Base","matcher","baseAssetService"],angular.module("app.dex").component("wDexWatchlistSelect",{templateUrl:"modules/dex/directives/dexWatchlistSelect/dexWatchlistSelect.html",controller:controller})}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,configService){return reactDirective(rc.StakingFaq,void 0,void 0,{$state:$state,configService:configService})};controller.$inject=["reactDirective","$state","configService"],angular.module("app.stakingFaq").directive("wReactStakingFaq",controller)}(),angular.module("app.ui").component("wSetScript",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/set-script/set-script.html"}),angular.module("app.ui").component("wTransactionInfoContent",{bindings:{signable:"<",confirmed:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-content.html"}),angular.module("app.ui").component("wTransactionInfoGeneral",{bindings:{timestamp:"<",height:"<",id:"<",fee:"<"},controller:function(){return new function TransactionInfoGeneral(){_classCallCheck(this,TransactionInfoGeneral),this.height=void 0,this.id=void 0,this.fee=void 0}},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-general.html"}),function(){var controller=function(){return new function confirmDeleteUserCtrl(locals){_classCallCheck(this,confirmDeleteUserCtrl),this.hasBackup=!1,this.typeOfUser=void 0,this.isSeedOrPrivateKey=!locals.user.userType||"seed"===locals.user.userType||"privateKey"===locals.user.userType,this.isLedgerOrKeeper="ledger"===locals.user.userType||"wavesKeeper"===locals.user.userType,this.typeOfUser="wavesKeeper"===locals.user.userType?"Waves Keeper":"Ledger"}(this.locals)};controller.$inject=[],angular.module("app.ui").controller("confirmDeleteUserCtrl",controller)}(),function(){var analytics=require("data-service").analytics,controller=function(Base,$scope,$mdDialog,user){return new(function(){function ForgotPasswordModalCtrl(_ref284){var _this592,overwrite=_ref284.overwrite;return _classCallCheck(this,ForgotPasswordModalCtrl),(_this592=_possibleConstructorReturn(this,_getPrototypeOf(ForgotPasswordModalCtrl).call(this,$scope))).overwrite=overwrite,_this592}return _inherits(ForgotPasswordModalCtrl,Base),_createClass(ForgotPasswordModalCtrl,[{key:"onReset",value:function(){user.resetAll().then(function(){$mdDialog.hide()}),analytics.user.forgotPasswordReset()}},{key:"onCancel",value:function(){analytics.user.forgotPasswordCancel()}}]),ForgotPasswordModalCtrl}())(this.locals)};controller.$inject=["Base","$scope","$mdDialog","user"],angular.module("app.utils").controller("ForgotPasswordModalCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function PairingWithMobileCtrl(){var _this593;return _classCallCheck(this,PairingWithMobileCtrl),(_this593=_possibleConstructorReturn(this,_getPrototypeOf(PairingWithMobileCtrl).call(this,$scope))).exportUrl="",_this593.userType=user.userType,_this593.canShowPairing=!0,ds.signature.getSignatureApi().getSeed().then(function(seed){_this593.exportUrl=seed}).catch(function(){_this593.canShowPairing=!1}).then(function(){$scope.$apply()}),_this593}return _inherits(PairingWithMobileCtrl,Base),PairingWithMobileCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.utils").controller("PairingWithMobileCtrl",controller)}(),function(){var controller=function(){return new(function(){function IssueHeader(){_classCallCheck(this,IssueHeader),this.signable=void 0,this._tx=void 0}return _createClass(IssueHeader,[{key:"$postLink",value:function(){this._tx=this.signable.getTxData(),this.name=this._tx.name,this.quantity=this._tx.quantity.div(Math.pow(10,this._tx.precision)).toFormat(this._tx.precision)}}]),IssueHeader}())};controller.$inject=[],angular.module("app.ui").component("wIssueHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/issue/issue-header.html"})}(),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function LeaseHeader(){_classCallCheck(this,LeaseHeader),this.signable=void 0,this.mirrorBalance=void 0,this.needShowMirror=!1}return _createClass(LeaseHeader,[{key:"$postLink",value:function(){var _this594=this;this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction),this.transaction.amount.asset.id!==baseAssetService.getBaseAssetId()&&baseAssetService.convertToBaseAsset(this.transaction.amount).then(function(mirror){_this594.baseAssetName=baseAssetService.getBaseAssetName(),_this594.mirrorBalance=mirror,_this594.needShowMirror=_this594.mirrorBalance.getCoins().gt(0),$scope.$apply()})}}]),LeaseHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wLeaseHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/lease/lease-header.html"})}(),function(){var rc=require("react-components"),controller=function(reactDirective,$state,user,modalManager,balanceWatcher,notification,clipboardService){return reactDirective(rc.Leasing,void 0,void 0,{$state:$state,user:user,modalManager:modalManager,balanceWatcher:balanceWatcher,notification:notification,clipboardService:clipboardService})};controller.$inject=["reactDirective","$state","user","modalManager","balanceWatcher","notification","clipboardService"],angular.module("app.wallet.leasing").directive("wLeasing",controller)}(),function(){var i18next=require("i18next"),rc=require("react-components"),controller=function(reactDirective,user,balanceWatcher,modalManager,utils,$state,configService){return reactDirective(rc.InputsBlockWrapper,void 0,void 0,{user:user,balanceWatcher:balanceWatcher,modalManager:modalManager,utils:utils,$state:$state,i18next:i18next,configService:configService})};controller.$inject=["reactDirective","user","balanceWatcher","modalManager","utils","$state","configService"],angular.module("app.ui").directive("wReactInputsBlock",controller)}(),function(){var tsUtils=require("ts-utils"),controller=function(user){return new(function(){function Sponsorship(){_classCallCheck(this,Sponsorship),this.props=null}return _createClass(Sponsorship,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"minSponsoredAssetFee.asset"))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Sponsorship}())};controller.$inject=["user"],angular.module("app.ui").component("wSponsorship",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/sponsorship/sponsorship.html",controller:controller})}(),function(){var Money=require("@waves/data-entities").Money,ds=require("data-service"),controller=function(Base,$scope,waves,balanceWatcher){return new(function(){function ReissueInfo(){var _getPrototypeOf17,_this595;_classCallCheck(this,ReissueInfo);for(var _len32=arguments.length,args=new Array(_len32),_key32=0;_key32<_len32;_key32++)args[_key32]=arguments[_key32];return(_this595=_possibleConstructorReturn(this,(_getPrototypeOf17=_getPrototypeOf(ReissueInfo)).call.apply(_getPrototypeOf17,[this].concat(args)))).signable=void 0,_this595.isConfirm=!1,_this595.id="",_this595.toRemainOnBalance=void 0,_this595.totalAfterIssueTokens=void 0,_this595}return _inherits(ReissueInfo,Base),_createClass(ReissueInfo,[{key:"$postLink",value:function(){var _this596=this;this.transaction=this.signable.getTxData();(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){return _this596.id=id}).then(function(id){return waves.node.transactions.get(id)}).then(function(){return!1},function(){return!0}).then(function(isConfirm){return _this596.isConfirm=isConfirm}).then(function(){return $scope.$apply()}),this.receive(balanceWatcher.change,this._onChangeBalances,this),this._onChangeBalances()}},{key:"_onChangeBalances",value:function(){var _this597=this,hash=balanceWatcher.getBalance();if(!Object.keys(hash).length)return null;var assetId=this.transaction.assetId;ds.api.assets.get(assetId).then(function(asset){var quantity=new Money(asset.quantity,asset),toReissue=_this597.transaction.quantity;_this597.toRemainOnBalance=(hash[assetId]||new Money(0,asset)).add(toReissue),_this597.totalAfterIssueTokens=quantity.add(toReissue),$scope.$apply()})}}]),ReissueInfo}())};controller.$inject=["Base","$scope","waves","balanceWatcher"],angular.module("app.ui").component("wReissueInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/reissue/reissue-info.html"})}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),analytics=ds.analytics,factory=function(Base,utils,waves){return function(){function SingleSend($scope){var _this598;return _classCallCheck(this,SingleSend),(_this598=_possibleConstructorReturn(this,_getPrototypeOf(SingleSend).call(this,$scope))).onSign=null,_this598.minAmount=null,_this598.maxAmount=null,_this598.feeList=[],_this598.hasFee=!0,_this598.mirror=null,_this598.noMirror=!1,_this598.focus="",_this598.wavesTx={type:SIGN_TYPE.TRANSFER,amount:null,attachment:"",fee:null,recipient:"",assetId:""},_this598.signPending=!1,_this598._noCurrentRate=!1,_this598.signPendingListener=void 0,_this598.signPendingListener=$scope.$on("signPendingChange",function(event,data){_this598.signPending=data}),_this598.observe("mirror",function(){_this598.state.singleSend.mirror=_this598.mirror}),_this598.$scope=$scope,_this598}return _inherits(SingleSend,Base),_createClass(SingleSend,[{key:"assetId",get:function(){return this.state.assetId},set:function(id){this.state.assetId=id}},{key:"moneyHash",get:function(){return this.state.moneyHash}},{key:"balance",get:function(){return this.moneyHash[this.assetId]}},{key:"mirrorId",get:function(){return this.state.mirrorId}},{key:"tx",get:function(){return this.state.singleSend}}]),_createClass(SingleSend,[{key:"$onDestroy",value:function(){_get(_getPrototypeOf(SingleSend.prototype),"$onDestroy",this).call(this),this.signPendingListener()}},{key:"onSignTx",value:function(signable){var assetName=this.tx.amount.asset.ticker||this.tx.amount.asset.id,usdValue=this.mirror?this.mirror.getTokens().toString():0;this.state.gatewayData&&this.state.gatewayData.details?analytics.sendAsset.gatewayContinueClick(assetName,usdValue):analytics.sendAsset.continueClick(assetName,usdValue),this.onSign({signable:signable})}},{key:"onReadQrCode",value:function(url){var _this599=this;if(analytics.sendAsset.readQrSuccess(),!url.includes("https://"))return this.tx.recipient=url,this.$scope.$apply(),null;var routerData=utils.getRouterParams(utils.getUrlForRoute(url));if(!routerData||"SEND_ASSET"!==routerData.name)return null;var result=routerData.data;if(this.tx.recipient=result.recipient,result){var applyAmount=function(){result.amount&&(_this599.tx.amount=_this599.balance.cloneWithTokens(result.amount),_this599._fillMirror()),_this599.$scope.$apply()};result.assetId=result.asset||result.assetId,result.assetId?waves.node.assets.balance(result.assetId).then(function(_ref285){var available=_ref285.available;if(_this599.moneyHash[available.asset.id]=available,_this599.assetId!==available.asset.id){var myAssetId=_this599.assetId;_this599.assetId=available.asset.id,_this599.canChooseAsset=!0,_this599.choosableMoneyList=[_this599.moneyHash[myAssetId],available]}applyAmount()},applyAmount):applyAmount()}}},{key:"fillMax",value:function(){var _this600=this,amount=null,moneyHash=utils.groupMoney(this.feeList);(amount=moneyHash[this.assetId]?this.balance.sub(moneyHash[this.assetId]):this.balance).getTokens().lt(0)&&(amount=this.balance.cloneWithTokens("0")),ds.api.rate.getRate(this.assetId,this.mirrorId).then(function(rate){_this600._noCurrentRate=!0,_this600.mirror=amount.convertTo(_this600.moneyHash[_this600.mirrorId].asset,rate),_this600.tx.amount=amount,_this600._noCurrentRate=!1,_this600.$scope.$apply()})}},{key:"onFillMaxClick",value:function(){ds.analytics.sendAsset.amountMaxClick()}},{key:"onWatchQR",value:function(){analytics.sendAsset.readQrClick()}},{key:"onToggleShowFee",value:function(isOpen){analytics.sendAsset.toggleShowFeeSelector(isOpen?"Show":"Hide")}},{key:"onChangeFee",value:function(fee){fee&&analytics.sendAsset.changeFeeAsset(fee.asset.id)}},{key:"onBlurMirror",value:function(){this.mirror||this._fillMirror(),this.focus=""}},{key:"_onChangeBaseAssets",value:function(){var _this601=this;ds.api.rate.getRate(this.assetId,this.mirrorId).then(function(rate){_this601.noMirror=rate.eq(0)})}},{key:"_onChangeFee",value:function(){var _this$tx=this.tx,amount=_this$tx.amount,fee=_this$tx.fee;this.feeList=[fee],amount&&fee&&(amount.asset.id!==fee.asset.id?this.hasFee=this.moneyHash[fee.asset.id]&&this.moneyHash[fee.asset.id].gte(fee):this.hasFee=this.moneyHash[fee.asset.id]&&this.moneyHash[fee.asset.id].gte(amount.add(fee)))}},{key:"_onChangeAssetId",value:function(){if(!this.assetId)throw new Error("Has no asset id!");if(this._onChangeBaseAssets(),!this.balance)return null;this.tx.amount=this.balance.cloneWithTokens("0"),this.mirror=this.moneyHash[this.mirrorId].cloneWithTokens("0")}},{key:"_onChangeMirrorId",value:function(){if(!this.mirrorId)throw new Error("Has no asset id!");if(this._onChangeBaseAssets(),!this.moneyHash[this.mirrorId])return null;this.mirror=this.moneyHash[this.mirrorId].cloneWithTokens("0"),this._onChangeAmount()}},{key:"_onChangeAmountMirror",value:function(){this._noCurrentRate||"mirror"!==this.focus||this._fillAmount()}},{key:"_onChangeAmount",value:function(){this._noCurrentRate||this.noMirror||"amount"!==this.focus||this._fillMirror()}},{key:"_fillMirror",value:function(){var _this602=this;this.tx.amount?ds.api.rate.getRate(this.assetId,this.mirrorId).then(function(rate){_this602.mirror=_this602.tx.amount.convertTo(_this602.moneyHash[_this602.mirrorId].asset,rate),_this602.$scope.$digest()}):this.mirror=null}},{key:"_fillAmount",value:function(){var _this603=this;if(!this.mirror)return this.tx.amount=null;ds.api.rate.getRate(this.mirrorId,this.assetId).then(function(rate){_this603.tx.amount=_this603.mirror.convertTo(_this603.balance.asset,rate),_this603.$scope.$digest()})}}]),SingleSend}()};factory.$inject=["Base","utils","waves"],angular.module("app.utils").factory("SingleSend",factory)}(),function(){var factory=function(i18n,utils){var Papa=require("papaparse"),HEADERS=[{name:"csv.date",id:"timestamp"},{name:"csv.id",id:"id"},{name:"csv.type",id:"typeName"},{name:"csv.transactionType",id:"type"},{name:"csv.price.ticker",id:"priceTicker"},{name:"csv.price.name",id:"priceName"},{name:"csv.price.value",id:"priceValue"},{name:"csv.price.id",id:"priceId"},{name:"csv.amount.ticker",id:"amountTicker"},{name:"csv.amount.name",id:"amountName"},{name:"csv.amount.value",id:"amountValue"},{name:"csv.amount.id",id:"amountId"},{name:"csv.fee.ticker",id:"feeTicker"},{name:"csv.fee.name",id:"feeName"},{name:"csv.fee.value",id:"feeValue"},{name:"csv.fee.id",id:"feeId"},{name:"csv.sender",id:"sender"},{name:"csv.recipient",id:"recipient"},{name:"csv.attachment",id:"attachment"},{name:"csv.height",id:"height"},{name:"csv.alias",id:"alias"},{name:"csv.description",id:"description"},{name:"csv.name",id:"name"},{name:"csv.reissuable.name",id:"reissuable"},{name:"csv.precision",id:"precision"}],NS="app.wallet.transactions";return new(function(){function TransactionsCsvGen(){_classCallCheck(this,TransactionsCsvGen)}return _createClass(TransactionsCsvGen,[{key:"generate",value:function(transactionList){var fields=HEADERS.map(function(item){return i18n.translate(item.name,NS)}),data=transactionList.map(function(tx){return HEADERS.map(function(header){var id=header.id,value=tx[id];try{switch(id){case"timestamp":return value&&utils.moment(value).format("DD.MM.YYYY HH:mm:ss")||value;case"reissuable":return null!=value&&i18n.translate("csv.reissuable.".concat(value),NS)||value;case"priceTicker":return tx.price&&tx.price.asset.ticker||"";case"priceName":return tx.price&&tx.price.asset.name||"";case"priceValue":return tx.price&&tx.price.toFormat()||"";case"priceId":return tx.price&&tx.price.asset.id||"";case"amountTicker":return tx.amount&&tx.amount.asset.ticker||"";case"amountName":return tx.amount&&tx.amount.asset.name||"";case"amountValue":return tx.amount&&tx.amount.toFormat()||"";case"amountId":return tx.amount&&tx.amount.asset.id||"";case"feeTicker":return tx.fee&&tx.fee.asset.ticker||"";case"feeName":return tx.fee&&tx.fee.asset.name||"";case"feeValue":return tx.fee&&tx.fee.toFormat()||"";case"feeId":return tx.fee&&tx.fee.asset.id||"";default:return null==value?"":String(value)}}catch(e){return""}})}),csv=Papa.unparse({fields:fields,data:data});WavesApp.isDesktop()?transfer("download",{fileContent:csv,fileName:"transactions.csv"}):TransactionsCsvGen._download(csv,"transactions.csv")}}],[{key:"_download",value:function(csv,name){if(window.navigator&&"function"==typeof window.navigator.msSaveOrOpenBlob)this._downloadInMsEdge(csv,name);else{var blob=new Blob([csv],{type:"text/csv;charset=utf-8;"}),url=URL.createObjectURL(blob),link=document.createElement("a");link.setAttribute("href",url),link.setAttribute("download",name),link.setAttribute("target","_blank"),link.style.position="absolute",link.style.opacity="0",document.body.appendChild(link),link.click(),requestAnimationFrame(function(){document.body.removeChild(link)})}}},{key:"_downloadInMsEdge",value:function(csv,name){var blob=new Blob([csv],{type:"text/csv"});window.navigator.msSaveOrOpenBlob(blob,name)}}]),TransactionsCsvGen}())};factory.$inject=["i18n","utils"],angular.module("app.wallet.transactions").factory("transactionsCsvGen",factory)}(),angular.module("app.ui").component("wCreateAlias",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/create-alias/create-alias.html"}),function(){var TABS={externalTx:"depositWithdraw",internalTx:"internalTx"},FILTERS={all:"all",transfer:{send:"send",receive:"receive"},massTransfer:{massSend:"mass-send",massReceive:"mass-receive"},exchange:"exchange",assetTransactions:{issue:"issue",reissue:"reissue",burn:"burn",sponsorship:"sponsorship"},scriptInvocation:"script-invocation"},controller=function(user,Base,$scope,transactionsCsvGen,waves,createPoll,notification){var analytics=require("data-service").analytics;return new(function(){function TransactionsCtrl(){var _this604;return _classCallCheck(this,TransactionsCtrl),(_this604=_possibleConstructorReturn(this,_getPrototypeOf(TransactionsCtrl).call(this,$scope))).isLastPage=!1,_this604.lastCursor=void 0,_this604.isPending=!0,_this604.poll=void 0,_this604.filter=void 0,_this604.transactionsHash=Object.create(null),$scope.TABS=TABS,$scope.FILTERS=FILTERS,_this604.transactions=[],_this604.internalTx="",_this604.externalTx="",_this604.activeStep=0,_this604.tabs=Object.values(TABS),_this604.activeTab=TABS.externalTx,_this604.controlsIsOpen=!1,_this604.observe(["filter"],_this604._onChangeFilter),_this604.observe("tab",_this604._onChangeTab),_this604.syncSettings({filter:"wallet.transactions.filter"}),_this604.activeTab===TABS.internalTx&&_this604._startPoll(),_this604}return _inherits(TransactionsCtrl,Base),_createClass(TransactionsCtrl,[{key:"isTransferFilter",get:function(){return Object.values(FILTERS.transfer).includes(this.filter)}},{key:"isMassTransferFilter",get:function(){return Object.values(FILTERS.massTransfer).includes(this.filter)}},{key:"isAssetTransactionsFilter",get:function(){return Object.values(FILTERS.assetTransactions).includes(this.filter)}}]),_createClass(TransactionsCtrl,[{key:"exportTransactions",value:function(argument_0){var maxTransactions=0<arguments.length&&void 0!==argument_0?argument_0:1e4;analytics.send({name:"Transactions Export Click",target:"ui"});var getSeriesTransactions=function(){var _ref286=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(){var _ref287,_ref287$allTransactio,allTransactions,_ref287$after,after,transactions,downloadError,filteredTransactions,_args20=arguments;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _ref287$allTransactio=(_ref287=0<_args20.length&&void 0!==_args20[0]?_args20[0]:{}).allTransactions,allTransactions=void 0===_ref287$allTransactio?[]:_ref287$allTransactio,_ref287$after=_ref287.after,after=void 0===_ref287$after?"":_ref287$after,downloadError=!1,_context20.prev=2,_context20.next=5,waves.node.transactions.list(1e3,after);case 5:transactions=_context20.sent,_context20.next=16;break;case 8:if(_context20.prev=8,_context20.t0=_context20.catch(2),downloadError=!0,allTransactions.length){_context20.next=14;break}return notification.error({ns:"app.wallet.transactions",title:{literal:"errors.download.title"},body:{literal:"errors.download.body"}}),_context20.abrupt("return",[]);case 14:transactions=[],notification.error({ns:"app.wallet.transactions",title:{literal:"errors.complete.title"},body:{literal:"errors.complete.body"}});case 16:if(filteredTransactions=transactions,user.getSetting("dontShowSpam")&&(filteredTransactions=transactions.filter(function(el){return!user.scam[el.assetId]})),allTransactions=allTransactions.concat(filteredTransactions),transactions.length<1e3||allTransactions.length>maxTransactions)return _context20.abrupt("return",{allTransactions:allTransactions,downloadError:downloadError});_context20.next=23;break;case 23:return _context20.abrupt("return",getSeriesTransactions({allTransactions:allTransactions,after:transactions[transactions.length-1].id}));case 24:case"end":return _context20.stop()}},_callee20,null,[[2,8]])}));return function(){return _ref286.apply(this,arguments)}}(),promiseGetTransactions=getSeriesTransactions();return promiseGetTransactions.then(function(_ref288){var allTransactions=_ref288.allTransactions,downloadError=_ref288.downloadError;allTransactions.length?transactionsCsvGen.generate(allTransactions):downloadError||notification.error({ns:"app.wallet.transactions",title:{literal:"errors.empty.title"},body:{literal:"errors.empty.body"}})}),promiseGetTransactions}},{key:"showMoreTransactions",value:function(){var _this605=this;this.poll.stop(),this._loadTransactions(this.lastCursor).then(function(data){_this605._setTxList({transactions:_this605.transactions.concat(data.transactions),isLastPage:data.isLastPage,lastCursor:data.lastCursor}),_this605.poll.play()})}},{key:"_getTxList",value:function(){var _this606=this;return this._loadNewTransactions().then(function(data){return{transactions:[].concat(_toConsumableArray(data.transactions),_toConsumableArray(_this606.transactions)),isLastPage:_this606.transactions.length?_this606.isLastPage:data.isLastPage,lastCursor:_this606.transactions.length?_this606.lastCursor:data.lastCursor}})}},{key:"_setTxList",value:function(_ref289){var transactions=_ref289.transactions,isLastPage=_ref289.isLastPage,lastCursor=_ref289.lastCursor;this.isPending=!1,this.transactions=transactions,this.isLastPage=isLastPage,this.lastCursor=lastCursor,this.transactionsHash[this.filter]={transactions:transactions,isLastPage:isLastPage,lastCursor:lastCursor},$scope.$digest()}},{key:"setActiveTab",value:function(tab){this.activeTab=tab}},{key:"toggleOpenControls",value:function(){this.controlsIsOpen=!this.controlsIsOpen}},{key:"_onChangeFilter",value:function(){var _ref290=this.transactionsHash[this.filter]||{},transactions=_ref290.transactions,isLastPage=_ref290.isLastPage,lastCursor=_ref290.lastCursor;this.transactions=transactions||[],this.isLastPage=void 0===isLastPage||isLastPage,this.lastCursor=lastCursor||"",this.tab===TABS.internalTx&&this._startPoll()}},{key:"_onChangeTab",value:function(){this.tab===TABS.internalTx?this._startPoll():this._stopPoll()}},{key:"_startPoll",value:function(){this.poll?(this.poll.stop(),this.poll.play()):this.poll=createPoll(this,this._getTxList,this._setTxList,3e4,{isBalance:!0})}},{key:"_stopPoll",value:function(){this.poll&&this.poll.stop()}},{key:"_loadTransactions",value:function(argument_0,argument_1){var after=0<arguments.length&&void 0!==argument_0?argument_0:"",limit=1<arguments.length&&void 0!==argument_1?argument_1:100;return this.isPending=!0,ds.TransactionsService.getTransactions({limit:limit,filter:this.filter,after:after},user)}},{key:"_loadNewTransactions",value:function(){var _this607=this,newTransactions=[];return function load(argument_0){var after=0<arguments.length&&void 0!==argument_0?argument_0:"";return _this607._loadTransactions(after,_this607.transactions.length?10:100).then(function(data){if(!data.transactions.length||!_this607.transactions.length)return data;var index=data.transactions.findIndex(function(_ref291){return _ref291.id===_this607.transactions[0].id});return 0<=index?{transactions:[].concat(newTransactions,_toConsumableArray(data.transactions.filter(function(tx,i){return i<index}))),isLastPage:data.isLastPage,lastCursor:data.lastCursor}:(newTransactions.push(data.transactions),load(data.lastCursor))})}()}}]),TransactionsCtrl}())};controller.$inject=["user","Base","$scope","transactionsCsvGen","waves","createPoll","notification"],angular.module("app.wallet.transactions").controller("TransactionsCtrl",controller)}(),function(){var controller=function(utils){return new(function(){function ExchangeInfo(){_classCallCheck(this,ExchangeInfo),this.signable=void 0,this.fee=void 0}return _createClass(ExchangeInfo,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.id=this.transaction.id,this.fee=utils.getExchangeFee(this.transaction),this.showSellMatcherFee=this.transaction.exchangeType===this.transaction.sellOrder.orderType,this.showBuyMatcherFee=this.transaction.exchangeType===this.transaction.buyOrder.orderType}}]),ExchangeInfo}())};controller.$inject=["utils"],angular.module("app.ui").component("wExchangeInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/exchange/info.html"})}(),function(){var controller=function(utils){return new(function(){function ReissueHeader(){_classCallCheck(this,ReissueHeader),this.signable=void 0}return _createClass(ReissueHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.quantity=this.transaction.quantity.toFormat(this.transaction.precision),this.name=this.transaction.quantity.asset.name,this.typeName=utils.getTransactionTypeName(this.transaction)}}]),ReissueHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wReissueHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/reissue/reissue-header.html"})}(),function(){var controller=function($scope,utils){var base58Encode=require("@waves/waves-transactions").libs.crypto.base58Encode;return new(function(){function TransferInfo(){_classCallCheck(this,TransferInfo),this.signable=void 0,this.isReceive=!1,this.isSend=!1,this.isSelf=!1,this.isSponsor=!1,this.attachment=""}return _createClass(TransferInfo,[{key:"$postLink",value:function(){var _this608=this;this.transaction=this.signable.getTxData();try{this.attachment=utils.bytesToSafeString(this.transaction.attachment)}catch(e){this.attachment="base58: ".concat(base58Encode(this.transaction.attachment))}switch(utils.getTransactionTypeName(this.transaction)){case WavesApp.TRANSACTION_TYPES.EXTENDED.CIRCULAR:this.isSelf=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.SEND:this.isSend=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.RECEIVE:this.isReceive=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.SPONSORSHIP_FEE:this.isSponsor=!0}(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this608.id=id,$scope.$apply()})}}]),TransferInfo}())};controller.$inject=["$scope","utils"],angular.module("app.ui").component("wTransferInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/transfer/transfer-info.html"})}(),function(){var i18next=require("i18next"),rc=require("react-components"),controller=function(reactDirective,utils,configService,baseAssetService,notification){return reactDirective(rc.ReceiveModalContentWrapper,["asset","isCryptocurrency","wavesAddress","gatewayAddress","gatewayServerError","minAmount","maxAmount","assetKeyName"],void 0,{utils:utils,i18next:i18next,configService:configService,baseAssetService:baseAssetService,notification:notification})};controller.$inject=["reactDirective","utils","configService","baseAssetService","notification"],angular.module("app.ui").directive("wReactReceiveModal",controller)}(),function(){var controller=function(Base,user,baseAssetService,waves,$scope,utils){return new(function(){function MassTransfer(){var _getPrototypeOf18,_this609;_classCallCheck(this,MassTransfer);for(var _len33=arguments.length,args=new Array(_len33),_key33=0;_key33<_len33;_key33++)args[_key33]=arguments[_key33];return(_this609=_possibleConstructorReturn(this,(_getPrototypeOf18=_getPrototypeOf(MassTransfer)).call.apply(_getPrototypeOf18,[this].concat(args)))).props=null,_this609}return _inherits(MassTransfer,Base),_createClass(MassTransfer,[{key:"$postLink",value:function(){var _this610=this;this.typeName=this.props.typeName,this.time=this.props.time,this.address=this.props.shownAddress,this.isScam=this.props.isScam,this.receive(utils.observe(this.props,"isScam"),function(){_this610.isScam=_this610.props.isScam,utils.safeApply($scope)});var TYPES=waves.node.transactions.TYPES;switch(this.typeName){case TYPES.SPONSORSHIP_FEE:this.sponsoredFee();break;default:this.transfered()}}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}},{key:"sponsoredFee",value:function(){this.assetName=this.getAssetName(this.props.fee.asset),this.amountParams={sign:"+",amount:this.props.fee.toFormat(),name:this.props.fee.asset.name}}},{key:"transfered",value:function(){var _this611=this;this.assetName=this.getAssetName(this.props.amount.asset),this.amountParams={amount:this.props.amount.toFormat(),name:this.props.amount.asset.name},this.props.amount&&this.props.amount instanceof ds.wavesDataEntities.Money&&baseAssetService.convertToBaseAsset(this.props.amount).then(function(baseMoney){var baseAssetName=baseAssetService.getBaseAssetName();_this611.mirrorBalanceParams={amount:baseMoney.toFormat(),name:baseAssetName},$scope.$digest()})}}]),MassTransfer}())};controller.$inject=["Base","user","baseAssetService","waves","$scope","utils"],angular.module("app.ui").component("wMassTransferRow",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/mass-transfer/mass-transfer.html",controller:controller})}(),function(){var controller=function(utils){return new(function(){function ExchangeHeader(){_classCallCheck(this,ExchangeHeader),this.typeName=void 0,this.signable=void 0,this.signPrice="–",this.signAmount="+",this.isScamAmount=void 0,this.isScamPrice=void 0}return _createClass(ExchangeHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction),this.totalPrice=utils.getExchangeTotalPrice(this.transaction.amount,this.transaction.price),this.signPrice="exchange-buy"===this.typeName?"–":"+",this.signAmount="exchange-buy"===this.typeName?"+":"–"}}]),ExchangeHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wExchangeHeader",{bindings:{signable:"<",isScamAmount:"<",isScamPrice:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/exchange/header.html"})}(),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function TransferHeader(){_classCallCheck(this,TransferHeader),this.typeName=void 0,this.signable=void 0,this.amount=void 0,this.name=void 0,this.needShowMirror=!1,this.mirrorBalance=void 0,this.isSponsor=!1}return _createClass(TransferHeader,[{key:"$postLink",value:function(){var _this612=this,tx=this.signable.getTxData();this.typeName=utils.getTransactionTypeName(tx),this.isSponsor=this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.SPONSORSHIP_FEE,this.amount=this.isSponsor?tx.fee.toFormat():tx.amount.toFormat(),this.name=this.isSponsor?tx.fee.asset.name:tx.amount.asset.name,this.isSponsor||tx.amount.asset.id===baseAssetService.getBaseAssetId()||baseAssetService.convertToBaseAsset(tx.amount).then(function(mirror){_this612.baseAssetName=baseAssetService.getBaseAssetName(),_this612.mirrorBalance=mirror,_this612.needShowMirror=_this612.mirrorBalance.getCoins().gt(0),_this612.equivalentText="≈ ".concat(_this612.mirrorBalance.toFormat()," ").concat(_this612.baseAssetName),"2iAvoenT8JAJNxuQXpKzmRKQbR5cGP3KYDEsGbykxsoG"===tx.assetId&&(_this612.equivalentText="".concat(_this612.amount," ").concat(_this612.baseAssetName)),$scope.$apply()})}}]),TransferHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wTransferHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/transfer/transfer-header.html"})}(),angular.module("app.ui").component("wCancelLeasing",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/cancel-leasing/cancel-leasing.html"}),function(){var controller=function($scope){return new(function(){function SetScriptInfo(){_classCallCheck(this,SetScriptInfo),this.signable=void 0,this.hasScript=!1}return _createClass(SetScriptInfo,[{key:"$postLink",value:function(){var _this613=this;this.transaction=this.signable.getTxData(),this.hasScript=!!(this.transaction.script||"").replace("base64:",""),this.transaction.script=this.transaction.script||"",(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this613.id=id,$scope.$apply()})}}]),SetScriptInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wSetScriptInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-script/info.html"})}(),function(){var Handlebars=require("handlebars"),BigNumber=require("@waves/bignumber").BigNumber,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("data-service").analytics,SELECTORS={AVAILABLE:"js-balance-available",SPONSORED:"js-sponsored-asset",IN_RESERVED:"js-balance-in-reserved",BASE_ASSET_BALANCE:"js-balance-in-base-asset",EXCHANGE_RATE:"js-exchange-rate",CHANGE_24:"js-change-24",CHART_CONTAINER:"js-chart-container",STARS_CONTAINER:"js-stars-container",BUTTONS:{SEND:"js-button-send",RECEIVE:"js-button-receive",DEX:"js-button-open-in-dex",TOGGLE_SPAM:"js-button-toggle-spam"},ACTION_BUTTONS:{ASSET_INFO:"js-action-button-asset-info",SEND:"js-action-button-send",RECEIVE:"js-action-button-receive",BURN:"js-action-button-burn",REISSUE:"js-action-button-reissue",DEX:"js-action-button-dex",TOGGLE_SPAM:"js-action-button-toggle-spam",SPONSORSHIP_CREATE:"js-action-button-sponsorship_create",SPONSORSHIP_EDIT:"js-action-button-sponsorship_edit",SPONSORSHIP_STOP:"js-action-button-cancel-sponsorship",SET_ASSET_SCRIPT:"js-action-button-set-asset-script"},SUSPICIOUS_LABEL:"js-suspicious-label"},USD_PRICE=new BigNumber(1),i18next=require("i18next"),ds=require("data-service"),controller=function(Base,$templateRequest,$element,utils,waves,user,modalManager,$state,ChartFactory,RatingStarsFactory,i18n,$scope,gatewayService,createPoll,baseAssetService){return new(function(){function PortfolioRow(){var _this614;return _classCallCheck(this,PortfolioRow),(_this614=_possibleConstructorReturn(this,_getPrototypeOf(PortfolioRow).call(this))).ChartFactory=null,_this614.$state=null,_this614.$scope=null,_this614.i18n=null,_this614.modalManager=null,_this614.$node=null,_this614.node=null,_this614.balance=null,_this614.utils=null,_this614.waves=null,_this614.user=null,_this614.canShowDex=null,_this614.gatewayService=null,_this614.createPoll=null,_this614.isSmart=!1,_this614._isMyAsset=!1,_this614.changeLanguageHandler=function(){return _this614._onChangeLanguage()},_this614.ChartFactory=ChartFactory,_this614.$state=$state,_this614.$scope=$scope,_this614.i18n=i18n,_this614.modalManager=modalManager,_this614.$node=$element,_this614.node=$element.get(0),_this614.utils=utils,_this614.waves=waves,_this614.user=user,_this614.gatewayService=gatewayService,_this614.createPoll=createPoll,PortfolioRow.templatePromise||(PortfolioRow.templatePromise=$templateRequest("modules/wallet/modules/portfolio/directives/portfolioRow/row.hbs").then(function(html){return Handlebars.compile(html)})),_this614.chartOptions={red:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#ef4829",fillColor:"#292f3c",gradientColor:["rgba(239, 72, 41, 0.1)","#292f3c"],lineWidth:1}}},blue:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#5a81ea",fillColor:"#292f3c",gradientColor:["rgba(90, 129, 234, 0.1)","#292f3c"],lineWidth:1}}},white:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#ffffff",fillColor:"#292f3c",gradientColor:["rgba(255, 255, 255, 0.1)","#292f3c"],lineWidth:1}}}},_this614}return _inherits(PortfolioRow,Base),_createClass(PortfolioRow,[{key:"$postLink",value:function(){var _this615=this;this._isWaves=this.balance.asset.id===baseAssetService.WavesAssetId,this._isMyAsset=this.balance.asset.sender===this.user.address,this.canShowDex=this._getCanShowDex();var canStopSponsored=this._getCanStopSponsored();Promise.all([this.waves.node.getFeeList({type:SIGN_TYPE.TRANSFER}),PortfolioRow.templatePromise]).then(function(_ref292){var _ref293=_slicedToArray(_ref292,2),list=_ref293[0],template=_ref293[1],balance=_this615.balance;_this615.isSmart=balance.asset.hasScript;var firstAssetChar=_this615.balance.asset.name.slice(0,1),canPayFee=list.find(function(item){return item.asset.id===_this615.balance.asset.id})&&!_this615._isWaves,_utils$getDataFromOra10=utils.getDataFromOracles(_this615.balance.asset.id),isVerified=_utils$getDataFromOra10.isVerified,isGateway=_utils$getDataFromOra10.isGateway,isTokenomica=_utils$getDataFromOra10.isTokenomica,logo=_utils$getDataFromOra10.logo,isGatewaySoon=_utils$getDataFromOra10.isGatewaySoon,isStable=_utils$getDataFromOra10.isStable,isInvestment=_utils$getDataFromOra10.isInvestment,isDefi=_utils$getDataFromOra10.isDefi;_this615.isGateway=isGateway,_this615.isWEST=_this615.balance.asset.id===baseAssetService.WCTAssetId,_this615.isVerifiedOrGateway=isVerified||isGateway||isGatewaySoon||isStable;var html=template({canSetAssetScript:_this615._isMyAsset&&_this615.isSmart,isSmart:_this615.isSmart,isVerified:isVerified,isStable:isStable,isGateway:isGateway,isTokenomica:isTokenomica,isWEST:_this615.isWEST,isGatewaySoon:isGatewaySoon,isInvestment:isInvestment,isDefi:isDefi,assetIconPath:logo||_this615.utils.getAssetLogo(_this615.balance.asset.id),firstAssetChar:firstAssetChar,canBurn:!_this615._isWaves,canReissue:_this615._isMyAsset&&_this615.balance.asset.reissuable,charColor:_this615.utils.getAssetLogoBackground(_this615.balance.asset.id),assetName:_this615.balance.asset.name,SELECTORS:_objectSpread({},SELECTORS),canShowDex:_this615.canShowDex,canShowToggleSpam:_this615._canShowToggleSpam(),canSponsored:_this615._isMyAsset,canPayFee:canPayFee,canStopSponsored:canStopSponsored});_this615.node.innerHTML=html,Object.defineProperty(_this615,"balance",{get:function(){return balance},set:function(value){_this615.balance.asset.id===value.asset.id&&_this615.balance.available.getTokens().eq(value.available.getTokens())&&_this615.balance.inOrders.getTokens().eq(value.inOrders.getTokens())&&_this615.balance.isOnScamList===value.isOnScamList||(balance=value,_this615._onUpdateBalance()),_this615._initSponsorShips()}}),_this615._poll=createPoll(_this615,_this615._initSponsorShips,angular.noop,5e3),_this615._onUpdateBalance(),_this615._setHandlers(),_this615.changeLanguageHandler()})}},{key:"$onDestroy",value:function(){_get(_getPrototypeOf(PortfolioRow.prototype),"$onDestroy",this).call(this),this.$node.off()}},{key:"_onChangeLanguage",value:function(){var _this616=this,nodeList=this.node.querySelectorAll("[w-i18n-literal]");this._updateBalances(),Array.prototype.forEach.call(nodeList,function(element){element.innerHTML=_this616.i18n.translate(element.getAttribute("w-i18n-literal"),"app.wallet.portfolio")})}},{key:"_getCanStopSponsored",value:function(){var _this617=this;return this._isMyAsset&&ds.utils.getTransferFeeList().find(function(item){return item.asset.id===_this617.balance.asset.id})}},{key:"_getCanShowDex",value:function(){var _utils$getDataFromOra11=utils.getDataFromOracles(this.balance.asset.id),isVerified=_utils$getDataFromOra11.isVerified,isGateway=_utils$getDataFromOra11.isGateway,isStable=_utils$getDataFromOra11.isStable,isGatewaySoon=_utils$getDataFromOra11.isGatewaySoon;return!utils.isLockedInDex(this.balance.asset.id)&&(this.balance.isPinned||isVerified||isGateway||isStable||isGatewaySoon||this._isMyAsset||this.balance.asset.isMyAsset||this.balance.asset.id===baseAssetService.WavesAssetId||this.gatewayService.getPurchasableWithCards()[this.balance.asset.id]||this.gatewayService.getCryptocurrencies()[this.balance.asset.id]||this.gatewayService.getFiats()[this.balance.asset.id])}},{key:"_onUpdateBalance",value:function(){var _this618=this;this._updateBalances(),this._initSpamState();var defaultAssets=baseAssetService.getDefaultAssetsHashId(),balance=this.balance;if(balance.isOnScamList)return this.node.querySelector(".".concat(SELECTORS.CHANGE_24)).innerHTML="—",this.node.querySelector(".".concat(SELECTORS.BASE_ASSET_BALANCE)).innerHTML="—",this.node.querySelector(".".concat(SELECTORS.EXCHANGE_RATE)).innerHTML="—",this.node.querySelector(".".concat(SELECTORS.SUSPICIOUS_LABEL)).classList.remove("hidden"),null;var suspiciousSelector=this.node.querySelector(".".concat(SELECTORS.SUSPICIOUS_LABEL));suspiciousSelector&&suspiciousSelector.classList.add("hidden");var baseAssetId=baseAssetService.getBaseAssetId(),baseAssetPrecision=baseAssetService.getBaseAssetPrecision(),change24Node=this.node.querySelector(".".concat(SELECTORS.CHANGE_24)),change24BN=balance.change24,isMoreZero=change24BN.gt(0),isLessZero=change24BN.lt(0);if(baseAssetId===balance.asset.id||balance.asset.id===defaultAssets.USDT)change24Node.innerHTML="0%",change24Node.classList.remove("minus"),change24Node.classList.remove("plus"),this.node.querySelector(".".concat(SELECTORS.BASE_ASSET_BALANCE)).innerHTML=balance.available.getTokens().mul(USD_PRICE).toFixed(baseAssetPrecision),this.node.querySelector(".".concat(SELECTORS.EXCHANGE_RATE)).innerHTML=USD_PRICE.toFixed(baseAssetPrecision);else{change24Node.classList.toggle("minus",isLessZero),change24Node.classList.toggle("plus",isMoreZero),change24Node.innerHTML="".concat(balance.change24.toFixed(2),"%"),this.node.querySelector(".".concat(SELECTORS.BASE_ASSET_BALANCE)).innerHTML=balance.amount.toFixed(baseAssetPrecision),this.node.querySelector(".".concat(SELECTORS.EXCHANGE_RATE)).innerHTML=balance.rate.toFixed(baseAssetPrecision);var startDate=this.utils.moment().add(-7,"days");this.waves.utils.getRateHistory(balance.asset.id,baseAssetId,startDate).then(function(values){var options,chartData={rate:values.map(function(item){return _objectSpread({},item,{rate:Number(item.rate.toFixed())})})};switch(!0){case isLessZero:options=_this618.chartOptions.red;break;case isMoreZero:options=_this618.chartOptions.blue;break;default:options=_this618.chartOptions.white}_this618.chart=new _this618.ChartFactory(_this618.$node.find(".".concat(SELECTORS.CHART_CONTAINER)),options,chartData)}).catch(function(){return null}),null===balance.rating||this.isGateway||balance.asset.id===baseAssetService.WavesAssetId||new RatingStarsFactory({$container:this.$node.find(".".concat(SELECTORS.STARS_CONTAINER)),rating:balance.rating,size:"s"})}}},{key:"_initActions",value:function(){var _this619=this,expanded=!1,$wrapper=this.$node.find(".actions__container"),toggleExpanded=function(){expanded=!expanded;var conteiner=_this619.$node.find(".actions__container"),conteinerNode=conteiner.get(0);if(conteiner.toggleClass("expanded",expanded),expanded){$(document).on("mousedown",_handler);var dropDownPosition=conteinerNode.getBoundingClientRect(),bodyPosition=document.body.getBoundingClientRect();conteinerNode.classList.toggle("to-up",dropDownPosition.bottom>bodyPosition.bottom)}else $(document).off("mousedown",_handler),conteinerNode.classList.remove("to-up")},_handler=function(e){0===$(e.target).closest($wrapper).length&&toggleExpanded()};this.$node.find(".actions__click").on("click",function(){toggleExpanded()}),this.$scope.$on("$destroy",function(){$(document).off("mousedown",_handler)})}},{key:"_setHandlers",value:function(){var _this620=this;this._initActions(),this.listenEventEmitter(i18next,"languageChanged",this.changeLanguageHandler),this.$node.on("click",".".concat(SELECTORS.BUTTONS.SEND),function(){analytics.send({name:"Transfer Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showSendAsset({assetId:_this620.balance.asset.id})}),this.$node.on("click",".".concat(SELECTORS.BUTTONS.DEX),function(){analytics.send({name:"Wallet Portfolio Open in DEX Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.utils.isLockedInDexSmartAssets(_this620.balance.asset,ds.api.assets.wavesAsset)?_this620.modalManager.showSmartPairModal(_this620.balance.asset.ticker||_this620.balance.asset.displayName,"WAVES"):_this620.utils.openDex(_this620.balance.asset.ticker||_this620.balance.asset.id)}),this.$node.on("click",".".concat(SELECTORS.BUTTONS.RECEIVE),function(){analytics.send({name:"Transfer Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showReceiveModal(_this620.balance.asset)}),this.$node.on("click",".".concat(SELECTORS.BUTTONS.TOGGLE_SPAM),function(){_this620.user.toggleSpamAsset(_this620.balance.asset.id),_this620._initSpamState()}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.ASSET_INFO),function(){_this620.modalManager.showAssetInfo(_this620.balance.asset)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.SEND),function(){analytics.send({name:"Transfer Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showSendAsset({assetId:_this620.balance.asset.id})}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.RECEIVE),function(){analytics.send({name:"Transfer Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showReceiveModal(_this620.balance.asset)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.BURN),function(){analytics.send({name:"Burn Token Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showBurnModal(_this620.balance.asset.id,_this620.onShowBuyFiatModal)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.REISSUE),function(){analytics.send({name:"Reissue Token Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showReissueModal(_this620.balance.asset.id,_this620.onShowBuyFiatModal)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.DEX),function(){analytics.send({name:"Wallet Portfolio Open in DEX Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.utils.isLockedInDexSmartAssets(_this620.balance.asset,ds.api.assets.wavesAsset)?_this620.modalManager.showSmartPairModal(_this620.balance.asset.ticker||_this620.balance.asset.displayName,"WAVES"):_this620.utils.openDex(_this620.balance.asset.ticker||_this620.balance.asset.id)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.SPONSORSHIP_CREATE),function(){analytics.send({name:"Enable Sponsorship Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showSponsorshipModal(_this620.balance.asset.id,!1,_this620.onShowBuyFiatModal)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.SET_ASSET_SCRIPT),function(){analytics.send({name:"Update Script Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showSetAssetScriptModal(_this620.balance.asset.id)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.SPONSORSHIP_EDIT),function(){analytics.send({name:"Change Sponsorship Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showSponsorshipModal(_this620.balance.asset.id,!0,_this620.onShowBuyFiatModal)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.SPONSORSHIP_STOP),function(){analytics.send({name:"Disable Sponsorship Click",params:{Currency:_this620.balance.asset.id},target:"ui"}),_this620.modalManager.showSponsorshipStopModal(_this620.balance.asset.id,_this620.onShowBuyFiatModal)}),this.$node.on("click",".".concat(SELECTORS.ACTION_BUTTONS.TOGGLE_SPAM),function(){_this620.user.toggleSpamAsset(_this620.balance.asset.id),_this620._initSpamState()})}},{key:"_initSpamState",value:function(){if(!this._canShowToggleSpam())return null;var isSpam=(this.user.getSetting("wallet.portfolio.spam")||[]).includes(this.balance.asset.id);[this.node.querySelector(".".concat(SELECTORS.BUTTONS.TOGGLE_SPAM)),this.node.querySelector(".".concat(SELECTORS.ACTION_BUTTONS.TOGGLE_SPAM))].forEach(function(toggleSpam){toggleSpam&&(toggleSpam.classList.toggle("icon-hide",!isSpam),toggleSpam.classList.toggle("icon-show",isSpam))})}},{key:"_initSponsorShips",value:function(list){var _this621=this,canStopSponsored=!!this._getCanStopSponsored(),canSponsored=!!this._isMyAsset,isSmart=this.isSmart,btnCreate=this.node.querySelector(".".concat(SELECTORS.ACTION_BUTTONS.SPONSORSHIP_CREATE)),btnEdit=this.node.querySelector(".".concat(SELECTORS.ACTION_BUTTONS.SPONSORSHIP_EDIT)),btnStop=this.node.querySelector(".".concat(SELECTORS.ACTION_BUTTONS.SPONSORSHIP_STOP)),icon=this.node.querySelector(".".concat(SELECTORS.SPONSORED," .asset-logo__marker"));btnCreate.classList.toggle("hidden",isSmart||!(canSponsored&&!canStopSponsored)),btnEdit.classList.toggle("hidden",!(canSponsored&&canStopSponsored)),btnStop.classList.toggle("hidden",isSmart||!canStopSponsored),Promise.resolve(list||this.waves.node.getFeeList({type:SIGN_TYPE.TRANSFER})).then(function(list){var canPayFee=list.find(function(item){return item.asset.id===_this621.balance.asset.id})&&!_this621._isWaves;icon.classList.toggle("asset-logo__marker_sponsored",!!canPayFee)})}},{key:"_updateBalances",value:function(){var asset=this.balance.asset,available=this.balance.available.getTokens(),inOrders=this.balance.inOrders.getTokens(),leasedOut=this.balance.leasedOut.getTokens(),availableHtml=this.utils.getNiceNumberTemplate(available,asset.precision,!0),inReservedHtml=this.utils.getNiceNumberTemplate(inOrders.add(leasedOut),asset.precision);this.node.querySelector(".".concat(SELECTORS.AVAILABLE)).innerHTML=availableHtml,this.node.querySelector(".".concat(SELECTORS.IN_RESERVED)).innerHTML=inReservedHtml}},{key:"_canShowToggleSpam",value:function(){return!this._isMyAsset&&(!this.isVerifiedOrGateway&&!this.user.scam[this.balance.asset.id])}}]),PortfolioRow}())($templateRequest,$element,utils,waves,user,modalManager,$state,ChartFactory,RatingStarsFactory,i18n,$scope,gatewayService,createPoll,baseAssetService)};controller.$inject=["Base","$templateRequest","$element","utils","waves","user","modalManager","$state","ChartFactory","RatingStarsFactory","i18n","$scope","gatewayService","createPoll","baseAssetService"],angular.module("app.wallet.portfolio").component("wPortfolioRow",{controller:controller,bindings:{balance:"<",canShowDex:"<",onShowBuyFiatModal:"&"},scope:!1})}(),function(){var controller=function(utils){return new(function(){function SetScriptHeader(){_classCallCheck(this,SetScriptHeader),this.signable=void 0}return _createClass(SetScriptHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction)}}]),SetScriptHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wSetScriptHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-script/header.html"})}(),function(){var Money=require("@waves/data-entities").Money,controller=function(SingleSend,$scope,configService,waves,utils){var ds=require("data-service");return new(function(){function BankSend(props){var _this622;return _classCallCheck(this,BankSend),(_this622=_possibleConstructorReturn(this,_getPrototypeOf(BankSend).call(this,props))).termsIsPending=!0,_this622.termsLoadError=!1,_this622.termsAccepted=!1,_this622.maxCoinomatAmount=null,_this622.onChangeMode=null,_this622.wavesTx.recipient=ds.config.get("bankRecipient"),_this622}return _inherits(BankSend,SingleSend),_createClass(BankSend,[{key:"isBankAccepted",get:function(){return!configService.get("PERMISSIONS.CANT_TRANSFER_GATEWAY").includes(this.balance.asset.id)}},{key:"isBankPendingOrError",get:function(){return this.termsLoadError||this.termsIsPending}}]),_createClass(BankSend,[{key:"$postLink",value:function(){var _this623=this,onHasMoneyHash=function(){_this623.receive(utils.observe(_this623.tx,"fee"),_this623._onChangeFee,_this623),_this623.receive(utils.observe(_this623.tx,"amount"),_this623._onChangeAmount,_this623),_this623.receive(utils.observe(_this623.state,"assetId"),_this623._onChangeAssetId,_this623),_this623.receive(utils.observe(_this623.state,"mirrorId"),_this623._onChangeMirrorId,_this623),_this623.observe("mirror",_this623._onChangeAmountMirror),_this623.receive(utils.observe(_this623.tx,"amount"),_this623._updateWavesTxObject,_this623),_this623.receive(utils.observe(_this623.tx,"attachment"),_this623._updateWavesTxObject,_this623),_this623._onChangeBaseAssets(),_this623._onChangeFee(),_this623._updateWavesTxObject(),_this623._setMinAndMaxAmount(),_this623._validateForm()};this.state.moneyHash?onHasMoneyHash():this.receiveOnce(utils.observe(this.state,"moneyHash"),onHasMoneyHash),this.receive(utils.observe(this.state,"moneyHash"),function(){_this623._onChangeBaseAssets(),_this623._onChangeFee(),_this623._setMinAndMaxAmount(),_this623._validateForm()}),$scope.$watch("$ctrl.bankSend.amount",function(){return _this623._validateForm()})}},{key:"setSendMode",value:function(mode){this.onChangeMode({mode:mode})}},{key:"createTx",value:function(){var attachmentString=this.tx.attachment?this.tx.attachment.toString():"",tx=waves.node.transactions.createTransaction(_objectSpread({},this.tx,{recipient:ds.config.get("bankRecipient"),attachment:utils.stringToBytes(attachmentString),amount:this.tx.amount}));return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"_setMinAndMaxAmount",value:function(){var maxCoinomatAmount=this.balance.cloneWithTokens(5e4),minCoinomatAmount=this.balance.cloneWithTokens(100);this.maxAmount=Money.min(maxCoinomatAmount,this.balance),this.minAmount=minCoinomatAmount,this.maxCoinomatAmount=maxCoinomatAmount}},{key:"_validateForm",value:function(){this.bankSend.amount&&this.tx.amount.getTokens().gt(0)&&this.bankSend.amount.$setTouched(!0)}},{key:"_updateWavesTxObject",value:function(){var attachmentString=this.tx.attachment?this.tx.attachment.toString():"";this.wavesTx=_objectSpread({},this.wavesTx,{attachment:utils.stringToBytes(attachmentString),amount:this.tx.amount,assetId:this.assetId})}},{key:"_onChangeAssetId",value:function(){_get(_getPrototypeOf(BankSend.prototype),"_onChangeAssetId",this).call(this),this._setMinAndMaxAmount(),this._validateForm()}}]),BankSend}())($scope)};controller.$inject=["SingleSend","$scope","configService","waves","utils"],angular.module("app.ui").component("wBankSend",{bindings:{state:"<",onSign:"&",onChangeMode:"&"},templateUrl:"modules/utils/modals/sendAsset/components/singleSend/bankSend/bank-send.html",transclude:!0,controller:controller})}(),function(){var controller=function(waves){return new(function(){function SetAssetScript(){_classCallCheck(this,SetAssetScript),this.props=null}return _createClass(SetAssetScript,[{key:"$postLink",value:function(){var _this624=this;this.props.assetId&&waves.node.assets.getAsset(this.props.assetId).then(function(asset){_this624.name=asset.name})}}]),SetAssetScript}())};controller.$inject=["waves"],angular.module("app.ui").component("wSetAssetScript",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/set-asset-script/set-asset-script.html",controller:controller})}(),function(){var controller=function($scope){return new(function(){function SponsorshipInfo(){_classCallCheck(this,SponsorshipInfo),this.signable=void 0}return _createClass(SponsorshipInfo,[{key:"$postLink",value:function(){var _this625=this;this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this625.id=id,$scope.$apply()})}}]),SponsorshipInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wSponsorshipInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/sponsorship/info.html"})}(),function(){var controller=function(Base,$scope,user){return new(function(){function MigrationAchivementModalCtrl(){var _this626;return _classCallCheck(this,MigrationAchivementModalCtrl),(_this626=_possibleConstructorReturn(this,_getPrototypeOf(MigrationAchivementModalCtrl).call(this,$scope))).address=user.address,_this626.hasAchivement=user.hasUserMigrationAchievement(),_this626}return _inherits(MigrationAchivementModalCtrl,Base),MigrationAchivementModalCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.utils").controller("MigrationAchivementModalCtrl",controller)}(),function(){var controller=function($scope){return new(function(){function CancelLeaseInfo(){_classCallCheck(this,CancelLeaseInfo),this.signable=void 0}return _createClass(CancelLeaseInfo,[{key:"$postLink",value:function(){var _this627=this;this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this627.id=id,$scope.$apply()})}}]),CancelLeaseInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wCancelLeaseInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/cancel-lease/info.html"})}(),function(){var controller=function($scope){return new(function(){function CreateAliasInfo(){_classCallCheck(this,CreateAliasInfo),this.signable=void 0}return _createClass(CreateAliasInfo,[{key:"$postLink",value:function(){var _this628=this;this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this628.id=id,$scope.$apply()})}}]),CreateAliasInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wCreateAliasInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/create-alias/create-alias-info.html"})}(),function(){var controller=function($scope){return new(function(){function CreateOrderInfo(){_classCallCheck(this,CreateOrderInfo),this.signable=void 0}return _createClass(CreateOrderInfo,[{key:"$postLink",value:function(){var _this629=this;this.order=this.signable.getTxData(),this.signable.getId().then(function(id){_this629.id=id,$scope.$apply()})}}]),CreateOrderInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wCreateOrderInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/create-order/createOrder.html"})}(),function(){var ds=require("data-service"),analytics=require("data-service").analytics,controller=function(SingleSend,$scope,utils,waves,user,configService,baseAssetService,outerBlockchains,gatewayService){return new(function(){function WavesSend(){var _getPrototypeOf19,_this630;_classCallCheck(this,WavesSend);for(var _len34=arguments.length,args=new Array(_len34),_key34=0;_key34<_len34;_key34++)args[_key34]=arguments[_key34];return(_this630=_possibleConstructorReturn(this,(_getPrototypeOf19=_getPrototypeOf(WavesSend)).call.apply(_getPrototypeOf19,[this].concat(args)))).onChangeMode=null,_this630.sendDescription=!1,_this630.submitClicked=!1,_this630.sendPlaceholderParams=void 0,_this630}return _inherits(WavesSend,SingleSend),_createClass(WavesSend,[{key:"$postLink",value:function(){var _this631=this;this.receive(utils.observe(this.tx,"recipient"),this.onChangeRecipient,this),this._setPlaceholder();var onHasMoneyHash=function(){_this631.receive(utils.observe(_this631.tx,"fee"),_this631._onChangeFee,_this631),_this631.receive(utils.observe(_this631.tx,"amount"),_this631._onChangeAmount,_this631),_this631.receive(utils.observe(_this631.state,"assetId"),_this631._onChangeAssetId,_this631),_this631.receive(utils.observe(_this631.state,"mirrorId"),_this631._onChangeMirrorId,_this631),_this631.observe("mirror",_this631._onChangeAmountMirror),_this631.receive(utils.observe(_this631.tx,"amount"),_this631._updateWavesTxObject,_this631),_this631.receive(utils.observe(_this631.tx,"recipient"),_this631._updateWavesTxObject,_this631),_this631.receive(utils.observe(_this631.tx,"attachment"),_this631._updateWavesTxObject,_this631),_this631.onChangeRecipient(),_this631._onChangeFee(),_this631._setMinAndMaxAmount(),_this631._onChangeBaseAssets(),_this631._updateWavesTxObject(),_this631._fillMirror()};this.state.moneyHash?onHasMoneyHash():this.receiveOnce(utils.observe(this.state,"moneyHash"),onHasMoneyHash),this.receive(utils.observe(this.state,"moneyHash"),function(){_this631._onChangeFee(),_this631._setMinAndMaxAmount(),_this631._onChangeBaseAssets()}),$scope.$watch("$ctrl.wavesSend.amount",function(){return _this631._validateForm()}),$scope.$watch("$ctrl.wavesSend.recipient",function(){_this631.tx.recipient&&_this631.wavesSend.recipient.$$element.focus()}),this.sendDescription=Boolean(this.tx&&this.tx.attachment)}},{key:"setSendMode",value:function(mode){this.onChangeMode({mode:mode})}},{key:"onChangeDescCheckbox",value:function(){this.tx.attachment="",analytics.sendAsset.toggleShowDescription(this.sendDescription?"Hide":"Show")}},{key:"createTx",value:function(){if(this.submitClicked=!0,!this.hasFee)return Promise.reject();var attachmentString=this.tx.attachment?this.tx.attachment.toString():"",tx=waves.node.transactions.createTransaction(_objectSpread({},this.tx,{attachment:utils.stringToBytes(attachmentString)}));return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"_setPlaceholder",value:function(){var _this632=this,defaultAsset=ds.utils.ConfigService.getConfig("defaultAssets").find(function(_ref294){return _ref294.assetId===_this632.state.assetId});if(defaultAsset){var outerChain=outerBlockchains[this.state.assetId],blockchainName=gatewayService.getBlockChainName(defaultAsset);outerChain&&blockchainName?(this.sendPlaceholderParams={blockchainName:blockchainName},this.sendPlaceholder="modal.send.placeholderRecipientOuter"):this.sendPlaceholder="modal.send.placeholderRecipientWaves"}else this.sendPlaceholder="modal.send.placeholderRecipientWaves"}},{key:"_updateWavesTxObject",value:function(){var attachmentString=this.tx.attachment?this.tx.attachment.toString():"",isWavesAddress=user.isValidAddress(this.tx.recipient);this.wavesTx=_objectSpread({},this.wavesTx,{recipient:isWavesAddress&&this.tx.recipient||"",attachment:utils.stringToBytes(attachmentString),amount:this.tx.amount,assetId:this.assetId})}},{key:"_validateForm",value:function(){var amountGtZero=this.tx.amount&&this.tx.amount.getTokens().gt(0);this.wavesSend.amount&&(amountGtZero||this.tx.recipient)&&this.wavesSend.amount.$setTouched(!0)}},{key:"_setMinAndMaxAmount",value:function(){this.minAmount=this.balance.cloneWithTokens("0"),this.maxAmount=this.balance}},{key:"_onChangeAssetId",value:function(){_get(_getPrototypeOf(WavesSend.prototype),"_onChangeAssetId",this).call(this),this._setMinAndMaxAmount(),this._setPlaceholder()}},{key:"canSendToBank",get:function(){return(configService.get("gateways.coinomat.fiat")||[]).reduce(function(acc,item){return acc[baseAssetService.getIdByTicker(item.name)]=item.isEnable,acc},{})[this.assetId]||!1}}]),WavesSend}())($scope)};controller.$inject=["SingleSend","$scope","utils","waves","user","configService","baseAssetService","outerBlockchains","gatewayService"],angular.module("app.ui").component("wWavesSend",{bindings:{state:"<",onSign:"&",onChangeMode:"&",onChangeRecipient:"&",onShowBuyFiatModal:"&"},templateUrl:"modules/utils/modals/sendAsset/components/singleSend/wavesSend/waves-send.html",transclude:!0,controller:controller})}(),function(){var rc=require("react-components"),controller=function(reactDirective,user,balanceWatcher,modalManager,utils,$state,notification,baseAssetService,$transitions,storage){return reactDirective(rc.StakingStablecoins,void 0,void 0,{user:user,balanceWatcher:balanceWatcher,modalManager:modalManager,utils:utils,$state:$state,notification:notification,baseAssetService:baseAssetService,$transitions:$transitions,storage:storage})};controller.$inject=["reactDirective","user","balanceWatcher","modalManager","utils","$state","notification","baseAssetService","$transitions","storage"],angular.module("app.staking").directive("stakingStablecoinsDirective",controller)}(),function(){var controller=function(ConfirmTxService,$scope){return new(function(){function ConfirmGatewayTransaction(props){var _this633;return _classCallCheck(this,ConfirmGatewayTransaction),(_this633=_possibleConstructorReturn(this,_getPrototypeOf(ConfirmGatewayTransaction).call(this,props))).targetRecipient="",_this633.gatewayDetails=null,_this633.observe(["gatewayDetails","tx"],function(){if(!_this633.gatewayDetails||!_this633.tx)return null;var fee=_this633.tx.amount.cloneWithTokens(_this633.gatewayDetails.gatewayFee);_this633.tx.amount=_this633.tx.amount.sub(fee)}),_this633}return _inherits(ConfirmGatewayTransaction,ConfirmTxService),_createClass(ConfirmGatewayTransaction,[{key:"getEventName",value:function(){return"Gateway"}}]),ConfirmGatewayTransaction}())($scope)};controller.$inject=["ConfirmTxService","$scope"],angular.module("app.ui").component("wConfirmGatewayTransaction",{bindings:{signable:"<",gatewayDetails:"<",targetRecipient:"<",onClickBack:"&",onTxSent:"&",blockchainName:"<"},templateUrl:"modules/ui/directives/confirmGatewayTransaction/confirmGatewayTransaction.html",scope:!1,transclude:!1,controller:controller})}(),function(){var controller=function(utils){return new(function(){function SponsorshipHeader(){_classCallCheck(this,SponsorshipHeader),this.signable=void 0}return _createClass(SponsorshipHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction)}}]),SponsorshipHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wSponsorshipHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/sponsorship/header.html"})}(),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function CancelLeaseHeader(){_classCallCheck(this,CancelLeaseHeader),this.signable=void 0,this.mirrorBalance=void 0,this.needShowMirror=!1}return _createClass(CancelLeaseHeader,[{key:"$postLink",value:function(){var _this634=this;this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction),this.transaction.lease.amount.asset.id!==baseAssetService.getBaseAssetId()&&baseAssetService.convertToBaseAsset(this.transaction.lease.amount).then(function(mirror){_this634.baseAssetName=baseAssetService.getBaseAssetName(),_this634.mirrorBalance=mirror,_this634.needShowMirror=_this634.mirrorBalance.getCoins().gt(0),$scope.$apply()})}}]),CancelLeaseHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wCancelLeaseHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/cancel-lease/header.html"})}(),function(){var controller=function(utils){return new(function(){function ExchangeHeader(){_classCallCheck(this,ExchangeHeader),this.typeName=void 0,this.signable=void 0,this.signPrice="–",this.signAmount="+"}return _createClass(ExchangeHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName="create-order",this.totalPrice=utils.getExchangeTotalPrice(this.transaction.amount,this.transaction.price),this.signPrice="exchange-buy"===this.typeName?"–":"+",this.signAmount="exchange-buy"===this.typeName?"+":"–"}}]),ExchangeHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wCreateOrderHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/create-order/createOrderHeader.html"})}(),function(){var controller=function($scope,utils){var base58Encode=require("@waves/waves-transactions").libs.crypto.base58Encode;return new(function(){function MassTransferInfo(){_classCallCheck(this,MassTransferInfo),this.signable=void 0,this.isSend=!1,this.isReceive=!1,this.showAllTX=!1,this.expandList=!1,this.attachment=""}return _createClass(MassTransferInfo,[{key:"$postLink",value:function(){var _this635=this;this.transaction=this.signable.getTxData();try{this.attachment=utils.bytesToSafeString(this.transaction.attachment)}catch(e){this.attachment="base58:".concat(base58Encode(this.transaction.attachment))}switch(utils.getTransactionTypeName(this.transaction)){case WavesApp.TRANSACTION_TYPES.EXTENDED.MASS_SEND:this.isSend=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.MASS_RECEIVE:this.isReceive=!0}(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this635.id=id,$scope.$apply()})}}]),MassTransferInfo}())};controller.$inject=["$scope","utils"],angular.module("app.ui").component("wMassTransferInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/mass-transfer/info.html"})}(),angular.module("app.ui").component("wScriptInvocation",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/script-invocation/script-invocation.html"}),function(){var controller=function(Base,$element,$injector){return new(function(){function ContainerAlertNotification(){var _this636;return _classCallCheck(this,ContainerAlertNotification),(_this636=_possibleConstructorReturn(this,_getPrototypeOf(ContainerAlertNotification).call(this))).type=null,_this636}return _inherits(ContainerAlertNotification,Base),_createClass(ContainerAlertNotification,[{key:"$postLink",value:function(){if(!this.type)throw new Error("Can't find type!");var notification=$injector.get(this.type);this.receive(notification.changeSignal,this._onChangeNotifications,this),this._onChangeNotifications(notification.getActiveNotificationsList())}},{key:"_onChangeNotifications",value:function(list){$element.children().detach().end().append(list.map(function(_ref295){return _ref295.$element}))}}]),ContainerAlertNotification}())};controller.$inject=["Base","$element","$injector"],angular.module("app").component("wContainerAlertNotification",{bindings:{type:"@"},transclude:!1,controller:controller})}(),function(){var tsUtils=require("ts-utils"),controller=function(){return new(function(){function UpdateAssetInfoRow(){_classCallCheck(this,UpdateAssetInfoRow),this.props=null}return _createClass(UpdateAssetInfoRow,[{key:"$postLink",value:function(){this.assetName=tsUtils.get(this.props,"name"),this.name=tsUtils.get(this.props,"name"),this.description=tsUtils.get(this.props,"description")}}]),UpdateAssetInfoRow}())};controller.$inject=[],angular.module("app.ui").component("wUpdateAssetInfoRow",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/update-asset-info/update-asset-info-row.html",controller:controller})}(),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function MassTransferHeader(){_classCallCheck(this,MassTransferHeader),this.typeName=void 0,this.signable=void 0,this.amount=void 0,this.name=void 0,this.needShowMirror=!1,this.mirrorBalance=void 0}return _createClass(MassTransferHeader,[{key:"$postLink",value:function(){var _this637=this,tx=this.signable.getTxData();this.typeName=utils.getTransactionTypeName(tx),this.amount=tx.amount.toFormat(),this.name=tx.amount.asset.name,tx.amount.asset.id!==baseAssetService.getBaseAssetId()&&baseAssetService.convertToBaseAsset(tx.amount).then(function(mirror){_this637.baseAssetName=baseAssetService.getBaseAssetName(),_this637.baseAssetPrecision=baseAssetService.getBaseAssetPrecision(),_this637.mirrorBalance=mirror,_this637.needShowMirror=_this637.mirrorBalance.getCoins().gt(0),$scope.$apply()})}}]),MassTransferHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wMassTransferHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/mass-transfer/header.html"})}(),(accessSecurityInformationCtrl=function($mdDialog,user){var onValid=this.locals.onValid;this.password="",this.showPasswordError=!1,this.onSubmit=function(){var _this638=this;this.showPasswordError=!1,user.checkPassword(this.password).then(function(){"function"==typeof onValid&&onValid(),$mdDialog.hide()}).catch(function(){_this638.password="",_this638.showPasswordError=!0})}}).$inject=["$mdDialog","user"],angular.module("app.utils").controller("AccessSecurityInformationCtrl",accessSecurityInformationCtrl),function(){var Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,controller=function(SingleSend,$scope,utils,user,waves,gatewayService,configService,baseAssetService){return new(function(){function GatewaySend(){var _getPrototypeOf20,_this639;_classCallCheck(this,GatewaySend);for(var _len35=arguments.length,args=new Array(_len35),_key35=0;_key35<_len35;_key35++)args[_key35]=arguments[_key35];return(_this639=_possibleConstructorReturn(this,(_getPrototypeOf20=_getPrototypeOf(GatewaySend)).call.apply(_getPrototypeOf20,[this].concat(args)))).gatewayDetailsError=!1,_this639.gatewayInvalidAddress=!1,_this639.gatewayAddressInUse=!1,_this639.gatewayAddressNotExist=!1,_this639.gatewaySmartAddress=!1,_this639.maxGatewayAmount=null,_this639.isIgnoredWithdrawMax=!1,_this639.errorMsg="",_this639}return _inherits(GatewaySend,SingleSend),_createClass(GatewaySend,[{key:"$postLink",value:function(){var _this640=this;this.receive(utils.observe(this.tx,"recipient"),this._onUpdateRecipient,this),this._checkIsIgnoredWithdrawMax();var onHasMoneyHash=function(){_this640.receive(utils.observe(_this640.tx,"fee"),_this640._onChangeFee,_this640),_this640.receive(utils.observe(_this640.tx,"amount"),_this640._onChangeAmount,_this640),_this640.receive(utils.observe(_this640.state,"assetId"),_this640._onChangeAssetId,_this640),_this640.receive(utils.observe(_this640.state,"mirrorId"),_this640._onChangeMirrorId,_this640),_this640.receive(utils.observe(_this640.state,"paymentId"),_this640.updateGatewayData,_this640),_this640.observe("mirror",_this640._onChangeAmountMirror),_this640.receive(utils.observe(_this640.tx,"amount"),_this640._updateWavesTxObject,_this640),_this640.receive(utils.observe(_this640.tx,"recipient"),_this640._updateWavesTxObject,_this640),_this640.receive(utils.observe(_this640.state,"gatewayData"),_this640._onUpdateGatewayData,_this640),_this640._onChangeFee(),_this640._fillMirror()};this.state.moneyHash?onHasMoneyHash():this.receiveOnce(utils.observe(this.state,"moneyHash"),onHasMoneyHash),this.receive(utils.observe(this.state,"moneyHash"),function(){_this640._onChangeFee()}),$scope.$watch("$ctrl.gatewaySend.recipient",function(){_this640.tx.recipient&&_this640.gatewaySend.recipient.$$element.focus()}),this.state.gatewayData&&this._onUpdateGatewayData()}},{key:"isMoneroNotIntegratedAddress",value:function(){return this.assetId===baseAssetService.getIdByTicker("XMR")&&95===this.tx.recipient.length}},{key:"createTx",value:function(){var fee=this.tx.amount.cloneWithTokens(this.gatewayDetails.gatewayFee),tx=waves.node.transactions.createTransaction(_objectSpread({},this.tx,{recipient:this.gatewayDetails.address,attachment:utils.stringToBytes(this.gatewayDetails.attachment),amount:this.tx.amount.add(fee)}));return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"openIntercom",value:function(){window.Intercom("show")}},{key:"_onUpdateGatewayData",value:function(){var _this$state$gatewayDa=this.state.gatewayData,details=_this$state$gatewayDa.details,error=_this$state$gatewayDa.error;if(this._skipErrors(),details){var max=this.isIgnoredWithdrawMax?this.balance.getTokens():BigNumber.min(details.maximumAmount.add(details.gatewayFee),this.balance.getTokens());this.minAmount=this.balance.cloneWithTokens(details.minimumAmount),this.maxAmount=this.balance.cloneWithTokens(max),this.maxGatewayAmount=Money.fromTokens(details.maximumAmount,this.balance.asset),this._onChangeGatewayDetails()}else if(error){var asset=this.balance.asset,type="withdraw";gatewayService.isInvalidAddressError(error,asset,type)?this.gatewayInvalidAddress=!0:gatewayService.isAddressInUseError(error,asset,type)?(this.gatewayAddressInUse=!0,this.errorMsg="ms-0067"):gatewayService.isAddressNotExistError(error,asset,type)?(this.gatewayAddressNotExist=!0,this.errorMsg="ms-0068"):gatewayService.isSmartAddressError(error,asset,type)?(this.gatewaySmartAddress=!0,this.errorMsg="ms-0069"):this.gatewayDetailsError=!0}else this.gatewayDetailsError=!0;utils.safeApply($scope)}},{key:"_onUpdateRecipient",value:function(){this.onChangeRecipient(),this.updateGatewayData()}},{key:"_onChangeFee",value:function(){var feeList,feeHash,balanceHash,_this641=this,details=this.gatewayDetails;if(details){var gatewayFee=this.balance.cloneWithTokens(details.gatewayFee);this.feeList=[this.tx.fee,gatewayFee],feeList=this.feeList.concat(this.balance.cloneWithTokens(details.minimumAmount)),feeHash=utils.groupMoney(feeList),balanceHash=_this641.moneyHash,_this641.hasFee=Object.keys(feeHash).every(function(feeAssetId){var fee=feeHash[feeAssetId];return balanceHash[fee.asset.id]&&balanceHash[fee.asset.id].gte(fee)})}}},{key:"_updateWavesTxObject",value:function(){if(this.gatewayDetails&&this.tx.amount){var fee=this.tx.amount?this.tx.amount.cloneWithTokens(this.gatewayDetails.gatewayFee):null;this.wavesTx=_objectSpread({},this.wavesTx,{recipient:this.gatewayDetails.address,attachment:utils.stringToBytes(this.gatewayDetails.attachment),amount:this.tx.amount.add(fee),assetId:this.assetId})}}},{key:"_onChangeGatewayDetails",value:function(){this._updateWavesTxObject(),this._onChangeFee(),this._validateForm()}},{key:"_validateForm",value:function(){this.tx.amount&&this.tx.amount.getTokens().gt(0)&&this.gatewaySend.amount&&this.gatewaySend.amount.$setTouched(!0)}},{key:"_onChangeAssetId",value:function(){_get(_getPrototypeOf(GatewaySend.prototype),"_onChangeAssetId",this).call(this),this.updateGatewayData(),this._checkIsIgnoredWithdrawMax()}},{key:"_checkIsIgnoredWithdrawMax",value:function(){this.isIgnoredWithdrawMax=gatewayService.checkIsIgnoredWithdrawMax(this.balance.asset)}},{key:"_skipErrors",value:function(){this.gatewayDetailsError=!1,this.gatewayInvalidAddress=!1,this.gatewayAddressInUse=!1,this.gatewayAddressNotExist=!1,this.gatewaySmartAddress=!1}},{key:"gatewayDetails",get:function(){return this.state.gatewayData.details}},{key:"paymentId",get:function(){return this.state.paymentId}},{key:"isGatewayAccepted",get:function(){return!configService.get("PERMISSIONS.CANT_TRANSFER_GATEWAY").includes(this.balance.asset.id)}},{key:"gatewayError",get:function(){return this.gatewayDetailsError||this.gatewayInvalidAddress||this.gatewayAddressInUse||this.gatewayAddressNotExist||this.gatewaySmartAddress}},{key:"blockchainName",get:function(){return gatewayService.getBlockChainName(this.balance.asset)}}]),GatewaySend}())($scope)};controller.$inject=["SingleSend","$scope","utils","user","waves","gatewayService","configService","baseAssetService"],angular.module("app.ui").component("wGatewaySend",{bindings:{state:"<",onSign:"&",onChangeRecipient:"&",updateGatewayData:"&"},templateUrl:"modules/utils/modals/sendAsset/components/singleSend/gatewaySend/gateway-send.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base){return new(function(){function UpdateAssetInfo(){var _getPrototypeOf21,_this642;_classCallCheck(this,UpdateAssetInfo);for(var _len36=arguments.length,args=new Array(_len36),_key36=0;_key36<_len36;_key36++)args[_key36]=arguments[_key36];return(_this642=_possibleConstructorReturn(this,(_getPrototypeOf21=_getPrototypeOf(UpdateAssetInfo)).call.apply(_getPrototypeOf21,[this].concat(args)))).signable=void 0,_this642}return _inherits(UpdateAssetInfo,Base),_createClass(UpdateAssetInfo,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData()}}]),UpdateAssetInfo}())};controller.$inject=["Base"],angular.module("app.ui").component("wUpdateAssetInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/update-asset-info/update-asset-info.html"})}(),function(){var controller=function($element){return new(function(){function DataInfo(){_classCallCheck(this,DataInfo),this.signable=void 0,this.dataVisible=!1,this.allVisible=!1,this.function=void 0,this.json=void 0,this.payment=void 0,this.paymentAssetName=void 0,this.assetId=void 0,this.args=void 0}return _createClass(DataInfo,[{key:"$postLink",value:function(){var _this643=this;this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this643.id=id}),this.json=JSON.stringify(this.transaction.call&&this.transaction.call.args||[],null,4),this.paymentList=this.transaction.payment.map(function(payment){return{assetName:payment.asset.displayName,assetId:payment.asset.id,paymentString:"".concat(payment.getTokens().toFormat()," ").concat(payment.asset.displayName)}}),this.transaction.call&&(this.args=this.transaction.call.args.map(function(item){return"list"===item.type?_objectSpread({},item,{value:JSON.stringify(item.value)}):item}))}},{key:"toggleAll",value:function(){this.allVisible=!this.allVisible,$element.find(".transaction-details__list").stop().animate({scrollTop:0},300)}},{key:"toggleVisible",value:function(){this.allVisible=!1,this.dataVisible=!this.dataVisible}}]),DataInfo}())};controller.$inject=["$element"],angular.module("app.ui").component("wScriptInvocationInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/script-invocation/script-invocation-info.html"})}(),function(){var ds=require("data-service"),controller=function($scope,$element){return new(function(){function SetAssetScriptInfo(){_classCallCheck(this,SetAssetScriptInfo),this.signable=void 0,this.asset=void 0,this.shownScript=!1,this.$container=void 0}return _createClass(SetAssetScriptInfo,[{key:"$postLink",value:function(){var _this644=this;this.transaction=this.signable.getTxData(),this.transaction.script=this.transaction.script||"",this.$container=$element.find(".js-script-container"),this.$container.hide(),ds.api.assets.get(this.transaction.assetId).then(function(asset){_this644.asset=asset,$scope.$apply()}),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this644.id=id,$scope.$apply()})}},{key:"toggleScript",value:function(){this.shownScript=!this.shownScript,this.$container.stop(!0,!0).slideToggle(100)}}]),SetAssetScriptInfo}())};controller.$inject=["$scope","$element"],angular.module("app.ui").component("wSetAssetScriptInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-asset-script/info.html"})}(),function(){var controller=function(utils){return new(function(){function SetScriptAssetHeader(){_classCallCheck(this,SetScriptAssetHeader),this.signable=void 0}return _createClass(SetScriptAssetHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction)}}]),SetScriptAssetHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wSetScriptAssetHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-asset-script/header.html"})}(),function(){var controller=function(){return new function UpdateAssetInfoHeader(){_classCallCheck(this,UpdateAssetInfoHeader)}};controller.$inject=[],angular.module("app.ui").component("wUpdateAssetInfoHeader",{controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/update-asset-info/update-asset-info-header.html"})}(),angular.module("app.ui").component("wScriptInvocationHeader",{bindings:{typeName:"<"},templateUrl:"modules/ui/directives/transactionInfo/types/script-invocation/script-invocation-header.html"})}();